- rules:
  - id: plaintext-http-link
    languages:
    - html
    message: This link points to a plaintext HTTP URL. Prefer an encrypted HTTPS URL
      if possible.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://cwe.mitre.org/data/definitions/319.html
      subcategory:
      - vuln
      technology:
      - html
    patterns:
    - pattern: <a href="$URL">...</a>
    - metavariable-regex:
        metavariable: $URL
        regex: ^(?i)http://
    severity: WARNING
- rules:
  - id: eval-detected
    languages:
    - html
    message: 'Detected the use of eval(...). This can introduce  a Cross-Site-Scripting
      (XSS) vulnerability if this  comes from user-provided input. Follow OWASP best  practices
      to ensure you handle XSS within a JavaScript context correct, and consider using
      safer APIs to evaluate  user-input such as JSON.parse(...). '
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
      subcategory:
      - audit
      technology:
      - browser
    patterns:
    - pattern-inside: '<script ...>$...A</script>

        '
    - metavariable-pattern:
        language: javascript
        metavariable: $...A
        patterns:
        - pattern-either:
          - pattern: $X(...)
        - pattern-not: $X("...")
        - metavariable-regex:
            metavariable: $X
            regex: ^(eval)$
        - focus-metavariable: $X
    severity: WARNING
- rules:
  - id: insecure-document-method
    languages:
    - html
    message: Detected the use of an inner/outerHTML assignment.  This can introduce
      a Cross-Site-Scripting (XSS) vulnerability if this  comes from user-provided
      input. If you have to use a dangerous web API,  consider using a sanitization
      library such as DOMPurify to sanitize  the HTML before it is assigned.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - browser
    patterns:
    - pattern-inside: '<script ...>$...A</script>

        '
    - metavariable-pattern:
        language: javascript
        metavariable: $...A
        patterns:
        - pattern-either:
          - patterns:
            - pattern-either:
              - pattern: $X. ... .innerHTML = ...
              - pattern: $X. ... .outerHTML = ...
            - pattern-not: $X. ... .$V = "..."
        - focus-metavariable: $X
    severity: WARNING
- rules:
  - id: missing-integrity
    languages:
    - generic
    message: "This tag is missing an 'integrity' subresource integrity attribute.\
      \ The 'integrity' attribute allows for the browser to verify that externally\
      \ hosted files (for example from a CDN) are delivered without unexpected manipulation.\
      \ Without this attribute, if an attacker can modify the externally hosted resource,\
      \ this could lead to XSS and other types of attacks. To prevent this, include\
      \ the base64-encoded cryptographic hash of the resource (file) you\u2019re telling\
      \ the browser to fetch in the 'integrity' attribute for all externally hosted\
      \ files."
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-353: Missing Support for Integrity Check'
      impact: LOW
      likelihood: LOW
      owasp:
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
      subcategory:
      - audit
      technology:
      - html
    paths:
      include:
      - '*.html'
    patterns:
    - pattern-either:
      - pattern: <script $...A >...</script>
      - pattern: <link $...A >
    - metavariable-pattern:
        metavariable: $...A
        patterns:
        - pattern-either:
          - pattern: src='... :// ...'
          - pattern: src="... :// ..."
          - pattern: href='... :// ...'
          - pattern: href="... :// ..."
          - pattern: src='//...'
          - pattern: src="//..."
          - pattern: href='//...'
          - pattern: href="//..."
        - pattern-not-regex: (?is).*integrity=
        - pattern-not-regex: (google-analytics\.com|fonts\.googleapis\.com|fonts\.gstatic\.com|googletagmanager\.com)
        - pattern-not-regex: .*rel\s*=\s*['"]?preconnect.*
    severity: WARNING
