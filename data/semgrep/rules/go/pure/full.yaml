- rules:
  - id: grpc-server-insecure-connection
    languages:
    - go
    message: Found an insecure gRPC server without 'grpc.Creds()' or options with
      credentials. This allows for a connection without encryption to this server.
      A malicious attacker could tamper with the gRPC message, which could compromise
      the machine. Include credentials derived from an SSL certificate in order to
      create a secure gRPC connection. You can create credentials using 'credentials.NewServerTLSFromFile("cert.pem",
      "cert.key")'.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-300: Channel Accessible by Non-Endpoint'
      impact: LOW
      likelihood: LOW
      owasp:
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://blog.gopheracademy.com/advent-2019/go-grps-and-tls/#connection-without-encryption
      subcategory:
      - audit
      technology:
      - grpc
    mode: taint
    pattern-sinks:
    - pattern: grpc.NewServer($OPT, ...)
      requires: OPTIONS and not CREDS
    - pattern: grpc.NewServer()
      requires: EMPTY_CONSTRUCTOR
    pattern-sources:
    - label: OPTIONS
      pattern: grpc.ServerOption{ ... }
    - label: CREDS
      pattern: grpc.Creds(...)
    - label: EMPTY_CONSTRUCTOR
      pattern: grpc.NewServer()
    severity: ERROR
- rules:
  - fix-regex:
      regex: (.*)WithInsecure\(.*?\)
      replacement: \1WithTransportCredentials(credentials.NewTLS(<your_tls_config_here>))
    id: grpc-client-insecure-connection
    languages:
    - go
    message: 'Found an insecure gRPC connection using ''grpc.WithInsecure()''. This
      creates a connection without encryption to a gRPC server. A malicious attacker
      could tamper with the gRPC message, which could compromise the machine. Instead,
      establish a secure connection with an SSL certificate using the ''grpc.WithTransportCredentials()''
      function. You can create a create credentials using a ''tls.Config{}'' struct
      with ''credentials.NewTLS()''. The final fix looks like this: ''grpc.WithTransportCredentials(credentials.NewTLS(<config>))''.'
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-300: Channel Accessible by Non-Endpoint'
      impact: LOW
      likelihood: LOW
      owasp:
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://blog.gopheracademy.com/advent-2019/go-grps-and-tls/#connection-without-encryption
      subcategory:
      - audit
      technology:
      - grpc
    pattern: $GRPC.Dial($ADDR, ..., $GRPC.WithInsecure(...), ...)
    severity: ERROR
- rules:
  - id: websocket-missing-origin-check
    languages:
    - go
    message: 'The Origin header in the HTTP WebSocket handshake is used to guarantee
      that the connection accepted by the WebSocket is from a trusted origin domain.
      Failure to enforce can lead to Cross Site Request Forgery (CSRF). As per "gorilla/websocket"
      documentation: "A CheckOrigin function should carefully validate the request
      origin to prevent cross-site request forgery."'
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-352: Cross-Site Request Forgery (CSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://pkg.go.dev/github.com/gorilla/websocket#Upgrader
      subcategory:
      - audit
      technology:
      - gorilla
    patterns:
    - pattern-inside: 'import ("github.com/gorilla/websocket")

        ...

        '
    - patterns:
      - pattern-not-inside: '$UPGRADER = websocket.Upgrader{..., CheckOrigin: $FN
          ,...}

          ...

          '
      - pattern-not-inside: '$UPGRADER.CheckOrigin = $FN2

          ...

          '
      - pattern: '$UPGRADER.Upgrade(...)

          '
    severity: WARNING
- rules:
  - fix-regex:
      regex: (SameSite\s*:\s+)http.SameSiteNoneMode
      replacement: \1http.SameSiteDefaultMode
    id: session-cookie-samesitenone
    languages:
    - go
    message: Found SameSiteNoneMode setting in Gorilla session options. Consider setting
      SameSite to Lax, Strict or Default for enhanced security.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-1275: Sensitive Cookie with Improper SameSite Attribute'
      impact: LOW
      likelihood: LOW
      owasp:
      - A05:2021 - Security Misconfiguration
      references:
      - https://pkg.go.dev/github.com/gorilla/sessions#Options
      subcategory:
      - audit
      technology:
      - gorilla
    patterns:
    - pattern-inside: "&sessions.Options{\n  ...,\n  SameSite: http.SameSiteNoneMode,\n\
        \  ...,\n}\n"
    - pattern: "&sessions.Options{\n  ...,\n}\n"
    severity: WARNING
- rules:
  - fix-regex:
      regex: (HttpOnly\s*:\s+)false
      replacement: \1true
    id: session-cookie-missing-httponly
    languages:
    - go
    message: A session cookie was detected without setting the 'HttpOnly' flag. The
      'HttpOnly' flag for cookies instructs the browser to forbid client-side scripts
      from reading the cookie which mitigates XSS attacks. Set the 'HttpOnly' flag
      by setting 'HttpOnly' to 'true' in the Options struct.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-1004: Sensitive Cookie Without ''HttpOnly'' Flag'
      impact: LOW
      likelihood: LOW
      owasp:
      - A05:2021 - Security Misconfiguration
      references:
      - https://github.com/0c34/govwa/blob/139693e56406b5684d2a6ae22c0af90717e149b8/user/session/session.go#L69
      subcategory:
      - audit
      technology:
      - gorilla
    patterns:
    - pattern-not-inside: "&sessions.Options{\n  ...,\n  HttpOnly: true,\n  ...,\n\
        }\n"
    - pattern: "&sessions.Options{\n  ...,\n}\n"
    severity: WARNING
- rules:
  - id: handler-assignment-from-multiple-sources
    languages:
    - go
    message: 'Variable $VAR is assigned from two different sources: ''$Y'' and ''$R''.
      Make sure this is intended, as this could cause logic bugs if they are treated
      as they are the same object.'
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-289: Authentication Bypass by Alternate Name'
      impact: MEDIUM
      likelihood: LOW
      references:
      - https://cwe.mitre.org/data/definitions/289.html
      subcategory:
      - audit
      technology:
      - gorilla
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern: '$Y, err := store.Get(...)

          ...

          $VAR := $Y.Values[...]

          ...

          $VAR = $R

          '
      - focus-metavariable: $R
    - patterns:
      - pattern: '$Y, err := store.Get(...)

          ...

          var $VAR $INT = $Y.Values["..."].($INT)

          ...

          $VAR = $R

          '
      - focus-metavariable: $R
    pattern-sources:
    - patterns:
      - pattern-inside: "func $HANDLER(..., $R *http.Request, ...) {\n  ...\n}\n"
      - focus-metavariable: $R
      - pattern-either:
        - pattern: $R.query
    severity: WARNING
- rules:
  - fix-regex:
      regex: (Secure\s*:\s+)false
      replacement: \1true
    id: session-cookie-missing-secure
    languages:
    - go
    message: A session cookie was detected without setting the 'Secure' flag. The
      'secure' flag for cookies prevents the client from transmitting the cookie over
      insecure channels such as HTTP. Set the 'Secure' flag by setting 'Secure' to
      'true' in the Options struct.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-614: Sensitive Cookie in HTTPS Session Without ''Secure'' Attribute'
      impact: LOW
      likelihood: LOW
      owasp:
      - A05:2021 - Security Misconfiguration
      references:
      - https://github.com/0c34/govwa/blob/139693e56406b5684d2a6ae22c0af90717e149b8/user/session/session.go#L69
      subcategory:
      - audit
      technology:
      - gorilla
    patterns:
    - pattern-not-inside: "&sessions.Options{\n  ...,\n  Secure: true,\n  ...,\n}\n"
    - pattern: "&sessions.Options{\n  ...,\n}\n"
    severity: WARNING
- rules:
  - id: gorm-dangerous-method-usage
    languages:
    - go
    message: Detected usage of dangerous method $METHOD which does not escape inputs
      (see link in references). If the argument is user-controlled, this can lead
      to SQL injection. When using $METHOD function, do not trust user-submitted data
      and only allow approved list of input (possibly, use an allowlist approach).
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      interfile: true
      likelihood: HIGH
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://gorm.io/docs/security.html#SQL-injection-Methods
      - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
      subcategory:
      - vuln
      technology:
      - gorm
    mode: taint
    options:
      interfile: true
    pattern-sanitizers:
    - pattern-either:
      - pattern: strconv.Atoi(...)
      - pattern: '($X: bool)

          '
    pattern-sinks:
    - patterns:
      - pattern-inside: 'import ("gorm.io/gorm")

          ...

          '
      - patterns:
        - pattern-inside: "func $VAL(..., $GORM *gorm.DB,... ) {\n  ...\n}\n"
        - pattern-either:
          - pattern: '$GORM. ... .$METHOD($VALUE)

              '
          - pattern: '$DB := $GORM. ... .$ANYTHING(...)

              ...

              $DB. ... .$METHOD($VALUE)

              '
      - focus-metavariable: $VALUE
      - metavariable-regex:
          metavariable: $METHOD
          regex: ^(Order|Exec|Raw|Group|Having|Distinct|Select|Pluck)$
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: '($REQUEST : http.Request).$ANYTHING

            '
        - pattern: '($REQUEST : *http.Request).$ANYTHING

            '
      - metavariable-regex:
          metavariable: $ANYTHING
          regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
    severity: WARNING
- rules:
  - id: hardcoded-jwt-key
    languages:
    - go
    message: A hard-coded credential was detected. It is not recommended to store
      credentials in source-code, as this risks secrets being leaked and used by either
      an internal or external malicious adversary. It is recommended to use environment
      variables to securely provide credentials or retrieve credentials from a secure
      vault or HSM (Hardware Security Module).
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-798: Use of Hard-coded Credentials'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      interfile: true
      likelihood: HIGH
      owasp:
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
      subcategory:
      - vuln
      technology:
      - jwt
      - secrets
    mode: taint
    options:
      interfile: true
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: '$TOKEN.SignedString($F)

            '
      - focus-metavariable: $F
    pattern-sources:
    - patterns:
      - pattern-inside: '[]byte("$F")

          '
    severity: WARNING
- rules:
  - id: jwt-go-none-algorithm
    languages:
    - go
    message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm
      assumes the integrity of the token has already been verified. This would allow
      a malicious actor to forge a JWT token that will automatically be verified.
      Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as
      'HS256'.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
      subcategory:
      - audit
      technology:
      - jwt
    patterns:
    - pattern-either:
      - pattern-inside: 'import "github.com/golang-jwt/jwt"

          ...

          '
      - pattern-inside: 'import "github.com/dgrijalva/jwt-go"

          ...

          '
    - pattern-either:
      - pattern: 'jwt.SigningMethodNone

          '
      - pattern: jwt.UnsafeAllowNoneSignatureType
    severity: ERROR
- rules:
  - id: jwt-go-parse-unverified
    languages:
    - go
    message: Detected the decoding of a JWT token without a verify step. Don't use
      `ParseUnverified` unless you know what you're doing This method parses the token
      but doesn't validate the signature. It's only ever useful in cases where you
      know the signature is valid (because it has been checked previously in the stack)
      and you want to extract values from it.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-345: Insufficient Verification of Data Authenticity'
      impact: LOW
      likelihood: LOW
      owasp:
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
      source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
      subcategory:
      - audit
      technology:
      - jwt
    patterns:
    - pattern-inside: 'import "github.com/dgrijalva/jwt-go"

        ...

        '
    - pattern: '$JWT.ParseUnverified(...)

        '
    severity: WARNING
- rules:
  - id: tainted-sql-string
    languages:
    - go
    message: Detected user input used to manually construct a SQL string. This is
      usually bad practice because manual construction could accidentally result in
      a SQL injection. An attacker could use a SQL injection to steal or modify contents
      of the database. Instead, use a parameterized query which is available by default
      in most database engines. Alternatively, consider using an object-relational
      mapper (ORM) such as Sequelize which will protect your queries.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/www-community/attacks/SQL_Injection
      subcategory:
      - vuln
      technology:
      - aws-lambda
    mode: taint
    pattern-sanitizers:
    - pattern: strconv.Atoi(...)
    pattern-sinks:
    - patterns:
      - pattern-either:
        - patterns:
          - pattern: '"$SQLSTR" + ...

              '
          - metavariable-regex:
              metavariable: $SQLSTR
              regex: (?i)(\s*select|\s*delete|\s*insert|\s*create|\s*update|\s*alter|\s*drop).*
        - patterns:
          - pattern-either:
            - pattern: fmt.Fprintf($F, "$SQLSTR", ...)
            - pattern: fmt.Sprintf("$SQLSTR", ...)
            - pattern: fmt.Printf("$SQLSTR", ...)
          - metavariable-regex:
              metavariable: $SQLSTR
              regex: \s*(?i)(select|delete|insert|create|update|alter|drop)\b.*%(v|s|q).*
      - pattern-not-inside: 'log.$PRINT(...)

          '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: 'func $HANDLER($CTX $CTXTYPE, $EVENT $TYPE, ...) {...}

            ...

            lambda.Start($HANDLER, ...)

            '
        - patterns:
          - pattern-inside: 'func $HANDLER($EVENT $TYPE) {...}

              ...

              lambda.Start($HANDLER, ...)

              '
          - pattern-not-inside: 'func $HANDLER($EVENT context.Context) {...}

              ...

              lambda.Start($HANDLER, ...)

              '
      - focus-metavariable: $EVENT
    severity: ERROR
- rules:
  - id: database-sqli
    languages:
    - go
    message: Detected SQL statement that is tainted by `$EVENT` object. This could
      lead to SQL injection if the variable is user-controlled and not properly sanitized.
      In order to prevent SQL injection, use parameterized queries or prepared statements
      instead. You can use prepared statements with the 'Prepare' and 'PrepareContext'
      calls.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://pkg.go.dev/database/sql#DB.Query
      subcategory:
      - vuln
      technology:
      - aws-lambda
      - database
      - sql
    mode: taint
    pattern-sinks:
    - patterns:
      - focus-metavariable: $QUERY
      - pattern-either:
        - pattern: $DB.Exec($QUERY,...)
        - pattern: $DB.ExecContent($QUERY,...)
        - pattern: $DB.Query($QUERY,...)
        - pattern: $DB.QueryContext($QUERY,...)
        - pattern: $DB.QueryRow($QUERY,...)
        - pattern: $DB.QueryRowContext($QUERY,...)
      - pattern-inside: 'import "database/sql"

          ...

          '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: 'func $HANDLER($CTX $CTXTYPE, $EVENT $TYPE, ...) {...}

            ...

            lambda.Start($HANDLER, ...)

            '
        - patterns:
          - pattern-inside: 'func $HANDLER($EVENT $TYPE) {...}

              ...

              lambda.Start($HANDLER, ...)

              '
          - pattern-not-inside: 'func $HANDLER($EVENT context.Context) {...}

              ...

              lambda.Start($HANDLER, ...)

              '
      - focus-metavariable: $EVENT
    severity: WARNING
- rules:
  - id: dangerous-execution
    languages:
    - go
    message: Detected non-static script inside otto VM. Audit the input to 'VM.Run'.
      If unverified user data can reach this call site, this is a code injection vulnerability.
      A malicious actor can inject a malicious script to execute arbitrary code.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - otto
      - vm
    patterns:
    - pattern-inside: '$VM = otto.New(...)

        ...

        '
    - pattern-not: $VM.Run("...", ...)
    - pattern: $VM.Run(...)
    severity: ERROR
- rules:
  - id: exported_loop_pointer
    languages:
    - go
    message: '`$VALUE` is a loop pointer that may be exported from the loop. This
      pointer is shared between loop iterations, so the exported reference will always
      point to the last loop value, which is likely unintentional. To fix, copy the
      pointer to a new pointer within the loop.'
    metadata:
      category: correctness
      references:
      - https://github.com/kyoh86/looppointer
      technology:
      - go
    pattern-either:
    - pattern: "for _, $VALUE := range $SOURCE {\n  <... &($VALUE) ...>\n}\n"
    - pattern: "for _, $VALUE := range $SOURCE {\n  <... func() { <... &$VALUE ...>\
        \ } ...>\n}\n"
    - pattern: "for _, $VALUE := range $SOURCE {\n  <... $ANYTHING(..., <... &$VALUE\
        \ ...>, ...) ...>\n}\n"
    severity: WARNING
- rules:
  - id: use-filepath-join
    languages:
    - go
    message: '`path.Join(...)` always joins using a forward slash. This may cause
      issues on Windows or other systems using a different delimiter. Use `filepath.Join(...)`
      instead which uses OS-specific path separators.'
    metadata:
      category: correctness
      confidence: LOW
      impact: HIGH
      likelihood: LOW
      references:
      - https://parsiya.net/blog/2019-03-09-path.join-considered-harmful/
      - https://go.dev/src/path/path.go?s=4034:4066#L145
      subcategory:
      - audit
      technology:
      - go
    mode: taint
    pattern-sanitizers:
    - pattern: 'url.Parse(...)

        ...

        '
    pattern-sinks:
    - pattern: path.Join(...)
    pattern-sources:
    - patterns:
      - pattern: '($STR : string)

          '
      - pattern-not: '"..."

          '
    - patterns:
      - pattern-inside: 'import "path"

          ...

          '
      - pattern: path.$FUNC(...)
      - metavariable-regex:
          metavariable: $FUNC
          regex: ^(Base|Clean|Dir|Split)$
    - patterns:
      - pattern-inside: 'import "path/filepath"

          ...

          '
      - pattern: filepath.$FUNC(...)
      - metavariable-regex:
          metavariable: $FUNC
          regex: ^(Base|Clean|Dir|FromSlash|Glob|Rel|Split|SplitList|ToSlash|VolumeName)$
    severity: WARNING
- rules:
  - id: eqeq-is-bad
    languages:
    - go
    message: Detected useless comparison operation `$X == $X` or `$X != $X`. This
      will always return 'True' or 'False' and therefore is not necessary. Instead,
      remove this comparison operation or use another comparison expression that is
      not deterministic.
    metadata:
      category: correctness
      technology:
      - go
    patterns:
    - pattern-not-inside: assert(...)
    - pattern-either:
      - pattern: $X == $X
      - pattern: $X != $X
    - pattern-not: 1 == 1
    severity: INFO
  - id: hardcoded-eq-true-or-false
    languages:
    - go
    message: Detected useless if statement. 'if (True)' and 'if (False)' always result
      in the same behavior, and therefore is not necessary in the code. Remove the
      'if (False)' expression completely or just the 'if (True)' comparison depending
      on which expression is in the code.
    metadata:
      category: correctness
      technology:
      - go
    pattern-either:
    - pattern: if (true) { ... }
    - pattern: if (false) { ... }
    severity: INFO
- rules:
  - fix: '0600

      '
    id: incorrect-default-permission
    languages:
    - go
    message: Detected file permissions that are set to more than `0600` (user/owner
      can read and write). Setting file permissions to higher than `0600` is most
      likely unnecessary and violates the principle of least privilege. Instead, set
      permissions to be `0600` or less for os.Chmod, os.Mkdir, os.OpenFile, os.MkdirAll,
      and ioutil.WriteFile
    metadata:
      category: correctness
      cwe: 'CWE-276: Incorrect Default Permissions'
      references:
      - https://github.com/securego/gosec/blob/master/rules/fileperms.go
      source_rule_url: https://github.com/securego/gosec
      technology:
      - go
    patterns:
    - pattern-either:
      - pattern: os.Chmod($NAME, $PERM)
      - pattern: os.Mkdir($NAME, $PERM)
      - pattern: os.OpenFile($NAME, $FLAG, $PERM)
      - pattern: os.MkdirAll($NAME, $PERM)
      - pattern: ioutil.WriteFile($NAME, $DATA, $PERM)
    - metavariable-comparison:
        base: 8
        comparison: $PERM > 0o600
        metavariable: $PERM
    - focus-metavariable:
      - $PERM
    severity: WARNING
- rules:
  - id: integer-overflow-int16
    languages:
    - go
    message: Detected conversion of the result of a strconv.Atoi command to an int16.
      This could lead to an integer overflow, which could possibly result in unexpected
      behavior and even privilege escalation. Instead, use `strconv.ParseInt`.
    metadata:
      category: correctness
      technology:
      - go
    patterns:
    - pattern: '$F, $ERR := strconv.Atoi($NUM)

        ...

        int16($F)

        '
    - metavariable-comparison:
        comparison: $NUM > 32767 or $NUM < -32768
        metavariable: $NUM
        strip: true
    severity: WARNING
  - id: integer-overflow-int32
    languages:
    - go
    message: Detected conversion of the result of a strconv.Atoi command to an int32.
      This could lead to an integer overflow, which could possibly result in unexpected
      behavior and even privilege escalation. Instead, use `strconv.ParseInt`.
    metadata:
      category: correctness
      technology:
      - go
    patterns:
    - pattern: '$F, $ERR := strconv.Atoi($NUM)

        ...

        int32($F)

        '
    - metavariable-comparison:
        comparison: $NUM > 2147483647 or $NUM < -2147483648
        metavariable: $NUM
        strip: true
    severity: WARNING
- rules:
  - id: useless-if-conditional
    languages:
    - go
    message: Detected an if block that checks for the same condition on both branches
      (`$X`). The second condition check is useless as it is the same as the first,
      and therefore can be removed from the code,
    metadata:
      category: maintainability
      technology:
      - go
    pattern: "if ($X) {\n    ...\n} else if ($X) {\n    ...\n}\n"
    severity: WARNING
  - id: useless-if-body
    languages:
    - go
    message: Detected identical statements in the if body and the else body of an
      if-statement. This will lead to the same code being executed no matter what
      the if-expression evaluates to. Instead, remove the if statement.
    metadata:
      category: maintainability
      technology:
      - go
    pattern: "if ($X) {\n    $S\n} else {\n    $S\n}\n"
    severity: WARNING
- rules:
  - id: channel-guarded-with-mutex
    languages:
    - go
    message: Detected a channel guarded with a mutex. Channels already have an internal
      mutex, so this is unnecessary. Remove the mutex. See https://hackmongo.com/page/golang-antipatterns/#guarded-channel
      for more information.
    metadata:
      category: best-practice
      technology:
      - go
    pattern-either:
    - pattern: '$MUX.Lock()

        $VALUE <- $CHANNEL

        $MUX.Unlock()

        '
    - pattern: '$MUX.Lock()

        $VALUE = <- $CHANNEL

        $MUX.Unlock()

        '
    severity: WARNING
- rules:
  - id: hidden-goroutine
    languages:
    - go
    message: Detected a hidden goroutine. Function invocations are expected to synchronous,
      and this function will execute asynchronously because all it does is call a
      goroutine. Instead, remove the internal goroutine and call the function using
      'go'.
    metadata:
      category: best-practice
      technology:
      - go
    patterns:
    - pattern-not: "func $FUNC(...) {\n  go func() {\n    ...\n  }(...)\n  $MORE\n\
        }\n"
    - pattern: "func $FUNC(...) {\n  go func() {\n    ...\n  }(...)\n}\n"
    severity: WARNING
- rules:
  - id: shared-url-struct-mutation
    languages:
    - go
    message: Shared URL struct may have been accidentally mutated. Ensure that this
      behavior is intended.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-436: Interpretation Conflict'
      impact: LOW
      likelihood: LOW
      references:
      - https://github.com/golang/go/issues/63777
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-inside: 'import "net/url"

        ...

        '
    - pattern-not-inside: '... = url.Parse(...)

        ...

        '
    - pattern-not-inside: '... = url.ParseRequestURI(...)

        ...

        '
    - pattern-not-inside: '... = url.URL{...}

        ...

        '
    - pattern-not-inside: 'var $URL *$X.URL

        ...

        '
    - pattern-either:
      - pattern: $URL.RawQuery = ...
      - pattern: $URL.Path = ...
      - pattern: $URL.RawPath = ...
      - pattern: $URL.Fragment = ...
      - pattern: $URL.RawFragment = ...
      - pattern: $URL.Scheme = ...
      - pattern: $URL.Opaque = ...
      - pattern: $URL.Host = ...
      - pattern: $URL.User = ...
    - metavariable-pattern:
        metavariable: $URL
        patterns:
        - pattern-not: $X.$Y
        - pattern-not: $X[...]
    severity: WARNING
- rules:
  - id: path-traversal-inside-zip-extraction
    languages:
    - go
    message: File traversal when extracting zip archive
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path
        Traversal'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A05:2017 - Broken Access Control
      - A01:2021 - Broken Access Control
      references:
      - https://owasp.org/Top10/A01_2021-Broken_Access_Control
      source_rule_url: https://github.com/securego/gosec/issues/205
      subcategory:
      - audit
      technology:
      - go
    pattern: "reader, $ERR := zip.OpenReader($ARCHIVE)\n...\nfor _, $FILE := range\
      \ reader.File {\n  ...\n  path := filepath.Join($TARGET, $FILE.Name)\n  ...\n\
      }\n"
    severity: WARNING
- rules:
  - id: reverseproxy-director
    languages:
    - go
    message: ReverseProxy can remove headers added by Director. Consider using ReverseProxy.Rewrite
      instead of ReverseProxy.Director.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-115: Misinterpretation of Input'
      impact: LOW
      likelihood: LOW
      references:
      - https://github.com/golang/go/issues/50580
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-inside: 'import "net/http/httputil"

        ...

        '
    - pattern-either:
      - pattern: $PROXY.Director = $FUNC
      - patterns:
        - pattern-inside: "httputil.ReverseProxy{\n    ...\n}\n"
        - pattern: 'Director: $FUNC

            '
    severity: WARNING
- rules:
  - id: bad-tmp-file-creation
    languages:
    - go
    message: File creation in shared tmp directory without using ioutil.Tempfile
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-377: Insecure Temporary File'
      impact: LOW
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://owasp.org/Top10/A01_2021-Broken_Access_Control
      source-rule-url: https://github.com/securego/gosec
      subcategory:
      - audit
      technology:
      - go
    pattern-either:
    - pattern: ioutil.WriteFile("=~//tmp/.*$/", ...)
    - pattern: os.Create("=~//tmp/.*$/", ...)
    severity: WARNING
- rules:
  - fix: filepath.FromSlash(filepath.Clean("/"+strings.Trim($...INNER, "/")))
    id: filepath-clean-misuse
    languages:
    - go
    message: '`Clean` is not intended to sanitize against path traversal attacks.
      This function is for finding the shortest path name equivalent to the given
      input. Using `Clean` to sanitize file reads may expose this application to path
      traversal attacks, where an attacker could access arbitrary files on the server.
      To fix this easily, write this: `filepath.FromSlash(path.Clean("/"+strings.Trim(req.URL.Path,
      "/")))` However, a better solution is using the `SecureJoin` function in the
      package `filepath-securejoin`. See https://pkg.go.dev/github.com/cyphar/filepath-securejoin#section-readme.'
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path
        Traversal'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      interfile: true
      likelihood: MEDIUM
      owasp:
      - A05:2017 - Broken Access Control
      - A01:2021 - Broken Access Control
      references:
      - https://pkg.go.dev/path#Clean
      - http://technosophos.com/2016/03/31/go-quickly-cleaning-filepaths.html
      - https://labs.detectify.com/2021/12/15/zero-day-path-traversal-grafana/
      - https://dzx.cz/2021/04/02/go_path_traversal/
      - https://pkg.go.dev/github.com/cyphar/filepath-securejoin#section-readme
      subcategory:
      - vuln
      technology:
      - go
    mode: taint
    options:
      interfile: true
    pattern-sanitizers:
    - pattern-either:
      - pattern: '"/" + ...

          '
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: filepath.Clean($...INNER)
        - pattern: path.Clean($...INNER)
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: '($REQUEST : *http.Request).$ANYTHING

            '
        - pattern: '($REQUEST : http.Request).$ANYTHING

            '
      - metavariable-regex:
          metavariable: $ANYTHING
          regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
    severity: ERROR
- rules:
  - fix-regex:
      regex: (.*)(Copy|CopyBuffer)\((.*?),(.*?)(\)|,.*\))
      replacement: \1CopyN(\3, \4, 1024*1024*256)
    id: potential-dos-via-decompression-bomb
    languages:
    - go
    message: 'Detected a possible denial-of-service via a zip bomb attack. By limiting
      the max bytes read, you can mitigate this attack. `io.CopyN()` can specify a
      size. '
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-400: Uncontrolled Resource Consumption'
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      references:
      - https://golang.org/pkg/io/#CopyN
      - https://github.com/securego/gosec/blob/master/rules/decompression-bomb.go
      source-rule-url: https://github.com/securego/gosec
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-either:
      - pattern: io.Copy(...)
      - pattern: io.CopyBuffer(...)
    - pattern-either:
      - pattern-inside: 'gzip.NewReader(...)

          ...

          '
      - pattern-inside: 'zlib.NewReader(...)

          ...

          '
      - pattern-inside: 'zlib.NewReaderDict(...)

          ...

          '
      - pattern-inside: 'bzip2.NewReader(...)

          ...

          '
      - pattern-inside: 'flate.NewReader(...)

          ...

          '
      - pattern-inside: 'flate.NewReaderDict(...)

          ...

          '
      - pattern-inside: 'lzw.NewReader(...)

          ...

          '
      - pattern-inside: 'tar.NewReader(...)

          ...

          '
      - pattern-inside: 'zip.NewReader(...)

          ...

          '
      - pattern-inside: 'zip.OpenReader(...)

          ...

          '
    severity: WARNING
- rules:
  - id: tainted-url-host
    languages:
    - go
    message: A request was found to be crafted from user-input `$REQUEST`. This can
      lead to Server-Side Request Forgery (SSRF) vulnerabilities, potentially exposing
      sensitive data. It is recommend where possible to not allow user-input to craft
      the base request, but to be treated as part of the path or query parameter.
      When user-input is necessary to craft the request, it is recommended to follow
      OWASP best practices to prevent abuse, including using an allowlist.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      interfile: true
      likelihood: MEDIUM
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://goteleport.com/blog/ssrf-attacks/
      subcategory:
      - vuln
      technology:
      - go
    mode: taint
    options:
      interfile: true
    pattern-sinks:
    - patterns:
      - pattern-either:
        - patterns:
          - pattern-either:
            - patterns:
              - pattern-inside: '$CLIENT := &http.Client{...}

                  ...

                  '
              - pattern: $CLIENT.$METHOD($URL, ...)
            - pattern: http.$METHOD($URL, ...)
          - metavariable-regex:
              metavariable: $METHOD
              regex: ^(Get|Head|Post|PostForm)$
        - patterns:
          - pattern: 'http.NewRequest("$METHOD", $URL, ...)

              '
          - metavariable-regex:
              metavariable: $METHOD
              regex: ^(GET|HEAD|POST|POSTFORM)$
      - focus-metavariable: $URL
      requires: INPUT and not CLEAN
    pattern-sources:
    - label: INPUT
      patterns:
      - pattern-either:
        - pattern: '($REQUEST : *http.Request).$ANYTHING

            '
        - pattern: '($REQUEST : http.Request).$ANYTHING

            '
      - metavariable-regex:
          metavariable: $ANYTHING
          regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
    - label: CLEAN
      patterns:
      - pattern-either:
        - pattern: '"$URLSTR" + $INPUT

            '
        - patterns:
          - pattern-either:
            - pattern: fmt.Fprintf($F, "$URLSTR", $INPUT, ...)
            - pattern: fmt.Sprintf("$URLSTR", $INPUT, ...)
            - pattern: fmt.Printf("$URLSTR", $INPUT, ...)
      - metavariable-regex:
          metavariable: $URLSTR
          regex: .*//[a-zA-Z0-10]+\..*
      requires: INPUT
    severity: WARNING
- rules:
  - id: tainted-sql-string
    languages:
    - go
    message: User data flows into this manually-constructed SQL string. User data
      can be safely inserted into SQL strings using prepared statements or an object-relational
      mapper (ORM). Manually-constructed SQL strings is a possible indicator of SQL
      injection, which could let an attacker steal or manipulate data from the database.
      Instead, use prepared statements (`db.Query("SELECT * FROM t WHERE id = ?",
      id)`) or a safe library.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      interfile: true
      likelihood: HIGH
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://golang.org/doc/database/sql-injection
      - https://www.stackhawk.com/blog/golang-sql-injection-guide-examples-and-prevention/
      subcategory:
      - vuln
      technology:
      - go
    mode: taint
    options:
      interfile: true
    pattern-sanitizers:
    - pattern-either:
      - pattern: strconv.Atoi(...)
      - pattern: '($X: bool)

          '
    pattern-sinks:
    - patterns:
      - pattern-either:
        - patterns:
          - pattern-either:
            - pattern: '"$SQLSTR" + ...

                '
            - patterns:
              - pattern-inside: '$VAR = "$SQLSTR";

                  ...

                  '
              - pattern: $VAR += ...
            - patterns:
              - pattern-inside: 'var $SB strings.Builder

                  ...

                  '
              - pattern-inside: '$SB.WriteString("$SQLSTR")

                  ...

                  $SB.String(...)

                  '
              - pattern: '$SB.WriteString(...)

                  '
          - metavariable-regex:
              metavariable: $SQLSTR
              regex: (?i)(select|delete|insert|create|update|alter|drop).*
        - patterns:
          - pattern-either:
            - pattern: fmt.Fprintf($F, "$SQLSTR", ...)
            - pattern: fmt.Sprintf("$SQLSTR", ...)
            - pattern: fmt.Printf("$SQLSTR", ...)
          - metavariable-regex:
              metavariable: $SQLSTR
              regex: \s*(?i)(select|delete|insert|create|update|alter|drop)\b.*%(v|s|q).*
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: '($REQUEST : *http.Request).$ANYTHING

            '
        - pattern: '($REQUEST : http.Request).$ANYTHING

            '
      - metavariable-regex:
          metavariable: $ANYTHING
          regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
    severity: ERROR
- rules:
  - id: raw-html-format
    languages:
    - go
    message: Detected user input flowing into a manually constructed HTML string.
      You may be accidentally bypassing secure methods of rendering HTML by manually
      constructing HTML and this could create a cross-site scripting vulnerability,
      which could let attackers steal sensitive user data. Use the `html/template`
      package which will safely render HTML instead, or inspect that the HTML is rendered
      safely.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
      subcategory:
      - vuln
      technology:
      - go
    mode: taint
    pattern-sanitizers:
    - pattern: html.EscapeString(...)
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: fmt.Printf("$HTMLSTR", ...)
        - pattern: fmt.Sprintf("$HTMLSTR", ...)
        - pattern: fmt.Fprintf($W, "$HTMLSTR", ...)
        - pattern: '"$HTMLSTR" + ...'
      - metavariable-pattern:
          language: generic
          metavariable: $HTMLSTR
          pattern: <$TAG ...
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: '($REQUEST : *http.Request).$ANYTHING

            '
        - pattern: '($REQUEST : http.Request).$ANYTHING

            '
      - metavariable-regex:
          metavariable: $ANYTHING
          regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
    severity: WARNING
- rules:
  - id: open-redirect
    languages:
    - go
    message: An HTTP redirect was found to be crafted from user-input `$REQUEST`.
      This can lead to open redirect vulnerabilities, potentially allowing attackers
      to redirect users to malicious web sites. It is recommend where possible to
      not allow user-input to craft the redirect URL. When user-input is necessary
      to craft the request, it is recommended to follow OWASP best practices to restrict
      the URL to domains in an allowlist.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
      description: An HTTP redirect was found to be crafted from user-input leading
        to an open redirect vulnerability
      impact: MEDIUM
      interfile: true
      likelihood: MEDIUM
      references:
      - https://knowledge-base.secureflag.com/vulnerabilities/unvalidated_redirects___forwards/open_redirect_go_lang.html
      subcategory:
      - vuln
      technology:
      - go
    mode: taint
    options:
      interfile: true
    pattern-sinks:
    - patterns:
      - pattern: http.Redirect($W, $REQ, $URL, ...)
      - focus-metavariable: $URL
      requires: INPUT and not CLEAN
    pattern-sources:
    - label: INPUT
      patterns:
      - pattern-either:
        - pattern: '($REQUEST : *http.Request).$ANYTHING

            '
        - pattern: '($REQUEST : http.Request).$ANYTHING

            '
      - metavariable-regex:
          metavariable: $ANYTHING
          regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
    - label: CLEAN
      patterns:
      - pattern-either:
        - pattern: '"$URLSTR" + $INPUT

            '
        - patterns:
          - pattern-either:
            - pattern: fmt.Fprintf($F, "$URLSTR", $INPUT, ...)
            - pattern: fmt.Sprintf("$URLSTR", $INPUT, ...)
            - pattern: fmt.Printf("$URLSTR", $INPUT, ...)
      - metavariable-regex:
          metavariable: $URLSTR
          regex: .*//[a-zA-Z0-10]+\..*
      requires: INPUT
    severity: WARNING
- rules:
  - id: dangerous-syscall-exec
    languages:
    - go
    message: Detected non-static command inside Exec. Audit the input to 'syscall.Exec'.
      If unverified user data can reach this call site, this is a code injection vulnerability.
      A malicious actor can inject a malicious script to execute arbitrary code.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-either:
      - patterns:
        - pattern: 'syscall.$METHOD($BIN,...)

            '
        - pattern-not: 'syscall.$METHOD("...",...)

            '
        - pattern-not-inside: '$BIN,$ERR := exec.LookPath("...");

            ...

            '
        - pattern-not-inside: '$BIN = "...";

            ...

            '
      - patterns:
        - pattern: 'syscall.$METHOD($BIN,$ARGS,...)

            '
        - pattern-not: 'syscall.$METHOD($BIN,[]string{"...",...},...)

            '
        - pattern-not-inside: '$ARGS := []string{"...",...};

            ...

            '
        - pattern-not-inside: '$CMD = "...";

            ...

            $ARGS = []string{$CMD,...};

            ...

            '
        - pattern-not-inside: '$CMD,$ERR := exec.LookPath("...");

            ...

            $ARGS = []string{$CMD,...};

            ...

            '
      - patterns:
        - pattern: 'syscall.$METHOD($BIN,[]string{"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$EXE,...},...)

            '
        - pattern-not: 'syscall.$METHOD($BIN,[]string{"...","...","...",...},...)

            '
      - patterns:
        - pattern: 'syscall.$METHOD($BIN,$ARGS,...)

            '
        - pattern-either:
          - pattern-inside: '$ARGS := []string{"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$EXE,...};

              ...

              '
          - pattern-inside: '$CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/";

              ...

              $ARGS = []string{$CMD,"-c",$EXE,...};

              ...

              '
          - pattern-inside: '$CMD,$ERR := exec.LookPath("=~/(sh|bash|ksh|csh|tcsh|zsh)/");

              ...

              $ARGS = []string{$CMD,"-c",$EXE,...};

              ...

              '
        - pattern-not-inside: '$ARGS := []string{"...","...","...",...};

            ...

            '
        - pattern-not-inside: '$CMD = "...";

            ...

            $ARGS = []string{$CMD,"...","...",...};

            ...

            '
        - pattern-not-inside: '$CMD,$ERR := exec.LookPath("...");

            ...

            $ARGS = []string{$CMD,"...","...",...};

            ...

            '
    - pattern-inside: 'import "syscall"

        ...

        '
    - metavariable-regex:
        metavariable: $METHOD
        regex: (Exec|ForkExec)
    severity: ERROR
- rules:
  - id: use-of-unsafe-block
    languages:
    - go
    message: Using the unsafe package in Go gives you low-level memory management
      and many of the strengths of the C language, but also steps around the type
      safety of Go and can lead to buffer overflows and possible arbitrary code execution
      by an attacker. Only use this package if you absolutely know what you're doing.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-242: Use of Inherently Dangerous Function'
      impact: LOW
      likelihood: LOW
      references:
      - https://cwe.mitre.org/data/definitions/242.html
      source_rule_url: https://github.com/securego/gosec/blob/master/rules/unsafe.go
      subcategory:
      - audit
      technology:
      - go
    pattern: unsafe.$FUNC(...)
    severity: WARNING
- rules:
  - id: dangerous-command-write
    languages:
    - go
    message: Detected non-static command inside Write. Audit the input to '$CW.Write'.
      If unverified user data can reach this call site, this is a code injection vulnerability.
      A malicious actor can inject a malicious script to execute arbitrary code.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern: '$CW.Write($BYTE)

        '
    - pattern-inside: '$CW,$ERR := $CMD.StdinPipe()

        ...

        '
    - pattern-not: '$CW.Write("...")

        '
    - pattern-not: '$CW.Write([]byte("..."))

        '
    - pattern-not: '$CW.Write([]byte("..."+"..."))

        '
    - pattern-not-inside: '$BYTE = []byte("...");

        ...

        '
    - pattern-not-inside: '$BYTE = []byte("..."+"...");

        ...

        '
    - pattern-inside: 'import "os/exec"

        ...

        '
    severity: ERROR
- rules:
  - id: reflect-makefunc
    languages:
    - go
    message: '''reflect.MakeFunc'' detected. This will sidestep protections that are
      normally afforded by Go''s type system. Audit this call and be sure that user
      input cannot be used to affect the code generated by MakeFunc; otherwise, you
      will have a serious security vulnerability.'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-913: Improper Control of Dynamically-Managed Code Resources'
      impact: LOW
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://owasp.org/Top10/A01_2021-Broken_Access_Control
      subcategory:
      - audit
      technology:
      - go
    pattern: reflect.MakeFunc(...)
    severity: ERROR
- rules:
  - id: dangerous-exec-command
    languages:
    - go
    message: Detected non-static command inside Command. Audit the input to 'exec.Command'.
      If unverified user data can reach this call site, this is a code injection vulnerability.
      A malicious actor can inject a malicious script to execute arbitrary code.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-either:
      - patterns:
        - pattern-either:
          - pattern: 'exec.Command($CMD,...)

              '
          - pattern: 'exec.CommandContext($CTX,$CMD,...)

              '
        - pattern-not: 'exec.Command("...",...)

            '
        - pattern-not: 'exec.CommandContext($CTX,"...",...)

            '
      - patterns:
        - pattern-either:
          - pattern: 'exec.Command("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$CMD,...)

              '
          - pattern: 'exec.CommandContext($CTX,"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$CMD,...)

              '
        - pattern-not: 'exec.Command("...","...","...",...)

            '
        - pattern-not: 'exec.CommandContext($CTX,"...","...","...",...)

            '
      - pattern-either:
        - pattern: 'exec.Command("=~/\/bin\/env/","=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$CMD,...)

            '
        - pattern: 'exec.CommandContext($CTX,"=~/\/bin\/env/","=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$CMD,...)

            '
    - pattern-inside: 'import "os/exec"

        ...

        '
    - pattern-not-inside: '$CMD,$ERR := exec.LookPath("...");

        ...

        '
    - pattern-not-inside: '$CMD = "...";

        ...

        '
    severity: ERROR
- rules:
  - id: dangerous-exec-cmd
    languages:
    - go
    message: Detected non-static command inside exec.Cmd. Audit the input to 'exec.Cmd'.
      If unverified user data can reach this call site, this is a code injection vulnerability.
      A malicious actor can inject a malicious script to execute arbitrary code.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-either:
      - patterns:
        - pattern: 'exec.Cmd {...,Path: $CMD,...}

            '
        - pattern-not: 'exec.Cmd {...,Path: "...",...}

            '
        - pattern-not-inside: '$CMD,$ERR := exec.LookPath("...");

            ...

            '
        - pattern-not-inside: '$CMD = "...";

            ...

            '
      - patterns:
        - pattern: 'exec.Cmd {...,Args: $ARGS,...}

            '
        - pattern-not: 'exec.Cmd {...,Args: []string{...},...}

            '
        - pattern-not-inside: '$ARGS = []string{"...",...};

            ...

            '
        - pattern-not-inside: '$CMD = "...";

            ...

            $ARGS = []string{$CMD,...};

            ...

            '
        - pattern-not-inside: '$CMD = exec.LookPath("...");

            ...

            $ARGS = []string{$CMD,...};

            ...

            '
      - patterns:
        - pattern: 'exec.Cmd {...,Args: []string{$CMD,...},...}

            '
        - pattern-not: 'exec.Cmd {...,Args: []string{"...",...},...}

            '
        - pattern-not-inside: '$CMD,$ERR := exec.LookPath("...");

            ...

            '
        - pattern-not-inside: '$CMD = "...";

            ...

            '
      - patterns:
        - pattern-either:
          - pattern: 'exec.Cmd {...,Args: []string{"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$EXE,...},...}

              '
          - patterns:
            - pattern: 'exec.Cmd {...,Args: []string{$CMD,"-c",$EXE,...},...}

                '
            - pattern-inside: '$CMD,$ERR := exec.LookPath("=~/(sh|bash|ksh|csh|tcsh|zsh)/");

                ...

                '
        - pattern-not: 'exec.Cmd {...,Args: []string{"...","...","...",...},...}

            '
        - pattern-not-inside: '$EXE = "...";

            ...

            '
    - pattern-inside: 'import "os/exec"

        ...

        '
    severity: ERROR
- rules:
  - id: unsafe-reflect-by-name
    languages:
    - go
    message: If an attacker can supply values that the application then uses to determine
      which method or field to invoke, the potential exists for the attacker to create
      control flow paths through the application that were not intended by the application
      developers. This attack vector may allow the attacker to bypass authentication
      or access control checks or otherwise cause the application to behave in an
      unexpected manner.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-470: Use of Externally-Controlled Input to Select Classes or Code (''Unsafe
        Reflection'')'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-either:
      - pattern: '$SMTH.MethodByName($NAME,...)

          '
      - pattern: '$SMTH.FieldByName($NAME,...)

          '
    - pattern-not: '$SMTH.MethodByName("...",...)

        '
    - pattern-not: '$SMTH.FieldByName("...",...)

        '
    - pattern-inside: 'import "reflect"

        ...

        '
    severity: WARNING
- rules:
  - id: md5-used-as-password
    languages:
    - go
    message: It looks like MD5 is used as a password hash. MD5 is not considered a
      secure password hash because it can be cracked by an attacker in a short amount
      of time. Use a suitable password hashing function such as bcrypt. You can use
      the `golang.org/x/crypto/bcrypt` package.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: MEDIUM
      interfile: true
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://tools.ietf.org/id/draft-lvelvindron-tls-md5-sha1-deprecate-01.html
      - https://security.stackexchange.com/questions/211/how-to-securely-hash-passwords
      - https://github.com/returntocorp/semgrep-rules/issues/1609
      - https://pkg.go.dev/golang.org/x/crypto/bcrypt
      subcategory:
      - vuln
      technology:
      - md5
    mode: taint
    options:
      interfile: true
    pattern-sinks:
    - patterns:
      - pattern: $FUNCTION(...)
      - metavariable-regex:
          metavariable: $FUNCTION
          regex: (?i)(.*password.*)
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: md5.New
        - pattern: md5.Sum
    severity: WARNING
- rules:
  - id: parsing-external-entities-enabled
    languages:
    - go
    message: Detected enabling of "XMLParseNoEnt", which allows parsing of external
      entities and can lead to XXE if user controlled data is parsed by the library.
      Instead, do not enable "XMLParseNoEnt" or be sure to adequately sanitize user-controlled
      data when it is being parsed by this library.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://knowledge-base.secureflag.com/vulnerabilities/xml_injection/xml_entity_expansion_go_lang.html
      - https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing
      subcategory:
      - audit
      technology:
      - libxml2
    patterns:
    - pattern-inside: 'import ("github.com/lestrrat-go/libxml2/parser")

        ...

        '
    - pattern: $PARSER := parser.New(parser.XMLParseNoEnt)
    severity: WARNING
- rules:
  - id: avoid-ssh-insecure-ignore-host-key
    languages:
    - go
    message: Disabled host key verification detected. This allows man-in-the-middle
      attacks. Use the 'golang.org/x/crypto/ssh/knownhosts' package to do host key
      verification. See https://skarlso.github.io/2019/02/17/go-ssh-with-host-key-verification/
      to learn more about the problem and how to fix it.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-322: Key Exchange without Entity Authentication'
      impact: LOW
      likelihood: LOW
      owasp:
      - A02:2021 - Cryptographic Failures
      references:
      - https://skarlso.github.io/2019/02/17/go-ssh-with-host-key-verification/
      - https://gist.github.com/Skarlso/34321a230cf0245018288686c9e70b2d
      source-rule-url: https://github.com/securego/gosec
      subcategory:
      - audit
      technology:
      - go
    pattern: ssh.InsecureIgnoreHostKey()
    severity: WARNING
- rules:
  - fix: 'tls.Config{ $...CONF, MinVersion: tls.VersionTLS13 }

      '
    id: missing-ssl-minversion
    languages:
    - go
    message: '`MinVersion` is missing from this TLS configuration.  By default, TLS
      1.2 is currently used as the minimum when acting as a client, and TLS 1.0 when
      acting as a server. General purpose web applications should default to TLS 1.3
      with all other protocols disabled.  Only where it is known that a web server
      must support legacy clients with unsupported an insecure browsers (such as Internet
      Explorer 10), it may be necessary to enable TLS 1.0 to provide support. Add
      `MinVersion: tls.VersionTLS13'' to the TLS configuration to bump the minimum
      version to TLS 1.3.'
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: LOW
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://golang.org/doc/go1.14#crypto/tls
      - https://golang.org/pkg/crypto/tls/#:~:text=MinVersion
      - https://www.us-cert.gov/ncas/alerts/TA14-290A
      source-rule-url: https://github.com/securego/gosec/blob/master/rules/tls_config.go
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern: 'tls.Config{ $...CONF }

        '
    - pattern-not: 'tls.Config{..., MinVersion: ..., ...}

        '
    severity: WARNING
- rules:
  - id: sha224-hash
    languages:
    - go
    message: This code uses a 224-bit hash function, which is deprecated or disallowed
      in some security policies. Consider updating to a stronger hash function such
      as SHA-384 or higher to ensure compliance and security.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-328: Use of Weak Hash'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar3.ipd.pdf
      - https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/ism/cyber-security-guidelines/guidelines-cryptography
      subcategory:
      - vuln
      technology:
      - go
    pattern-either:
    - patterns:
      - pattern-inside: 'import "crypto/sha256"

          ...

          '
      - pattern-either:
        - pattern: 'sha256.New224()

            '
        - pattern: 'sha256.Sum224(...)

            '
    - patterns:
      - pattern-inside: 'import "golang.org/x/crypto/sha3"

          ...

          '
      - pattern-either:
        - pattern: 'sha3.New224()

            '
        - pattern: 'sha3.Sum224(...)

            '
    severity: WARNING
- rules:
  - id: insecure-module-used
    languages:
    - go
    message: The package `net/http/cgi` is on the import blocklist.  The package is
      vulnerable to httpoxy attacks (CVE-2015-5386). It is recommended to use `net/http`
      or a web framework to build a web application instead.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://godoc.org/golang.org/x/crypto/sha3
      source-rule-url: https://github.com/securego/gosec
      subcategory:
      - audit
      technology:
      - go
    pattern-either:
    - patterns:
      - pattern-inside: 'import "net/http/cgi"

          ...

          '
      - pattern: 'cgi.$FUNC(...)

          '
    severity: WARNING
- rules:
  - id: use-of-md5
    languages:
    - go
    message: Detected MD5 hash algorithm which is considered insecure. MD5 is not
      collision resistant and is therefore not suitable as a cryptographic signature.
      Use SHA256 or SHA3 instead.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-328: Use of Weak Hash'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://github.com/securego/gosec#available-rules
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-inside: 'import "crypto/md5"

        ...

        '
    - pattern-either:
      - pattern: 'md5.New()

          '
      - pattern: 'md5.Sum(...)

          '
    severity: WARNING
  - id: use-of-sha1
    languages:
    - go
    message: Detected SHA1 hash algorithm which is considered insecure. SHA1 is not
      collision resistant and is therefore not suitable as a cryptographic signature.
      Use SHA256 or SHA3 instead.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-328: Use of Weak Hash'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://github.com/securego/gosec#available-rules
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-inside: 'import "crypto/sha1"

        ...

        '
    - pattern-either:
      - pattern: 'sha1.New()

          '
      - pattern: 'sha1.Sum(...)

          '
    severity: WARNING
  - id: use-of-DES
    languages:
    - go
    message: Detected DES cipher algorithm which is insecure. The algorithm is considered
      weak and has been deprecated. Use AES instead.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://github.com/securego/gosec#available-rules
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-inside: 'import "crypto/des"

        ...

        '
    - pattern-either:
      - pattern: 'des.NewTripleDESCipher(...)

          '
      - pattern: 'des.NewCipher(...)

          '
    severity: WARNING
  - id: use-of-rc4
    languages:
    - go
    message: Detected RC4 cipher algorithm which is insecure. The algorithm has many
      known vulnerabilities. Use AES instead.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://github.com/securego/gosec#available-rules
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-inside: 'import "crypto/rc4"

        ...

        '
    - pattern: rc4.NewCipher(...)
    severity: WARNING
- rules:
  - fix: '2048

      '
    id: use-of-weak-rsa-key
    languages:
    - go
    message: RSA keys should be at least 2048 bits
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-326: Inadequate Encryption Strength'
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#algorithms
      source-rule-url: https://github.com/securego/gosec/blob/master/rules/rsa.go
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-either:
      - pattern: 'rsa.GenerateKey(..., $BITS)

          '
      - pattern: 'rsa.GenerateMultiPrimeKey(..., $BITS)

          '
    - metavariable-comparison:
        comparison: $BITS < 2048
        metavariable: $BITS
    - focus-metavariable:
      - $BITS
    severity: WARNING
- rules:
  - id: tls-with-insecure-cipher
    languages:
    - go
    message: Detected an insecure CipherSuite via the 'tls' module. This suite is
      considered weak. Use the function 'tls.CipherSuites()' to get a list of good
      cipher suites. See https://golang.org/pkg/crypto/tls/#InsecureCipherSuites for
      why and what other cipher suites to use.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: LOW
      likelihood: HIGH
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://golang.org/pkg/crypto/tls/#InsecureCipherSuites
      source-rule-url: https://github.com/securego/gosec/blob/master/rules/tls.go
      subcategory:
      - vuln
      technology:
      - go
    pattern-either:
    - pattern: 'tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_RSA_WITH_RC4_128_SHA,
        ...}}

        '
    - pattern: 'tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_RSA_WITH_3DES_EDE_CBC_SHA,
        ...}}

        '
    - pattern: 'tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_RSA_WITH_AES_128_CBC_SHA256,
        ...}}

        '
    - pattern: 'tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_ECDHE_ECDSA_WITH_RC4_128_SHA,
        ...}}

        '
    - pattern: 'tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_ECDHE_RSA_WITH_RC4_128_SHA,
        ...}}

        '
    - pattern: 'tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA,
        ...}}

        '
    - pattern: 'tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256,
        ...}}

        '
    - pattern: 'tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,
        ...}}

        '
    - pattern: 'tls.CipherSuite{..., TLS_RSA_WITH_RC4_128_SHA, ...}

        '
    - pattern: 'tls.CipherSuite{..., TLS_RSA_WITH_3DES_EDE_CBC_SHA, ...}

        '
    - pattern: 'tls.CipherSuite{..., TLS_RSA_WITH_AES_128_CBC_SHA256, ...}

        '
    - pattern: 'tls.CipherSuite{..., TLS_ECDHE_ECDSA_WITH_RC4_128_SHA, ...}

        '
    - pattern: 'tls.CipherSuite{..., TLS_ECDHE_RSA_WITH_RC4_128_SHA, ...}

        '
    - pattern: 'tls.CipherSuite{..., TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA, ...}

        '
    - pattern: 'tls.CipherSuite{..., TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256, ...}

        '
    - pattern: 'tls.CipherSuite{..., TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256, ...}

        '
    severity: WARNING
- rules:
  - fix: 'crypto/rand

      '
    id: math-random-used
    languages:
    - go
    message: Do not use `math/rand`. Use `crypto/rand` instead.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-338: Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A02:2021 - Cryptographic Failures
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#secure-random-number-generation
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-either:
      - pattern: 'import $RAND "$MATH"

          '
      - pattern: 'import "$MATH"

          '
    - metavariable-regex:
        metavariable: $MATH
        regex: ^(math/rand(\/v[0-9]+)*)$
    - pattern-either:
      - pattern-inside: '...

          rand.$FUNC(...)

          '
      - pattern-inside: '...

          $RAND.$FUNC(...)

          '
    - focus-metavariable:
      - $MATH
    severity: WARNING
- rules:
  - fix-regex:
      regex: VersionSSL30
      replacement: VersionTLS13
    id: ssl-v3-is-insecure
    languages:
    - go
    message: SSLv3 is insecure because it has known vulnerabilities. Starting with
      go1.14, SSLv3 will be removed. Instead, use 'tls.VersionTLS13'.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: LOW
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://golang.org/doc/go1.14#crypto/tls
      - https://www.us-cert.gov/ncas/alerts/TA14-290A
      source-rule-url: https://github.com/securego/gosec/blob/master/rules/tls_config.go
      subcategory:
      - vuln
      technology:
      - go
    pattern: 'tls.Config{..., MinVersion: $TLS.VersionSSL30, ...}'
    severity: WARNING
- rules:
  - id: unescaped-data-in-htmlattr
    languages:
    - go
    message: Found a formatted template string passed to 'template. HTMLAttr()'. 'template.HTMLAttr()'
      does not escape contents. Be absolutely sure there is no user-controlled data
      in this template or validate and sanitize the data before passing it into the
      template.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://golang.org/pkg/html/template/#HTMLAttr
      subcategory:
      - audit
      technology:
      - go
    pattern-either:
    - pattern: template.HTMLAttr($T + $X, ...)
    - pattern: template.HTMLAttr(fmt.$P("...", ...), ...)
    - pattern: '$T = "..."

        ...

        $T = $FXN(..., $T, ...)

        ...

        template.HTMLAttr($T, ...)

        '
    - pattern: '$T = fmt.$P("...", ...)

        ...

        template.HTMLAttr($T, ...)

        '
    - pattern: '$T, $ERR = fmt.$P("...", ...)

        ...

        template.HTMLAttr($T, ...)

        '
    - pattern: '$T = $X + $Y

        ...

        template.HTMLAttr($T, ...)

        '
    - pattern: '$T = "..."

        ...

        $OTHER, $ERR = fmt.$P(..., $T, ...)

        ...

        template.HTMLAttr($OTHER, ...)'
    severity: WARNING
- rules:
  - id: avoid-bind-to-all-interfaces
    languages:
    - go
    message: Detected a network listener listening on 0.0.0.0 or an empty string.
      This could unexpectedly expose the server publicly as it binds to all available
      interfaces. Instead, specify another IP address that is not 0.0.0.0 nor the
      empty string.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
      cwe2021-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://owasp.org/Top10/A01_2021-Broken_Access_Control
      source-rule-url: https://github.com/securego/gosec
      subcategory:
      - audit
      technology:
      - go
    pattern-either:
    - pattern: tls.Listen($NETWORK, "=~/^0.0.0.0:.*$/", ...)
    - pattern: net.Listen($NETWORK, "=~/^0.0.0.0:.*$/", ...)
    - pattern: tls.Listen($NETWORK, "=~/^:.*$/", ...)
    - pattern: net.Listen($NETWORK, "=~/^:.*$/", ...)
    severity: WARNING
- rules:
  - id: unescaped-data-in-url
    languages:
    - go
    message: Found a formatted template string passed to 'template.URL()'. 'template.URL()'
      does not escape contents, and this could result in XSS (cross-site scripting)
      and therefore confidential data being stolen. Sanitize data coming into this
      function or make sure that no user-controlled input is coming into the function.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://golang.org/pkg/html/template/#URL
      subcategory:
      - audit
      technology:
      - go
    pattern-either:
    - pattern: template.URL($T + $X, ...)
    - pattern: template.URL(fmt.$P("...", ...), ...)
    - pattern: '$T = "..."

        ...

        $T = $FXN(..., $T, ...)

        ...

        template.URL($T, ...)

        '
    - pattern: '$T = fmt.$P("...", ...)

        ...

        template.URL($T, ...)

        '
    - pattern: '$T, $ERR = fmt.$P("...", ...)

        ...

        template.URL($T, ...)

        '
    - pattern: '$T = $X + $Y

        ...

        template.URL($T, ...)

        '
    - pattern: '$T = "..."

        ...

        $OTHER, $ERR = fmt.$P(..., $T, ...)

        ...

        template.URL($OTHER, ...)'
    severity: WARNING
- rules:
  - id: pprof-debug-exposure
    languages:
    - go
    message: The profiling 'pprof' endpoint is automatically exposed on /debug/pprof.
      This could leak information about the server. Instead, use `import "net/http/pprof"`.
      See https://www.farsightsecurity.com/blog/txt-record/go-remote-profiling-20161028/
      for more information and mitigation.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-489: Active Debug Code'
      impact: LOW
      likelihood: LOW
      owasp: A06:2017 - Security Misconfiguration
      references:
      - https://www.farsightsecurity.com/blog/txt-record/go-remote-profiling-20161028/
      source-rule-url: https://github.com/securego/gosec#available-rules
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-inside: 'import _ "net/http/pprof"

        ...

        '
    - pattern-inside: "func $ANY(...) {\n  ...\n}\n"
    - pattern-not-inside: '$MUX = http.NewServeMux(...)

        ...

        http.ListenAndServe($ADDR, $MUX)

        '
    - pattern-not: http.ListenAndServe("=~/^localhost.*/", ...)
    - pattern-not: http.ListenAndServe("=~/^127[.]0[.]0[.]1.*/", ...)
    - pattern: http.ListenAndServe(...)
    severity: WARNING
- rules:
  - id: formatted-template-string
    languages:
    - go
    message: Found a formatted template string passed to 'template.HTML()'. 'template.HTML()'
      does not escape contents. Be absolutely sure there is no user-controlled data
      in this template. If user data can reach this template, you may have a XSS vulnerability.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://golang.org/pkg/html/template/#HTML
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-not: template.HTML("..." + "...")
    - pattern-either:
      - pattern: template.HTML($T + $X, ...)
      - pattern: template.HTML(fmt.$P("...", ...), ...)
      - pattern: '$T = "..."

          ...

          $T = $FXN(..., $T, ...)

          ...

          template.HTML($T, ...)

          '
      - pattern: '$T = fmt.$P("...", ...)

          ...

          template.HTML($T, ...)

          '
      - pattern: '$T, $ERR = fmt.$P("...", ...)

          ...

          template.HTML($T, ...)

          '
      - pattern: '$T = $X + $Y

          ...

          template.HTML($T, ...)

          '
      - pattern: '$T = "..."

          ...

          $OTHER, $ERR = fmt.$P(..., $T, ...)

          ...

          template.HTML($OTHER, ...)'
    severity: WARNING
- rules:
  - id: fs-directory-listing
    languages:
    - go
    message: 'Detected usage of ''http.FileServer'' as handler: this allows directory
      listing and an attacker could navigate through directories looking for sensitive
      files. Be sure to disable directory listing or restrict access to specific directories/files.'
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-548: Exposure of Information Through Directory Listing'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A06:2017 - Security Misconfiguration
      - A01:2021 - Broken Access Control
      references:
      - https://github.com/OWASP/Go-SCP
      - https://cwe.mitre.org/data/definitions/548.html
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-either:
      - patterns:
        - pattern-inside: '$FS := http.FileServer(...)

            ...

            '
        - pattern-either:
          - pattern: 'http.ListenAndServe(..., $FS)

              '
          - pattern: 'http.ListenAndServeTLS(..., $FS)

              '
          - pattern: 'http.Handle(..., $FS)

              '
          - pattern: 'http.HandleFunc(..., $FS)

              '
      - patterns:
        - pattern: 'http.$FN(..., http.FileServer(...))

            '
        - metavariable-regex:
            metavariable: $FN
            regex: (ListenAndServe|ListenAndServeTLS|Handle|HandleFunc)
    severity: WARNING
- rules:
  - id: unescaped-data-in-js
    languages:
    - go
    message: Found a formatted template string passed to 'template.JS()'. 'template.JS()'
      does not escape contents. Be absolutely sure there is no user-controlled data
      in this template.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://golang.org/pkg/html/template/#JS
      subcategory:
      - audit
      technology:
      - go
    pattern-either:
    - pattern: template.JS($T + $X, ...)
    - pattern: template.JS(fmt.$P("...", ...), ...)
    - pattern: '$T = "..."

        ...

        $T = $FXN(..., $T, ...)

        ...

        template.JS($T, ...)

        '
    - pattern: '$T = fmt.$P("...", ...)

        ...

        template.JS($T, ...)

        '
    - pattern: '$T, $ERR = fmt.$P("...", ...)

        ...

        template.JS($T, ...)

        '
    - pattern: '$T = $X + $Y

        ...

        template.JS($T, ...)

        '
    - pattern: '$T = "..."

        ...

        $OTHER, $ERR = fmt.$P(..., $T, ...)

        ...

        template.JS($OTHER, ...)

        '
    severity: WARNING
- rules:
  - id: wip-xss-using-responsewriter-and-printf
    languages:
    - go
    message: Found data going from url query parameters into formatted data written
      to ResponseWriter. This could be XSS and should not be done. If you must do
      this, ensure your data is sanitized or escaped.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-inside: "func $FUNC(..., $W http.ResponseWriter, ...) {\n  ...\n  var\
        \ $TEMPLATE = \"...\"\n  ...\n  $W.Write([]byte(fmt.$PRINTF($TEMPLATE, ...)),\
        \ ...)\n  ...\n}\n"
    - pattern-either:
      - pattern: '$PARAMS = r.URL.Query()

          ...

          $DATA, $ERR := $PARAMS[...]

          ...

          $INTERM = $ANYTHING(..., $DATA, ...)

          ...

          $W.Write([]byte(fmt.$PRINTF(..., $INTERM, ...)))

          '
      - pattern: '$PARAMS = r.URL.Query()

          ...

          $DATA, $ERR := $PARAMS[...]

          ...

          $INTERM = $DATA[...]

          ...

          $W.Write([]byte(fmt.$PRINTF(..., $INTERM, ...)))

          '
      - pattern: '$DATA, $ERR := r.URL.Query()[...]

          ...

          $INTERM = $DATA[...]

          ...

          $W.Write([]byte(fmt.$PRINTF(..., $INTERM, ...)))

          '
      - pattern: '$DATA, $ERR := r.URL.Query()[...]

          ...

          $INTERM = $ANYTHING(..., $DATA, ...)

          ...

          $W.Write([]byte(fmt.$PRINTF(..., $INTERM, ...)))

          '
      - pattern: '$PARAMS = r.URL.Query()

          ...

          $DATA, $ERR := $PARAMS[...]

          ...

          $W.Write([]byte(fmt.$PRINTF(..., $DATA, ...)))

          '
    severity: WARNING
- rules:
  - fix-regex:
      regex: (HttpOnly\s*:\s+)false
      replacement: \1true
    id: cookie-missing-httponly
    languages:
    - go
    message: A session cookie was detected without setting the 'HttpOnly' flag. The
      'HttpOnly' flag for cookies instructs the browser to forbid client-side scripts
      from reading the cookie which mitigates XSS attacks. Set the 'HttpOnly' flag
      by setting 'HttpOnly' to 'true' in the Cookie.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-1004: Sensitive Cookie Without ''HttpOnly'' Flag'
      impact: LOW
      likelihood: LOW
      owasp:
      - A05:2021 - Security Misconfiguration
      references:
      - https://github.com/0c34/govwa/blob/139693e56406b5684d2a6ae22c0af90717e149b8/util/cookie.go
      - https://golang.org/src/net/http/cookie.go
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-not-inside: "http.Cookie{\n  ...,\n  HttpOnly: true,\n  ...,\n}\n"
    - pattern: "http.Cookie{\n  ...,\n}\n"
    severity: WARNING
- rules:
  - id: dynamic-httptrace-clienttrace
    languages:
    - go
    message: Detected a potentially dynamic ClientTrace. This occurred because semgrep
      could not find a static definition for '$TRACE'. Dynamic ClientTraces are dangerous
      because they deserialize function code to run when certain Request events occur,
      which could lead to code being run without your knowledge. Ensure that your
      ClientTrace is statically defined.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-913: Improper Control of Dynamically-Managed Code Resources'
      impact: LOW
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://github.com/returntocorp/semgrep-rules/issues/518
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-not-inside: 'package $PACKAGE

        ...

        &httptrace.ClientTrace { ... }

        ...

        '
    - pattern: httptrace.WithClientTrace($ANY, $TRACE)
    severity: WARNING
- rules:
  - fix-regex:
      regex: (Secure\s*:\s+)false
      replacement: \1true
    id: cookie-missing-secure
    languages:
    - go
    message: A session cookie was detected without setting the 'Secure' flag. The
      'secure' flag for cookies prevents the client from transmitting the cookie over
      insecure channels such as HTTP. Set the 'Secure' flag by setting 'Secure' to
      'true' in the Options struct.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-614: Sensitive Cookie in HTTPS Session Without ''Secure'' Attribute'
      impact: LOW
      likelihood: LOW
      owasp:
      - A05:2021 - Security Misconfiguration
      references:
      - https://github.com/0c34/govwa/blob/139693e56406b5684d2a6ae22c0af90717e149b8/util/cookie.go
      - https://golang.org/src/net/http/cookie.go
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-not-inside: "http.Cookie{\n  ...,\n  Secure: true,\n  ...,\n}\n"
    - pattern: "http.Cookie{\n  ...,\n}\n"
    severity: WARNING
- rules:
  - fix: http.ListenAndServeTLS($ADDR, certFile, keyFile, $HANDLER)
    id: use-tls
    languages:
    - go
    message: Found an HTTP server without TLS. Use 'http.ListenAndServeTLS' instead.
      See https://golang.org/pkg/net/http/#ListenAndServeTLS for more information.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://golang.org/pkg/net/http/#ListenAndServeTLS
      subcategory:
      - audit
      technology:
      - go
    pattern: http.ListenAndServe($ADDR, $HANDLER)
    severity: WARNING
- rules:
  - id: string-formatted-query
    languages:
    - go
    message: String-formatted SQL query detected. This could lead to SQL injection
      if the string is not sanitized properly. Audit this call to ensure the SQL is
      not manipulable by external data.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://github.com/securego/gosec
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - metavariable-regex:
        metavariable: $OBJ
        regex: (?i).*(db|database)
    - pattern-not-inside: '$VAR = "..." + "..."

        ...

        $OBJ.$SINK(..., $VAR, ...)

        '
    - pattern-not: $OBJ.Exec("...")
    - pattern-not: $OBJ.ExecContext($CTX, "...")
    - pattern-not: $OBJ.Query("...")
    - pattern-not: $OBJ.QueryContext($CTX, "...")
    - pattern-not: $OBJ.QueryRow("...")
    - pattern-not: $OBJ.QueryRow($CTX, "...")
    - pattern-not: $OBJ.QueryRowContext($CTX, "...")
    - pattern-either:
      - pattern: $OBJ.Exec($X + ...)
      - pattern: $OBJ.ExecContext($CTX, $X + ...)
      - pattern: $OBJ.Query($X + ...)
      - pattern: $OBJ.QueryContext($CTX, $X + ...)
      - pattern: $OBJ.QueryRow($X + ...)
      - pattern: $OBJ.QueryRow($CTX, $X + ...)
      - pattern: $OBJ.QueryRowContext($CTX, $X + ...)
      - pattern: $OBJ.Exec(fmt.$P("...", ...))
      - pattern: $OBJ.ExecContext($CTX, fmt.$P("...", ...))
      - pattern: $OBJ.Query(fmt.$P("...", ...))
      - pattern: $OBJ.QueryContext($CTX, fmt.$P("...", ...))
      - pattern: $OBJ.QueryRow(fmt.$P("...", ...))
      - pattern: $OBJ.QueryRow($CTX, fmt.$U("...", ...))
      - pattern: $OBJ.QueryRowContext($CTX, fmt.$P("...", ...))
      - patterns:
        - pattern-either:
          - pattern: $QUERY = fmt.Fprintf($F, "$SQLSTR", ...)
          - pattern: $QUERY = fmt.Sprintf("$SQLSTR", ...)
          - pattern: $QUERY = fmt.Printf("$SQLSTR", ...)
          - pattern: $QUERY = $X + ...
        - pattern-either:
          - pattern-inside: "func $FUNC(...) {\n    ...\n    $OBJ.Query($QUERY, ...)\n\
              \    ...\n}\n"
          - pattern-inside: "func $FUNC(...) {\n    ...\n    $OBJ.ExecContext($CTX,\
              \ $QUERY, ...)\n    ...\n}\n"
          - pattern-inside: "func $FUNC(...) {\n    ...\n    $OBJ.Exec($QUERY, ...)\n\
              \    ...\n}\n"
          - pattern-inside: "func $FUNC(...) {\n    ...\n    $OBJ.QueryRow($CTX, $QUERY)\n\
              \    ...\n}\n"
          - pattern-inside: "func $FUNC(...) {\n    ...\n    $OBJ.QueryRow($QUERY)\n\
              \    ...\n}\n"
          - pattern-inside: "func $FUNC(...) {\n    ...\n    $OBJ.QueryContext($CTX,\
              \ $QUERY)\n    ...\n}\n"
          - pattern-inside: "func $FUNC(...) {\n    ...\n    $OBJ.QueryRowContext($CTX,\
              \ $QUERY, ...)\n    ...\n}\n"
    severity: WARNING
- rules:
  - id: gosql-sqli
    languages:
    - go
    message: Detected string concatenation with a non-literal variable in a "database/sql"
      Go SQL statement. This could lead to SQL injection if the variable is user-controlled
      and not properly sanitized. In order to prevent SQL injection, use parameterized
      queries or prepared statements instead. You can use prepared statements with
      the 'Prepare' and 'PrepareContext' calls.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://golang.org/pkg/database/sql/
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-either:
      - patterns:
        - pattern: $DB.$METHOD(...,$QUERY,...)
        - pattern-either:
          - pattern-inside: '$QUERY = $X + $Y

              ...

              '
          - pattern-inside: '$QUERY += $X

              ...

              '
          - pattern-inside: '$QUERY = fmt.Sprintf("...", $PARAM1, ...)

              ...

              '
        - pattern-not-inside: '$QUERY += "..."

            ...

            '
        - pattern-not-inside: '$QUERY = "..." + "..."

            ...

            '
      - pattern: $DB.$METHOD(..., $X + $Y, ...)
      - pattern: $DB.$METHOD(..., fmt.Sprintf("...", $PARAM1, ...), ...)
    - pattern-either:
      - pattern-inside: '$DB, ... = sql.Open(...)

          ...

          '
      - pattern-inside: "func $FUNCNAME(..., $DB *sql.DB, ...) {\n  ...\n}\n"
    - pattern-not: $DB.$METHOD(..., "..." + "...", ...)
    - metavariable-regex:
        metavariable: $METHOD
        regex: ^(Exec|ExecContent|Query|QueryContext|QueryRow|QueryRowContext)$
    severity: ERROR
- rules:
  - id: pgx-sqli
    languages:
    - go
    message: 'Detected string concatenation with a non-literal variable in a pgx Go
      SQL statement. This could lead to SQL injection if the variable is user-controlled
      and not properly sanitized. In order to prevent SQL injection, use parameterized
      queries instead. You can use parameterized queries like so: (`SELECT $1 FROM
      table`, `data1)'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://github.com/jackc/pgx
      - https://pkg.go.dev/github.com/jackc/pgx/v4#hdr-Connection_Pool
      subcategory:
      - vuln
      technology:
      - pgx
    patterns:
    - pattern-either:
      - patterns:
        - pattern: $DB.$METHOD(...,$QUERY,...)
        - pattern-either:
          - pattern-inside: '$QUERY = $X + $Y

              ...

              '
          - pattern-inside: '$QUERY += $X

              ...

              '
          - pattern-inside: '$QUERY = fmt.Sprintf("...", $PARAM1, ...)

              ...

              '
        - pattern-not-inside: '$QUERY += "..."

            ...

            '
        - pattern-not-inside: '$QUERY = "..." + "..."

            ...

            '
      - pattern: $DB.$METHOD(..., $X + $Y, ...)
      - pattern: $DB.$METHOD(..., fmt.Sprintf("...", $PARAM1, ...), ...)
    - pattern-either:
      - pattern-inside: '$DB, ... = pgx.Connect(...)

          ...

          '
      - pattern-inside: '$DB, ... = pgx.NewConnPool(...)

          ...

          '
      - pattern-inside: '$DB, ... = pgx.ConnectConfig(...)

          ...

          '
      - pattern-inside: "func $FUNCNAME(..., $DB *pgx.Conn, ...) {\n  ...\n}\n"
    - pattern-not: $DB.$METHOD(..., "..." + "...", ...)
    - metavariable-regex:
        metavariable: $METHOD
        regex: ^(Exec|ExecEx|Query|QueryEx|QueryRow|QueryRowEx)$
    severity: ERROR
- rules:
  - id: pg-orm-sqli
    languages:
    - go
    message: Detected string concatenation with a non-literal variable in a go-pg
      ORM SQL statement. This could lead to SQL injection if the variable is user-controlled
      and not properly sanitized. In order to prevent SQL injection, do not use strings
      concatenated with user-controlled input. Instead, use parameterized statements.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://pg.uptrace.dev/queries/
      subcategory:
      - vuln
      technology:
      - go-pg
    patterns:
    - pattern-inside: "import (\n  ...\n  \"$IMPORT\"\n)\n...\n"
    - metavariable-regex:
        metavariable: $IMPORT
        regex: .*go-pg
    - pattern-either:
      - patterns:
        - pattern: $DB.$METHOD(...,$QUERY,...)
        - pattern-either:
          - pattern-inside: '$QUERY = $X + $Y

              ...

              '
          - pattern-inside: '$QUERY += $X

              ...

              '
          - pattern-inside: '$QUERY = fmt.Sprintf("...", $PARAM1, ...)

              ...

              '
        - pattern-not-inside: '$QUERY += "..."

            ...

            '
        - pattern-not-inside: '$QUERY = "..." + "..."

            ...

            '
      - pattern: '$DB.$INTFUNC1(...).$METHOD(..., $X + $Y, ...).$INTFUNC2(...)

          '
      - pattern: '$DB.$METHOD(..., fmt.Sprintf("...", $PARAM1, ...), ...)

          '
      - pattern-inside: '$DB = pg.Connect(...)

          ...

          '
      - pattern-inside: "func $FUNCNAME(..., $DB *pg.DB, ...) {\n  ...\n}\n"
    - pattern-not-inside: '$QUERY = fmt.Sprintf("...", ...,"...", ...)

        ...

        '
    - pattern-not-inside: '$QUERY += "..."

        ...

        '
    - pattern-not: $DB.$METHOD(...,"...",...)
    - pattern-not: '$DB.$INTFUNC1(...).$METHOD(..., "...", ...).$INTFUNC2(...)

        '
    - pattern-not-inside: '$QUERY = "..." + "..."

        '
    - pattern-not: '"..."

        '
    - pattern-not: path.Join(...)
    - pattern-not: filepath.Join(...)
    - metavariable-regex:
        metavariable: $METHOD
        regex: ^(Where|WhereOr|Join|GroupExpr|OrderExpr|ColumnExpr)$
    severity: ERROR
- rules:
  - id: pg-sqli
    languages:
    - go
    message: 'Detected string concatenation with a non-literal variable in a go-pg
      SQL statement. This could lead to SQL injection if the variable is user-controlled
      and not properly sanitized. In order to prevent SQL injection, use parameterized
      queries instead of string concatenation. You can use parameterized queries like
      so: ''(SELECT ? FROM table, data1)'''
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://pg.uptrace.dev/
      - https://pkg.go.dev/github.com/go-pg/pg/v10
      subcategory:
      - vuln
      technology:
      - go-pg
    patterns:
    - pattern-either:
      - patterns:
        - pattern: '$DB.$METHOD(...,$QUERY,...)

            '
        - pattern-either:
          - pattern-inside: '$QUERY = $X + $Y

              ...

              '
          - pattern-inside: '$QUERY += $X

              ...

              '
          - pattern-inside: '$QUERY = fmt.Sprintf("...", $PARAM1, ...)

              ...

              '
        - pattern-not-inside: '$QUERY += "..."

            ...

            '
        - pattern-not-inside: '$QUERY = "..." + "..."

            ...

            '
      - pattern: $DB.$METHOD(..., $X + $Y, ...)
      - pattern: $DB.$METHOD(..., fmt.Sprintf("...", $PARAM1, ...), ...)
    - pattern-either:
      - pattern-inside: '$DB = pg.Connect(...)

          ...

          '
      - pattern-inside: "func $FUNCNAME(..., $DB *pg.DB, ...) {\n  ...\n}\n"
    - pattern-not: $DB.$METHOD(..., "..." + "...", ...)
    - metavariable-regex:
        metavariable: $METHOD
        regex: ^(Exec|ExecContext|ExecOne|ExecOneContext|Query|QueryOne|QueryContext|QueryOneContext)$
    severity: ERROR
- rules:
  - id: no-interpolation-js-template-string
    languages:
    - generic
    message: Detected template variable interpolation in a JavaScript template string.
      This is potentially vulnerable to cross-site scripting (XSS) attacks because
      a malicious actor has control over JavaScript but without the need to use escaped
      characters. Instead, obtain this variable outside of the template string and
      ensure your template is properly escaped.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://github.com/golang/go/issues/9200#issuecomment-66100328
      - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
      subcategory:
      - audit
      technology:
      - generic
    paths:
      include:
      - '*.html'
      - '*.thtml'
      - '*.gohtml'
      - '*.tmpl'
      - '*.tpl'
    patterns:
    - pattern-inside: <script ...> ... ... ... ... ... </script>
    - pattern: '` ... {{ ... }} ...`'
    severity: WARNING
- rules:
  - fix: 'html/template

      '
    id: import-text-template
    languages:
    - go
    message: When working with web applications that involve rendering user-generated  content,
      it's important to properly escape any HTML content to prevent  Cross-Site Scripting
      (XSS) attacks. In Go, the `text/template` package does  not automatically escape
      HTML content, which can leave your application  vulnerable to these types of
      attacks. To mitigate this risk, it's  recommended to use the `html/template`
      package instead, which provides  built-in functionality for HTML escaping. By
      using `html/template` to render  your HTML content, you can help to ensure that
      your web application is more  secure and less susceptible to XSS vulnerabilities.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://www.veracode.com/blog/secure-development/use-golang-these-mistakes-could-compromise-your-apps-security
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern: 'import "$IMPORT"

        '
    - metavariable-regex:
        metavariable: $IMPORT
        regex: ^(text/template)$
    - focus-metavariable: $IMPORT
    severity: WARNING
- rules:
  - id: no-interpolation-in-tag
    languages:
    - generic
    message: Detected template variable interpolation in an HTML tag. This is potentially
      vulnerable to cross-site scripting (XSS) attacks because a malicious actor has
      control over HTML but without the need to use escaped characters. Use explicit
      tags instead.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://github.com/golang/go/issues/19669
      - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
      subcategory:
      - audit
      technology:
      - generic
    paths:
      include:
      - '*.html'
      - '*.thtml'
      - '*.gohtml'
      - '*.tmpl'
      - '*.tpl'
    pattern: <{{ ... }} ... >
    severity: WARNING
- rules:
  - id: no-printf-in-responsewriter
    languages:
    - go
    message: Detected 'printf' or similar in 'http.ResponseWriter.write()'. This bypasses
      HTML escaping that prevents cross-site scripting vulnerabilities. Instead, use
      the 'html/template' package to render data to users.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-either:
      - pattern-inside: "func $HANDLER(..., $WRITER http.ResponseWriter, ...) {\n\
          \  ...\n}\n"
      - pattern-inside: "func(..., $WRITER http.ResponseWriter, ...) {\n  ...\n}\n"
    - pattern: '$WRITER.Write(<... fmt.$PRINTF(...) ...>, ...)

        '
    severity: WARNING
- rules:
  - id: unsafe-template-type
    languages:
    - go
    message: Semgrep could not determine that the argument to 'template.HTML()' is
      a constant. 'template.HTML()' and similar does not escape contents. Be absolutely
      sure there is no user-controlled data in this template. If user data can reach
      this template, you may have a XSS vulnerability. Instead, do not use this function
      and use 'template.Execute()'.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://golang.org/pkg/html/template/#HTML
      - https://github.com/0c34/govwa/blob/139693e56406b5684d2a6ae22c0af90717e149b8/vulnerability/xss/xss.go#L33
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-not: template.$ANY("..." + "...")
    - pattern-not: template.$ANY("...")
    - pattern-either:
      - pattern: template.HTML(...)
      - pattern: template.CSS(...)
      - pattern: template.HTMLAttr(...)
      - pattern: template.JS(...)
      - pattern: template.JSStr(...)
      - pattern: template.Srcset(...)
      - pattern: template.URL(...)
    severity: WARNING
- rules:
  - id: no-io-writestring-to-responsewriter
    languages:
    - go
    message: Detected 'io.WriteString()' writing directly to 'http.ResponseWriter'.
      This bypasses HTML escaping that prevents cross-site scripting vulnerabilities.
      Instead, use the 'html/template' package to render data to users.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
      - https://golang.org/pkg/io/#WriteString
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-either:
      - pattern-inside: "func $HANDLER(..., $WRITER http.ResponseWriter, ...) {\n\
          \  ...\n}\n"
      - pattern-inside: "func(..., $WRITER http.ResponseWriter, ...) {\n  ...\n}\n"
    - pattern-not: io.WriteString($WRITER, "...")
    - pattern: io.WriteString($WRITER, $STRING)
    severity: WARNING
- rules:
  - id: no-fprintf-to-responsewriter
    languages:
    - go
    message: Detected 'Fprintf' or similar writing to 'http.ResponseWriter'. This
      bypasses HTML escaping that prevents cross-site scripting vulnerabilities. Instead,
      use the 'html/template' package to render data to users.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-either:
      - pattern-inside: "func $HANDLER(..., $WRITER http.ResponseWriter, ...) {\n\
          \  ...\n}\n"
      - pattern-inside: "func(..., $WRITER http.ResponseWriter, ...) {\n  ...\n}\n"
    - pattern-not: fmt.$PRINTF($WRITER, "...")
    - pattern: fmt.$PRINTF($WRITER, ...)
    severity: WARNING
- rules:
  - id: no-direct-write-to-responsewriter
    languages:
    - go
    message: Detected directly writing or similar in 'http.ResponseWriter.write()'.
      This bypasses HTML escaping that prevents cross-site scripting vulnerabilities.
      Instead, use the 'html/template' package and render data using 'template.Execute()'.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
      subcategory:
      - audit
      technology:
      - go
    patterns:
    - pattern-either:
      - pattern-inside: "func $HANDLER(..., $WRITER http.ResponseWriter, ...) {\n\
          \  ...\n}\n"
      - pattern-inside: "func $HANDLER(..., $WRITER *http.ResponseWriter, ...) {\n\
          \  ...\n}\n"
      - pattern-inside: "func(..., $WRITER http.ResponseWriter, ...) {\n  ...\n}\n"
    - pattern-either:
      - pattern: $WRITER.Write(...)
      - pattern: (*$WRITER).Write(...)
    - pattern-not: $WRITER.Write([]byte("..."))
    severity: WARNING
- rules:
  - id: go-insecure-templates
    languages:
    - go
    message: usage of insecure template types. They are documented as a security risk.
      See https://golang.org/pkg/html/template/#HTML.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://golang.org/pkg/html/template/#HTML
      - https://twitter.com/empijei/status/1275177219011350528
      subcategory:
      - audit
      technology:
      - template
    patterns:
    - pattern-inside: 'import "html/template"

        ...

        '
    - pattern-either:
      - pattern: var $VAR template.HTML = $EXP
      - pattern: var $VAR template.CSS = $EXP
      - pattern: var $VAR template.HTMLAttr = $EXP
      - pattern: var $VAR template.JS = $EXP
      - pattern: var $VAR template.JSStr = $EXP
      - pattern: var $VAR template.Srcset = $EXP
    severity: WARNING
- rules:
  - id: go-ssti
    languages:
    - go
    message: A server-side template injection occurs when an attacker is able to use
      native template syntax to inject a malicious payload into a template, which
      is then executed server-side. When using "html/template" always check that user
      inputs are validated and sanitized before included within the template.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-1336: Improper Neutralization of Special Elements Used in a Template
        Engine'
      impact: HIGH
      likelihood: LOW
      references:
      - https://www.onsecurity.io/blog/go-ssti-method-research/
      - http://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html
      subcategory:
      - vuln
      technology:
      - go
    patterns:
    - pattern-inside: 'import ("html/template")

        ...

        '
    - pattern: $TEMPLATE = fmt.Sprintf("...", $ARG, ...)
    - patterns:
      - pattern-either:
        - pattern-inside: 'func $FN(..., $REQ *http.Request, ...){

            ...

            }

            '
        - pattern-inside: 'func $FN(..., $REQ http.Request, ...){

            ...

            }

            '
        - pattern-inside: 'func(..., $REQ *http.Request, ...){

            ...

            }

            '
    - patterns:
      - pattern-either:
        - pattern-inside: '$ARG := $REQ.URL.Query().Get(...)

            ...

            $T, $ERR := $TMPL.Parse($TEMPLATE)

            '
        - pattern-inside: '$ARG := $REQ.Form.Get(...)

            ...

            $T, $ERR := $TMPL.Parse($TEMPLATE)

            '
        - pattern-inside: '$ARG := $REQ.PostForm.Get(...)

            ...

            $T, $ERR := $TMPL.Parse($TEMPLATE)

            '
    severity: ERROR
