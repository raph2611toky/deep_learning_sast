- rules:
  - id: multiple-entrypoint-instructions
    languages:
    - dockerfile
    message: Multiple ENTRYPOINT instructions were found. Only the last one will take
      effect.
    metadata:
      category: correctness
      references:
      - https://github.com/hadolint/hadolint/wiki/DL4004
      - https://kapeli.com/cheat_sheets/Dockerfile.docset/Contents/Resources/Documents/index#//dash_ref_Instructions/Entry/ENTRYPOINT/0
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL4004
      technology:
      - dockerfile
    patterns:
    - pattern: 'ENTRYPOINT ...

        ...

        $ENTRYPOINT_INSTR

        '
    - metavariable-pattern:
        metavariable: $ENTRYPOINT_INSTR
        pattern: 'ENTRYPOINT ...

          '
    - focus-metavariable: $ENTRYPOINT_INSTR
    severity: ERROR
- rules:
  - id: invalid-port
    languages:
    - dockerfile
    message: Detected an invalid port number. Valid ports are 0 through 65535.
    metadata:
      category: correctness
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3011
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3011
      technology:
      - dockerfile
    pattern-either:
    - patterns:
      - pattern: EXPOSE $PORT
      - metavariable-comparison:
          comparison: int($PORT) > 65535
          metavariable: $PORT
    severity: ERROR
- rules:
  - id: missing-assume-yes-switch
    languages:
    - dockerfile
    message: This 'apt-get install' is missing the '-y' switch. This might stall builds
      because it requires human intervention. Add the '-y' switch.
    metadata:
      category: correctness
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3014
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3014
      technology:
      - dockerfile
    patterns:
    - pattern: "RUN ... apt-get install ... $MULTIFLAG ... \n"
    - pattern-not: 'RUN ... apt-get install ... --assume-yes ...

        '
    - pattern-not: 'RUN ... apt-get install ... --yes ...

        '
    - pattern-not: 'RUN ... apt-get install ... -y ...

        '
    - metavariable-regex:
        metavariable: $MULTIFLAG
        regex: (^([^-])|(-[^y]+)$)
    severity: WARNING
- rules:
  - id: missing-dnf-assume-yes-switch
    languages:
    - dockerfile
    message: This 'dnf install' is missing the '-y' switch. This might stall builds
      because it requires human intervention. Add the '-y' switch.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3038
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3038
      technology:
      - dockerfile
    patterns:
    - pattern: 'RUN ... dnf install ...

        '
    - pattern-not-inside: 'RUN ... dnf install ... -y ...

        '
    - pattern-not-inside: 'RUN ... dnf ... --assumeyes ...

        '
    severity: WARNING
- rules:
  - id: remove-package-lists
    languages:
    - dockerfile
    message: The package lists were not deleted after running 'apt-get update', which
      increases the size of the image. Remove the package lists by appending '&& rm
      -rf /var/lib/apt/lists/*' at the end of apt-get command chain.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3009
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3009
      technology:
      - dockerfile
    patterns:
    - pattern-not-inside: RUN ... rm -rf /var/lib/apt/lists/*
    - pattern: RUN apt-get update ...
    - pattern: apt-get update
    severity: WARNING
- rules:
  - id: missing-yum-assume-yes-switch
    languages:
    - dockerfile
    message: This 'yum install' is missing the '-y' switch. This might stall builds
      because it requires human intervention. Add the '-y' switch.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3030
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3030
      technology:
      - dockerfile
    patterns:
    - pattern: 'RUN ... yum install ...

        '
    - pattern-not: 'RUN ... yum install ... -y ...

        '
    - pattern-not: 'RUN ... yum ... --assumeyes ...

        '
    severity: WARNING
- rules:
  - id: set-pipefail
    languages:
    - dockerfile
    message: Only the exit code from the final command in this RUN instruction will
      be evaluated unless 'pipefail' is set. If you want to fail the command at any
      stage in the pipe, set 'pipefail' by including 'SHELL ["/bin/bash", "-o", "pipefail",
      "-c"] before the command. If you're using alpine and don't have bash installed,
      communicate this explicitly with `SHELL ["/bin/ash"]`.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL4006
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL4006
      technology:
      - dockerfile
    patterns:
    - pattern-either:
      - pattern: RUN ... | ...
      - pattern: RUN ... || ...
    - pattern-not-inside: 'SHELL [..., "pipefail", ...]

        ...

        RUN ... | ...

        '
    - pattern-not-inside: 'SHELL ["/bin/ash", ...]

        ...

        RUN ... | ...

        '
    severity: WARNING
- rules:
  - id: avoid-apt-get-upgrade
    languages:
    - dockerfile
    message: Packages in base containers should be up-to-date, removing the need to
      upgrade or dist-upgrade. If a package is out of date, contact the maintainers.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3005
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3005
      technology:
      - dockerfile
    pattern-either:
    - pattern: RUN ... apt-get upgrade ...
    - pattern: RUN ... apt-get dist-upgrade ...
    severity: WARNING
- rules:
  - id: missing-no-install-recommends
    languages:
    - dockerfile
    message: This 'apt-get install' is missing '--no-install-recommends'. This prevents
      unnecessary packages from being installed, thereby reducing image size. Add
      '--no-install-recommends'.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3015
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3015
      technology:
      - dockerfile
    patterns:
    - pattern: 'RUN apt-get install ...

        '
    - pattern-not: RUN apt-get install ... --no-install-recommends ...
    severity: INFO
- rules:
  - id: remove-package-cache
    languages:
    - dockerfile
    message: The package cache was not deleted after running 'apt-get update', which
      increases the size of the image. Remove the package cache by appending '&& apt-get
      clean' at the end of apt-get command chain.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3009
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3009
      technology:
      - dockerfile
    patterns:
    - pattern-not-inside: RUN ... && apt-get clean ...
    - pattern: RUN ... apt-get update ...
    - pattern: apt-get update
    severity: WARNING
- rules:
  - id: missing-dnf-clean-all
    languages:
    - dockerfile
    message: This dnf command does not end with '&& dnf clean all'. Running 'dnf clean
      all' will remove cached data and reduce package size. (This must be performed
      in the same RUN step.)
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3038
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3038
      technology:
      - dockerfile
    patterns:
    - pattern: RUN ... dnf ...
    - pattern-not-inside: RUN ... && dnf clean all
    - pattern-not-inside: RUN ... && \ dnf clean all
    severity: WARNING
- rules:
  - id: prefer-apt-get
    languages:
    - dockerfile
    message: '''apt-get'' is preferred as an unattended tool for stability. ''apt''
      is discouraged.'
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3027
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3027
      technology:
      - dockerfile
    patterns:
    - pattern: RUN apt ...
    - pattern-not: RUN apt-get ...
    severity: INFO
- rules:
  - id: missing-zypper-clean
    languages:
    - dockerfile
    message: This zypper command does not end with '&& zypper clean'. Running 'zypper
      clean' will remove cached data and reduce package size. (This must be performed
      in the same RUN step.)
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3036
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3036
      technology:
      - dockerfile
    patterns:
    - pattern: RUN ... zypper $COMMAND ...
    - pattern-not-inside: RUN ... zypper clean
    - pattern-not-inside: RUN ... zypper clean
    severity: WARNING
- rules:
  - id: missing-apk-no-cache
    languages:
    - dockerfile
    message: This apk command is missing '--no-cache'. This forces apk to use a package
      index instead of a local package cache, removing the need for '--update' and
      the deletion of '/var/cache/apk/*'. Add '--no-cache' to your apk command.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3019
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3019
      technology:
      - dockerfile
    patterns:
    - pattern: 'RUN apk $COMMAND ...

        '
    - pattern-not-inside: 'RUN apk ... --no-cache ...

        '
    severity: INFO
- rules:
  - id: avoid-dnf-update
    languages:
    - dockerfile
    message: Packages in base images should be up-to-date, removing the need for 'dnf
      update'. If packages are out-of-date, consider contacting the base image maintainer.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3039
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3039
      technology:
      - dockerfile
    pattern: dnf update
    severity: INFO
- rules:
  - id: missing-pip-no-cache-dir
    languages:
    - dockerfile
    message: This '$PIP install' is missing '--no-cache-dir'. This flag prevents package
      archives from being kept around, thereby reducing image size. Add '--no-cache-dir'.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3042
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3042
      technology:
      - dockerfile
    patterns:
    - patterns:
      - pattern: 'RUN ... $PIP install ...

          '
      - pattern-not-inside: 'RUN ... $PIP install ... --no-cache-dir ...

          '
      - pattern-not-inside: 'RUN ... $PIP install . ...

          '
      - pattern-not-inside: 'ENV ... PIP_NO_CACHE_DIR=$BOOL ...

          ...

          RUN ... $PIP install ...

          '
      - pattern-not-inside: 'ENV ... PIP_NO_CACHE_DIR ...

          ...

          RUN ... $PIP install ...

          '
    - metavariable-regex:
        metavariable: $PIP
        regex: (pip|pip2|pip3|python -m pip|python3 -m pip)
    severity: INFO
- rules:
  - id: prefer-copy-over-add
    languages:
    - dockerfile
    message: The ADD command will accept and include files from a URL and automatically
      extract archives. This potentially exposes the container to a man-in-the-middle
      attack or other attacks if a malicious actor can tamper with the source archive.
      Since ADD can have this and other unexpected side effects, the use of the more
      explicit COPY command is preferred.
    metadata:
      category: best-practice
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html
      technology:
      - dockerfile
    patterns:
    - pattern: 'ADD $FROM $TO

        '
    - metavariable-regex:
        metavariable: $FROM
        regex: (^[A-Za-z]+:\/\/|.*[.](gz|bz2|zip|tar)$)
    - focus-metavariable: $FROM
    severity: INFO
- rules:
  - id: avoid-platform-with-from
    languages:
    - dockerfile
    message: Using '--platform' with FROM restricts the image to build on a single
      platform. Further, this must be the same as the build platform. If you intended
      to specify the target platform, use the utility 'docker buildx --platform='
      instead.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3029
      - https://docs.docker.com/buildx/working-with-buildx/
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3029
      technology:
      - dockerfile
    pattern: FROM --platform=$PLATFORM $IMAGE
    severity: INFO
- rules:
  - id: use-either-wget-or-curl
    languages:
    - dockerfile
    message: '''wget'' and ''curl'' are similar tools. Choose one and do not install
      the other to decrease image size.'
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL4001
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL4001
      technology:
      - dockerfile
    pattern-either:
    - pattern: 'RUN wget ...

        ...

        RUN curl ...

        '
    - pattern: 'RUN curl ...

        ...

        RUN wget ...

        '
    severity: INFO
- rules:
  - id: avoid-latest-version
    languages:
    - dockerfile
    message: Images should be tagged with an explicit version to produce deterministic
      container images. The 'latest' tag may change the base container without warning.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3007
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3007
      technology:
      - dockerfile
    pattern: FROM $FROM:latest
    severity: WARNING
- rules:
  - id: missing-image-version
    languages:
    - dockerfile
    message: Detected docker image with no explicit version attached. Images should
      be tagged with an explicit version to produce deterministic container images
      -- attach a version when using  `FROM <image>`.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3006
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3006
      technology:
      - dockerfile
    patterns:
    - pattern-either:
      - pattern: FROM $IMAGE
    - pattern-not: FROM $IMAGE:$VERSION
    - pattern-not: FROM $IMAGE@$DIGEST
    - pattern-not: FROM $IMAGE:$VERSION@$DIGEST
    - pattern-not: FROM scratch
    severity: WARNING
- rules:
  - id: prefer-json-notation
    languages:
    - dockerfile
    message: Prefer JSON notation when using CMD or ENTRYPOINT. This allows signals
      to be passed from the OS.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3025
      - https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#cmd
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3025
      technology:
      - dockerfile
    pattern-either:
    - patterns:
      - pattern: CMD $WORD ...
      - pattern-not-inside: CMD [...]
    - patterns:
      - pattern: ENTRYPOINT $WORD ...
      - pattern-not-inside: ENTRYPOINT [...]
    severity: INFO
- rules:
  - fix: '# MAINTAINER $NAME'
    id: maintainer-is-deprecated
    languages:
    - dockerfile
    message: MAINTAINER has been deprecated.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL4000
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL4000
      technology:
      - dockerfile
    pattern: MAINTAINER $NAME
    severity: INFO
- rules:
  - id: avoid-yum-update
    languages:
    - dockerfile
    message: Packages in base images should be up-to-date, removing the need for 'yum
      update'. If packages are out-of-date, consider contacting the base image maintainer.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3031
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3031
      technology:
      - dockerfile
    pattern: yum update
    severity: INFO
- rules:
  - fix: SHELL ["$SHELL", "-c"]
    id: use-shell-instruction
    languages:
    - dockerfile
    message: Use the SHELL instruction to set the default shell instead of overwriting
      '/bin/sh'.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL4005
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL4005
      technology:
      - dockerfile
    pattern: 'RUN ln ... $SHELL /bin/sh

      '
    severity: WARNING
- rules:
  - id: nonsensical-command
    languages:
    - dockerfile
    message: Some commands such as `$CMD` do not make sense in a container. Do not
      use these.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3001
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3001
      technology:
      - dockerfile
    patterns:
    - pattern: RUN $CMD ...
    - metavariable-regex:
        metavariable: $CMD
        regex: (shutdown|service|ps|free|top|kill|mount|ifconfig|nano|vim)
    severity: WARNING
- rules:
  - id: avoid-zypper-update
    languages:
    - dockerfile
    message: Packages in base images should be up-to-date, removing the need for 'zypper
      update'. If packages are out-of-date, consider contacting the base image maintainer.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3035
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3035
      technology:
      - dockerfile
    pattern: zypper update ...
    severity: INFO
- rules:
  - id: avoid-apk-upgrade
    languages:
    - dockerfile
    message: Packages in base images should be up-to-date, removing the need for 'apk
      upgrade'. If packages are out-of-date, consider contacting the base image maintainer.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3017
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3017
      technology:
      - dockerfile
    pattern: RUN ... apk upgrade ...
    severity: INFO
- rules:
  - id: use-workdir
    languages:
    - dockerfile
    message: As recommended by Docker's documentation, it is best to use 'WORKDIR'
      instead of 'RUN cd ...' for improved clarity and reliability. Also, 'RUN cd
      ...' may not work as expected in a container.
    metadata:
      category: best-practice
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3003
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3003
      technology:
      - dockerfile
    options:
      implicit_deep_exprstmt: false
    patterns:
    - pattern-either:
      - pattern-inside: 'RUN $ CMD ...

          '
      - pattern-inside: 'RUN $CMD ... && ...

          '
    - metavariable-pattern:
        metavariable: $CMD
        pattern: cd
    - focus-metavariable: $CMD
    severity: WARNING
- rules:
  - id: dockerfile-source-not-pinned
    languages:
    - dockerfile
    message: To ensure reproducible builds, pin Dockerfile `FROM` commands to a specific
      hash. You can find the hash by running `docker pull $IMAGE` and then  specify
      it with `$IMAGE:$VERSION@sha256:<hash goes here>`
    metadata:
      category: best-practice
      references:
      - https://stackoverflow.com/a/33511811/4965
      technology:
      - docker
    patterns:
    - pattern-either:
      - patterns:
        - pattern: FROM $IMAGE:$VERSION@$HASH
        - metavariable-regex:
            metavariable: $HASH
            regex: (?!sha256:)
      - patterns:
        - pattern: FROM $IMAGE
        - pattern: FROM $IMAGE:$VERSION
        - pattern-not-inside: FROM $IMAGE:$VERSION@$HASH
    severity: INFO
- rules:
  - id: no-sudo-in-dockerfile
    languages:
    - dockerfile
    message: Avoid using sudo in Dockerfiles. Running processes as a non-root user
      can help  reduce the potential impact of configuration errors and security vulnerabilities.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-250: Execution with Unnecessary Privileges'
      impact: LOW
      likelihood: LOW
      owasp:
      - A05:2021 - Security Misconfiguration
      references:
      - https://cwe.mitre.org/data/definitions/250.html
      - https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#user
      subcategory:
      - audit
      technology:
      - dockerfile
    patterns:
    - pattern: 'RUN sudo ...

        '
    severity: WARNING
- rules:
  - fix: 'USER non-root

      CMD $...VARS

      '
    id: missing-user
    languages:
    - dockerfile
    message: By not specifying a USER, a program in the container may run as 'root'.
      This is a security hazard. If an attacker can control a process running as root,
      they may have control over the container. Ensure that the last USER in a Dockerfile
      is a USER other than 'root'.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-269: Improper Privilege Management'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A04:2021 - Insecure Design
      references:
      - https://owasp.org/Top10/A04_2021-Insecure_Design
      subcategory:
      - audit
      technology:
      - dockerfile
    patterns:
    - pattern: 'CMD $...VARS

        '
    - pattern-not-inside: 'USER $USER

        ...

        '
    severity: ERROR
- rules:
  - id: secret-in-build-arg
    languages:
    - dockerfile
    message: Docker build time arguments are not suited for secrets, because the argument
      values are saved with the image. Running `docker image history` on the image
      will show information on how the image was built, including arguments. If these
      contain plain text secrets, anyone with access to the docker image can access
      those secrets and exploit them.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-538: Insertion of Sensitive Information into Externally-Accessible File
        or Directory'
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://cwe.mitre.org/data/definitions/538.html
      - https://docs.docker.com/engine/reference/builder/#arg
      subcategory:
      - audit
      technology:
      - dockerfile
    patterns:
    - pattern-either:
      - pattern: ARG $ARG
      - pattern: ARG $ARG=...
    - metavariable-regex:
        metavariable: $ARG
        regex: (?i).*(password|secret|token|key|cert|api|auth)
    severity: WARNING
- rules:
  - id: dockerfile-dockerd-socket-mount
    languages:
    - dockerfile
    - yaml
    message: The Dockerfile(image) mounts docker.sock to the container which may allow
      an attacker already inside of the container to escape container and execute
      arbitrary commands on the host machine.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-862: Missing Authorization'
      - 'CWE-269: Improper Privilege Management'
      impact: HIGH
      likelihood: MEDIUM
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html
      - https://redfoxsec.com/blog/insecure-volume-mounts-in-docker/
      - https://blog.quarkslab.com/why-is-exposing-the-docker-socket-a-really-bad-idea.html
      subcategory:
      - audit
      technology:
      - dockerfile
    pattern-either:
    - patterns:
      - pattern: VOLUME $X
      - metavariable-regex:
          metavariable: $X
          regex: /var/run/docker.sock
    - patterns:
      - pattern-regex: '- "/var/run/docker.sock:.*"'
      - pattern-inside: "volumes:\n  ...\n"
    severity: ERROR
- rules:
  - id: last-user-is-root
    languages:
    - dockerfile
    message: The last user in the container is 'root'. This is a security hazard because
      if an attacker gains control of the container they will have root access. Switch
      back to another user after running commands as 'root'.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-269: Improper Privilege Management'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A04:2021 - Insecure Design
      references:
      - https://github.com/hadolint/hadolint/wiki/DL3002
      source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3002
      subcategory:
      - audit
      technology:
      - dockerfile
    patterns:
    - pattern: USER root
    - pattern-not-inside:
        patterns:
        - pattern: 'USER root

            ...

            USER $X

            '
        - metavariable-pattern:
            metavariable: $X
            patterns:
            - pattern-not: root
    severity: ERROR
- rules:
  - fix: 'USER non-root

      ENTRYPOINT $...VARS

      '
    id: missing-user-entrypoint
    languages:
    - dockerfile
    message: By not specifying a USER, a program in the container may run as 'root'.
      This is a security hazard. If an attacker can control a process running as root,
      they may have control over the container. Ensure that the last USER in a Dockerfile
      is a USER other than 'root'.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-269: Improper Privilege Management'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A04:2021 - Insecure Design
      references:
      - https://owasp.org/Top10/A04_2021-Insecure_Design
      subcategory:
      - audit
      technology:
      - dockerfile
    patterns:
    - pattern: 'ENTRYPOINT $...VARS

        '
    - pattern-not-inside: 'USER $USER

        ...

        '
    severity: ERROR
