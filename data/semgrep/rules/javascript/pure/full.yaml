- rules:
  - id: expat-xxe
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the XML Parser it can result in XML
      External or Internal Entity (XXE) Processing vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
      subcategory:
      - audit
      technology:
      - node-expat
    patterns:
    - pattern-either:
      - pattern: 'var $EXPAT = require(''node-expat'');

          ...

          new $EXPAT.Parser(...);

          ...

          $PARSER.parse(...);

          '
      - pattern: 'var $EXPAT = require(''node-expat'');

          ...

          new $EXPAT.Parser(...);

          ...

          $PARSER.write(...);

          '
      - pattern: 'require(''node-expat'');

          ...

          new Parser(...);

          ...

          $PARSER.parse(...);

          '
      - pattern: 'require(''node-expat'');

          ...

          new Parser(...);

          ...

          $PARSER.write(...);

          '
    - pattern-not: 'var $EXPAT = require(''node-expat'');

        ...

        new $EXPAT.Parser(...);

        ...

        $PARSER.parse("...");

        '
    - pattern-not: 'var $EXPAT = require(''node-expat'');

        ...

        new $EXPAT.Parser(...);

        ...

        $PARSER.write("...");

        '
    - pattern-not: 'require(''node-expat'');

        ...

        new Parser(...);

        ...

        $PARSER.parse("...");

        '
    - pattern-not: 'require(''node-expat'');

        ...

        new Parser(...);

        ...

        $PARSER.write("...");

        '
    - pattern-not: '$X = "...";

        ...

        $PARSER.parse($X);

        '
    - pattern-not: '$X = "...";

        ...

        $PARSER.write($X);'
    severity: WARNING
- rules:
  - id: shelljs-exec-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `exec` method it can result in
      Remote Code Execution
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - shelljs
    patterns:
    - pattern-inside: 'require(''shelljs'');

        ...

        '
    - pattern-not-inside: 'require(''shelljs'');

        ...

        var $INPUT = "...";

        ...

        '
    - pattern: $SHELL.exec($INPUT,...)
    - pattern-not: $SHELL.exec("...",...)
    severity: ERROR
- rules:
  - id: jwt-none-alg
    languages:
    - javascript
    - typescript
    message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm
      assumes the integrity of the token has already been verified. This would allow
      a malicious actor to forge a JWT token that will automatically be verified.
      Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as
      'HS256'.
    metadata:
      asvs:
        control_id: 3.5.3 Insecue Stateless Session Tokens
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
        section: 'V3: Session Management Verification Requirements'
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
      subcategory:
      - vuln
      technology:
      - jose
      - jwt
    pattern-either:
    - pattern: 'var $JOSE = require("jose");

        ...

        var { JWK, JWT } = $JOSE;

        ...

        var $T = JWT.verify($P, JWK.None,...);

        '
    - pattern: 'var $JOSE = require("jose");

        ...

        var { JWK, JWT } = $JOSE;

        ...

        $T = JWT.verify($P, JWK.None,...);

        '
    - pattern: 'var $JOSE = require("jose");

        ...

        var { JWK, JWT } = $JOSE;

        ...

        JWT.verify($P, JWK.None,...);

        '
    severity: ERROR
- rules:
  - id: hardcoded-jwt-secret
    languages:
    - javascript
    - typescript
    message: A hard-coded credential was detected. It is not recommended to store
      credentials in source-code, as this risks secrets being leaked and used by either
      an internal or external malicious adversary. It is recommended to use environment
      variables to securely provide credentials or retrieve credentials from a secure
      vault or HSM (Hardware Security Module).
    metadata:
      asvs:
        control_id: 3.5.2 Static API keys or secret
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
        section: 'V3: Session Management Verification Requirements'
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-798: Use of Hard-coded Credentials'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      interfile: true
      likelihood: HIGH
      owasp:
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
      subcategory:
      - vuln
      technology:
      - jose
      - jwt
      - secrets
    options:
      interfile: true
      symbolic_propagation: true
    patterns:
    - pattern-inside: '$JOSE = require("jose");

        ...

        '
    - pattern-either:
      - pattern-inside: 'var {JWT} = $JOSE;

          ...

          '
      - pattern-inside: 'var {JWK, JWT} = $JOSE;

          ...

          '
      - pattern-inside: 'const {JWT} = $JOSE;

          ...

          '
      - pattern-inside: 'const {JWK, JWT} = $JOSE;

          ...

          '
      - pattern-inside: 'let {JWT} = $JOSE;

          ...

          '
      - pattern-inside: 'let {JWK, JWT} = $JOSE;

          ...

          '
    - pattern-either:
      - pattern: 'JWT.verify($P, "...", ...);

          '
      - pattern: 'JWT.sign($P, "...", ...);

          '
      - pattern: "JWT.verify($P, JWK.asKey(\"...\"), ...);     \n"
      - pattern: '$JWT.sign($P, JWK.asKey("..."), ...);

          '
    severity: WARNING
- rules:
  - id: jose-exposed-data
    languages:
    - javascript
    - typescript
    message: The object is passed strictly to jose.JWT.sign(...) Make sure that sensitive
      information is not exposed through JWT token payload.
    metadata:
      asvs:
        control_id: 3.5.2 Static API keys or secret
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
        section: 'V3: Session Management Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-522: Insufficiently Protected Credentials'
      cwe2021-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A02:2017 - Broken Authentication
      - A04:2021 - Insecure Design
      references:
      - https://owasp.org/Top10/A04_2021-Insecure_Design
      source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
      subcategory:
      - audit
      technology:
      - jose
      - jwt
    patterns:
    - pattern-inside: 'require(''jose'');

        ...

        '
    - pattern-either:
      - patterns:
        - pattern-inside: function (...,$INPUT,...) {...}
        - pattern-either:
          - pattern: $JOSE.JWT.sign($INPUT,...)
          - pattern: $JWT.sign($INPUT,...)
      - patterns:
        - pattern-inside: function $F(...,$INPUT,...) {...}
        - pattern-either:
          - pattern: $JOSE.JWT.sign($INPUT,...)
          - pattern: $JWT.sign($INPUT,...)
    severity: WARNING
- rules:
  - id: chrome-remote-interface-compilescript-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `compileScript` method it can result
      in Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://github.com/cyrus-and/chrome-remote-interface
      subcategory:
      - vuln
      technology:
      - chrome-remote-interface
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: 'require(''chrome-remote-interface'');

            ...

            '
        - pattern-inside: 'import ''chrome-remote-interface'';

            ...

            '
      - pattern-either:
        - pattern: '$RUNTIME.compileScript({expression: $SINK},...)

            '
        - pattern: '$RUNTIME.evaluate({expression: $SINK},...)

            '
        - pattern: '$PAGE.navigate({url: $SINK},...)

            '
        - pattern: '$RUNTIME.printToPDF({headerTemplate: $SINK},...)

            '
        - pattern: '$RUNTIME.printToPDF({footerTemplate: $SINK},...)

            '
        - pattern: '$PAGE.setDocumentContent({html: $SINK},...)

            '
      - focus-metavariable: $SINK
    pattern-sources:
    - patterns:
      - pattern-inside: function ... (..., $ARG,...) {...}
      - focus-metavariable: $ARG
    severity: WARNING
- rules:
  - id: grpc-nodejs-insecure-connection
    languages:
    - javascript
    - typescript
    message: Found an insecure gRPC connection. This creates a connection without
      encryption to a gRPC client/server. A malicious attacker could tamper with the
      gRPC message, which could compromise the machine.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-502: Deserialization of Untrusted Data'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A08:2017 - Insecure Deserialization
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://blog.gopheracademy.com/advent-2017/go-grpc-beyond-basics/#:~:text=disables%20transport%20security
      subcategory:
      - audit
      technology:
      - grpc
    pattern-either:
    - pattern: 'require(''grpc'');

        ...

        $GRPC($ADDR,...,$CREDENTIALS.createInsecure(),...);

        '
    - pattern: 'require(''grpc'');

        ...

        new $GRPC($ADDR,...,$CREDENTIALS.createInsecure(),...);

        '
    - pattern: 'require(''grpc'');

        ...

        $CREDS = <... $CREDENTIALS.createInsecure() ...>;

        ...

        $GRPC($ADDR,...,$CREDS,...);'
    - pattern: 'require(''grpc'');

        ...

        $CREDS = <... $CREDENTIALS.createInsecure() ...>;

        ...

        new $GRPC($ADDR,...,$CREDS,...);'
    severity: ERROR
- rules:
  - id: avoid-v-html
    languages:
    - regex
    message: Dynamically rendering arbitrary HTML on your website can be very dangerous
      because it can easily lead to XSS vulnerabilities. Only use HTML interpolation
      on trusted content and never on user-provided content.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://vuejs.org/v2/guide/syntax.html#Raw-HTML
      subcategory:
      - audit
      technology:
      - vue
    paths:
      include:
      - '*.vue'
    pattern-regex: <[^<>]*v-html=
    severity: WARNING
- rules:
  - id: unsafe-serialize-javascript
    languages:
    - javascript
    - typescript
    message: '`serialize-javascript` used with `unsafe` parameter, this could be vulnerable
      to XSS.'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-80: Improper Neutralization of Script-Related HTML Tags in a Web Page
        (Basic XSS)'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - serialize-javascript
    patterns:
    - pattern-inside: '$S = require(''serialize-javascript'');

        ...

        '
    - pattern-not-inside: escape(...)
    - pattern-not-inside: encodeURI(...)
    - pattern: '$S(..., {unsafe: true});

        '
    severity: WARNING
- rules:
  - id: unsafe-argon2-config
    languages:
    - javascript
    - typescript
    message: Prefer Argon2id where possible. Per RFC9016, section 4 IETF recommends
      selecting Argon2id unless you can guarantee an adversary has no direct access
      to the computing environment.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-916: Use of Password Hash With Insufficient Computational Effort'
      impact: LOW
      likelihood: HIGH
      owasp:
      - A02:2021 - Cryptographic Failures
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html
      - https://eprint.iacr.org/2016/759.pdf
      - https://www.cs.tau.ac.il/~tromer/papers/cache-joc-20090619.pdf
      - https://datatracker.ietf.org/doc/html/rfc9106#section-4
      subcategory:
      - vuln
      technology:
      - argon2
      - cryptography
    mode: taint
    pattern-sanitizers:
    - patterns:
      - pattern: '{type: $ARGON.argon2id}

          ...

          '
    pattern-sinks:
    - patterns:
      - pattern: '$Y

          '
      - pattern-inside: '$ARGON.hash(...,$Y)

          '
    pattern-sources:
    - patterns:
      - pattern-inside: '$ARGON = require(''argon2'');

          ...

          '
      - pattern: '{type: ...}

          '
    severity: WARNING
- rules:
  - id: wkhtmltopdf-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `wkhtmltopdf` it can result in
      Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - wkhtmltopdf
    patterns:
    - pattern-inside: '$WK = require(''wkhtmltopdf'');

        ...

        '
    - pattern-not-inside: 'var $INPUT = "...";

        ...

        '
    - pattern: $WK($INPUT,...)
    - pattern-not: $WK("...",...)
    severity: WARNING
- rules:
  - id: intercom-settings-user-identifier-without-user-hash
    languages:
    - js
    message: Found an initialization of the Intercom Messenger that identifies a User,
      but does not specify a `user_hash`. This configuration allows users to impersonate
      one another. See the Intercom Identity Verification docs for more context https://www.intercom.com/help/en/articles/183-set-up-identity-verification-for-web-and-mobile
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-287: Improper Authentication'
      impact: HIGH
      likelihood: MEDIUM
      references:
      - https://www.intercom.com/help/en/articles/183-set-up-identity-verification-for-web-and-mobile
      subcategory:
      - audit
      technology:
      - intercom
    patterns:
    - pattern-either:
      - pattern: 'window.intercomSettings = {..., email: $EMAIL, ...};

          '
      - pattern: 'window.intercomSettings = {..., user_id: $USER_ID, ...};

          '
      - pattern: 'Intercom(''boot'', {..., email: $EMAIL, ...});

          '
      - pattern: 'Intercom(''boot'', {..., user_id: $USER_ID, ...});

          '
      - pattern: '$VAR = {..., email: $EMAIL, ...};

          ...

          Intercom(''boot'', $VAR);

          '
      - pattern: '$VAR = {..., user_id: $EMAIL, ...};

          ...

          Intercom(''boot'', $VAR);

          '
    - pattern-not: 'window.intercomSettings = {..., user_hash: $USER_HASH, ...};

        '
    - pattern-not: 'Intercom(''boot'', {..., user_hash: $USER_HASH, ...});

        '
    - pattern-not: '$VAR = {..., user_hash: $USER_HASH, ...};

        ...

        Intercom(''boot'', $VAR);

        '
    severity: WARNING
- rules:
  - id: jwt-none-alg
    languages:
    - javascript
    - typescript
    message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm
      assumes the integrity of the token has already been verified. This would allow
      a malicious actor to forge a JWT token that will automatically be verified.
      Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as
      'HS256'.
    metadata:
      asvs:
        control_id: 3.5.3 Insecue Stateless Session Tokens
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
        section: 'V3: Session Management Verification Requirements'
        version: '4'
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: HIGH
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
      subcategory:
      - vuln
      technology:
      - jwt
    patterns:
    - pattern-inside: '$JWT = require("jsonwebtoken");

        ...

        '
    - pattern: $JWT.verify($P, $X, {algorithms:[...,'none',...]},...)
    severity: ERROR
- rules:
  - id: hardcoded-jwt-secret
    languages:
    - javascript
    - typescript
    message: A hard-coded credential was detected. It is not recommended to store
      credentials in source-code, as this risks secrets being leaked and used by either
      an internal or external malicious adversary. It is recommended to use environment
      variables to securely provide credentials or retrieve credentials from a secure
      vault or HSM (Hardware Security Module).
    metadata:
      asvs:
        control_id: 3.5.2 Static API keys or secret
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
        section: 'V3: Session Management Verification Requirements'
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-798: Use of Hard-coded Credentials'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
      subcategory:
      - vuln
      technology:
      - jwt
      - javascript
      - secrets
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: '$JWT = require("jsonwebtoken")

            ...

            '
        - pattern-inside: 'import $JWT from "jsonwebtoken"

            ...

            '
        - pattern-inside: 'import * as $JWT from "jsonwebtoken"

            ...

            '
        - pattern-inside: 'import {...,$JWT,...} from "jsonwebtoken"

            ...

            '
      - pattern-either:
        - pattern-inside: '$JWT.sign($DATA,$VALUE,...);

            '
        - pattern-inside: '$JWT.verify($DATA,$VALUE,...);

            '
      - focus-metavariable: $VALUE
    pattern-sources:
    - patterns:
      - pattern: "$X = '...' \n"
      - pattern: "$X = '$Y' \n"
    - patterns:
      - pattern-either:
        - pattern-inside: '$JWT.sign($DATA,"...",...);

            '
        - pattern-inside: '$JWT.verify($DATA,"...",...);

            '
    severity: WARNING
- rules:
  - id: jwt-exposed-data
    languages:
    - javascript
    - typescript
    message: The object is passed strictly to jsonwebtoken.sign(...) Make sure that
      sensitive information is not exposed through JWT token payload.
    metadata:
      asvs:
        control_id: 3.5.3 Insecue Stateless Session Tokens
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
        section: 'V3: Session Management Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-522: Insufficiently Protected Credentials'
      cwe2021-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A02:2017 - Broken Authentication
      - A04:2021 - Insecure Design
      references:
      - https://owasp.org/Top10/A04_2021-Insecure_Design
      source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
      subcategory:
      - audit
      technology:
      - jwt
    patterns:
    - pattern-inside: '$JWT = require(''jsonwebtoken'');

        ...

        '
    - pattern-either:
      - pattern-inside: function (...,$INPUT,...) {...}
      - pattern-inside: function $F(...,$INPUT,...) {...}
    - pattern: $JWT.sign($INPUT,...)
    severity: WARNING
- rules:
  - id: jwt-decode-without-verify
    languages:
    - javascript
    - typescript
    message: Detected the decoding of a JWT token without a verify step. JWT tokens
      must be verified before use, otherwise the token's integrity is unknown. This
      means a malicious actor could forge a JWT token with any claims. Call '.verify()'
      before using the token.
    metadata:
      asvs:
        control_id: 3.5.3 Insecue Stateless Session Tokens
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
        section: 'V3: Session Management Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-345: Insufficient Verification of Data Authenticity'
      impact: LOW
      likelihood: LOW
      owasp:
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
      source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
      subcategory:
      - audit
      technology:
      - jwt
    patterns:
    - pattern-inside: '$JWT = require(''jsonwebtoken'');

        ...

        '
    - pattern-not-inside: '...

        $JWT.verify($TOKEN, ...)

        ...

        '
    - pattern-not-inside: '...

        if (<... $JWT.verify($TOKEN, ...) ...>) { ... }

        ...

        '
    - pattern: $JWT.decode($TOKEN, ...)
    severity: WARNING
- rules:
  - id: playwright-evaluate-code-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `evaluate` method it can result
      in Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - playwright
    patterns:
    - pattern-inside: 'require(''playwright'');

        ...

        '
    - pattern-not-inside: 'var $INPUT = function $FNAME(...){...};

        ...

        '
    - pattern-either:
      - pattern: $PAGE.evaluate($INPUT,...)
      - pattern: $PAGE.evaluateHandle($INPUT,...)
      - pattern: $PAGE.evaluateOnNewDocument($INPUT,...)
    - pattern-not: $PAGE.evaluate("...",...)
    - pattern-not: $PAGE.evaluate(function(...){...},...)
    - pattern-not: $PAGE.evaluateHandle("...",...)
    - pattern-not: $PAGE.evaluateHandle(function(...){...},...)
    - pattern-not: $PAGE.evaluateOnNewDocument("...",...)
    - pattern-not: $PAGE.evaluateOnNewDocument(function(...){...},...)
    severity: WARNING
- rules:
  - id: playwright-goto-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `goto` method it can result in
      Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - playwright
    patterns:
    - pattern-inside: 'require(''playwright'');

        ...

        '
    - pattern-not-inside: 'require(''playwright'');

        ...

        var $INPUT = "...";

        ...

        $PAGE.goto($INPUT,...)

        '
    - pattern: $PAGE.goto($INPUT,...)
    - pattern-not: $PAGE.goto("...",...)
    severity: WARNING
- rules:
  - id: playwright-addinitscript-code-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `addInitScript` method it can result
      in Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - playwright
    patterns:
    - pattern-inside: 'require(''playwright'');

        ...

        '
    - pattern-not-inside: 'var $INPUT = function $FNAME(...){...};

        ...

        '
    - pattern: $CONTEXT.addInitScript($INPUT,...)
    - pattern-not: $CONTEXT.addInitScript("...",...)
    - pattern-not: $CONTEXT.addInitScript(function(...){...},...)
    severity: WARNING
- rules:
  - id: playwright-exposed-chrome-devtools
    languages:
    - javascript
    - typescript
    message: Remote debugging protocol does not perform any authentication, so exposing
      it too widely can be a security risk.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - playwright
    patterns:
    - pattern-inside: 'require(''playwright'');

        ...

        '
    - pattern-either:
      - pattern-regex: --remote-debugging-address
      - pattern-regex: --remote-debugging-port
      - pattern-regex: --remote-debugging-socket-name
      - pattern-regex: --remote-debugging-targets
    severity: WARNING
- rules:
  - id: playwright-setcontent-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `setContent` method it can result
      in Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - playwright
    patterns:
    - pattern-inside: 'require(''playwright'');

        ...

        '
    - pattern-not-inside: 'require(''playwright'');

        ...

        var $INPUT = "...";

        ...

        $PAGE.setContent($INPUT,...)

        '
    - pattern: $PAGE.setContent($INPUT,...)
    - pattern-not: $PAGE.setContent("...",...)
    severity: WARNING
- rules:
  - id: playwright-evaluate-arg-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `evaluate` method it can result
      in Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - playwright
    patterns:
    - pattern-inside: 'require(''playwright'');

        ...

        '
    - pattern-either:
      - pattern-inside: function $FUNC (...,$INPUT,...) {...}
      - pattern-inside: function (...,$INPUT,...) {...}
    - pattern-either:
      - pattern: $PAGE.evaluate($CODE,...,<... $INPUT ...>,...)
      - pattern: $PAGE.evaluateHandle($CODE,...,<... $INPUT ...>,...)
    severity: WARNING
- rules:
  - id: dynamodb-request-object
    languages:
    - javascript
    - typescript
    message: Detected DynamoDB query params that are tainted by `$EVENT` object. This
      could lead to NoSQL injection if the variable is user-controlled and not properly
      sanitized. Explicitly assign query params instead of passing data from `$EVENT`
      directly to DynamoDB client.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-943: Improper Neutralization of Special Elements in Data Query Logic'
      impact: HIGH
      likelihood: MEDIUM
      owasp:
      - A01:2017 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - javascript
      - aws-lambda
      - dynamodb
    mode: taint
    pattern-sanitizers:
    - patterns:
      - pattern: '{...}

          '
    pattern-sinks:
    - patterns:
      - focus-metavariable: $SINK
      - pattern: '$DC.$METHOD($SINK, ...)

          '
      - metavariable-regex:
          metavariable: $METHOD
          regex: (query|send|scan|delete|put|transactWrite|update|batchExecuteStatement|executeStatement|executeTransaction|transactWriteItems)
      - pattern-either:
        - pattern-inside: '$DC = new $AWS.DocumentClient(...);

            ...

            '
        - pattern-inside: '$DC = new $AWS.DynamoDB(...);

            ...

            '
        - pattern-inside: '$DC = new DynamoDBClient(...);

            ...

            '
        - pattern-inside: '$DC = DynamoDBDocumentClient.from(...);

            ...

            '
    pattern-sources:
    - patterns:
      - pattern: $EVENT
      - pattern-either:
        - pattern-inside: "exports.handler = function ($EVENT, ...) {\n  ...\n}\n"
        - pattern-inside: 'function $FUNC ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
        - pattern-inside: '$FUNC = function ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
    severity: ERROR
- rules:
  - id: vm-runincontext-injection
    languages:
    - javascript
    - typescript
    message: The `vm` module enables compiling and running code within V8 Virtual
      Machine contexts. The `vm` module is not a security mechanism. Do not use it
      to run untrusted code. If code passed to `vm` functions is controlled by user
      input it could result in command injection. Do not let user input in `vm` functions.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - javascript
      - aws-lambda
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: 'require(''vm'');

            ...

            '
        - pattern-inside: 'import ''vm''

            ...

            '
      - pattern-either:
        - pattern: $VM.runInContext($X,...)
        - pattern: $VM.runInNewContext($X,...)
        - pattern: $VM.runInThisContext($X,...)
        - pattern: $VM.compileFunction($X,...)
        - pattern: new $VM.Script($X,...)
        - pattern: new $VM.SourceTextModule($X,...)
        - pattern: runInContext($X,...)
        - pattern: runInNewContext($X,...)
        - pattern: runInThisContext($X,...)
        - pattern: compileFunction($X,...)
        - pattern: new Script($X,...)
        - pattern: new SourceTextModule($X,...)
    pattern-sources:
    - patterns:
      - pattern: $EVENT
      - pattern-either:
        - pattern-inside: "exports.handler = function ($EVENT, ...) {\n  ...\n}\n"
        - pattern-inside: 'function $FUNC ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
        - pattern-inside: '$FUNC = function ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
    severity: ERROR
- rules:
  - id: tainted-sql-string
    languages:
    - javascript
    - typescript
    message: Detected user input used to manually construct a SQL string. This is
      usually bad practice because manual construction could accidentally result in
      a SQL injection. An attacker could use a SQL injection to steal or modify contents
      of the database. Instead, use a parameterized query which is available by default
      in most database engines. Alternatively, consider using an object-relational
      mapper (ORM) such as Sequelize which will protect your queries.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/www-community/attacks/SQL_Injection
      subcategory:
      - vuln
      technology:
      - aws-lambda
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - patterns:
          - pattern-either:
            - pattern: '"$SQLSTR" + $EXPR

                '
            - pattern: '"$SQLSTR".concat(...)

                '
            - pattern: util.format($SQLSTR, ...)
          - metavariable-regex:
              metavariable: $SQLSTR
              regex: .*\b(?i)(select|delete|insert|create|update|alter|drop)\b.*
        - patterns:
          - pattern: '`...${...}...`

              '
          - pattern-regex: '.*\b(?i)(select|delete|insert|create|update|alter|drop)\b.*

              '
      - pattern-not-inside: 'console.$LOG(...)

          '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: "exports.handler = function ($EVENT, ...) {\n  ...\n}\n"
        - pattern-inside: 'function $FUNC ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
        - pattern-inside: '$FUNC = function ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
      - pattern: $EVENT
    severity: ERROR
- rules:
  - id: tainted-html-response
    languages:
    - javascript
    - typescript
    message: Detected user input flowing into an HTML response. You may be accidentally
      bypassing secure methods of rendering HTML by manually constructing HTML and
      this could create a cross-site scripting vulnerability, which could let attackers
      steal sensitive user data.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - aws-lambda
    mode: taint
    pattern-sinks:
    - patterns:
      - focus-metavariable: $BODY
      - pattern-inside: '{..., headers: {..., ''Content-Type'': ''text/html'', ...},
          body: $BODY, ... }

          '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: "exports.handler = function ($EVENT, ...) {\n  ...\n}\n"
        - pattern-inside: 'function $FUNC ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
        - pattern-inside: '$FUNC = function ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
      - pattern: $EVENT
    severity: WARNING
- rules:
  - id: mysql-sqli
    languages:
    - javascript
    - typescript
    message: 'Detected SQL statement that is tainted by `$EVENT` object. This could
      lead to SQL injection if the variable is user-controlled and not properly sanitized.
      In order to prevent SQL injection, use parameterized queries or prepared statements
      instead. You can use parameterized statements like so: `connection.query(''SELECT
      $1 from table'', [userinput])`'
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: MEDIUM
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://www.npmjs.com/package/mysql2
      subcategory:
      - vuln
      technology:
      - aws-lambda
      - mysql
      - mysql2
    mode: taint
    pattern-sinks:
    - patterns:
      - focus-metavariable: $QUERY
      - pattern-either:
        - pattern: $POOL.query($QUERY, ...)
        - pattern: $POOL.execute($QUERY, ...)
      - pattern-either:
        - pattern-inside: 'require(''mysql'')

            ...

            '
        - pattern-inside: 'require(''mysql2'')

            ...

            '
        - pattern-inside: 'require(''mysql2/promise'')

            ...

            '
        - pattern-inside: 'import ''mysql''

            ...

            '
        - pattern-inside: 'import ''mysql2''

            ...

            '
        - pattern-inside: 'import ''mysql2/promise''

            ...

            '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: "exports.handler = function ($EVENT, ...) {\n  ...\n}\n"
        - pattern-inside: 'function $FUNC ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
        - pattern-inside: '$FUNC = function ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
      - pattern: $EVENT
    severity: WARNING
- rules:
  - id: knex-sqli
    languages:
    - javascript
    - typescript
    message: 'Detected SQL statement that is tainted by `$EVENT` object. This could
      lead to SQL injection if the variable is user-controlled and not properly sanitized.
      In order to prevent SQL injection, use parameterized queries or prepared statements
      instead. You can use parameterized statements like so: `knex.raw(''SELECT $1
      from table'', [userinput])`'
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: MEDIUM
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://knexjs.org/#Builder-fromRaw
      - https://knexjs.org/#Builder-whereRaw
      subcategory:
      - vuln
      technology:
      - aws-lambda
      - knex
    mode: taint
    pattern-sinks:
    - patterns:
      - focus-metavariable: $QUERY
      - pattern-either:
        - pattern: $KNEX.fromRaw($QUERY, ...)
        - pattern: $KNEX.whereRaw($QUERY, ...)
        - pattern: $KNEX.raw($QUERY, ...)
      - pattern-either:
        - pattern-inside: 'require(''knex'')

            ...

            '
        - pattern-inside: 'import ''knex''

            ...

            '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: "exports.handler = function ($EVENT, ...) {\n  ...\n}\n"
        - pattern-inside: 'function $FUNC ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
        - pattern-inside: '$FUNC = function ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
      - pattern: $EVENT
    severity: WARNING
- rules:
  - id: tainted-eval
    languages:
    - javascript
    - typescript
    message: The `eval()` function evaluates JavaScript code represented as a string.
      Executing JavaScript from a string is an enormous security risk. It is far too
      easy for a bad actor to run arbitrary code when you use `eval()`. Ensure evaluated
      content is not definable by external sources.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code
        (''Eval Injection'')'
      impact: HIGH
      likelihood: MEDIUM
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - javascript
      - aws-lambda
    mode: taint
    pattern-sinks:
    - patterns:
      - focus-metavariable: $CODE
      - pattern-either:
        - pattern: eval($CODE)
        - pattern: Function(...,$CODE)
        - pattern: new Function(...,$CODE)
    pattern-sources:
    - patterns:
      - pattern: $EVENT
      - pattern-either:
        - pattern-inside: "exports.handler = function ($EVENT, ...) {\n  ...\n}\n"
        - pattern-inside: 'function $FUNC ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
        - pattern-inside: '$FUNC = function ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
    severity: WARNING
- rules:
  - id: detect-child-process
    languages:
    - javascript
    - typescript
    message: Allowing spawning arbitrary programs or running shell processes with
      arbitrary arguments may end up in a command injection vulnerability. Try to
      avoid non-literal values for the command string. If it is not possible, then
      do not let running arbitrary commands, use a white list for inputs.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: MEDIUM
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - javascript
      - aws-lambda
    mode: taint
    pattern-sinks:
    - patterns:
      - focus-metavariable: $CMD
      - pattern-either:
        - pattern: exec($CMD,...)
        - pattern: execSync($CMD,...)
        - pattern: spawn($CMD,...)
        - pattern: spawnSync($CMD,...)
        - pattern: $CP.exec($CMD,...)
        - pattern: $CP.execSync($CMD,...)
        - pattern: $CP.spawn($CMD,...)
        - pattern: $CP.spawnSync($CMD,...)
      - pattern-either:
        - pattern-inside: 'require(''child_process'')

            ...

            '
        - pattern-inside: 'import ''child_process''

            ...

            '
    pattern-sources:
    - patterns:
      - pattern: $EVENT
      - pattern-either:
        - pattern-inside: "exports.handler = function ($EVENT, ...) {\n  ...\n}\n"
        - pattern-inside: 'function $FUNC ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
        - pattern-inside: '$FUNC = function ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
    severity: ERROR
- rules:
  - id: tainted-html-string
    languages:
    - javascript
    - typescript
    message: Detected user input flowing into a manually constructed HTML string.
      You may be accidentally bypassing secure methods of rendering HTML by manually
      constructing HTML and this could create a cross-site scripting vulnerability,
      which could let attackers steal sensitive user data. To be sure this is safe,
      check that the HTML is rendered safely. Otherwise, use templates which will
      safely render HTML instead.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - aws-lambda
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - patterns:
          - pattern-either:
            - pattern: '"$HTMLSTR" + $EXPR

                '
            - pattern: '"$HTMLSTR".concat(...)

                '
            - pattern: $UTIL.format($HTMLSTR, ...)
            - pattern: format($HTMLSTR, ...)
          - metavariable-pattern:
              language: generic
              metavariable: $HTMLSTR
              pattern: <$TAG ...
        - patterns:
          - pattern: '`...${...}...`

              '
          - pattern-regex: '.*<\w+.*

              '
      - pattern-not-inside: 'console.$LOG(...)

          '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: "exports.handler = function ($EVENT, ...) {\n  ...\n}\n"
        - pattern-inside: 'function $FUNC ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
        - pattern-inside: '$FUNC = function ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
      - pattern: $EVENT
    severity: WARNING
- rules:
  - id: sequelize-sqli
    languages:
    - javascript
    - typescript
    message: 'Detected SQL statement that is tainted by `$EVENT` object. This could
      lead to SQL injection if the variable is user-controlled and not properly sanitized.
      In order to prevent SQL injection, use parameterized queries or prepared statements
      instead. You can use parameterized statements like so: `sequelize.query(''SELECT
      * FROM projects WHERE status = ?'', { replacements: [''active''], type: QueryTypes.SELECT
      });`'
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: MEDIUM
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://sequelize.org/master/manual/raw-queries.html
      subcategory:
      - vuln
      technology:
      - aws-lambda
      - sequelize
    mode: taint
    pattern-sinks:
    - patterns:
      - focus-metavariable: $QUERY
      - pattern-either:
        - pattern: $DB.query($QUERY, ...)
      - pattern-either:
        - pattern-inside: 'require(''sequelize'')

            ...

            '
        - pattern-inside: 'import ''sequelize''

            ...

            '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: "exports.handler = function ($EVENT, ...) {\n  ...\n}\n"
        - pattern-inside: 'function $FUNC ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
        - pattern-inside: '$FUNC = function ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
      - pattern: $EVENT
    severity: WARNING
- rules:
  - id: pg-sqli
    languages:
    - javascript
    - typescript
    message: 'Detected SQL statement that is tainted by `$EVENT` object. This could
      lead to SQL injection if the variable is user-controlled and not properly sanitized.
      In order to prevent SQL injection, use parameterized queries or prepared statements
      instead. You can use parameterized statements like so: `connection.query(''SELECT
      $1 from table'', [userinput])`'
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: MEDIUM
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://node-postgres.com/features/queries
      subcategory:
      - vuln
      technology:
      - aws-lambda
      - postgres
      - pg
    mode: taint
    pattern-sinks:
    - patterns:
      - focus-metavariable: $QUERY
      - pattern-either:
        - pattern: $DB.query($QUERY, ...)
      - pattern-either:
        - pattern-inside: 'require(''pg'')

            ...

            '
        - pattern-inside: 'import ''pg''

            ...

            '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: "exports.handler = function ($EVENT, ...) {\n  ...\n}\n"
        - pattern-inside: 'function $FUNC ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
        - pattern-inside: '$FUNC = function ($EVENT, ...) {...}

            ...

            exports.handler = $FUNC

            '
      - pattern: $EVENT
    severity: WARNING
- rules:
  - id: xml2json-xxe
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the XML Parser it can result in XML
      External or Internal Entity (XXE) Processing vulnerabilities
    metadata:
      asvs:
        control_id: 5.5.2 Insecue XML Deserialization
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
      subcategory:
      - audit
      technology:
      - xml2json
    patterns:
    - pattern: 'var $XML = require(''xml2json'');

        ...

        $XML.toJson(...);

        '
    - pattern-not: 'var $XML = require(''xml2json'');

        ...

        $XML.toJson("...",...);

        '
    - pattern-not: 'var $XML = require(''xml2json'');

        ...

        var $S = "...";

        ...

        $XML.toJson($S,...);'
    severity: WARNING
- rules:
  - id: calling-set-state-on-current-state
    languages:
    - javascript
    message: Calling setState on the current state is always a no-op. Did you mean
      to change the state like $Y(!$X) instead?
    metadata:
      category: correctness
      technology:
      - react
    patterns:
    - pattern: $Y($X);
    - pattern-inside: 'const [$X, $Y] = useState(...);

        ...

        '
    severity: ERROR
- rules:
  - id: deno-dangerous-run
    languages:
    - javascript
    - typescript
    message: Detected non-literal calls to Deno.run(). This could lead to a command
      injection vulnerability.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://deno.land/manual/examples/subprocess#simple-example
      subcategory:
      - vuln
      technology:
      - deno
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: 'Deno.run({cmd: [$INPUT,...]},...)

            '
        - pattern: 'Deno.run({cmd: ["=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$INPUT,...]},...)

            '
        - patterns:
          - pattern: 'Deno.run({cmd: [$CMD,"-c",$INPUT,...]},...)

              '
          - pattern-inside: '$CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/"

              ...

              '
      - focus-metavariable: $INPUT
    pattern-sources:
    - patterns:
      - pattern-inside: function ... (..., $ARG,...) {...}
      - focus-metavariable: $ARG
    severity: ERROR
- rules:
  - id: phantom-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `phantom` page methods it can result
      in Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - phantom
    patterns:
    - pattern-inside: '$PHANTOM = require(''phantom'');

        ...

        '
    - pattern-either:
      - pattern: $PAGE.open($INPUT,...)
      - pattern: $PAGE.property("content",$INPUT,...)
      - pattern: $PAGE.setContent($INPUT,...)
      - pattern: $PAGE.openUrl($INPUT,...)
      - pattern: $PAGE.evaluateJavaScript($INPUT,...)
    - pattern-not: $PAGE.open("...",...)
    - pattern-not: $PAGE.property("content","...",...)
    - pattern-not: $PAGE.setContent("...",...)
    - pattern-not: $PAGE.openUrl("...",...)
    - pattern-not: $PAGE.evaluateJavaScript("...",...)
    severity: WARNING
- rules:
  - id: raw-html-concat
    languages:
    - javascript
    - typescript
    message: User controlled data in a HTML string may result in XSS
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/www-community/attacks/xss/
      subcategory:
      - vuln
      technology:
      - browser
    mode: taint
    pattern-sanitizers:
    - patterns:
      - pattern-either:
        - pattern-inside: 'import $S from "underscore.string"

            ...

            '
        - pattern-inside: 'import * as $S from "underscore.string"

            ...

            '
        - pattern-inside: 'import $S from "underscore.string"

            ...

            '
        - pattern-inside: '$S = require("underscore.string")

            ...

            '
      - pattern-either:
        - pattern: $S.escapeHTML(...)
    - patterns:
      - pattern-either:
        - pattern-inside: 'import $S from "dompurify"

            ...

            '
        - pattern-inside: 'import { ..., $S,... } from "dompurify"

            ...

            '
        - pattern-inside: 'import * as $S from "dompurify"

            ...

            '
        - pattern-inside: '$S = require("dompurify")

            ...

            '
        - pattern-inside: 'import $S from "isomorphic-dompurify"

            ...

            '
        - pattern-inside: 'import * as $S from "isomorphic-dompurify"

            ...

            '
        - pattern-inside: '$S = require("isomorphic-dompurify")

            ...

            '
      - pattern-either:
        - patterns:
          - pattern-inside: '$VALUE = $S(...)

              ...

              '
          - pattern: $VALUE.sanitize(...)
        - patterns:
          - pattern-inside: '$VALUE = $S.sanitize

              ...

              '
          - pattern: $S(...)
        - pattern: $S.sanitize(...)
        - pattern: $S(...)
    - patterns:
      - pattern-either:
        - pattern-inside: 'import $S from ''xss'';

            ...

            '
        - pattern-inside: 'import * as $S from ''xss'';

            ...

            '
        - pattern-inside: '$S = require("xss")

            ...

            '
      - pattern: $S(...)
    - patterns:
      - pattern-either:
        - pattern-inside: 'import $S from ''sanitize-html'';

            ...

            '
        - pattern-inside: 'import * as $S from "sanitize-html";

            ...

            '
        - pattern-inside: '$S = require("sanitize-html")

            ...

            '
      - pattern: $S(...)
    - patterns:
      - pattern-either:
        - pattern-inside: '$S = new Remarkable()

            ...

            '
      - pattern: $S.render(...)
    pattern-sinks:
    - patterns:
      - pattern-either:
        - patterns:
          - pattern: $STRING + $EXPR
          - pattern-not: $STRING + "..."
          - metavariable-pattern:
              language: generic
              metavariable: $STRING
              patterns:
              - pattern: <$TAG ...
              - pattern-not: <$TAG ...>...</$TAG>...
        - patterns:
          - pattern: $EXPR + $STRING
          - pattern-not: '"..." + $STRING'
          - metavariable-pattern:
              language: generic
              metavariable: $STRING
              patterns:
              - pattern: '... </$TAG'
        - patterns:
          - pattern: '[..., $STRING, ...].join(...)'
          - metavariable-pattern:
              language: generic
              metavariable: $STRING
              patterns:
              - pattern: <$TAG ...
        - patterns:
          - pattern: '[..., $STRING, ...].join(...)'
          - metavariable-pattern:
              language: generic
              metavariable: $STRING
              patterns:
              - pattern: '... </$TAG'
        - patterns:
          - pattern: $VAR += $STRING
          - metavariable-pattern:
              language: generic
              metavariable: $STRING
              patterns:
              - pattern: <$TAG ...
        - patterns:
          - pattern: $VAR += $STRING
          - metavariable-pattern:
              language: generic
              metavariable: $STRING
              patterns:
              - pattern: '... </$TAG'
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: location.href
        - pattern: location.hash
        - pattern: location.search
        - pattern: $WINDOW. ... .location.href
        - pattern: $WINDOW. ... .location.hash
        - pattern: $WINDOW. ... .location.search
    severity: WARNING
- rules:
  - id: eval-detected
    languages:
    - javascript
    - typescript
    message: Detected the use of eval(). eval() can be dangerous if used to evaluate
      dynamic content. If this content can be input from outside the program, this
      may be a code injection vulnerability. Ensure evaluated content is not definable
      by external sources.
    metadata:
      asvs:
        control_id: 5.2.4 Dynamic Code Execution Features
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v52-sanitization-and-sandboxing
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code
        (''Eval Injection'')'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - browser
    patterns:
    - pattern-not: eval("...")
    - pattern: eval(...)
    severity: WARNING
- rules:
  - id: wildcard-postmessage-configuration
    languages:
    - javascript
    - typescript
    message: The target origin of the window.postMessage() API is set to "*". This
      could allow for information disclosure due to the possibility of any origin
      allowed to receive the message.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-345: Insufficient Verification of Data Authenticity'
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
      subcategory:
      - audit
      technology:
      - browser
    pattern: $OBJECT.postMessage(...,'*')
    severity: WARNING
- rules:
  - id: dom-based-xss
    languages:
    - javascript
    - typescript
    message: 'Detected possible DOM-based XSS. This occurs because a portion of the
      URL is being used to construct an element added directly to the page. For example,
      a malicious actor could send someone a link like this: http://www.some.site/page.html?default=<script>alert(document.cookie)</script>
      which would add the script to the page. Consider allowlisting appropriate values
      or using an approach which does not involve the URL.'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/www-community/attacks/DOM_Based_XSS
      subcategory:
      - audit
      technology:
      - browser
    pattern-either:
    - pattern: document.write(<... document.location.$W ...>)
    - pattern: document.write(<... location.$W ...>)
    severity: ERROR
- rules:
  - id: raw-html-join
    languages:
    - javascript
    - typescript
    message: User controlled data in a HTML string may result in XSS
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/www-community/attacks/xss/
      subcategory:
      - audit
      technology:
      - browser
    patterns:
    - pattern-either:
      - patterns:
        - pattern: '[..., $STRING, ...].join(...)

            '
        - metavariable-pattern:
            language: generic
            metavariable: $STRING
            patterns:
            - pattern-either:
              - pattern: '... </$TAG

                  '
              - pattern: '<$TAG ...

                  '
        - pattern-not: '[..., "$HARDCODED", ...].join("...")

            '
    severity: WARNING
- rules:
  - id: insufficient-postmessage-origin-validation
    languages:
    - javascript
    - typescript
    message: No validation of origin is done by the addEventListener API. It may be
      possible to exploit this flaw to perform Cross Origin attacks such as Cross-Site
      Scripting(XSS).
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-345: Insufficient Verification of Data Authenticity'
      impact: LOW
      likelihood: LOW
      owasp:
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
      subcategory:
      - audit
      technology:
      - browser
    pattern-either:
    - patterns:
      - pattern: 'window.addEventListener(''message'', $FUNC, ...)

          '
      - metavariable-pattern:
          metavariable: $FUNC
          patterns:
          - pattern: 'function($OBJ) { ... }

              '
          - pattern-not: 'function($OBJ) { ... if (<... $OBJ.origin ...>) { ... }
              ... }

              '
    - patterns:
      - pattern-either:
        - pattern-inside: 'function $FNAME($OBJ) { $CONTEXT }

            ...

            '
        - pattern-inside: '$FNAME = (...) => { $CONTEXT }

            ...

            '
      - pattern: 'window.addEventListener(''message'', $FNAME,...)

          '
      - metavariable-pattern:
          metavariable: $CONTEXT
          patterns:
          - pattern-not: '... if (<... $OBJ.origin ...>) { ... } ...

              '
    severity: WARNING
- rules:
  - id: js-open-redirect-from-function
    languages:
    - javascript
    - typescript
    message: The application accepts potentially user-controlled input `$PROP` which
      can control the location of the current window context. This can lead two types
      of vulnerabilities open-redirection and Cross-Site-Scripting (XSS) with JavaScript
      URIs. It is recommended to validate user-controllable input before allowing
      it to control the redirection.
    metadata:
      asvs:
        control_id: 5.5.1 Insecue Redirect
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v51-input-validation
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html
      subcategory:
      - vuln
      technology:
      - browser
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: location.href = $SINK
        - pattern: window.location.href = $SINK
        - pattern: this.window.location.href = $SINK
        - pattern: this.location.href = $SINK
        - pattern: location.replace($SINK)
        - pattern: window.location.replace($SINK)
        - pattern: this.window.location.replace($SINK)
        - pattern: this.location.replace($SINK)
      - focus-metavariable: $SINK
      - metavariable-pattern:
          metavariable: $SINK
          patterns:
          - pattern-not: '"..." + $VALUE

              '
          - pattern-not: '`...${$VALUE}`

              '
    pattern-sources:
    - patterns:
      - pattern-inside: 'function ... (..., $PROP, ...) { ... }

          '
      - focus-metavariable: $PROP
    severity: INFO
- rules:
  - id: js-open-redirect
    languages:
    - javascript
    - typescript
    message: The application accepts potentially user-controlled input `$PROP` which
      can control the location of the current window context. This can lead two types
      of vulnerabilities open-redirection and Cross-Site-Scripting (XSS) with JavaScript
      URIs. It is recommended to validate user-controllable input before allowing
      it to control the redirection.
    metadata:
      asvs:
        control_id: 5.5.1 Insecue Redirect
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v51-input-validation
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
      impact: MEDIUM
      interfile: true
      likelihood: HIGH
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html
      subcategory:
      - vuln
      technology:
      - browser
    mode: taint
    options:
      interfile: true
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: location.href = $SINK
        - pattern: $THIS. ... .location.href = $SINK
        - pattern: location.replace($SINK)
        - pattern: $THIS. ... .location.replace($SINK)
        - pattern: location = $SINK
        - pattern: $WINDOW. ... .location = $SINK
      - focus-metavariable: $SINK
      - metavariable-pattern:
          metavariable: $SINK
          patterns:
          - pattern-not: '"..." + $VALUE

              '
          - pattern-not: '`...${$VALUE}`

              '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: '$PROP = new URLSearchParams($WINDOW. ... .location.search).get(''...'')

            ...

            '
        - pattern-inside: '$PROP = new URLSearchParams(location.search).get(''...'')

            ...

            '
        - pattern-inside: '$PROP = new URLSearchParams($WINDOW. ... .location.hash.substring(1)).get(''...'')

            ...

            '
        - pattern-inside: '$PROP = new URLSearchParams(location.hash.substring(1)).get(''...'')

            ...

            '
      - pattern: $PROP
    - patterns:
      - pattern-either:
        - pattern-inside: '$PROPS = new URLSearchParams($WINDOW. ... .location.search)

            ...

            '
        - pattern-inside: '$PROPS = new URLSearchParams(location.search)

            ...

            '
        - pattern-inside: '$PROPS = new URLSearchParams($WINDOW. ... .location.hash.substring(1))

            ...

            '
        - pattern-inside: '$PROPS = new URLSearchParams(location.hash.substring(1))

            ...

            '
      - pattern: $PROPS.get('...')
    - patterns:
      - pattern-either:
        - pattern-inside: '$PROPS = new URL($WINDOW. ... .location.href)

            ...

            '
        - pattern-inside: '$PROPS = new URL(location.href)

            ...

            '
      - pattern: $PROPS.searchParams.get('...')
    - patterns:
      - pattern-either:
        - pattern-inside: '$PROPS = new URL($WINDOW. ... .location.href).searchParams.get(''...'')

            ...

            '
        - pattern-inside: '$PROPS = new URL(location.href).searchParams.get(''...'')

            ...

            '
      - pattern: $PROPS
    severity: WARNING
- rules:
  - id: insecure-document-method
    languages:
    - javascript
    - typescript
    message: User controlled data in methods like `innerHTML`, `outerHTML` or `document.write`
      is an anti-pattern that can lead to XSS vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - browser
    patterns:
    - pattern-either:
      - pattern: '$EL.innerHTML = $HTML;

          '
      - pattern: '$EL.outerHTML = $HTML;

          '
      - pattern: document.write(...)
    - pattern-not: '$EL.innerHTML = "...";

        '
    - pattern-not: '$EL.outerHTML = "...";

        '
    - pattern-not: document.write("...")
    severity: ERROR
- rules:
  - id: insecure-innerhtml
    languages:
    - javascript
    - typescript
    message: User controlled data in a `$EL.innerHTML` is an anti-pattern that can
      lead to XSS vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - browser
    patterns:
    - pattern: '$EL.innerHTML = $HTML;

        '
    - pattern-not: '$EL.innerHTML = "...";

        '
    severity: ERROR
- rules:
  - id: insecure-createnodesfrommarkup
    languages:
    - javascript
    - typescript
    message: User controlled data in a `createNodesFromMarkup` is an anti-pattern
      that can lead to XSS vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - fbjs
    patterns:
    - pattern-either:
      - pattern: createNodesFromMarkup(...)
      - pattern: $X.createNodesFromMarkup(...)
    - pattern-not: createNodesFromMarkup("...",...)
    - pattern-not: $X.createNodesFromMarkup("...",...)
    severity: WARNING
- rules:
  - id: tofastproperties-code-execution
    languages:
    - javascript
    - typescript
    message: Potential arbitrary code execution, whatever is provided to `toFastProperties`
      is sent straight to eval()
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - http://bluebirdjs.com/docs/getting-started.html
      subcategory:
      - vuln
      technology:
      - bluebird
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: $UTIL.toFastProperties($SINK,...)
        - pattern: toFastProperties($SINK,...)
      - pattern-either:
        - pattern-inside: '$BB = require(''bluebird'');

            ...

            '
        - pattern-inside: 'import ''bluebird'';

            ...

            '
      - focus-metavariable: $SINK
    pattern-sources:
    - patterns:
      - pattern-inside: function ... (..., $ARG,...) {...}
      - focus-metavariable: $ARG
    severity: WARNING
- rules:
  - id: multiargs-code-execution
    languages:
    - javascript
    - typescript
    message: Potential arbitrary code execution, piped to eval
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - thenify
    patterns:
    - pattern-either:
      - pattern: '$THENIFY($FN, {multiArgs: ...},...)

          '
      - pattern: '$OPTS = {multiArgs: ...};

          ...

          $THENIFY($FN,$OPTS,...);

          '
    - pattern-not: '$THENIFY($FN, {multiArgs: false},...)

        '
    - pattern-not: '$OPTS = {multiArgs: false};

        ...

        $THENIFY($FN,$OPTS,...)

        '
    - pattern-either:
      - pattern-inside: '$THENIFY = require(''thenify'');

          ...

          '
      - pattern-inside: 'import ''thenify'';

          ...

          '
    severity: WARNING
- rules:
  - id: puppeteer-evaluate-code-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `evaluate` method it can result
      in Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - puppeteer
    patterns:
    - pattern-inside: 'require(''puppeteer'');

        ...

        '
    - pattern-not-inside: 'var $INPUT = function $FNAME(...){...};

        ...

        '
    - pattern-either:
      - pattern: $PAGE.evaluate($INPUT,...)
      - pattern: $PAGE.evaluateHandle($INPUT,...)
      - pattern: $PAGE.evaluateOnNewDocument($INPUT,...)
    - pattern-not: $PAGE.evaluate("...",...)
    - pattern-not: $PAGE.evaluate(function(...){...},...)
    - pattern-not: $PAGE.evaluateHandle("...",...)
    - pattern-not: $PAGE.evaluateHandle(function(...){...},...)
    - pattern-not: $PAGE.evaluateOnNewDocument("...",...)
    - pattern-not: $PAGE.evaluateOnNewDocument(function(...){...},...)
    severity: WARNING
- rules:
  - id: puppeteer-setcontent-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `setContent` method it can result
      in Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - puppeteer
    patterns:
    - pattern-inside: 'require(''puppeteer'');

        ...

        '
    - pattern-not-inside: 'require(''puppeteer'');

        ...

        var $INPUT = "...";

        ...

        '
    - pattern: $PAGE.setContent($INPUT,...)
    - pattern-not: $PAGE.setContent("...",...)
    severity: WARNING
- rules:
  - id: puppeteer-exposed-chrome-devtools
    languages:
    - javascript
    - typescript
    message: Remote debugging protocol does not perform any authentication, so exposing
      it too widely can be a security risk.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - puppeteer
    patterns:
    - pattern-inside: 'require(''puppeteer'');

        ...

        '
    - pattern-either:
      - pattern-regex: --remote-debugging-address
      - pattern-regex: --remote-debugging-port
      - pattern-regex: --remote-debugging-socket-name
      - pattern-regex: --remote-debugging-targets
    severity: WARNING
- rules:
  - id: puppeteer-goto-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `goto` method it can result in
      Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - puppeteer
    patterns:
    - pattern-inside: 'require(''puppeteer'');

        ...

        '
    - pattern-not-inside: 'require(''puppeteer'');

        ...

        var $INPUT = "...";

        ...

        $PAGE.goto($INPUT,...)

        '
    - pattern: $PAGE.goto($INPUT,...)
    - pattern-not: $PAGE.goto("...",...)
    severity: WARNING
- rules:
  - id: puppeteer-evaluate-arg-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `evaluate` method it can result
      in Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - puppeteer
    patterns:
    - pattern-inside: 'require(''puppeteer'');

        ...

        '
    - pattern-either:
      - pattern-inside: function $FUNC (...,$INPUT,...) {...}
      - pattern-inside: function (...,$INPUT,...) {...}
    - pattern-either:
      - pattern: $PAGE.evaluate($CODE,...,<... $INPUT ...>,...)
      - pattern: $PAGE.evaluateHandle($CODE,...,<... $INPUT ...>,...)
      - pattern: $PAGE.evaluateOnNewDocument($CODE,...,<... $INPUT ...>,...)
    severity: WARNING
- rules:
  - id: jquery-insecure-method
    languages:
    - javascript
    - typescript
    message: User controlled data in a jQuery's `.$METHOD(...)` is an anti-pattern
      that can lead to XSS vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/www-community/attacks/xss/
      - https://bugs.jquery.com/ticket/9521
      subcategory:
      - audit
      technology:
      - jquery
    options:
      symbolic_propagation: true
    pattern-either:
    - patterns:
      - pattern-either:
        - pattern: $.$METHOD($VAR,...)
        - pattern: $(...).$METHOD($VAR,...)
        - pattern: jQuery.$METHOD($VAR,...)
        - pattern: jQuery(...).$METHOD($VAR,...)
      - pattern-not: $.$METHOD("...",...)
      - pattern-not: $(...).$METHOD("...",...)
      - pattern-not: jQuery.$METHOD("...",...)
      - pattern-not: jQuery(...).$METHOD("...",...)
      - metavariable-regex:
          metavariable: $METHOD
          regex: ^(html|append|prepend|wrap|wrapInner|wrapAll|before|after|globalEval|getScript)$
    - patterns:
      - pattern-either:
        - pattern: $(...).$METHOD($VAR,...)
        - pattern: jQuery(...).$METHOD($VAR,...)
      - pattern-not: $("...",...).$METHOD(...)
      - pattern-not: jQuery("...",...).$METHOD(...)
      - metavariable-regex:
          metavariable: $METHOD
          regex: ^(appendTo|insertAfter|insertBefore|prependTo)$
    severity: WARNING
- rules:
  - id: prohibit-jquery-html
    languages:
    - javascript
    - typescript
    message: JQuery's `html` function is susceptible to Cross Site Scripting (XSS)
      attacks. If you're just passing text, consider `text` instead. Otherwise, use
      a function that escapes HTML such as edX's `HtmlUtils.setHtml()`.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      help: '## Remediation

        Avoid using JQuery''s html() function. If the string is plain text, use the
        text() function instead.

        Otherwise, use a function that escapes html such as edx''s HtmlUtils.setHtml().

        '
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      precision: high
      references:
      - https://edx.readthedocs.io/projects/edx-developer-guide/en/latest/preventing_xss/preventing_xss.html#javascript-concat-html
      - https://stackoverflow.com/questions/8318581/html-vs-innerhtml-jquery-javascript-xss-attacks
      - https://api.jquery.com/text/#text-text
      shortDesription: Use of JQuery's unsafe html() function.
      subcategory:
      - audit
      tags:
      - security
      technology:
      - jquery
    patterns:
    - pattern: '$X.html(...)

        '
    - pattern-not: '$X.html("...",...)

        '
    severity: WARNING
- rules:
  - id: jquery-insecure-selector
    languages:
    - javascript
    - typescript
    message: User controlled data in a `$(...)` is an anti-pattern that can lead to
      XSS vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/www-community/attacks/xss/
      - https://bugs.jquery.com/ticket/9521
      subcategory:
      - audit
      technology:
      - jquery
    patterns:
    - pattern-either:
      - pattern: '$(<... window ...>)

          '
      - pattern: '$(<... location ...>)

          '
      - patterns:
        - pattern: '$X = <... window ...>;

            ...

            $(<... $X ...>);

            '
        - focus-metavariable: $X
      - patterns:
        - pattern: '$X = <... location ...>;

            ...

            $(<... $X ...>);

            '
        - focus-metavariable: $X
      - patterns:
        - pattern-either:
          - pattern-inside: "function $FUNC(..., $Y, ...) {\n  ...\n}\n"
          - pattern-inside: "function (..., $Y, ...) {\n  ...\n}\n"
          - pattern-inside: "function $FUNC(...,$Z,...) {\n  ...\n  $Y = <... $Z ...>;\n\
              \  ...\n}\n"
          - pattern-inside: "function (...,$Z,...) {\n  ...\n  $Y = <... $Z ...>;\n\
              \  ...\n}\n"
        - pattern-either:
          - pattern: '$(<... $Y ...>)

              '
          - pattern: '$("..." + (<... $Y ...>))

              '
          - pattern: '$((<... $Y ...>) + "...")

              '
        - pattern-not-inside: "$JQUERY.each(function($INDEX, $Y) {\n  ...\n})\n"
        - focus-metavariable: $Y
    - pattern-not: '$(window)

        '
    - pattern-not: '$(document)

        '
    - pattern-not: '$(this)

        '
    severity: WARNING
- rules:
  - id: missing-template-string-indicator
    languages:
    - javascript
    - typescript
    message: This looks like a JavaScript template string. Are you missing a '$' in
      front of '{...}'?
    metadata:
      category: correctness
      technology:
      - js
    patterns:
    - pattern-inside: '`...`

        '
    - pattern: $STR
    - metavariable-regex:
        metavariable: $STR
        regex: .*[^$]+{[^{}]*}.*
    severity: INFO
- rules:
  - id: no-stringify-keys
    languages:
    - javascript
    - typescript
    message: JSON stringify does not produce a stable key ordering, and should not
      be relied on for producing object keys. Consider using json-stable-stringify
      instead.
    metadata:
      category: correctness
      references:
      - https://www.npmjs.com/package/json-stable-stringify
      - https://stackoverflow.com/a/16168003
      technology:
      - javascript
      - typescript
    mode: taint
    pattern-sinks:
    - pattern: $OBJECT[...]
    pattern-sources:
    - pattern: JSON.stringify(...)
    - patterns:
      - pattern-inside: '$STRINGIFY = JSON.stringify

          ...

          $STRINGIFY(...)

          '
      - pattern: $STRINGIFY(...)
    severity: WARNING
- rules:
  - id: useless-assignment
    languages:
    - javascript
    - typescript
    message: '`$X` is assigned twice; the first assignment is useless'
    metadata:
      category: correctness
      technology:
      - javascript
    patterns:
    - pattern: '$X = $Y;

        $X = $Z;

        '
    - pattern-not: '$X = $Y;

        $X = <... $X ...>;

        '
    severity: INFO
- rules:
  - id: eqeq-is-bad
    languages:
    - javascript
    - typescript
    message: Detected a useless comparison operation `$X == $X` or `$X != $X`. This
      operation is always true. If testing for floating point NaN, use `math.isnan`,
      or `cmath.isnan` if the number is complex.
    metadata:
      category: correctness
      technology:
      - javascript
    patterns:
    - pattern-not-inside: assert(...)
    - pattern-either:
      - pattern: $X == $X
      - pattern: $X != $X
    - pattern-not: 1 == 1
    severity: INFO
- rules:
  - id: no-replaceall
    languages:
    - javascript
    - typescript
    message: The string method replaceAll is not supported in all versions of javascript,
      and is not supported by older browser versions. Consider using replace() with
      a regex as the first argument instead like mystring.replace(/bad/g, "good")
      instead of mystring.replaceAll("bad", "good") (https://discourse.threejs.org/t/replaceall-is-not-a-function/14585)
    metadata:
      category: correctness
      references:
      - https://discourse.threejs.org/t/replaceall-is-not-a-function/14585
      technology:
      - javascript
    pattern: $STRING.replaceAll("...",$NEW)
    severity: WARNING
- rules:
  - id: lazy-load-module
    languages:
    - javascript
    - typescript
    message: Lazy loading can complicate code bundling if care is not taken, also
      `require`s are run synchronously by Node.js. If they are called from within
      a function, it may block other requests from being handled at a more critical
      time. The best practice is to `require` modules at the beginning of each file,
      before and outside of any functions.
    metadata:
      category: best-practice
      references:
      - https://nodesecroadmap.fyi/chapter-2/dynamism.html
      - https://github.com/goldbergyoni/nodebestpractices#-38-require-modules-first-not-inside-functions
      technology:
      - javascript
    patterns:
    - pattern: require(...)
    - pattern-inside: "function $NAME(...) {\n    ...\n}\n"
    severity: WARNING
- rules:
  - id: assigned-undefined
    languages:
    - javascript
    - typescript
    message: '`undefined` is not a reserved keyword in Javascript, so this is "valid"
      Javascript but highly confusing and likely to result in bugs.'
    metadata:
      category: best-practice
      technology:
      - javascript
    pattern-either:
    - pattern: undefined = $X;
    - pattern: var undefined = $X;
    - pattern: let undefined = $X;
    - pattern: const undefined = $X;
    severity: WARNING
- rules:
  - id: zlib-async-loop
    languages:
    - javascript
    - typescript
    message: Creating and using a large number of zlib objects simultaneously can
      cause significant memory fragmentation. It is strongly recommended that the
      results of compression operations be cached or made synchronous to avoid duplication
      of effort.
    metadata:
      category: best-practice
      references:
      - https://nodejs.org/api/zlib.html#zlib_threadpool_usage_and_performance_considerations
      technology:
      - javascript
    patterns:
    - pattern-either:
      - pattern-inside: "for (...) {\n    ...\n}\n"
      - pattern-inside: "while (...) {\n    ...\n}\n"
      - pattern-inside: "do {\n    ...\n} while (...)\n"
      - pattern-inside: '$SMTH.forEach(...)

          '
      - pattern-inside: '$SMTH.map(...)

          '
      - pattern-inside: '$SMTH.reduce(...)

          '
      - pattern-inside: '$SMTH.reduceRight(...)

          '
    - pattern: zlib.$METHOD(...);
    - metavariable-regex:
        metavariable: $METHOD
        regex: ^.+$(?<!Sync)
    severity: WARNING
- rules:
  - id: javascript-alert
    languages:
    - javascript
    - typescript
    message: found alert() call; should this be in production code?
    metadata:
      category: best-practice
      technology:
      - javascript
    pattern-either:
    - pattern: alert()
    - pattern: alert($X)
    severity: WARNING
  - id: javascript-debugger
    languages:
    - javascript
    - typescript
    message: found debugger call; should this be in production code?
    metadata:
      category: best-practice
      technology:
      - javascript
    pattern: debugger;
    severity: WARNING
  - id: javascript-confirm
    languages:
    - javascript
    - typescript
    message: found confirm() call; should this be in production code?
    metadata:
      category: best-practice
      technology:
      - javascript
    pattern: confirm(...)
    severity: WARNING
  - id: javascript-prompt
    languages:
    - javascript
    - typescript
    message: found prompt() call; should this be in production code?
    metadata:
      category: best-practice
      technology:
      - javascript
    pattern-either:
    - pattern: prompt()
    - pattern: prompt($X)
    - pattern: prompt($X, $Y)
    severity: WARNING
- rules:
  - id: detect-disable-mustache-escape
    languages:
    - javascript
    - typescript
    message: Markup escaping disabled. This can be used with some template engines
      to escape disabling of HTML entities, which can lead to XSS attacks.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-116: Improper Encoding or Escaping of Output'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-disable-mustache-escape.js
      subcategory:
      - audit
      technology:
      - mustache
    pattern: $OBJ.escapeMarkup = false
    severity: WARNING
- rules:
  - id: detect-buffer-noassert
    languages:
    - javascript
    - typescript
    message: Detected usage of noassert in Buffer API, which allows the offset the
      be beyond the end of the buffer. This could result in writing or reading beyond
      the end of the buffer.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-119: Improper Restriction of Operations within the Bounds of a Memory
        Buffer'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      references:
      - https://cwe.mitre.org/data/definitions/119.html
      source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-buffer-noassert.js
      subcategory:
      - audit
      technology:
      - javascript
    patterns:
    - pattern: $OBJ.$API(..., true)
    - metavariable-regex:
        metavariable: $API
        regex: (read|write)(U?Int8|(U?Int(16|32)|Float|Double)(LE|BE))
    severity: WARNING
- rules:
  - id: detect-pseudoRandomBytes
    languages:
    - javascript
    - typescript
    message: Detected usage of crypto.pseudoRandomBytes, which does not produce secure
      random numbers.
    metadata:
      asvs:
        control_id: 6.3.1 Insecure Randomness
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v63-random-values
        section: 'V6: Stored Cryptography Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-338: Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)'
      impact: LOW
      likelihood: LOW
      owasp:
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-pseudoRandomBytes.js
      subcategory:
      - audit
      technology:
      - javascript
    pattern: crypto.pseudoRandomBytes
    severity: WARNING
- rules:
  - id: detect-insecure-websocket
    languages:
    - regex
    message: Insecure WebSocket Detected. WebSocket Secure (wss) should be used for
      all WebSocket connections.
    metadata:
      asvs:
        control_id: 13.5.1 Insecure WebSocket
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x21-V13-API.md#v135-websocket-security-requirements
        section: 'V13: API and Web Service Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      subcategory:
      - audit
      technology:
      - regex
    patterns:
    - pattern-regex: \bws:\/\/
    - pattern-not-inside: \bws:\/\/localhost.*
    - pattern-not-inside: \bws:\/\/127.0.0.1.*
    severity: ERROR
- rules:
  - id: detect-child-process
    languages:
    - javascript
    - typescript
    message: 'Detected calls to child_process from a function argument `$FUNC`. This
      could lead to a command injection if the input is user controllable. Try to
      avoid calls to child_process, and if it is needed ensure user input is correctly
      sanitized or sandboxed. '
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Nodejs_Security_Cheat_Sheet.html#do-not-use-dangerous-functions
      source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-child-process.js
      subcategory:
      - audit
      technology:
      - javascript
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: '$CP = require(''child_process'')

            ...

            '
        - pattern-inside: 'import * as $CP from ''child_process''

            ...

            '
        - pattern-inside: 'import $CP from ''child_process''

            ...

            '
      - pattern-either:
        - pattern: $CP.exec($CMD,...)
        - pattern: $CP.execSync($CMD,...)
        - pattern: $CP.spawn($CMD,...)
        - pattern: $CP.spawnSync($CMD,...)
      - pattern-not-inside: $CP.$EXEC("...",...)
      - pattern-not-inside: $CP.$EXEC(["...",...],...)
      - pattern-not-inside: '$CMD = "..."

          ...

          '
      - pattern-not-inside: '$CMD = ["...",...]

          ...

          '
      - focus-metavariable: $CMD
    - patterns:
      - pattern-either:
        - pattern: child_process.exec($CMD,...)
        - pattern: child_process.execSync($CMD,...)
        - pattern: child_process.spawn($CMD,...)
        - pattern: child_process.spawnSync($CMD,...)
      - pattern-not-inside: child_process.$EXEC("...",...)
      - pattern-not-inside: child_process.$EXEC(["...",...],...)
      - pattern-not-inside: '$CMD = "..."

          ...

          '
      - pattern-not-inside: '$CMD = ["...",...]

          ...

          '
      - focus-metavariable: $CMD
    pattern-sources:
    - patterns:
      - pattern-inside: "function ... (...,$FUNC,...) {\n  ...\n}\n"
      - focus-metavariable: $FUNC
    severity: ERROR
- rules:
  - id: detect-no-csrf-before-method-override
    languages:
    - javascript
    - typescript
    message: Detected use of express.csrf() middleware before express.methodOverride().
      This can allow GET requests (which are not checked by csrf) to turn into POST
      requests later.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-352: Cross-Site Request Forgery (CSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      - A05:2017 - Broken Access Control
      references:
      - https://github.com/nodesecurity/eslint-plugin-security/blob/master/docs/bypass-connect-csrf-protection-by-abusing.md
      source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-no-csrf-before-method-override.js
      subcategory:
      - audit
      technology:
      - javascript
    pattern: 'express.csrf();

      ...

      express.methodOverride();

      '
    severity: WARNING
- rules:
  - id: spawn-git-clone
    languages:
    - javascript
    - typescript
    message: Git allows shell commands to be specified in ext URLs for remote repositories.
      For example, git clone 'ext::sh -c whoami% >&2' will execute the whoami command
      to try to connect to a remote repository. Make sure that the URL is not controlled
      by external input.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - git
    patterns:
    - pattern-either:
      - pattern: spawn('git', ['clone',...,$F])
      - pattern: $X.spawn('git', ['clone',...,$F])
      - pattern: spawn('git', ['clone',...,$P,$F])
      - pattern: $X.spawn('git', ['clone',...,$P,$F])
    - pattern-not: spawn('git', ['clone',...,"..."])
    - pattern-not: $X.spawn('git', ['clone',...,"..."])
    - pattern-not: spawn('git', ['clone',...,"...","..."])
    - pattern-not: $X.spawn('git', ['clone',...,"...","..."])
    severity: ERROR
- rules:
  - id: detect-eval-with-expression
    languages:
    - javascript
    - typescript
    message: Detected use of dynamic execution of JavaScript which may come from user-input,
      which can lead to Cross-Site-Scripting (XSS). Where possible avoid including
      user-input in functions which dynamically execute user-input.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code
        (''Eval Injection'')'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2021 - Injection
      references:
      - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval#never_use_eval!
      source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-eval-with-expression.js
      subcategory:
      - vuln
      technology:
      - javascript
    mode: taint
    pattern-sanitizers:
    - patterns:
      - pattern-either:
        - pattern: location.href = $FUNC(...)
        - pattern: location.hash = $FUNC(...)
        - pattern: location.search = $FUNC(...)
        - pattern: $WINDOW. ... .location.href = $FUNC(...)
        - pattern: $WINDOW. ... .location.hash = $FUNC(...)
        - pattern: $WINDOW. ... .location.search = $FUNC(...)
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: eval(<... $SINK ...>)
        - pattern: window.eval(<... $SINK ...>)
        - pattern: new Function(<... $SINK ...>)
        - pattern: new Function(<... $SINK ...>)(...)
        - pattern: setTimeout(<... $SINK ...>,...)
        - pattern: setInterval(<... $SINK ...>,...)
      - focus-metavariable: $SINK
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: "$PROP = new URLSearchParams($WINDOW. ... .location.search).get('...')\n\
            \  ...\n"
        - pattern-inside: "$PROP = new URLSearchParams(location.search).get('...')\n\
            \  ...\n"
        - pattern-inside: "$PROP = new URLSearchParams($WINDOW. ... .location.hash.substring(1)).get('...')\n\
            \  ...\n"
        - pattern-inside: "$PROP = new URLSearchParams(location.hash.substring(1)).get('...')\n\
            \  ...\n"
      - focus-metavariable: $PROP
    - patterns:
      - pattern-either:
        - pattern-inside: "$PROPS = new URLSearchParams($WINDOW. ... .location.search)\n\
            \  ...\n"
        - pattern-inside: "$PROPS = new URLSearchParams(location.search)\n  ...\n"
        - pattern-inside: "$PROPS = new\nURLSearchParams($WINDOW. ... .location.hash.substring(1))\n\
            \  ...\n"
        - pattern-inside: '$PROPS = new URLSearchParams(location.hash.substring(1))

            ...

            '
      - pattern: $PROPS.get('...')
      - focus-metavariable: $PROPS
    - patterns:
      - pattern-either:
        - pattern: location.href
        - pattern: location.hash
        - pattern: location.search
        - pattern: $WINDOW. ... .location.href
        - pattern: $WINDOW. ... .location.hash
        - pattern: $WINDOW. ... .location.search
    severity: WARNING
- rules:
  - id: insecure-object-assign
    languages:
    - javascript
    - typescript
    message: Depending on the context, user control data in `Object.assign` can cause
      web response to include data that it should not have or can lead to a mass assignment
      vulnerability.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html
      - https://en.wikipedia.org/wiki/Mass_assignment_vulnerability
      subcategory:
      - vuln
      technology:
      - javascript
    mode: taint
    pattern-sinks:
    - pattern: Object.assign(...)
    pattern-sources:
    - patterns:
      - pattern: JSON.parse(...)
      - pattern-not: JSON.parse("...",...)
    severity: WARNING
- rules:
  - id: html-in-template-string
    languages:
    - javascript
    - typescript
    message: This template literal looks like HTML and has interpolated variables.
      These variables are not HTML-encoded by default. If the variables contain HTML
      tags, these may be interpreted by the browser, resulting in cross-site scripting
      (XSS).
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-116: Improper Encoding or Escaping of Output'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - javascript
    patterns:
    - pattern-either:
      - pattern: '`$HTML${$VAR}...`

          '
      - pattern: '`...${$VAR}$HTML`

          '
    - metavariable-regex:
        metavariable: $HTML
        regex: .*</?[a-zA-Z]
    severity: WARNING
- rules:
  - id: dangerous-spawn-shell
    languages:
    - javascript
    - typescript
    message: Detected non-literal calls to $EXEC(). This could lead to a command injection
      vulnerability.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Nodejs_Security_Cheat_Sheet.html#do-not-use-dangerous-functions
      source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-child-process.js
      subcategory:
      - vuln
      technology:
      - javascript
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: 'require(''child_process'')

            ...

            '
        - pattern-inside: 'import ''child_process''

            ...

            '
      - pattern-either:
        - pattern: spawn(...)
        - pattern: spawnSync(...)
        - pattern: $CP.spawn(...)
        - pattern: $CP.spawnSync(...)
      - pattern-either:
        - pattern: '$EXEC("=~/(sh|bash|ksh|csh|tcsh|zsh)/",["-c", $ARG, ...],...)

            '
        - patterns:
          - pattern: $EXEC($CMD,["-c", $ARG, ...],...)
          - pattern-inside: '$CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/"

              ...

              '
        - pattern: '$EXEC("=~/(sh|bash|ksh|csh|tcsh|zsh)/",[$ARG, ...],...)

            '
        - patterns:
          - pattern: $EXEC($CMD,[$ARG, ...],...)
          - pattern-inside: '$CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/"

              ...

              '
      - focus-metavariable: $ARG
    pattern-sources:
    - patterns:
      - pattern-inside: "function ... (...,$FUNC,...) {\n  ...\n}\n"
      - focus-metavariable: $FUNC
    severity: ERROR
- rules:
  - id: spawn-shell-true
    languages:
    - javascript
    - typescript
    message: 'Found ''$SPAWN'' with ''{shell: $SHELL}''. This is dangerous because
      this call will spawn the command using a shell process. Doing so propagates
      current shell settings and variables, which makes it much easier for a malicious
      actor to execute commands. Use ''{shell: false}'' instead.'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - javascript
    patterns:
    - pattern-either:
      - pattern: 'spawn(...,{shell: $SHELL})

          '
      - pattern: 'spawnSync(...,{shell: $SHELL})

          '
      - pattern: '$CP.spawn(...,{shell: $SHELL})

          '
      - pattern: '$CP.spawnSync(...,{shell: $SHELL})

          '
    - pattern-not: 'spawn(...,{shell: false})

        '
    - pattern-not: 'spawnSync(...,{shell: false})

        '
    - pattern-not: '$CP.spawn(...,{shell: false})

        '
    - pattern-not: '$CP.spawnSync(...,{shell: false})

        '
    severity: ERROR
- rules:
  - id: hardcoded-hmac-key
    languages:
    - javascript
    - typescript
    message: Detected a hardcoded hmac key. Avoid hardcoding secrets and consider
      using an alternate option such as reading the secret from a config file or using
      an environment variable.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-798: Use of Hard-coded Credentials'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      interfile: true
      likelihood: LOW
      owasp:
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://rules.sonarsource.com/javascript/RSPEC-2068
      - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#key-management
      subcategory:
      - audit
      technology:
      - crypto
      - hmac
    options:
      interfile: true
    pattern-either:
    - pattern: $CRYPTO.createHmac($ALGO, '...')
    - patterns:
      - pattern-inside: 'const $SECRET = ''...''

          ...

          '
      - pattern: $CRYPTO.createHmac($ALGO, $SECRET)
    severity: WARNING
- rules:
  - id: detect-redos
    languages:
    - javascript
    - typescript
    message: Detected the use of a regular expression `$REDOS` which appears to be
      vulnerable to a Regular expression Denial-of-Service (ReDoS). For this reason,
      it is recommended to review the regex and ensure it is not vulnerable to catastrophic
      backtracking, and if possible use a library which offers default safety against
      ReDoS vulnerabilities.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-1333: Inefficient Regular Expression Complexity'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A05:2021 - Security Misconfiguration
      - A06:2017 - Security Misconfiguration
      references:
      - https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS
      - https://www.regular-expressions.info/redos.html
      subcategory:
      - vuln
      technology:
      - javascript
    patterns:
    - pattern-either:
      - pattern: 'new RegExp(/$REDOS/,...)

          '
      - pattern: 'new RegExp("$REDOS",...)

          '
      - pattern: '/$REDOS/.test(...)

          '
      - pattern: '"$REDOS".test(...)

          '
      - pattern: '$X.match(/$REDOS/)

          '
      - pattern: '$X.match("$REDOS")

          '
    - metavariable-analysis:
        analyzer: redos
        metavariable: $REDOS
    severity: WARNING
- rules:
  - id: detect-non-literal-fs-filename
    languages:
    - typescript
    - javascript
    message: Detected that function argument `$ARG` has entered the fs module. An
      attacker could potentially control the location of this file, to include going
      backwards in the directory with '../'. To address this, ensure that user-controlled
      variables in file paths are validated.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path
        Traversal'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A05:2017 - Broken Access Control
      - A01:2021 - Broken Access Control
      references:
      - https://owasp.org/www-community/attacks/Path_Traversal
      source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-non-literal-fs-filename.js
      subcategory:
      - vuln
      technology:
      - typescript
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: '$FS = require(''fs'')

            ...

            '
        - pattern-inside: '$FS = require(''fs/promises'')

            ...

            '
        - pattern-inside: 'import * as $FS from ''fs''

            ...

            '
        - pattern-inside: 'import $FS from ''fs''

            ...

            '
        - pattern-inside: 'import * as $FS from ''fs/promises''

            ...

            '
        - pattern-inside: 'import $FS from ''fs/promises''

            ...

            '
      - pattern-not: $FS. ... .$METHOD("...", ...)
      - pattern-either:
        - pattern: $FS. ... .access($FILE,...)
        - pattern: $FS. ... .appendFile($FILE,...)
        - pattern: $FS. ... .chmod($FILE,...)
        - pattern: $FS. ... .chown($FILE,...)
        - pattern: $FS. ... .close($FILE,...)
        - pattern: $FS. ... .copyFile($FILE,...)
        - pattern: $FS. ... .copyFile($SMTH, $FILE,...)
        - pattern: $FS. ... .cp($FILE, ...)
        - pattern: $FS. ... .cp($SMTH, $FILE, ...)
        - pattern: $FS. ... .createReadStream($FILE,...)
        - pattern: $FS. ... .createWriteStream($FILE,...)
        - pattern: $FS. ... .exists($FILE, ...)
        - pattern: $FS. ... .fchmod($FILE, ...)
        - pattern: $FS. ... .fchown($FILE, ...)
        - pattern: $FS. ... .fdatasync($FILE, ...)
        - pattern: $FS. ... .fstat($FILE, ...)
        - pattern: $FS. ... .fsync($FILE, ...)
        - pattern: $FS. ... .ftruncate($FILE, ...)
        - pattern: $FS. ... .futimes($FILE, ...)
        - pattern: $FS. ... .lchmod($FILE, ...)
        - pattern: $FS. ... .lchown($FILE, ...)
        - pattern: $FS. ... .lutimes($FILE, ...)
        - pattern: $FS. ... .link($FILE, ...)
        - pattern: $FS. ... .link($SMTH, $FILE, ...)
        - pattern: $FS. ... .lstat($FILE, ...)
        - pattern: $FS. ... .mkdir($FILE, ...)
        - pattern: $FS. ... .mkdtemp($FILE, ...)
        - pattern: $FS. ... .open($FILE, ...)
        - pattern: $FS. ... .opendir($FILE, ...)
        - pattern: $FS. ... .read($FILE, ...)
        - pattern: $FS. ... .read($FILE, ...)
        - pattern: $FS. ... .readdir($FILE, ...)
        - pattern: $FS. ... .readFile($FILE, ...)
        - pattern: $FS. ... .readlink($FILE, ...)
        - pattern: $FS. ... .readv($FILE, ...)
        - pattern: $FS. ... .realpath($FILE, ...)
        - pattern: $FS. ... .realpath.native($FILE, ...)
        - pattern: $FS. ... .rename($FILE, ...)
        - pattern: $FS. ... .rename($SMTH, $FILE, ...)
        - pattern: $FS. ... .rmdir($FILE, ...)
        - pattern: $FS. ... .rm($FILE, ...)
        - pattern: $FS. ... .stat($FILE, ...)
        - pattern: $FS. ... .symlink($SMTH, $FILE, ...)
        - pattern: $FS. ... .symlink($FILE, ...)
        - pattern: $FS. ... .truncate($FILE, ...)
        - pattern: $FS. ... .unlink($FILE, ...)
        - pattern: $FS. ... .unwatchFile($FILE, ...)
        - pattern: $FS. ... .utimes($FILE, ...)
        - pattern: $FS. ... .watch($FILE, ...)
        - pattern: $FS. ... .watchFile($FILE, ...)
        - pattern: $FS. ... .write($FILE, ...)
        - pattern: $FS. ... .writeFile($FILE, ...)
        - pattern: $FS. ... .writev($FILE, ...)
        - pattern: $FS. ... .accessSync($FILE, ...)
        - pattern: $FS. ... .appendFileSync($FILE, ...)
        - pattern: $FS. ... .chmodSync($FILE, ...)
        - pattern: $FS. ... .chownSync($FILE, ...)
        - pattern: $FS. ... .closeSync($FILE, ...)
        - pattern: $FS. ... .copyFileSync($FILE, ...)
        - pattern: $FS. ... .copyFileSync($SMTH, $FILE, ...)
        - pattern: $FS. ... .cpSync($FILE, ...)
        - pattern: $FS. ... .cpSync($SMTH, $FILE, ...)
        - pattern: $FS. ... .existsSync($FILE, ...)
        - pattern: $FS. ... .fchmodSync($FILE, ...)
        - pattern: $FS. ... .fchownSync($FILE, ...)
        - pattern: $FS. ... .fdatasyncSync($FILE, ...)
        - pattern: $FS. ... .fstatSync($FILE, ...)
        - pattern: $FS. ... .fsyncSync($FILE, ...)
        - pattern: $FS. ... .ftruncateSync($FILE, ...)
        - pattern: $FS. ... .futimesSync($FILE, ...)
        - pattern: $FS. ... .lchmodSync($FILE, ...)
        - pattern: $FS. ... .lchownSync($FILE, ...)
        - pattern: $FS. ... .lutimesSync($FILE, ...)
        - pattern: $FS. ... .linkSync($FILE, ...)
        - pattern: $FS. ... .linkSync($SMTH, $FILE, ...)
        - pattern: $FS. ... .lstatSync($FILE, ...)
        - pattern: $FS. ... .mkdirSync($FILE, ...)
        - pattern: $FS. ... .mkdtempSync($FILE, ...)
        - pattern: $FS. ... .opendirSync($FILE, ...)
        - pattern: $FS. ... .openSync($FILE, ...)
        - pattern: $FS. ... .readdirSync($FILE, ...)
        - pattern: $FS. ... .readFileSync($FILE, ...)
        - pattern: $FS. ... .readlinkSync($FILE, ...)
        - pattern: $FS. ... .readSync($FILE, ...)
        - pattern: $FS. ... .readSync($FILE, ...)
        - pattern: $FS. ... .readvSync($FILE, ...)
        - pattern: $FS. ... .realpathync($FILE, ...)
        - pattern: $FS. ... .realpathSync.native($FILE, ...)
        - pattern: $FS. ... .renameSync($FILE, ...)
        - pattern: $FS. ... .renameSync($SMTH, $FILE, ...)
        - pattern: $FS. ... .rmdirSync($FILE, ...)
        - pattern: $FS. ... .rmSync($FILE, ...)
        - pattern: $FS. ... .statSync($FILE, ...)
        - pattern: $FS. ... .symlinkSync($FILE, ...)
        - pattern: $FS. ... .symlinkSync($SMTH, $FILE, ...)
        - pattern: $FS. ... .truncateSync($FILE, ...)
        - pattern: $FS. ... .unlinkSync($FILE, ...)
        - pattern: $FS. ... .utimesSync($FILE, ...)
        - pattern: $FS. ... .writeFileSync($FILE, ...)
        - pattern: $FS. ... .writeSync($FILE, ...)
        - pattern: $FS. ... .writevSync($FILE, ...)
      - focus-metavariable: $FILE
    - patterns:
      - pattern-either:
        - pattern-inside: 'import ''fs''

            ...

            '
        - pattern-inside: 'import ''fs/promises''

            ...

            '
      - pattern-not: $METHOD("...", ...)
      - pattern-either:
        - pattern: access($FILE,...)
        - pattern: appendFile($FILE,...)
        - pattern: chmod($FILE,...)
        - pattern: chown($FILE,...)
        - pattern: close($FILE,...)
        - pattern: copyFile($FILE,...)
        - pattern: copyFile($SMTH, $FILE,...)
        - pattern: cp($FILE, ...)
        - pattern: cp($SMTH, $FILE, ...)
        - pattern: createReadStream($FILE,...)
        - pattern: createWriteStream($FILE,...)
        - pattern: exists($FILE, ...)
        - pattern: fchmod($FILE, ...)
        - pattern: fchown($FILE, ...)
        - pattern: fdatasync($FILE, ...)
        - pattern: fstat($FILE, ...)
        - pattern: fsync($FILE, ...)
        - pattern: ftruncate($FILE, ...)
        - pattern: futimes($FILE, ...)
        - pattern: lchmod($FILE, ...)
        - pattern: lchown($FILE, ...)
        - pattern: lutimes($FILE, ...)
        - pattern: link($FILE, ...)
        - pattern: link($SMTH, $FILE, ...)
        - pattern: lstat($FILE, ...)
        - pattern: mkdir($FILE, ...)
        - pattern: mkdtemp($FILE, ...)
        - pattern: open($FILE, ...)
        - pattern: opendir($FILE, ...)
        - pattern: read($FILE, ...)
        - pattern: read($FILE, ...)
        - pattern: readdir($FILE, ...)
        - pattern: readFile($FILE, ...)
        - pattern: readlink($FILE, ...)
        - pattern: readv($FILE, ...)
        - pattern: realpath($FILE, ...)
        - pattern: realpath.native($FILE, ...)
        - pattern: rename($FILE, ...)
        - pattern: rename($SMTH, $FILE, ...)
        - pattern: rmdir($FILE, ...)
        - pattern: rm($FILE, ...)
        - pattern: stat($FILE, ...)
        - pattern: symlink($SMTH, $FILE, ...)
        - pattern: symlink($FILE, ...)
        - pattern: truncate($FILE, ...)
        - pattern: unlink($FILE, ...)
        - pattern: unwatchFile($FILE, ...)
        - pattern: utimes($FILE, ...)
        - pattern: watch($FILE, ...)
        - pattern: watchFile($FILE, ...)
        - pattern: write($FILE, ...)
        - pattern: writeFile($FILE, ...)
        - pattern: writev($FILE, ...)
        - pattern: accessSync($FILE, ...)
        - pattern: appendFileSync($FILE, ...)
        - pattern: chmodSync($FILE, ...)
        - pattern: chownSync($FILE, ...)
        - pattern: closeSync($FILE, ...)
        - pattern: copyFileSync($FILE, ...)
        - pattern: copyFileSync($SMTH, $FILE, ...)
        - pattern: cpSync($FILE, ...)
        - pattern: cpSync($SMTH, $FILE, ...)
        - pattern: existsSync($FILE, ...)
        - pattern: fchmodSync($FILE, ...)
        - pattern: fchownSync($FILE, ...)
        - pattern: fdatasyncSync($FILE, ...)
        - pattern: fstatSync($FILE, ...)
        - pattern: fsyncSync($FILE, ...)
        - pattern: ftruncateSync($FILE, ...)
        - pattern: futimesSync($FILE, ...)
        - pattern: lchmodSync($FILE, ...)
        - pattern: lchownSync($FILE, ...)
        - pattern: lutimesSync($FILE, ...)
        - pattern: linkSync($FILE, ...)
        - pattern: linkSync($SMTH, $FILE, ...)
        - pattern: lstatSync($FILE, ...)
        - pattern: mkdirSync($FILE, ...)
        - pattern: mkdtempSync($FILE, ...)
        - pattern: opendirSync($FILE, ...)
        - pattern: openSync($FILE, ...)
        - pattern: readdirSync($FILE, ...)
        - pattern: readFileSync($FILE, ...)
        - pattern: readlinkSync($FILE, ...)
        - pattern: readSync($FILE, ...)
        - pattern: readSync($FILE, ...)
        - pattern: readvSync($FILE, ...)
        - pattern: realpathync($FILE, ...)
        - pattern: realpathSync.native($FILE, ...)
        - pattern: renameSync($FILE, ...)
        - pattern: renameSync($SMTH, $FILE, ...)
        - pattern: rmdirSync($FILE, ...)
        - pattern: rmSync($FILE, ...)
        - pattern: statSync($FILE, ...)
        - pattern: symlinkSync($FILE, ...)
        - pattern: symlinkSync($SMTH, $FILE, ...)
        - pattern: truncateSync($FILE, ...)
        - pattern: unlinkSync($FILE, ...)
        - pattern: utimesSync($FILE, ...)
        - pattern: writeFileSync($FILE, ...)
        - pattern: writeSync($FILE, ...)
        - pattern: writevSync($FILE, ...)
      - focus-metavariable: $FILE
    pattern-sources:
    - patterns:
      - pattern-inside: function ... (..., $ARG,...) {...}
      - focus-metavariable: $ARG
    severity: WARNING
- rules:
  - id: incomplete-sanitization
    languages:
    - javascript
    - typescript
    message: '`$STR.replace` method will only replace the first occurrence when used
      with a string argument ($CHAR). If this method is used for escaping of dangerous
      data then there is a possibility for a bypass. Try to use sanitization library
      instead or use a Regex with a global flag.'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-116: Improper Encoding or Escaping of Output'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - javascript
    patterns:
    - pattern: '$STR.replace(($CHAR: string), ...)

        '
    - metavariable-regex:
        metavariable: $CHAR
        regex: ^[\"\']([\'\"\<\>\*\|\{\}\[\]\%\$]{1}|\\n|\\r|\\t|\\&)[\"\']$
    severity: WARNING
- rules:
  - id: unsafe-dynamic-method
    languages:
    - javascript
    - typescript
    message: Using non-static data to retrieve and run functions from the object is
      dangerous. If the data is user-controlled, it may allow executing arbitrary
      code.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - javascript
    patterns:
    - pattern-either:
      - pattern: $OBJ[$X](...)
      - pattern: '$Y = $OBJ[$X]

          ...

          $Y(...)

          '
    - metavariable-pattern:
        metavariable: $X
        patterns:
        - pattern-not: '"..."

            '
        - pattern-not: '($X: float)

            '
    - pattern-not-inside: 'for (...) {...}

        '
    - pattern-not-inside: '$SMTH.forEach(...)

        '
    - pattern-not-inside: '$SMTH.map(...)

        '
    - pattern-not-inside: '$SMTH.reduce(...)

        '
    - pattern-not-inside: '$SMTH.reduceRight(...)

        '
    - pattern-not-inside: "if (<... $OBJ.hasOwnProperty(...) ...>) {\n  ...\n}\n...\n"
    severity: WARNING
- rules:
  - id: md5-used-as-password
    languages:
    - javascript
    message: It looks like MD5 is used as a password hash. MD5 is not considered a
      secure password hash because it can be cracked by an attacker in a short amount
      of time. Use a suitable password hashing function such as bcrypt. You can use
      the `bcrypt` node.js package.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://tools.ietf.org/id/draft-lvelvindron-tls-md5-sha1-deprecate-01.html
      - https://security.stackexchange.com/questions/211/how-to-securely-hash-passwords
      - https://github.com/returntocorp/semgrep-rules/issues/1609
      - https://www.npmjs.com/package/bcrypt
      subcategory:
      - vuln
      technology:
      - crypto
      - md5
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern: $FUNCTION(...);
      - metavariable-regex:
          metavariable: $FUNCTION
          regex: (?i)(.*password.*)
    pattern-sources:
    - pattern: $CRYPTO.createHash("md5")
    severity: WARNING
- rules:
  - id: code-string-concat
    languages:
    - javascript
    - typescript
    message: Found data from an Express or Next web request flowing to `eval`. If
      this data is user-controllable this can lead to execution of arbitrary system
      commands in the context of your application process. Avoid `eval` whenever possible.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code
        (''Eval Injection'')'
      impact: MEDIUM
      interfile: true
      likelihood: MEDIUM
      owasp:
      - A03:2021 - Injection
      references:
      - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval
      - https://nodejs.org/api/child_process.html#child_processexeccommand-options-callback
      - https://www.stackhawk.com/blog/nodejs-command-injection-examples-and-prevention/
      - https://ckarande.gitbooks.io/owasp-nodegoat-tutorial/content/tutorial/a1_-_server_side_js_injection.html
      subcategory:
      - vuln
      technology:
      - node.js
      - Express
      - Next.js
    mode: taint
    options:
      interfile: true
    pattern-sinks:
    - patterns:
      - pattern: 'eval(...)

          '
    pattern-sources:
    - pattern-either:
      - patterns:
        - pattern-either:
          - pattern-inside: function ... ($REQ, $RES) {...}
          - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
          - patterns:
            - pattern-either:
              - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
              - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT)
                  {...})
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(get|post|put|head|delete|options)$
        - pattern-either:
          - pattern: $REQ.query
          - pattern: $REQ.body
          - pattern: $REQ.params
          - pattern: $REQ.cookies
          - pattern: $REQ.headers
      - patterns:
        - pattern-either:
          - pattern-inside: 'import { ...,$IMPORT,... } from ''next/router''

              ...

              '
          - pattern-inside: 'import $IMPORT from ''next/router'';

              ...

              '
        - pattern-either:
          - patterns:
            - pattern-inside: '$ROUTER = $IMPORT()

                ...

                '
            - pattern-either:
              - pattern-inside: 'const { ...,$PROPS,... } = $ROUTER.query

                  ...

                  '
              - pattern-inside: 'var { ...,$PROPS,... } = $ROUTER.query

                  ...

                  '
              - pattern-inside: 'let { ...,$PROPS,... } = $ROUTER.query

                  ...

                  '
            - focus-metavariable: $PROPS
          - patterns:
            - pattern-inside: '$ROUTER = $IMPORT()

                ...

                '
            - pattern: "$ROUTER.query.$VALUE \n"
          - patterns:
            - pattern: $IMPORT().query.$VALUE
    severity: ERROR
- rules:
  - id: detect-non-literal-require
    languages:
    - javascript
    - typescript
    message: Detected the use of require(variable). Calling require with a non-literal
      argument might allow an attacker to load and run arbitrary code, or access arbitrary
      files.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code
        (''Eval Injection'')'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2021 - Injection
      references:
      - https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-non-literal-require.js
      source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-non-literal-require.js
      subcategory:
      - vuln
      technology:
      - javascript
    mode: taint
    pattern-sinks:
    - pattern: require(...)
    pattern-sources:
    - patterns:
      - pattern-inside: function ... (..., $ARG,...) {...}
      - focus-metavariable: $ARG
    severity: WARNING
- rules:
  - id: unknown-value-with-script-tag
    languages:
    - javascript
    - typescript
    message: Cannot determine what '$UNK' is and it is used with a '<script>' tag.
      This could be susceptible to cross-site scripting (XSS). Ensure '$UNK' is not
      externally controlled, or sanitize this data.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://www.developsec.com/2017/11/09/xss-in-a-script-tag/
      - https://github.com/juice-shop/juice-shop/blob/1ceb8751e986dacd3214a618c37e7411be6bc11a/routes/videoHandler.ts#L68
      subcategory:
      - audit
      technology:
      - javascript
    patterns:
    - pattern-inside: '$UNK = $ANYFUNC(...);

        ...

        $OTHERFUNC(..., <... $UNK ...>, ...);

        '
    - pattern: $OTHERFUNC(..., <... "=~/.*<script.*/" ...>, ...)
    - pattern: $UNK
    severity: WARNING
- rules:
  - id: unsafe-formatstring
    languages:
    - javascript
    - typescript
    message: Detected string concatenation with a non-literal variable in a util.format
      / console.log function. If an attacker injects a format specifier in the string,
      it will forge the log message. Try to use constant values for the format string.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-134: Use of Externally-Controlled Format String'
      impact: LOW
      likelihood: MEDIUM
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://cwe.mitre.org/data/definitions/134.html
      subcategory:
      - audit
      technology:
      - javascript
    mode: taint
    pattern-sinks:
    - patterns:
      - focus-metavariable: $STR
      - pattern-either:
        - pattern: 'console.$LOG($STR,$PARAM,...)

            '
        - patterns:
          - pattern-inside: '$UTIL = require(''util'')

              ...

              '
          - pattern: '$UTIL.format($STR,$PARAM,...)

              '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: $X + $Y
        - pattern: $X.concat($Y)
        - pattern: '`...${...}...`

            '
      - pattern-not: '"..." + "..."

          '
      - pattern-not: '$X.concat("...")

          '
    severity: INFO
- rules:
  - id: detect-non-literal-regexp
    languages:
    - javascript
    - typescript
    message: RegExp() called with a `$ARG` function argument, this might allow an
      attacker to cause a Regular Expression Denial-of-Service (ReDoS) within your
      application as RegExP blocks the main thread. For this reason, it is recommended
      to use hardcoded regexes instead. If your regex is run on user-controlled input,
      consider performing input validation or use a regex checking/sanitization library
      such as https://www.npmjs.com/package/recheck to verify that the regex does
      not appear vulnerable to ReDoS.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-1333: Inefficient Regular Expression Complexity'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A05:2021 - Security Misconfiguration
      - A06:2017 - Security Misconfiguration
      references:
      - https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS
      source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-non-literal-regexp.js
      subcategory:
      - vuln
      technology:
      - javascript
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: new RegExp($ARG, ...)
        - pattern: RegExp($ARG, ...)
      - pattern-not: RegExp("...", ...)
      - pattern-not: new RegExp("...", ...)
      - pattern-not: RegExp(/.../, ...)
      - pattern-not: new RegExp(/.../, ...)
    pattern-sources:
    - patterns:
      - pattern-inside: 'function ... (...,$ARG,...) {...}

          '
      - focus-metavariable: $ARG
    severity: WARNING
- rules:
  - id: path-join-resolve-traversal
    languages:
    - javascript
    - typescript
    message: Detected possible user input going into a `path.join` or `path.resolve`
      function. This could possibly lead to a path traversal vulnerability,  where
      the attacker can access arbitrary files stored in the file system. Instead,
      be sure to sanitize or validate user input first.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path
        Traversal'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A05:2017 - Broken Access Control
      - A01:2021 - Broken Access Control
      references:
      - https://owasp.org/www-community/attacks/Path_Traversal
      subcategory:
      - vuln
      technology:
      - javascript
      - node.js
    mode: taint
    pattern-sanitizers:
    - pattern: $Y.replace(...)
    - pattern: $Y.indexOf(...)
    - pattern: "function ... (...) {\n    ...\n    <... $Y.indexOf(...) ...>\n   \
        \ ...\n}\n"
    - patterns:
      - pattern: $FUNC(...)
      - metavariable-regex:
          metavariable: $FUNC
          regex: sanitize
    pattern-sinks:
    - patterns:
      - focus-metavariable: $SINK
      - pattern-either:
        - pattern-inside: '$PATH = require(''path'');

            ...

            '
        - pattern-inside: 'import $PATH from ''path'';

            ...

            '
      - pattern-either:
        - pattern: $PATH.join(...,$SINK,...)
        - pattern: $PATH.resolve(...,$SINK,...)
    - patterns:
      - focus-metavariable: $SINK
      - pattern-inside: 'import ''path'';

          ...

          '
      - pattern-either:
        - pattern-inside: path.join(...,$SINK,...)
        - pattern-inside: path.resolve(...,$SINK,...)
    pattern-sources:
    - patterns:
      - focus-metavariable: $X
      - pattern-either:
        - pattern-inside: 'function ... (...,$X,...) {...}

            '
        - pattern-inside: 'function ... (...,{...,$X,...},...) {...}

            '
    severity: WARNING
- rules:
  - id: node-mssql-sqli
    languages:
    - javascript
    - typescript
    message: 'Detected string concatenation with a non-literal variable in a `mssql`
      JS SQL statement. This could lead to SQL injection if the variable is user-controlled
      and not properly sanitized. In order to prevent SQL injection, use parameterized
      queries or prepared statements instead. You can use parameterized statements
      like so: `$REQ.input(''USER_ID'', mssql.Int, id);`'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://www.npmjs.com/package/mssql
      subcategory:
      - vuln
      technology:
      - mssql
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: 'require(''mssql'');

            ...

            '
        - pattern-inside: 'import ''mssql'';

            ...

            '
      - pattern-inside: '$REQ = $POOL.request(...)

          ...

          '
      - pattern: '$REQ.query($QUERY,...)

          '
      - focus-metavariable: $QUERY
    pattern-sources:
    - patterns:
      - pattern-inside: "function ... (...,$FUNC,...) {\n  ...\n}\n"
      - focus-metavariable: $FUNC
    severity: WARNING
- rules:
  - id: node-knex-sqli
    languages:
    - javascript
    - typescript
    message: 'Detected SQL statement that is tainted by `$REQ` object. This could
      lead to SQL injection if the variable is user-controlled and not properly sanitized.
      In order to prevent SQL injection, it is recommended to use parameterized queries
      or prepared statements. An example of parameterized queries like so: `knex.raw(''SELECT
      $1 from table'', [userinput])` can help prevent SQLi.'
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://knexjs.org/#Builder-fromRaw
      - https://knexjs.org/#Builder-whereRaw
      - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
      subcategory:
      - vuln
      technology:
      - express
      - nodejs
      - knex
    mode: taint
    pattern-sanitizers:
    - patterns:
      - pattern: parseInt(...)
    pattern-sinks:
    - patterns:
      - focus-metavariable: $QUERY
      - pattern-either:
        - pattern-inside: $KNEX.fromRaw($QUERY, ...)
        - pattern-inside: $KNEX.whereRaw($QUERY, ...)
        - pattern-inside: $KNEX.raw($QUERY, ...)
      - pattern-either:
        - pattern-inside: 'require(''knex'')

            ...

            '
        - pattern-inside: 'import ''knex''

            ...

            '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: function ... ($REQ, $RES) {...}
        - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
        - patterns:
          - pattern-either:
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT)
                {...})
          - metavariable-regex:
              metavariable: $METHOD
              regex: ^(get|post|put|head|delete|options)
      - pattern-either:
        - pattern: $REQ.query
        - pattern: $REQ.body
        - pattern: $REQ.params
        - pattern: $REQ.cookies
        - pattern: $REQ.headers
        - pattern: $REQ.files.$ANYTHING.data.toString('utf8')
        - pattern: $REQ.files.$ANYTHING['data'].toString('utf8')
    - patterns:
      - pattern-either:
        - pattern-inside: '({ $REQ }: Request,$RES: Response, $NEXT: NextFunction)
            =>

            {...}

            '
        - pattern-inside: '({ $REQ }: Request,$RES: Response) => {...}

            '
      - focus-metavariable: $REQ
      - pattern-either:
        - pattern: params
        - pattern: query
        - pattern: cookies
        - pattern: headers
        - pattern: body
        - pattern: files.$ANYTHING.data.toString('utf8')
        - pattern: files.$ANYTHING['data'].toString('utf8')
    severity: WARNING
- rules:
  - id: node-mysql-sqli
    languages:
    - javascript
    - typescript
    message: Detected a `$IMPORT` SQL statement that comes from a function argument.
      This could lead to SQL injection if the variable is user-controlled and is not
      properly sanitized. In order to prevent SQL injection, it is recommended to
      use parameterized queries or prepared statements.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://www.npmjs.com/package/mysql2
      - https://www.npmjs.com/package/mysql
      - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
      subcategory:
      - vuln
      technology:
      - mysql
      - mysql2
      - javascript
      - nodejs
    mode: taint
    pattern-sanitizers:
    - patterns:
      - pattern: parseInt(...)
    pattern-sinks:
    - patterns:
      - focus-metavariable: $QUERY
      - pattern-either:
        - pattern-inside: $POOL.query($QUERY, ...)
        - pattern-inside: $POOL.execute($QUERY, ...)
      - pattern-either:
        - pattern-inside: 'import $S from "$IMPORT"

            ...

            '
        - pattern-inside: 'import { ... } from "$IMPORT"

            ...

            '
        - pattern-inside: 'import * as $S from "$IMPORT"

            ...

            '
        - pattern-inside: 'require("$IMPORT")

            ...

            '
      - metavariable-regex:
          metavariable: $IMPORT
          regex: (mysql|mysql2)
    pattern-sources:
    - patterns:
      - pattern-inside: function ... (..., $Y,...) {...}
      - pattern: $Y
      - pattern-not-inside: 'function ... (..., $Y: number,...) {...}

          '
      - pattern-not-inside: $Y.query
      - pattern-not-inside: $Y.body
      - pattern-not-inside: $Y.params
      - pattern-not-inside: $Y.cookies
      - pattern-not-inside: $Y.headers
    severity: WARNING
- rules:
  - id: node-postgres-sqli
    languages:
    - javascript
    - typescript
    message: 'Detected string concatenation with a non-literal variable in a node-postgres
      JS SQL statement. This could lead to SQL injection if the variable is user-controlled
      and not properly sanitized. In order to prevent SQL injection, use parameterized
      queries or prepared statements instead. You can use parameterized statements
      like so: `client.query(''SELECT $1 from table'', [userinput])`'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-915: Improperly Controlled Modification of Dynamically-Determined Object
        Attributes'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://node-postgres.com/features/queries
      subcategory:
      - vuln
      technology:
      - node-postgres
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: "const { $CLIENT } = require('pg')\n ...\n"
        - pattern-inside: "var { $CLIENT } = require('pg')\n ...\n"
        - pattern-inside: "let { $CLIENT } = require('pg')\n ...\n"
      - pattern-either:
        - pattern-inside: '$DB = new $CLIENT(...)

            ...

            '
        - pattern-inside: "$NEWPOOL = new $CLIENT(...)\n...\n$NEWPOOL.connect((...,\
            \ $DB, ...) => {\n    ...\n})\n"
      - pattern: $DB.query($QUERY,...)
      - focus-metavariable: $QUERY
    pattern-sources:
    - patterns:
      - pattern-inside: "function ... (...,$FUNC,...) {\n  ...\n}\n"
      - focus-metavariable: $FUNC
      - pattern-not-inside: '$F. ... .$SOURCE(...)

          '
    severity: WARNING
- rules:
  - id: prototype-pollution-loop
    languages:
    - typescript
    - javascript
    message: 'Possibility of prototype polluting function detected. By adding or modifying
      attributes of an object prototype, it is possible to create attributes that
      exist on every object, or replace critical attributes with malicious ones. This
      can be problematic if the software depends on existence or non-existence of
      certain attributes, or uses pre-defined attributes of object prototype (such
      as hasOwnProperty, toString or valueOf). Possible mitigations might be: freezing
      the object prototype, using an object without prototypes (via Object.create(null)
      ), blocking modifications of attributes that resolve to object prototype, using
      Map instead of object.'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-915: Improperly Controlled Modification of Dynamically-Determined Object
        Attributes'
      impact: LOW
      likelihood: LOW
      owasp:
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf
      subcategory:
      - audit
      technology:
      - typescript
    patterns:
    - pattern-either:
      - pattern: '$SMTH = $SMTH[$A]

          '
      - pattern: '$SMTH = $SMTH[$A] = ...

          '
      - pattern: '$SMTH = $SMTH[$A] && $Z

          '
      - pattern: '$SMTH = $SMTH[$A] || $Z

          '
    - pattern-either:
      - pattern-inside: "for(...) {\n  ...\n}\n"
      - pattern-inside: "while(...) {\n  ...\n}\n"
      - pattern-inside: "$X.forEach(function $NAME(...) {\n  ...\n})\n"
    - pattern-not-inside: 'for(var $A = $S; ...; ...) {...}

        '
    - pattern-not-inside: 'for($A = $S; ...; ...) {...}

        '
    - pattern-not-inside: '$X.forEach(function $NAME($OBJ, $A,...) {...})

        '
    - metavariable-pattern:
        metavariable: $A
        patterns:
        - pattern-not: '"..."'
        - pattern-not: '`...${...}...`

            '
        - pattern-not: '($A: float)

            '
    severity: WARNING
- rules:
  - id: prototype-pollution-assignment
    languages:
    - javascript
    - typescript
    message: 'Possibility of prototype polluting assignment detected. By adding or
      modifying attributes of an object prototype, it is possible to create attributes
      that exist on every object, or replace critical attributes with malicious ones.
      This can be problematic if the software depends on existence or non-existence
      of certain attributes, or uses pre-defined attributes of object prototype (such
      as hasOwnProperty, toString or valueOf). Possible mitigations might be: freezing
      the object prototype, using an object without prototypes (via Object.create(null)
      ), blocking modifications of attributes that resolve to object prototype, using
      Map instead of object.'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-915: Improperly Controlled Modification of Dynamically-Determined Object
        Attributes'
      impact: LOW
      likelihood: LOW
      owasp:
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf
      subcategory:
      - audit
      technology:
      - javascript
    patterns:
    - pattern: '$X[$B] = ...

        '
    - pattern-not: '$X[$B] = ''...''

        '
    - pattern-inside: '$X = $SMTH[$A]

        ...

        '
    - pattern-not-inside: "if (<...'constructor' ...>) {\n  ...\n}\n...\n"
    - pattern-not-inside: "if (<...'__proto__' ...>) {\n  ...\n}\n...\n"
    - pattern-not-inside: 'for(var $B = $S; ...; ...) {...}

        '
    - pattern-not-inside: 'for($B = $S; ...; ...) {...}

        '
    - pattern-not-inside: '$X.forEach(function $NAME($OBJ, $B,...) {...})

        '
    - metavariable-pattern:
        metavariable: $A
        patterns:
        - pattern-not: '"..."'
        - pattern-not: '`...${...}...`

            '
        - pattern-not: '($A: float)

            '
    - metavariable-pattern:
        metavariable: $B
        patterns:
        - pattern-not: '"..."'
        - pattern-not: '`...${...}...`

            '
        - pattern-not: '($B: float)

            '
    severity: WARNING
- rules:
  - id: detect-angular-trust-as-resourceurl-method
    languages:
    - javascript
    - typescript
    message: The use of $sce.trustAsResourceUrl can be dangerous if unsanitized user
      input flows through this API.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/service/$sce#trustAsResourceUrl
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - audit
      technology:
      - angular
    patterns:
    - pattern-either:
      - pattern: '$SOURCE = $scope.$INPUT;

          $sce.trustAsResourceUrl($SOURCE);

          '
      - pattern: '$sce.trustAsResourceUrl($scope.$INPUT);

          '
    - pattern-inside: 'app.controller(..., function($scope,$sce){

        ...

        });

        '
    severity: WARNING
- rules:
  - id: detect-angular-element-methods
    languages:
    - javascript
    - typescript
    message: Use of angular.element can lead to XSS if user-input is treated as part
      of the HTML element within `$SINK`. It is recommended to contextually output
      encode user-input, before inserting into `$SINK`. If the HTML needs to be preserved
      it is recommended to sanitize the input using $sce.getTrustedHTML or $sanitize.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/function/angular.element
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - vuln
      technology:
      - angularjs
    mode: taint
    pattern-sanitizers:
    - patterns:
      - pattern-either:
        - pattern: $sce.getTrustedHtml(...)
        - pattern: $sanitize(...)
        - pattern: DOMPurify.sanitize(...)
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: 'angular.element(...). ... .$SINK($QUERY)

            '
        - pattern-inside: '$ANGULAR = angular.element(...)

            ...

            $ANGULAR. ... .$SINK($QUERY)

            '
      - metavariable-regex:
          metavariable: $SINK
          regex: ^(after|append|html|prepend|replaceWith|wrap)$
      - focus-metavariable: $QUERY
    pattern-sources:
    - patterns:
      - pattern-either:
        - patterns:
          - pattern-inside: 'function(..., $SCOPE, ...) { ... }

              '
          - focus-metavariable: $SCOPE
          - metavariable-regex:
              metavariable: $SCOPE
              regex: ^\$scope$
        - pattern: $rootScope
        - pattern: $injector.get('$rootScope')
        - pattern: $injector.get('$scope')
    severity: INFO
- rules:
  - id: detect-angular-trust-as-url-method
    languages:
    - javascript
    - typescript
    message: The use of $sce.trustAsUrl can be dangerous if unsanitized user input
      flows through this API.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/service/$sce#trustAsUrl
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - audit
      technology:
      - angular
    patterns:
    - pattern-either:
      - pattern: '$SOURCE = $scope.$INPUT;

          $sce.trustAsUrl($SOURCE);

          '
      - pattern: '$sce.trustAsUrl($scope.$INPUT);

          '
    - pattern-inside: 'app.controller(..., function($scope,$sce){

        ...

        });

        '
    severity: WARNING
- rules:
  - id: detect-angular-open-redirect
    languages:
    - javascript
    - typescript
    message: Use of $window.location.href can lead to open-redirect if user input
      is used for redirection.
    metadata:
      asvs:
        control_id: 5.5.1 Insecue Redirect
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v51-input-validation
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/service/$sce#trustAsJs
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - audit
      technology:
      - angular
    patterns:
    - pattern: '$window.location.href = ...

        '
    - pattern-not: '$window.location.href = "..."

        '
    severity: ERROR
- rules:
  - id: detect-angular-resource-loading
    languages:
    - javascript
    - typescript
    message: $sceDelegateProvider allowlisting can introduce security issues if wildcards
      are used.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/service/$sce#trustAsJs
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - audit
      technology:
      - angular
    pattern-either:
    - pattern: '$sceDelegateProvider.resourceUrlWhitelist([...,''**'',...]);

        '
    - patterns:
      - pattern: '$sceDelegateProvider.resourceUrlWhitelist([...,$DOM,...]);

          '
      - metavariable-regex:
          metavariable: $DOM
          regex: ^'.*\*\*.+'$
    severity: WARNING
- rules:
  - id: detect-angular-trust-as-html-method
    languages:
    - javascript
    - typescript
    message: The use of $sce.trustAsHtml can be dangerous if unsanitized user input
      flows through this API.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/service/$sce#trustAsHtml
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - audit
      technology:
      - angular
    patterns:
    - pattern-either:
      - pattern: '$SOURCE = $scope.$INPUT;

          $sce.trustAsHtml($SOURCE);

          '
      - pattern: '$sce.trustAsHtml($scope.$INPUT);

          '
    - pattern-inside: 'app.controller(..., function($scope,$sce){

        ...

        });

        '
    severity: WARNING
- rules:
  - id: detect-angular-trust-as-css-method
    languages:
    - javascript
    - typescript
    message: The use of $sce.trustAsCss can be dangerous if unsanitized user input
      flows through this API.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/service/$sce#trustAsCss
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - audit
      technology:
      - angular
    patterns:
    - pattern-either:
      - pattern: '$SOURCE = $scope.$INPUT;

          $sce.trustAsCss($SOURCE);

          '
      - pattern: '$sce.trustAsCss($scope.$INPUT);

          '
    - pattern-inside: 'app.controller(..., function($scope,$sce){

        ...

        });

        '
    severity: WARNING
- rules:
  - id: detect-angular-sce-disabled
    languages:
    - javascript
    - typescript
    message: $sceProvider is set to false. Disabling Strict Contextual escaping (SCE)
      in an AngularJS application could provide additional attack surface for XSS
      vulnerabilities.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/service/$sce
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - vuln
      technology:
      - angular
    pattern: '$sceProvider.enabled(false);

      '
    severity: ERROR
- rules:
  - id: detect-angular-trust-as-js-method
    languages:
    - javascript
    - typescript
    message: The use of $sce.trustAsJs can be dangerous if unsanitized user input
      flows through this API.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/service/$sce#trustAsJs
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - audit
      technology:
      - angular
    patterns:
    - pattern-either:
      - pattern: '$SOURCE = $scope.$INPUT;

          $sce.trustAsJs($SOURCE);

          '
      - pattern: '$sce.trustAsJs($scope.$INPUT);

          '
    - pattern-inside: 'app.controller(..., function($scope,$sce){

        ...

        });

        '
    severity: WARNING
- rules:
  - id: detect-angular-element-taint
    languages:
    - javascript
    - typescript
    message: Use of angular.element can lead to XSS if user-input is treated as part
      of the HTML element within `$SINK`. It is recommended to contextually output
      encode user-input, before inserting into `$SINK`. If the HTML needs to be preserved
      it is recommended to sanitize the input using $sce.getTrustedHTML or $sanitize.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/function/angular.element
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - vuln
      technology:
      - angularjs
    mode: taint
    pattern-sanitizers:
    - patterns:
      - pattern-either:
        - pattern: $sce.getTrustedHtml(...)
        - pattern: $sanitize(...)
        - pattern: DOMPurify.sanitize(...)
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: 'angular.element(...). ... .$SINK($QUERY)

            '
        - pattern-inside: '$ANGULAR = angular.element(...)

            ...

            $ANGULAR. ... .$SINK($QUERY)

            '
      - metavariable-regex:
          metavariable: $SINK
          regex: ^(after|append|html|prepend|replaceWith|wrap)$
      - focus-metavariable: $QUERY
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: window.location.search
        - pattern: window.document.location.search
        - pattern: document.location.search
        - pattern: location.search
        - pattern: $location.search(...)
    - patterns:
      - pattern-either:
        - pattern: $DECODE(<... location.hash ...>)
        - pattern: $DECODE(<... window.location.hash ...>)
        - pattern: $DECODE(<... document.location.hash ...>)
        - pattern: $DECODE(<... location.href ...>)
        - pattern: $DECODE(<... window.location.href ...>)
        - pattern: $DECODE(<... document.location.href ...>)
        - pattern: $DECODE(<... document.URL ...>)
        - pattern: $DECODE(<... window.document.URL ...>)
        - pattern: $DECODE(<... document.location.href ...>)
        - pattern: $DECODE(<... document.location.href ...>)
        - pattern: $DECODE(<... $location.absUrl() ...>)
        - pattern: $DECODE(<... $location.url() ...>)
        - pattern: $DECODE(<... $location.hash() ...>)
      - metavariable-regex:
          metavariable: $DECODE
          regex: ^(unescape|decodeURI|decodeURIComponent)$
    - patterns:
      - pattern-inside: $http.$METHOD(...).$CONTINUE(function $FUNC($RES) {...})
      - metavariable-regex:
          metavariable: $METHOD
          regex: ^(get|delete|head|jsonp|post|put|patch)
      - pattern: $RES.data
    severity: WARNING
- rules:
  - id: detect-angular-translateprovider-translations-method
    languages:
    - javascript
    message: The use of $translateProvider.translations method can be dangerous if
      user input is provided to this API.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/service/$sce#trustAsUrl
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - audit
      technology:
      - angular
      - typescript
    patterns:
    - pattern: '$translateProvider.translations(...,$SOURCE);

        '
    - pattern-inside: 'app.controller(..., function($scope,$sce){

        ...

        });

        '
    severity: WARNING
- rules:
  - id: detect-angular-trust-as-method
    languages:
    - javascript
    - typescript
    message: The use of $sce.trustAs can be dangerous if unsanitized user input flows
      through this API.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://docs.angularjs.org/api/ng/service/$sce
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
      subcategory:
      - vuln
      technology:
      - angular
    mode: taint
    pattern-sinks:
    - pattern: $sce.trustAs(...)
    - pattern: $sce.trustAsHtml(...)
    pattern-sources:
    - patterns:
      - pattern-inside: 'app.controller(..., function($scope,$sce) {

          ...

          });

          '
      - pattern: $scope.$X
    severity: WARNING
- rules:
  - id: sequelize-tls-disabled-cert-validation
    languages:
    - javascript
    - typescript
    message: Set "rejectUnauthorized" to false is a convenient way to resolve certificate
      error. But this method is unsafe because it disables the server certificate
      verification, making the Node app open to MITM attack. "rejectUnauthorized"
      option must be alway set to True (default value). With self -signed certificate
      or custom CA, use "ca" option to define Root Certificate. This rule checks TLS
      configuration only for Postgresql, MariaDB and MySQL. SQLite is not really concerned
      by TLS configuration. This rule could be extended for MSSQL, but the dialectOptions
      is specific for Tedious.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://node-postgres.com/features/ssl
      - https://nodejs.org/api/tls.html#tls_class_tls_tlssocket
      - https://nodejs.org/api/tls.html#tls_tls_createsecurecontext_options
      subcategory:
      - audit
      technology:
      - sequelize
    patterns:
    - pattern: "{\n  host: $HOST,\n  database: $DATABASE,\n  dialect: $DIALECT,\n\
        \  dialectOptions: {\n    ssl: {\n      rejectUnauthorized: false\n    }\n\
        \  }\n }\n"
    - metavariable-regex:
        metavariable: $DIALECT
        regex: '[''"](mariadb|mysql|postgres)[''"]'
    severity: ERROR
- rules:
  - id: express-sequelize-injection
    languages:
    - javascript
    - typescript
    message: Detected a sequelize statement that is tainted by user-input. This could
      lead to SQL injection if the variable is user-controlled and is not properly
      sanitized. In order to prevent SQL injection, it is recommended to use parameterized
      queries or prepared statements.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      interfile: true
      likelihood: HIGH
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://sequelize.org/docs/v6/core-concepts/raw-queries/#replacements
      subcategory:
      - vuln
      technology:
      - express
    mode: taint
    options:
      interfile: true
    pattern-sanitizers:
    - pattern-either:
      - pattern: parseInt(...)
      - pattern: $FUNC. ... .hash(...)
    pattern-sinks:
    - pattern-either:
      - patterns:
        - pattern-either:
          - pattern: sequelize.query($QUERY,...)
          - pattern: $DB.sequelize.query($QUERY,...)
        - focus-metavariable: $QUERY
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern-inside: function ... ($REQ, $RES) {...}
        - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
        - patterns:
          - pattern-either:
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT)
                {...})
          - metavariable-regex:
              metavariable: $METHOD
              regex: ^(get|post|put|head|delete|options)$
      - pattern-either:
        - pattern: $REQ.query
        - pattern: $REQ.body
        - pattern: $REQ.params
        - pattern: $REQ.cookies
        - pattern: $REQ.headers
        - pattern: $REQ.files.$ANYTHING.data.toString('utf8')
        - pattern: $REQ.files.$ANYTHING['data'].toString('utf8')
    - patterns:
      - pattern-either:
        - pattern-inside: '({ $REQ }: Request,$RES: Response, $NEXT: NextFunction)
            =>

            {...}

            '
        - pattern-inside: '({ $REQ }: Request,$RES: Response) => {...}

            '
      - focus-metavariable: $REQ
      - pattern-either:
        - pattern: params
        - pattern: query
        - pattern: cookies
        - pattern: headers
        - pattern: body
        - pattern: files.$ANYTHING.data.toString('utf8')
        - pattern: files.$ANYTHING['data'].toString('utf8')
    severity: ERROR
- rules:
  - id: sequelize-weak-tls-version
    languages:
    - javascript
    - typescript
    message: TLS1.0 and TLS1.1 are deprecated and should not be used anymore. By default,
      NodeJS used TLSv1.2. So, TLS min version must not be downgrade to TLS1.0 or
      TLS1.1. Enforce TLS1.3 is highly recommended This rule checks TLS configuration
      only for PostgreSQL, MariaDB and MySQL. SQLite is not really concerned by TLS
      configuration. This rule could be extended for MSSQL, but the dialectOptions
      is specific for Tedious.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://node-postgres.com/features/ssl
      - https://nodejs.org/api/tls.html#tls_class_tls_tlssocket
      - https://nodejs.org/api/tls.html#tls_tls_createsecurecontext_options
      - https://nodejs.org/api/tls.html#tls_tls_default_min_version
      subcategory:
      - audit
      technology:
      - sequelize
    patterns:
    - pattern-inside: "{\n  host: $HOST,\n  database: $DATABASE,\n  dialect: $DIALECT,\n\
        \  dialectOptions:\n    { ssl: ... }\n }\n"
    - pattern-either:
      - pattern: "{\n  minVersion: 'TLSv1'\n}\n"
      - pattern: "{\n  minVersion: 'TLSv1.1'\n}\n"
    - metavariable-regex:
        metavariable: $DIALECT
        regex: '[''"](mariadb|mysql|postgres)[''"]'
    severity: WARNING
- rules:
  - id: sequelize-raw-query
    languages:
    - javascript
    - typescript
    message: 'Avoiding SQL string concatenation: untrusted input concatenated with
      raw SQL query can result in SQL Injection. Data replacement or data binding
      should be used. See https://sequelize.org/master/manual/raw-queries.html'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://sequelize.org/master/manual/raw-queries.html
      subcategory:
      - audit
      technology:
      - sequelize
    pattern-either:
    - pattern: '$DATABASE.sequelize.query(`...${...}...`, ...)

        '
    - pattern: '$QUERY = `...${...}...`

        ...

        $DATABASE.sequelize.query($QUERY, ...)

        '
    - pattern: '$DATABASE.sequelize.query($SQL + $VALUE, ...)

        '
    - pattern: '$QUERY = $SQL + $VALUE

        ...

        $DATABASE.sequelize.query($QUERY, ...)

        '
    - pattern: 'Sequelize.literal(`...${...}...`)

        '
    - pattern: '$QUERY = `...${...}...`

        ...

        Sequelize.literal($QUERY)

        '
    - pattern: 'Sequelize.literal($SQL + $VALUE)

        '
    - pattern: '$QUERY = $SQL + $VALUE

        ...

        Sequelize.literal($QUERY)

        '
    severity: WARNING
- rules:
  - id: sequelize-enforce-tls
    languages:
    - javascript
    - typescript
    message: 'If TLS is disabled on server side (Postgresql server), Sequelize establishes
      connection without TLS and no error will be thrown. To prevent MITN (Man In
      The Middle) attack, TLS must be enforce by Sequelize. Set "ssl: true" or define
      settings "ssl: {...}"'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://node-postgres.com/features/ssl
      - https://nodejs.org/api/tls.html#tls_class_tls_tlssocket
      - https://nodejs.org/api/tls.html#tls_tls_createsecurecontext_options
      - https://nodejs.org/api/tls.html#tls_tls_default_min_version
      subcategory:
      - audit
      technology:
      - sequelize
    patterns:
    - pattern: "{\n  host: $HOST,\n  database: $DATABASE,\n  dialect: $DIALECT\n }\n"
    - pattern-not: "{\n  host: $HOST,\n  database: $DATABASE,\n  dialect: \"postgres\"\
        ,\n  dialectOptions: {\n      ssl: true\n  }\n}\n"
    - pattern-not: "{\n  host: $HOST,\n  database: $DATABASE,\n  dialect: $DIALECT,\n\
        \  dialectOptions: {\n    ssl: { ... }\n  }\n}\n"
    - metavariable-regex:
        metavariable: $DIALECT
        regex: '[''"](mariadb|mysql|postgres)[''"]'
    severity: WARNING
- rules:
  - id: vm2-code-injection
    languages:
    - javascript
    - typescript
    message: Make sure that unverified user data can not reach `vm2`.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - vm2
    patterns:
    - pattern-inside: 'require(''vm2'');

        ...

        '
    - pattern-not-inside: '$CODE = "...";

        ...

        '
    - pattern-not-inside: 'require(''vm2'');

        ...

        $CODE = new VMScript(...);

        ...

        '
    - pattern-either:
      - pattern: '$VM = new VM(...);

          ...

          $VM.run($CODE,...);

          '
      - pattern: 'new VM(...).run($CODE,...);

          '
      - pattern: '$VM = new NodeVM(...);

          ...

          $VM.run($CODE,...);

          '
      - pattern: 'new NodeVM(...).run($CODE,...);

          '
      - pattern: 'new VMScript($CODE,...);

          '
    - pattern-not: '$VM = new VM(...);

        ...

        $VM.run("...",...);

        '
    - pattern-not: '$VM = new NodeVM(...);

        ...

        $VM.run("...",...);

        '
    - pattern-not: '(new VM(...)).run("...",...);

        '
    - pattern-not: '(new NodeVM(...)).run("...",...);

        '
    - pattern-not: new VMScript("...",...);
    severity: WARNING
- rules:
  - id: vm2-context-injection
    languages:
    - javascript
    - typescript
    message: Make sure that unverified user data can not reach `vm2`.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - vm2
    patterns:
    - pattern-inside: '$VM = require(''vm2'');

        ...

        '
    - pattern-either:
      - pattern: "function (...,$INPUT,...) {\n  ...\n  new VM({sandbox: <... $INPUT\
          \ ...>},...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $CONTEXT = <... $INPUT ...>;\n\
          \  ...\n  new VM({sandbox: <... $CONTEXT ...>},...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $CONTEXT = <... {$NAME:$INPUT}\
          \ ...>;\n  ...\n  new VM({sandbox: <... $CONTEXT ...>},...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $CONTEXT = {$NAME: <... $INPUT\
          \ ...>};\n  ...\n  new VM({sandbox: <... $CONTEXT ...>},...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $VAR = <... $INPUT ...>;\n\
          \  ...\n  $CONTEXT = {$NAME: <... $VAR ...>};\n  ...\n  new VM({sandbox:\
          \ <... $CONTEXT ...>},...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $OPTS = {sandbox: <... $INPUT\
          \ ...>};\n  ...\n  new VM($OPTS,...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $CONTEXT = <... $INPUT ...>;\n\
          \  ...\n  $OPTS = {sandbox: <... $CONTEXT ...>};\n  ...\n  new VM($OPTS,...);\n\
          \  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $CONTEXT = {$NAME: <... $INPUT\
          \ ...>};\n  ...\n  $OPTS = {sandbox: <... $CONTEXT ...>};\n  ...\n  new\
          \ VM($OPTS,...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $VAR = <... $INPUT ...>;\n\
          \  ...\n  $CONTEXT = {$NAME: <... $VAR ...>};\n  ...\n  $OPTS = {sandbox:\
          \ <... $CONTEXT ...>};\n  ...\n  new VM($OPTS,...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  new VM({sandbox: <... $INPUT\
          \ ...>},...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $CONTEXT = <... $INPUT ...>;\n\
          \  ...\n  new VM({sandbox: <... $CONTEXT ...>},...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $CONTEXT = <... {$NAME:$INPUT}\
          \ ...>;\n  ...\n  new VM({sandbox: <... $CONTEXT ...>},...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $CONTEXT = {$NAME: <...\
          \ $INPUT ...>};\n  ...\n  new VM({sandbox: <... $CONTEXT ...>},...);\n \
          \ ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $VAR = <... $INPUT ...>;\n\
          \  ...\n  $CONTEXT = {$NAME: <... $VAR ...>};\n  ...\n  new VM({sandbox:\
          \ <... $CONTEXT ...>},...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $OPTS = {sandbox: <... $INPUT\
          \ ...>};\n  ...\n  new VM($OPTS,...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $CONTEXT = <... $INPUT ...>;\n\
          \  ...\n  $OPTS = {sandbox: <... $CONTEXT ...>};\n  ...\n  new VM($OPTS,...);\n\
          \  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $CONTEXT = {$NAME: <...\
          \ $INPUT ...>};\n  ...\n  $OPTS = {sandbox: <... $CONTEXT ...>};\n  ...\n\
          \  new VM($OPTS,...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $VAR = <... $INPUT ...>;\n\
          \  ...\n  $CONTEXT = {$NAME: <... $VAR ...>};\n  ...\n  $OPTS = {sandbox:\
          \ <... $CONTEXT ...>};\n  ...\n  new VM($OPTS,...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  new NodeVM({sandbox: <...\
          \ $INPUT ...>},...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $CONTEXT = <... $INPUT ...>;\n\
          \  ...\n  new NodeVM({sandbox: <... $CONTEXT ...>},...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $CONTEXT = <... {$NAME:$INPUT}\
          \ ...>;\n  ...\n  new NodeVM({sandbox: <... $CONTEXT ...>},...);\n  ...\n\
          }\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $CONTEXT = {$NAME: <... $INPUT\
          \ ...>};\n  ...\n  new NodeVM({sandbox: <... $CONTEXT ...>},...);\n  ...\n\
          }\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $VAR = <... $INPUT ...>;\n\
          \  ...\n  $CONTEXT = {$NAME: <... $VAR ...>};\n  ...\n  new NodeVM({sandbox:\
          \ <... $CONTEXT ...>},...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $OPTS = {sandbox: <... $INPUT\
          \ ...>};\n  ...\n  new NodeVM($OPTS,...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $CONTEXT = <... $INPUT ...>;\n\
          \  ...\n  $OPTS = {sandbox: <... $CONTEXT ...>};\n  ...\n  new NodeVM($OPTS,...);\n\
          \  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $CONTEXT = {$NAME: <... $INPUT\
          \ ...>};\n  ...\n  $OPTS = {sandbox: <... $CONTEXT ...>};\n  ...\n  new\
          \ NodeVM($OPTS,...);\n  ...\n}\n"
      - pattern: "function (...,$INPUT,...) {\n  ...\n  $VAR = <... $INPUT ...>;\n\
          \  ...\n  $CONTEXT = {$NAME: <... $VAR ...>};\n  ...\n  $OPTS = {sandbox:\
          \ <... $CONTEXT ...>};\n  ...\n  new NodeVM($OPTS,...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  new NodeVM({sandbox: <...\
          \ $INPUT ...>},...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $CONTEXT = <... $INPUT ...>;\n\
          \  ...\n  new NodeVM({sandbox: <... $CONTEXT ...>},...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $CONTEXT = <... {$NAME:$INPUT}\
          \ ...>;\n  ...\n  new NodeVM({sandbox: <... $CONTEXT ...>},...);\n  ...\n\
          }\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $CONTEXT = {$NAME: <...\
          \ $INPUT ...>};\n  ...\n  new NodeVM({sandbox: <... $CONTEXT ...>},...);\n\
          \  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $VAR = <... $INPUT ...>;\n\
          \  ...\n  $CONTEXT = {$NAME: <... $VAR ...>};\n  ...\n  new NodeVM({sandbox:\
          \ <... $CONTEXT ...>},...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $OPTS = {sandbox: <... $INPUT\
          \ ...>};\n  ...\n  new NodeVM($OPTS,...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $CONTEXT = <... $INPUT ...>;\n\
          \  ...\n  $OPTS = {sandbox: <... $CONTEXT ...>};\n  ...\n  new NodeVM($OPTS,...);\n\
          \  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $CONTEXT = {$NAME: <...\
          \ $INPUT ...>};\n  ...\n  $OPTS = {sandbox: <... $CONTEXT ...>};\n  ...\n\
          \  new NodeVM($OPTS,...);\n  ...\n}\n"
      - pattern: "function $F(...,$INPUT,...) {\n  ...\n  $VAR = <... $INPUT ...>;\n\
          \  ...\n  $CONTEXT = {$NAME: <... $VAR ...>};\n  ...\n  $OPTS = {sandbox:\
          \ <... $CONTEXT ...>};\n  ...\n  new NodeVM($OPTS,...);\n  ...\n}"
    severity: WARNING
- rules:
  - id: monaco-hover-htmlsupport
    languages:
    - typescript
    - javascript
    message: If user input reaches `HoverProvider` while `supportHml` is set to `true`
      it may introduce an XSS vulnerability. Do not produce HTML for hovers with dynamically
      generated input.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://github.com/microsoft/monaco-editor/issues/801
      subcategory:
      - audit
      technology:
      - monaco
      - monaco-editor
    patterns:
    - pattern-either:
      - pattern-inside: 'import "monaco-editor"

          ...

          '
      - pattern-inside: 'require("monaco-editor")

          ...

          '
    - pattern-either:
      - pattern: '{value: $VAL, supportHtml: true}

          '
      - pattern: '{value: $VAL, isTrusted: true}

          '
    - pattern-inside: '{range: $R, contents: [...]}

        '
    - pattern-not: '{..., value: "...", ...}

        '
    severity: WARNING
- rules:
  - id: sax-xxe
    languages:
    - javascript
    - typescript
    message: Use of 'ondoctype' in 'sax' library detected. By default, 'sax' won't
      do anything with custom DTD entity definitions. If you're implementing a custom
      DTD entity definition, be sure not to introduce XML External Entity (XXE) vulnerabilities,
      or be absolutely sure that external entities received from a trusted source
      while processing XML.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://github.com/Leonidas-from-XIV/node-xml2js/issues/415
      - https://github.com/isaacs/sax-js
      subcategory:
      - audit
      technology:
      - sax
    pattern-either:
    - pattern: 'require(''sax'');

        ...

        $PARSER.ondoctype = ...;

        '
    - pattern: 'require(''sax'');

        ...

        $PARSER.on(''doctype'',...);'
    severity: WARNING
- rules:
  - id: detect-replaceall-sanitization
    languages:
    - javascript
    - typescript
    message: Detected a call to `$FUNC()` in an attempt to HTML escape the string
      `$STR`. Manually sanitizing input through a manually built list can be circumvented
      in many situations, and it's better to use a well known sanitization library
      such as `sanitize-html` or `DOMPurify`.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://www.npmjs.com/package/dompurify
      - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
      subcategory:
      - audit
      technology:
      - javascript
      - typescript
    patterns:
    - pattern-either:
      - pattern: $STR.$FUNC('<', '&lt;')
      - pattern: $STR.$FUNC('>', '&gt;')
      - pattern: $STR.$FUNC('"', '&quot;')
      - pattern: $STR.$FUNC("'", '&apos;')
      - pattern: $STR.$FUNC('&', '&amp;')
    - metavariable-regex:
        metavariable: $FUNC
        regex: (replace|replaceAll)
    severity: INFO
- rules:
  - id: hardcoded-passport-secret
    languages:
    - javascript
    - typescript
    message: A hard-coded credential was detected. It is not recommended to store
      credentials in source-code, as this risks secrets being leaked and used by either
      an internal or external malicious adversary. It is recommended to use environment
      variables to securely provide credentials or retrieve credentials from a secure
      vault or HSM (Hardware Security Module).
    metadata:
      asvs:
        control_id: 3.5.2 Static API keys or secret
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
        section: 'V3: Session Management Verification Requirements'
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-798: Use of Hard-coded Credentials'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
      subcategory:
      - vuln
      technology:
      - jwt
      - nodejs
      - secrets
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern-inside: '$F = require("$I").Strategy

            ...

            '
        - pattern-inside: '$F = require("$I")

            ...

            '
        - pattern-inside: 'import { $STRAT as $F } from ''$I''

            ...

            '
        - pattern-inside: 'import $F from ''$I''

            ...

            '
      - metavariable-regex:
          metavariable: $I
          regex: (passport-.*)
      - pattern-inside: 'new $F($VALUE,...)

          '
      - focus-metavariable: $VALUE
    pattern-sources:
    - by-side-effect: true
      patterns:
      - pattern-either:
        - pattern: '{..., clientSecret: "...", ...}

            '
        - pattern: '{..., secretOrKey: "...", ...}

            '
        - pattern: '{..., consumerSecret: "...", ...}

            '
        - patterns:
          - pattern-inside: '$OBJ = {}

              ...

              '
          - pattern-either:
            - pattern: '$OBJ.clientSecret = "..."

                '
            - pattern: '$OBJ.secretOrKey = "..."

                '
            - pattern: '$OBJ.consumerSecret = "..."

                '
          - pattern: $OBJ
        - patterns:
          - pattern-inside: '$SECRET = ''...''

              ...

              '
          - pattern-either:
            - pattern: '{..., clientSecret: $SECRET, ...}

                '
            - pattern: '{..., secretOrKey: $SECRET, ...}

                '
            - pattern: '{..., consumerSecret: $SECRET, ...}

                '
        - patterns:
          - pattern-inside: '$SECRET = ''...''

              ...

              '
          - pattern-either:
            - pattern-inside: '$VALUE = {..., clientSecret: $SECRET, ...}

                ...

                '
            - pattern-inside: '$VALUE = {..., secretOrKey: $SECRET, ...}

                ...

                '
            - pattern-inside: '$VALUE = {..., consumerSecret: $SECRET, ...}

                ...

                '
          - pattern: $VALUE
    severity: WARNING
- rules:
  - id: sandbox-code-injection
    languages:
    - javascript
    - typescript
    message: Make sure that unverified user data can not reach `sandbox`.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - sandbox
    patterns:
    - pattern-inside: '$SANDBOX = require(''sandbox'');

        ...

        '
    - pattern-not-inside: '$CODE = "...";

        ...

        '
    - pattern-either:
      - patterns:
        - pattern-inside: '$S = new $SANDBOX(...);

            ...

            '
        - pattern: $S.run($CODE,...);
      - pattern: 'new $SANDBOX(...).run($CODE,...);

          '
    - pattern-not-inside: '$S = new $SANDBOX(...);

        ...

        $S.run("...",...);

        '
    - pattern-not-inside: new $SANDBOX(...).run("...",...);
    severity: WARNING
- rules:
  - id: apollo-axios-ssrf
    languages:
    - javascript
    message: User-controllable argument $DATAVAL to $METHOD passed to Axios via internal
      handler $INNERFUNC. This could be a server-side request forgery. A user could
      call a restricted API or leak internal headers to an unauthorized party. Validate
      your user arguments against an allowlist of known URLs, or consider refactoring
      so that user-controlled data is not necessary.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://www.cvedetails.com/cve/CVE-2020-28168/
      - https://owasp.org/www-community/attacks/Server_Side_Request_Forgery
      subcategory:
      - audit
      technology:
      - apollo
      - axios
    patterns:
    - pattern: const $RESPONSE = await axios.request($INNERARG,...)
    - pattern-inside: "Query: {\n  $METHOD(parent, args, context, info) {\n    ...\n\
        \    $DATA = args.$DATAVAL\n    ...\n    async function $INNERFUNC(...,$INNERARG,...){\n\
        \      ...\n    }\n    ...\n    return $INNERFUNC(...,$DATA,...)\n    }\n\
        \  }\n"
    severity: WARNING
- rules:
  - id: wkhtmltoimage-injection
    languages:
    - javascript
    - typescript
    message: If unverified user data can reach the `wkhtmltoimage` it can result in
      Server-Side Request Forgery vulnerabilities
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-918: Server-Side Request Forgery (SSRF)'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A10:2021 - Server-Side Request Forgery (SSRF)
      references:
      - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
      subcategory:
      - audit
      technology:
      - wkhtmltoimage
    patterns:
    - pattern-inside: '$WK = require(''wkhtmltoimage'');

        ...

        '
    - pattern-not-inside: 'var $INPUT = "...";

        ...

        '
    - pattern: $WK.generate($INPUT,...)
    - pattern-not: $WK.generate("...",...)
    severity: WARNING
- rules:
  - id: ajv-allerrors-true
    languages:
    - javascript
    - typescript
    message: 'By setting `allErrors: true` in `Ajv` library, all error objects will
      be allocated without limit. This allows the attacker to produce a huge number
      of errors which can lead to denial of service. Do not use `allErrors: true`
      in production.'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-400: Uncontrolled Resource Consumption'
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      references:
      - https://ajv.js.org/options.html#allerrors
      subcategory:
      - audit
      technology:
      - ajv
    pattern-either:
    - pattern: 'new Ajv({...,allErrors: true,...},...)

        '
    - patterns:
      - pattern: 'new Ajv($SETTINGS,...)

          '
      - pattern-inside: '$SETTINGS = {...,allErrors: true,...}

          ...

          '
    severity: WARNING
- rules:
  - id: jwt-simple-noverify
    languages:
    - javascript
    - typescript
    message: Detected the decoding of a JWT token without a verify step. JWT tokens
      must be verified before use, otherwise the token's integrity is unknown. This
      means a malicious actor could forge a JWT token with any claims. Set 'verify'
      to `true` before using the token.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-287: Improper Authentication'
      - 'CWE-345: Insufficient Verification of Data Authenticity'
      - 'CWE-347: Improper Verification of Cryptographic Signature'
      impact: HIGH
      likelihood: MEDIUM
      owasp:
      - A05:2021 - Security Misconfiguration
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://www.npmjs.com/package/jwt-simple
      - https://cwe.mitre.org/data/definitions/287
      - https://cwe.mitre.org/data/definitions/345
      - https://cwe.mitre.org/data/definitions/347
      subcategory:
      - vuln
      technology:
      - jwt-simple
      - jwt
    patterns:
    - pattern-inside: '$JWT = require(''jwt-simple'');

        ...

        '
    - pattern: $JWT.decode($TOKEN, $SECRET, $NOVERIFY, ...)
    - metavariable-pattern:
        metavariable: $NOVERIFY
        patterns:
        - pattern-either:
          - pattern: 'true

              '
          - pattern: '"..."

              '
    severity: ERROR
- rules:
  - id: create-de-cipher-no-iv
    languages:
    - javascript
    - typescript
    message: The deprecated functions 'createCipher' and 'createDecipher' generate
      the same initialization vector every time. For counter modes such as CTR, GCM,
      or CCM this leads to break of both confidentiality and integrity, if the key
      is used more than once. Other modes are still affected in their strength, though
      they're not completely broken. Use 'createCipheriv' or 'createDecipheriv' instead.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-1204: Generation of Weak Initialization Vector (IV)'
      impact: MEDIUM
      likelihood: HIGH
      references:
      - https://nodejs.org/api/crypto.html#cryptocreatecipheralgorithm-password-options
      - https://nodejs.org/api/crypto.html#cryptocreatedecipheralgorithm-password-options
      subcategory:
      - vuln
      technology:
      - node-crypto
    patterns:
    - pattern-either:
      - pattern: '$CRYPTO.createCipher(...)

          '
      - pattern: '$CRYPTO.createDecipher(...)

          '
    severity: ERROR
- rules:
  - id: gcm-no-tag-length
    languages:
    - javascript
    - typescript
    message: The call to 'createDecipheriv' with the Galois Counter Mode (GCM) mode
      of operation is missing an expected authentication tag length. If the expected
      authentication tag length is not specified or otherwise checked, the application
      might be tricked into verifying a shorter-than-expected authentication tag.
      This can be abused by an attacker to spoof ciphertexts or recover the implicit
      authentication key of GCM, allowing arbitrary forgeries.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-310: CWE CATEGORY: Cryptographic Issues'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A02:2021 - Cryptographic Failures
      references:
      - https://www.securesystems.de/blog/forging_ciphertexts_under_Galois_Counter_Mode_for_the_Node_js_crypto_module/
      - https://nodejs.org/api/crypto.html#cryptocreatedecipherivalgorithm-key-iv-options
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures/
      subcategory:
      - vuln
      technology:
      - node-crypto
    patterns:
    - pattern: '$CRYPTO.createDecipheriv(''$ALGO'', $KEY, $IV)

        '
    - metavariable-regex:
        metavariable: $ALGO
        regex: .*(-gcm)$
    severity: ERROR
- rules:
  - id: aead-no-final
    languages:
    - javascript
    - typescript
    message: The 'final' call of a Decipher object checks the authentication tag in
      a mode for authenticated encryption. Failing to call 'final' will invalidate
      all integrity guarantees of the released ciphertext.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-310: CWE CATEGORY: Cryptographic Issues'
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A02:2021 - Cryptographic Failures
      references:
      - https://nodejs.org/api/crypto.html#deciphersetauthtagbuffer-encoding
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures/
      subcategory:
      - vuln
      technology:
      - node-crypto
    patterns:
    - pattern: '$DECIPHER = $CRYPTO.createDecipheriv(''$ALGO'', ...)

        ...

        $DECIPHER.update(...)

        '
    - pattern-not-inside: '$DECIPHER = $CRYPTO.createDecipheriv(''$ALGO'', ...)

        ...

        $DECIPHER.final(...)

        '
    - metavariable-regex:
        metavariable: $ALGO
        regex: .*(-gcm|-ccm|-ocb|chacha20-poly1305)$
    severity: ERROR
