- rules:
  - fix: '$COOKIE = new Cookie($...ARGS);

      $COOKIE.setSecure(true);

      '
    id: cookie-issecure-false
    languages:
    - java
    message: 'Default session middleware settings: `setSecure` not set to true. This
      ensures that the cookie is sent only over HTTPS to prevent cross-site scripting
      attacks.'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://docs.oracle.com/javaee/6/api/javax/servlet/http/Cookie.html#setSecure(boolean)
      - https://owasp.org/www-community/controls/SecureCookieAttribute
      subcategory:
      - audit
      technology:
      - java
      - cookie
      vulnerability: Insecure Transport
    patterns:
    - pattern: $COOKIE = new Cookie($...ARGS);
    - pattern-not-inside: '$COOKIE = new Cookie(...);

        ...

        $COOKIE.setSecure(...);

        '
    severity: WARNING
- rules:
  - fix-regex:
      regex: setSecure\(false\)
      replacement: setSecure(true)
    id: cookie-setSecure
    languages:
    - java
    message: 'Default session middleware settings: `setSecure` not set to true. This
      ensures that the cookie is sent only over HTTPS to prevent cross-site scripting
      attacks.'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://docs.oracle.com/javaee/6/api/javax/servlet/http/Cookie.html#setSecure(boolean)
      - https://owasp.org/www-community/controls/SecureCookieAttribute
      subcategory:
      - audit
      technology:
      - java
      - cookie
      vulnerability: Insecure Transport
    patterns:
    - patterns:
      - pattern-inside: '$COOKIE = new Cookie(...);

          ...

          '
      - pattern: '$COOKIE.setSecure(false);

          '
    - pattern-not-inside: '$COOKIE = new Cookie(...);

        ...

        $COOKIE.setSecure(true);

        '
    severity: WARNING
- rules:
  - id: tainted-sqli
    languages:
    - java
    message: Detected SQL statement that is tainted by `$EVENT` object. This could
      lead to SQL injection if variables in the SQL statement are not properly sanitized.
      Use parameterized SQL queries or properly sanitize user input instead.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      interfile: true
      likelihood: MEDIUM
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - sql
      - java
      - aws-lambda
    mode: taint
    options:
      interfile: true
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: "(java.sql.CallableStatement $STMT) = ...; \n"
        - pattern: '(java.sql.Statement $STMT) = ...;

            '
        - pattern: '(java.sql.PreparedStatement $STMT) = ...;

            '
        - pattern: '$VAR = $CONN.prepareStatement(...)

            '
        - pattern: '$PATH.queryForObject(...);

            '
        - pattern: '(java.util.Map<String, Object> $STMT) = $PATH.queryForMap(...);

            '
        - pattern: '(org.springframework.jdbc.support.rowset.SqlRowSet $STMT) = ...;

            '
        - patterns:
          - pattern-inside: '(String $SQL) = "$SQLSTR" + ...;

              ...

              '
          - pattern: $PATH.$SQLCMD(..., $SQL, ...);
          - metavariable-regex:
              metavariable: $SQLSTR
              regex: (?i)(^SELECT.* | ^INSERT.* | ^UPDATE.*)
          - metavariable-regex:
              metavariable: $SQLCMD
              regex: (execute|query|executeUpdate|batchUpdate)
    pattern-sources:
    - patterns:
      - focus-metavariable: $EVENT
      - pattern-either:
        - pattern: "$HANDLERTYPE $HANDLER($TYPE $EVENT, com.amazonaws.services.lambda.runtime.Context\
            \ $CONTEXT) {\n  ...\n}\n"
        - pattern: "$HANDLERTYPE $HANDLER(InputStream $EVENT, OutputStream $OUT, com.amazonaws.services.lambda.runtime.Context\
            \ $CONTEXT) {\n  ...\n}\n"
    severity: WARNING
- rules:
  - id: tainted-sql-string
    languages:
    - java
    message: Detected user input used to manually construct a SQL string. This is
      usually bad practice because manual construction could accidentally result in
      a SQL injection. An attacker could use a SQL injection to steal or modify contents
      of the database. Instead, use a parameterized query which is available by default
      in most database engines. Alternatively, consider using an object-relational
      mapper (ORM) such as Sequelize which will protect your queries.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      interfile: true
      likelihood: MEDIUM
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/www-community/attacks/SQL_Injection
      subcategory:
      - vuln
      technology:
      - aws-lambda
    mode: taint
    options:
      interfile: true
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: '"$SQLSTR" + ...

            '
        - pattern: '"$SQLSTR".concat(...)

            '
        - patterns:
          - pattern-inside: 'StringBuilder $SB = new StringBuilder("$SQLSTR");

              ...

              '
          - pattern: $SB.append(...)
        - patterns:
          - pattern-inside: '$VAR = "$SQLSTR";

              ...

              '
          - pattern: $VAR += ...
        - pattern: String.format("$SQLSTR", ...)
      - metavariable-regex:
          metavariable: $SQLSTR
          regex: (?i)(select|delete|insert|create|update|alter|drop)\b
      - pattern-not-inside: 'System.out.$PRINTLN(...)

          '
    pattern-sources:
    - patterns:
      - focus-metavariable: $EVENT
      - pattern-either:
        - pattern: "$HANDLERTYPE $HANDLER($TYPE $EVENT, com.amazonaws.services.lambda.runtime.Context\
            \ $CONTEXT) {\n  ...\n}\n"
        - pattern: "$HANDLERTYPE $HANDLER(InputStream $EVENT, OutputStream $OUT, com.amazonaws.services.lambda.runtime.Context\
            \ $CONTEXT) {\n  ...\n}\n"
    severity: ERROR
- rules:
  - id: mongodb-nosqli
    languages:
    - java
    message: Detected non-constant data passed into a NoSQL query using the 'where'
      evaluation operator. If this data can be controlled by an external user, this
      is a NoSQL injection. Ensure data passed to the NoSQL query is not user controllable,
      or properly sanitize the data. Ideally, avoid using the 'where' operator at
      all and instead use the helper methods provided by com.mongodb.client.model.Filters
      with comparative operators such as eq, ne, lt, gt, etc.
    metadata:
      asvs:
        control_id: 5.3.4 Injection Prevention
        control_url: https://github.com/OWASP/ASVS/blob/master/5.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention
        section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
        version: '5'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-943: Improper Neutralization of Special Elements in Data Query Logic'
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      - https://www.mongodb.com/docs/manual/tutorial/query-documents/
      - https://www.mongodb.com/docs/manual/reference/operator/query/where/
      subcategory:
      - audit
      technology:
      - nosql
      - mongodb
    patterns:
    - pattern-either:
      - pattern: (com.mongodb.BasicDBObject $QUERY).put("$where", $INPUT);
      - pattern: '(HashMap<String, String> $MAP).put("$where", $INPUT);

          ...

          (com.mongodb.BasicDBObject $QUERY).putAll($MAP);

          '
      - pattern: (com.mongodb.BasicDBObject $QUERY).append("$where", $INPUT);
      - pattern: new com.mongodb.BasicDBObject("$where", $INPUT);
      - pattern: '(HashMap<String, String> $MAP).put("$where", $INPUT);

          ...

          new com.mongodb.BasicDBObject($MAP);

          '
      - pattern: '(HashMap<String, String> $MAP).put("$where", $INPUT);

          ...

          String json = new JSONObject($MAP).toString();

          ...

          (com.mongodb.BasicDBObject $QUERY).parse((String $JSON));

          '
      - pattern: com.mongodb.BasicDBObjectBuilder.start().add("$where", $INPUT);
      - pattern: com.mongodb.BasicDBObjectBuilder.start().append("$where", $INPUT);
      - pattern: com.mongodb.BasicDBObjectBuilder.start("$where", $INPUT);
      - pattern: '(HashMap<String, String> $MAP).put("$where", $INPUT);

          ...

          com.mongodb.BasicDBObjectBuilder.start($MAP);

          '
    - metavariable-pattern:
        metavariable: $INPUT
        patterns:
        - pattern: '...

            '
        - pattern-not: '"..."

            '
    severity: WARNING
- rules:
  - id: java-jwt-none-alg
    languages:
    - java
    message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm
      assumes the integrity of the token has already been verified. This would allow
      a malicious actor to forge a JWT token that will automatically be verified.
      Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as
      'HS256'.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
      subcategory:
      - vuln
      technology:
      - jwt
    pattern-either:
    - pattern: '$JWT.sign(com.auth0.jwt.algorithms.Algorithm.none());

        '
    - pattern: '$NONE = com.auth0.jwt.algorithms.Algorithm.none();

        ...

        $JWT.sign($NONE);

        '
    - pattern: "class $CLASS {\n  ...\n  $TYPE $NONE = com.auth0.jwt.algorithms.Algorithm.none();\n\
        \  ...\n  $RETURNTYPE $FUNC (...) {\n    ...\n    $JWT.sign($NONE);\n    ...\n\
        \  }\n  ...\n}"
    severity: ERROR
- rules:
  - id: java-jwt-hardcoded-secret
    languages:
    - java
    message: A hard-coded credential was detected. It is not recommended to store
      credentials in source-code, as this risks secrets being leaked and used by either
      an internal or external malicious adversary. It is recommended to use environment
      variables to securely provide credentials or retrieve credentials from a secure
      vault or HSM (Hardware Security Module).
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-798: Use of Hard-coded Credentials'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
      subcategory:
      - vuln
      technology:
      - java
      - secrets
      - jwt
    patterns:
    - pattern-either:
      - pattern: '(Algorithm $ALG) = $ALGO.$HMAC("$Y");

          '
      - pattern: '$SECRET = "$Y";

          ...

          (Algorithm $ALG) = $ALGO.$HMAC($SECRET);

          '
      - pattern: "class $CLASS {\n  ...\n  $TYPE $SECRET = \"$Y\";\n  ...\n  $RETURNTYPE\
          \ $FUNC (...) {\n    ...\n    (Algorithm $ALG) = $ALGO.$HMAC($SECRET);\n\
          \    ...\n  }\n  ...\n}\n"
    - focus-metavariable: $Y
    - metavariable-regex:
        metavariable: $HMAC
        regex: (HMAC384|HMAC256|HMAC512)
    severity: WARNING
- rules:
  - id: java-jwt-decode-without-verify
    languages:
    - java
    message: Detected the decoding of a JWT token without a verify step. JWT tokens
      must be verified before use, otherwise the token's integrity is unknown. This
      means a malicious actor could forge a JWT token with any claims. Call '.verify()'
      before using the token.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-345: Insufficient Verification of Data Authenticity'
      impact: HIGH
      likelihood: LOW
      owasp:
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
      source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
      subcategory:
      - vuln
      technology:
      - jwt
    patterns:
    - pattern: 'com.auth0.jwt.JWT.decode(...);

        '
    - pattern-not-inside: "class $CLASS {\n  ...\n  $RETURNTYPE $FUNC (...) {\n  \
        \  ...\n    $VERIFIER.verify(...);\n    ...\n  }\n}"
    severity: WARNING
- rules:
  - id: manifest-usesCleartextTraffic-true
    languages:
    - generic
    message: The Android manifest is configured to allow non-encrypted connections.
      Evaluate if this is necessary for your app, and disable it if appropriate. This
      flag is ignored on Android 7 (API 24) and above if a Network Security Config
      is present.
    metadata:
      category: best-practice
      references:
      - https://developer.android.com/guide/topics/manifest/application-element#usesCleartextTraffic
      - https://developer.android.com/training/articles/security-config
      technology:
      - android
    paths:
      include:
      - '*.xml'
    patterns:
    - pattern: 'android:usesCleartextTraffic="true"

        '
    - pattern-not-inside: '<!-- ... -->

        '
    severity: INFO
  - id: manifest-usesCleartextTraffic-ignored-by-nsc
    languages:
    - generic
    message: Manifest uses both `android:usesCleartextTraffic` and Network Security
      Config. The `usesCleartextTraffic` directive is ignored on Android 7 (API 24)
      and above if a Network Security Config is present.
    metadata:
      category: best-practice
      references:
      - https://developer.android.com/guide/topics/manifest/application-element#usesCleartextTraffic
      - https://developer.android.com/training/articles/security-config
      technology:
      - android
    paths:
      include:
      - '*.xml'
    patterns:
    - pattern-either:
      - pattern: 'android:usesCleartextTraffic ... android:networkSecurityConfig

          '
      - pattern: 'android:networkSecurityConfig ... android:usesCleartextTraffic

          '
    - pattern-not-inside: '<!-- ... -->

        '
    severity: INFO
- rules:
  - id: exported_activity
    languages:
    - generic
    message: The application exports an activity. Any application on the device can
      launch the exported activity which may compromise the integrity of your application
      or its data.  Ensure that any exported activities do not have privileged access
      to your application's control plane.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-926: Improper Export of Android Application Components'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A5:2021 Security Misconfiguration
      references:
      - https://cwe.mitre.org/data/definitions/926.html
      subcategory:
      - vuln
      technology:
      - Android
    paths:
      exclude:
      - sources/
      - classes3.dex
      - '*.so'
      include:
      - '*AndroidManifest.xml'
    patterns:
    - pattern-not-inside: <activity ... android:exported="false" ... />
    - pattern-inside: "<activity  ... /> \n"
    - pattern-either:
      - pattern: '<activity ... android:exported="true" ... />

          '
      - pattern: '<activity ... <intent-filter> ... />

          '
    severity: WARNING
- rules:
  - id: eqeq
    languages:
    - java
    message: '`$X == $X` or `$X != $X` is always true. (Unless the value compared
      is a float or double). To test if `$X` is not-a-number, use `Double.isNaN($X)`.'
    metadata:
      category: correctness
      technology:
      - java
    patterns:
    - pattern-not-inside: assert $X;
    - pattern-not-inside: 'assert $X : $Y;

        '
    - pattern-either:
      - pattern: $X == $X
      - pattern: $X != $X
    - pattern-not: 1 == 1
    severity: ERROR
- rules:
  - id: no-string-eqeq
    languages:
    - java
    message: Strings should not be compared with '=='. This is a reference comparison
      operator. Use '.equals()' instead.
    metadata:
      category: correctness
      technology:
      - java
    patterns:
    - pattern-not: null == (String $Y)
    - pattern: $X == (String $Y)
    severity: WARNING
- rules:
  - id: hardcoded-conditional
    languages:
    - java
    message: This if statement will always have the same behavior and is therefore
      unnecessary.
    metadata:
      category: correctness
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern: if (true) { ... }
      - pattern: if (false) { ... }
      - pattern: if ($VAR = true) { ... }
      - pattern: if ($VAR = false) { ... }
      - pattern: if ($EXPR && false) { ... }
      - pattern: if (false && $EXPR) { ... }
      - pattern: if ($EXPR || true) { ... }
      - pattern: if (true || $EXPR) { ... }
    severity: ERROR
- rules:
  - id: assignment-comparison
    languages:
    - java
    message: The value of `$X` is being ignored and will be used in the conditional
      test
    metadata:
      category: correctness
      technology:
      - java
    pattern-either:
    - pattern: if ($X=true) { ... }
    - pattern: if ($X=false) { ... }
    severity: ERROR
- rules:
  - id: servletresponse-writer-xss
    languages:
    - java
    message: 'Cross-site scripting detected in HttpServletResponse writer with variable
      ''$VAR''. User input was detected going directly from the HttpServletRequest
      into output. Ensure your data is properly encoded using org.owasp.encoder.Encode.forHtml:
      ''Encode.forHtml($VAR)''.'
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#XSS_SERVLET
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern-inside: $TYPE $FUNC(..., HttpServletResponse $RESP, ...) { ... }
    - pattern-inside: $VAR = $REQ.getParameter(...); ...
    - pattern-either:
      - pattern: $RESP.getWriter(...).write(..., $VAR, ...);
      - pattern: '$WRITER = $RESP.getWriter(...);

          ...

          $WRITER.write(..., $VAR, ...);

          '
    severity: ERROR
- rules:
  - id: insecure-jms-deserialization
    languages:
    - java
    message: JMS Object messages depend on Java Serialization for marshalling/unmarshalling
      of the message payload when ObjectMessage.getObject() is called. Deserialization
      of untrusted data can lead to security flaws; a remote attacker could via a
      crafted JMS ObjectMessage to execute arbitrary code with the permissions of
      the application listening/consuming JMS Messages. In this case, the JMS MessageListener
      consume an ObjectMessage type received inside the onMessage method, which may
      lead to arbitrary code execution when calling the $Y.getObject method.
    metadata:
      asvs:
        control_id: 5.5.3 Insecue Deserialization
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-502: Deserialization of Untrusted Data'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A08:2017 - Insecure Deserialization
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities-wp.pdf
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern-inside: "public class $JMS_LISTENER implements MessageListener {\n \
        \ ...\n  public void onMessage(Message $JMS_MSG) {\n      ...\n  }\n}\n"
    - pattern-either:
      - pattern-inside: $X = $Y.getObject(...);
      - pattern-inside: $X = ($Z) $Y.getObject(...);
    severity: WARNING
- rules:
  - id: jackson-unsafe-deserialization
    languages:
    - java
    message: When using Jackson to marshall/unmarshall JSON to Java objects, enabling
      default typing is dangerous and can lead to RCE. If an attacker can control
      `$JSON` it might be possible to provide a malicious JSON which can be used to
      exploit unsecure deserialization. In order to prevent this issue, avoid to enable
      default typing (globally or by using "Per-class" annotations) and avoid using
      `Object` and other dangerous types for member variable declaration which creating
      classes for Jackson based deserialization.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-502: Deserialization of Untrusted Data'
      impact: HIGH
      likelihood: LOW
      owasp:
      - A8:2017 Insecure Deserialization
      - A8:2021 Software and Data Integrity Failures
      references:
      - https://swapneildash.medium.com/understanding-insecure-implementation-of-jackson-deserialization-7b3d409d2038
      - https://cowtowncoder.medium.com/on-jackson-cves-dont-panic-here-is-what-you-need-to-know-54cd0d6e8062
      - https://adamcaudill.com/2017/10/04/exploiting-jackson-rce-cve-2017-7525/
      subcategory:
      - audit
      technology:
      - jackson
    patterns:
    - pattern-either:
      - patterns:
        - pattern-inside: 'ObjectMapper $OM = new ObjectMapper(...);

            ...

            '
        - pattern-inside: '$OM.enableDefaultTyping();

            ...

            '
        - pattern: $OM.readValue($JSON, ...);
      - patterns:
        - pattern-inside: "class $CLASS {\n  ...\n  @JsonTypeInfo(use = Id.CLASS,...)\n\
            \  $TYPE $VAR;\n  ...\n}\n"
        - metavariable-regex:
            metavariable: $TYPE
            regex: (Object|Serializable|Comparable)
        - pattern: $OM.readValue($JSON, $CLASS.class);
      - patterns:
        - pattern-inside: "class $CLASS {\n  ...\n  ObjectMapper $OM;\n  ...\n  $INITMETHODTYPE\
            \ $INITMETHOD(...) {\n    ...\n    $OM = new ObjectMapper();\n    ...\n\
            \    $OM.enableDefaultTyping();\n    ...\n  }\n  ...\n}\n"
        - pattern-inside: "$METHODTYPE $METHOD(...) {\n  ...  \n}\n"
        - pattern: $OM.readValue($JSON, ...);
    severity: WARNING
- rules:
  - id: httpservlet-path-traversal
    languages:
    - java
    message: Detected a potential path traversal. A malicious actor could control
      the location of this file, to include going backwards in the directory with
      '../'. To address this, ensure that user-controlled variables in file paths
      are sanitized. You may also consider using a utility method such as org.apache.commons.io.FilenameUtils.getName(...)
      to only retrieve the file name from the path.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path
        Traversal'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A05:2017 - Broken Access Control
      - A01:2021 - Broken Access Control
      references:
      - https://www.owasp.org/index.php/Path_Traversal
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#PATH_TRAVERSAL_IN
      subcategory:
      - vuln
      technology:
      - java
    mode: taint
    pattern-sanitizers:
    - pattern: org.apache.commons.io.FilenameUtils.getName(...)
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: '(java.io.File $FILE) = ...

            '
        - pattern: '(java.io.FileOutputStream $FOS) = ...

            '
        - pattern: 'new java.io.FileInputStream(...)

            '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: '(HttpServletRequest $REQ)

            '
        - patterns:
          - pattern-inside: "(javax.servlet.http.Cookie[] $COOKIES) = (HttpServletRequest\
              \ $REQ).getCookies(...);\n...\nfor (javax.servlet.http.Cookie $COOKIE:\
              \ $COOKIES) {\n  ...\n}\n"
          - pattern: '$COOKIE.getValue(...)

              '
        - patterns:
          - pattern-inside: '$TYPE[] $VALS = (HttpServletRequest $REQ).$GETFUNC(...);

              ...

              '
          - pattern: '$PARAM = $VALS[$INDEX];

              '
    severity: ERROR
- rules:
  - id: use-snakeyaml-constructor
    languages:
    - java
    message: Used SnakeYAML org.yaml.snakeyaml.Yaml() constructor with no arguments,
      which is vulnerable to deserialization attacks. Use the one-argument Yaml(...)
      constructor instead, with SafeConstructor or a custom Constructor as the argument.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-502: Deserialization of Untrusted Data'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A08:2017 - Insecure Deserialization
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://securitylab.github.com/research/swagger-yaml-parser-vulnerability/#snakeyaml-deserialization-vulnerability
      subcategory:
      - audit
      technology:
      - snakeyaml
    patterns:
    - pattern: '$Y = new org.yaml.snakeyaml.Yaml();

        ...

        $Y.load(...);

        '
    severity: WARNING
- rules:
  - id: xmlinputfactory-external-entities-enabled
    languages:
    - java
    message: XML external entities are enabled for this XMLInputFactory. This is vulnerable
      to XML external entity attacks. Disable external entities by setting "javax.xml.stream.isSupportingExternalEntities"
      to false.
    metadata:
      asvs:
        control_id: 5.5.2 Insecue XML Deserialization
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://semgrep.dev/blog/2022/xml-security-in-java
      - https://semgrep.dev/docs/cheat-sheets/java-xxe/
      - https://www.blackhat.com/docs/us-15/materials/us-15-Wang-FileCry-The-New-Age-Of-XXE-java-wp.pdf
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern: (javax.xml.stream.XMLInputFactory $XMLFACTORY).setProperty("javax.xml.stream.isSupportingExternalEntities",
          true);
      - pattern: (javax.xml.stream.XMLInputFactory $XMLFACTORY).setProperty(javax.xml.stream.XMLInputFactory.SUPPORT_DTD,
          true);
      - pattern: (javax.xml.stream.XMLInputFactory $XMLFACTORY).setProperty("javax.xml.stream.isSupportingExternalEntities",
          Boolean.TRUE);
      - pattern: (javax.xml.stream.XMLInputFactory $XMLFACTORY).setProperty(javax.xml.stream.XMLInputFactory.SUPPORT_DTD,
          Boolean.TRUE);
    severity: ERROR
- rules:
  - id: xmlinputfactory-possible-xxe
    languages:
    - java
    message: XML external entities are not explicitly disabled for this XMLInputFactory.
      This could be vulnerable to XML external entity vulnerabilities. Explicitly
      disable external entities by setting "javax.xml.stream.isSupportingExternalEntities"
      to false.
    metadata:
      asvs:
        control_id: 5.5.2 Insecue XML Deserialization
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://semgrep.dev/blog/2022/xml-security-in-java
      - https://semgrep.dev/docs/cheat-sheets/java-xxe/
      - https://www.blackhat.com/docs/us-15/materials/us-15-Wang-FileCry-The-New-Age-Of-XXE-java-wp.pdf
      - https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#xmlinputfactory-a-stax-parser
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern-not-inside: "$METHOD(...) {\n  ...\n  $XMLFACTORY.setProperty(\"javax.xml.stream.isSupportingExternalEntities\"\
        , false);\n  ...\n}\n"
    - pattern-not-inside: "$METHOD(...) {\n  ...\n  $XMLFACTORY.setProperty(javax.xml.stream.XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES,\
        \ false);\n  ...\n}\n"
    - pattern-not-inside: "$METHOD(...) {\n  ...\n  $XMLFACTORY.setProperty(\"javax.xml.stream.isSupportingExternalEntities\"\
        , Boolean.FALSE);\n  ...\n}\n"
    - pattern-not-inside: "$METHOD(...) {\n  ...\n  $XMLFACTORY.setProperty(javax.xml.stream.XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES,\
        \ Boolean.FALSE);\n  ...\n}\n"
    - pattern-either:
      - pattern: javax.xml.stream.XMLInputFactory.newFactory(...)
      - pattern: new XMLInputFactory(...)
    severity: WARNING
- rules:
  - id: do-privileged-use
    languages:
    - java
    message: Marking code as privileged enables a piece of trusted code to temporarily
      enable access to more resources than are available directly to the code that
      called it. Be very careful in your use of the privileged construct, and always
      remember to make the privileged code section as small as possible.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-269: Improper Privilege Management'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A04:2021 - Insecure Design
      references:
      - https://docs.oracle.com/javase/8/docs/technotes/guides/security/doprivileged.html
      - https://wiki.sei.cmu.edu/confluence/display/java/Privilege+Escalation
      - http://phrack.org/papers/escaping_the_java_sandbox.html
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-inside: 'import java.security.*;

        ...

        '
    - pattern-either:
      - pattern: AccessController.doPrivileged(...);
      - pattern: class $ACTION implements PrivilegedAction<Void> { ... }
    severity: WARNING
- rules:
  - fix: '"AES/GCM/NoPadding"

      '
    id: cbc-padding-oracle
    languages:
    - java
    message: Using CBC with PKCS5Padding is susceptible to padding oracle attacks.
      A malicious actor could discern the difference between plaintext with valid
      or invalid padding. Further, CBC mode does not include any integrity checks.
      Use 'AES/GCM/NoPadding' instead.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://capec.mitre.org/data/definitions/463.html
      - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#cipher-modes
      - https://find-sec-bugs.github.io/bugs.htm#CIPHER_INTEGRITY
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#PADDING_ORACLE
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-inside: Cipher.getInstance("=~/.*\/CBC\/PKCS5Padding/")
    - pattern: '"=~/.*\/CBC\/PKCS5Padding/"

        '
    severity: WARNING
- rules:
  - id: cookie-missing-secure-flag
    languages:
    - java
    message: A cookie was detected without setting the 'secure' flag. The 'secure'
      flag for cookies prevents the client from transmitting the cookie over insecure
      channels such as HTTP. Set the 'secure' flag by calling '$COOKIE.setSecure(true);'
    metadata:
      asvs:
        control_id: 3.4.1 Missing Cookie Attribute
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v34-cookie-based-session-management
        section: 'V3: Session Management Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-614: Sensitive Cookie in HTTPS Session Without ''Secure'' Attribute'
      impact: LOW
      likelihood: LOW
      owasp:
      - A05:2021 - Security Misconfiguration
      references:
      - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#INSECURE_COOKIE
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-not-inside: $COOKIE.setValue(""); ...
    - pattern-either:
      - pattern: $COOKIE.setSecure(false);
      - patterns:
        - pattern-not-inside: $COOKIE.setSecure(...); ...
        - pattern-not-inside: $COOKIE = ResponseCookie.from(...). ...; ...
        - pattern: $RESPONSE.addCookie($COOKIE);
    severity: WARNING
- rules:
  - id: crlf-injection-logs
    languages:
    - java
    message: When data from an untrusted source is put into a logger and not neutralized
      correctly, an attacker could forge log entries or include malicious content.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-93: Improper Neutralization of CRLF Sequences (''CRLF Injection'')'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#CRLF_INJECTION_LOGS
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern-either:
      - patterns:
        - pattern-inside: "class $CLASS {\n  ...\n  Logger $LOG = ...;\n  ...\n}\n"
        - pattern-either:
          - pattern-inside: "$X $METHOD(...,HttpServletRequest $REQ,...) {\n  ...\n\
              }\n"
          - pattern-inside: "$X $METHOD(...,ServletRequest $REQ,...) {\n  ...\n}\n"
          - pattern-inside: "$X $METHOD(...) {\n  ...\n  HttpServletRequest $REQ =\
              \ ...;\n  ...\n}\n"
          - pattern-inside: "$X $METHOD(...) {\n  ...\n  ServletRequest $REQ = ...;\n\
              \  ...\n}\n"
      - pattern-inside: "$X $METHOD(...) {\n  ...\n  Logger $LOG = ...;\n  ...\n \
          \ HttpServletRequest $REQ = ...;\n  ...\n}\n"
      - pattern-inside: "$X $METHOD(...) {\n  ...\n  Logger $LOG = ...;\n  ...\n \
          \ ServletRequest $REQ = ...;\n  ...\n}\n"
    - pattern-either:
      - pattern: 'String $VAL = $REQ.getParameter(...);

          ...

          $LOG.$LEVEL(<... $VAL ...>);

          '
      - pattern: 'String $VAL = $REQ.getParameter(...);

          ...

          $LOG.log($LEVEL,<... $VAL ...>);

          '
      - pattern: '$LOG.$LEVEL(<... $REQ.getParameter(...) ...>);

          '
      - pattern: '$LOG.log($LEVEL,<... $REQ.getParameter(...) ...>);

          '
    severity: WARNING
- rules:
  - id: ldap-injection
    languages:
    - java
    message: Detected non-constant data passed into an LDAP query. If this data can
      be controlled by an external user, this is an LDAP injection. Ensure data passed
      to an LDAP query is not controllable; or properly sanitize the data.
    metadata:
      asvs:
        control_id: 5.3.7 Injection
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
        section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-90: Improper Neutralization of Special Elements used in an LDAP Query
        (''LDAP Injection'')'
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#LDAP_INJECTION
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern-inside: "$X $METHOD(...) {\n  ...\n  InitialDirContext $CTX = ...;\n\
          \  ...\n}\n"
      - pattern-inside: "$X $METHOD(...) {\n  ...\n  DirContext $CTX = ...;\n  ...\n\
          }\n"
      - pattern-inside: "$X $METHOD(...) {\n  ...\n  InitialLdapContext $CTX = ...;\n\
          \  ...\n}\n"
      - pattern-inside: "$X $METHOD(...) {\n  ...\n  LdapContext $CTX = ...;\n  ...\n\
          }\n"
      - pattern-inside: "$X $METHOD(...) {\n  ...\n  LdapCtx $CTX = ...;\n  ...\n\
          }\n"
      - pattern-inside: "$X $METHOD(...) {\n  ...\n  EventDirContext $CTX = ...;\n\
          \  ...\n}\n"
    - pattern: "$X $METHOD(...) {\n  ...\n  $CTX.search($Y,$INPUT,...);\n  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $CTX.search($Y,\"...\",...);\n  ...\n\
        }\n"
    severity: WARNING
- rules:
  - id: java-reverse-shell
    languages:
    - java
    message: Semgrep found potential reverse shell behavior
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern: "Socket $S=new Socket(...);\n...\nInputStream $SI = $S.getInputStream();\n\
          ...\nwhile(!$S.isClosed())\n{\n  ...\n  while($SI.available()>0)$PO.write($SI.read());\n\
          \  ...\n  $SO.flush();\n  ...\n}\n"
    - pattern-inside: 'Process $P=new ProcessBuilder(...).redirectErrorStream(true).start();

        ...

        $P.destroy();

        '
    severity: WARNING
- rules:
  - id: object-deserialization
    languages:
    - java
    message: Found object deserialization using ObjectInputStream. Deserializing entire
      Java objects is dangerous because malicious actors can create Java object streams
      with unintended consequences. Ensure that the objects being deserialized are
      not user-controlled. If this must be done, consider using HMACs to sign the
      data stream to make sure it is not tampered with, or consider only transmitting
      object fields and populating a new object.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-502: Deserialization of Untrusted Data'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A08:2017 - Insecure Deserialization
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://www.owasp.org/index.php/Deserialization_of_untrusted_data
      - https://www.oracle.com/java/technologies/javase/seccodeguide.html#8
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#OBJECT_DESERIALIZATION
      subcategory:
      - audit
      technology:
      - java
    pattern: new ObjectInputStream(...);
    severity: WARNING
- rules:
  - id: insecure-smtp-connection
    languages:
    - java
    message: Insecure SMTP connection detected. This connection will trust any SSL
      certificate. Enable certificate verification by setting 'email.setSSLCheckServerIdentity(true)'.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-297: Improper Validation of Certificate with Host Mismatch'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#INSECURE_SMTP_SSL
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern-not-inside: '$EMAIL.setSSLCheckServerIdentity(true);

        ...

        '
    - pattern-inside: '$EMAIL = new SimpleEmail(...);

        ...

        '
    - pattern: $EMAIL.send(...);
    severity: WARNING
- rules:
  - id: xml-decoder
    languages:
    - java
    message: XMLDecoder should not be used to parse untrusted data. Deserializing
      user input can lead to arbitrary code execution. Use an alternative and explicitly
      disable external entities. See https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html
      for alternatives and vulnerability prevention.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://semgrep.dev/blog/2022/xml-security-in-java
      - https://semgrep.dev/docs/cheat-sheets/java-xxe/
      - https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#XML_DECODER
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern: "$X $METHOD(...) {\n  ...\n  new XMLDecoder(...);\n  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  new XMLDecoder(\"...\");\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $STR = \"...\";\n  ...\n  new\
        \ XMLDecoder($STR);\n  ...\n}"
    severity: WARNING
- rules:
  - id: blowfish-insufficient-key-size
    languages:
    - java
    message: Using less than 128 bits for Blowfish is considered insecure. Use 128
      bits or more, or switch to use AES instead.
    metadata:
      asvs:
        control_id: 6.2.5 Insecure Algorithm
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
        section: V6 Stored Cryptography Verification Requirements
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-326: Inadequate Encryption Strength'
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#BLOWFISH_KEY_SIZE
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern: '$KEYGEN = KeyGenerator.getInstance("Blowfish");

        ...

        $KEYGEN.init($SIZE);

        '
    - metavariable-comparison:
        comparison: $SIZE < 128
        metavariable: $SIZE
    severity: WARNING
- rules:
  - id: xssrequestwrapper-is-insecure
    languages:
    - java
    message: It looks like you're using an implementation of XSSRequestWrapper from
      dzone. (https://www.javacodegeeks.com/2012/07/anti-cross-site-scripting-xss-filter.html)
      The XSS filtering in this code is not secure and can be bypassed by malicious
      actors. It is recommended to use a stack that automatically escapes in your
      view or templates instead of filtering yourself.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#XSS_REQUEST_WRAPPER
      subcategory:
      - audit
      technology:
      - java
    pattern-either:
    - pattern: "class XSSRequestWrapper extends HttpServletRequestWrapper {\n  ...\n\
        }\n"
    - pattern: '$P = $X.compile("</script>", $X.CASE_INSENSITIVE);

        $V = $P.matcher(...).replaceAll("");'
    severity: WARNING
- rules:
  - id: dangerous-groovy-shell
    languages:
    - java
    message: A expression is built with a dynamic value. The source of the value(s)
      should be verified to avoid that unfiltered values fall into this risky code
      evaluation.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#GROOVY_SHELL
      subcategory:
      - audit
      technology:
      - groovy
    patterns:
    - pattern-either:
      - pattern: '$SHELL.parse(...)

          '
      - pattern: '$SHELL.evaluate(...)

          '
      - pattern: '$SHELL.parseClass(...)

          '
    - pattern-either:
      - pattern-inside: 'groovy.lang.GroovyShell $SHELL = ...;

          ...

          '
      - pattern-inside: 'groovy.lang.GroovyClassLoader $SHELL = ...;

          ...

          '
    - pattern-not: '$SHELL.parse("...",...)

        '
    - pattern-not: '$SHELL.evaluate("...",...)

        '
    - pattern-not: '$SHELL.parseClass("...",...)

        '
    severity: WARNING
- rules:
  - id: script-engine-injection
    languages:
    - java
    message: Detected potential code injection using ScriptEngine. Ensure user-controlled
      data cannot enter '.eval()', otherwise, this is a code injection vulnerability.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SCRIPT_ENGINE_INJECTION
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern-inside: "class $CLASS {\n  ...\n  ScriptEngine $SE;\n  ...\n}\n"
      - pattern-inside: "class $CLASS {\n  ...\n  ScriptEngine $SE = ...;\n  ...\n\
          }\n"
      - pattern-inside: "$X $METHOD(...) {\n  ...\n  ScriptEngine $SE = ...;\n  ...\n\
          }\n"
    - pattern: "$X $METHOD(...) {\n  ...\n  $SE.eval(...);\n  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $SE.eval(\"...\");\n  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $SE.eval($S);\n\
        \  ...\n}\n"
    severity: WARNING
- rules:
  - id: permissive-cors
    languages:
    - java
    message: https://find-sec-bugs.github.io/bugs.htm#PERMISSIVE_CORS Permissive CORS
      policy will allow a malicious application to communicate with the victim application
      in an inappropriate way, leading to spoofing, data theft, relay and other attacks.
    metadata:
      asvs:
        control_id: 14.4.8 Permissive CORS
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x22-V14-Config.md#v144-http-security-headers-requirements
        section: 'V14: Configuration Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-183: Permissive List of Allowed Inputs'
      impact: LOW
      likelihood: LOW
      owasp:
      - A04:2021 - Insecure Design
      references:
      - https://owasp.org/Top10/A04_2021-Insecure_Design
      subcategory:
      - audit
      technology:
      - java
    pattern-either:
    - pattern: 'HttpServletResponse $RES = ...;

        ...

        $RES.addHeader("=~/access-control-allow-origin/i", "=~/^\*|null$/i");

        '
    - pattern: 'HttpServletResponse $RES = ...;

        ...

        $RES.setHeader("=~/access-control-allow-origin/i", "=~/^\*|null$/i");

        '
    - pattern: 'ServerHttpResponse $RES = ...;

        ...

        $RES.getHeaders().add("=~/access-control-allow-origin/i", "=~/^\*|null$/i");

        '
    - pattern: 'HttpHeaders $HEADERS = ...;

        ...

        $HEADERS.set("=~/access-control-allow-origin/i", "=~/^\*|null$/i");

        '
    - pattern: 'ServerWebExchange $SWE = ...;

        ...

        $SWE.getResponse().getHeaders().add("Access-Control-Allow-Origin", "*");

        '
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...) {\n  ...\n  $RES.addHeader(\"\
        =~/access-control-allow-origin/i\", \"=~/^\\*|null$/i\");\n  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...) {\n  ...\n  $RES.setHeader(\"\
        =~/access-control-allow-origin/i\", \"=~/^\\*|null$/i\");\n  ...\n}\n"
    - pattern: "$X $METHOD(...,ServerHttpResponse $RES,...) {\n  ...\n  $RES.getHeaders().add(\"\
        =~/access-control-allow-origin/i\", \"=~/^\\*|null$/i\");\n  ...\n}\n"
    - pattern: "$X $METHOD(...,ServerWebExchange $SWE,...) {\n  ...\n  $SWE.getResponse().getHeaders().add(\"\
        =~/access-control-allow-origin/i\", \"=~/^\\*|null$/i\");\n  ...\n}\n"
    - pattern: ResponseEntity.$RES().header("=~/access-control-allow-origin/i", "=~/^\*|null$/i")
    - pattern: ServerResponse.$RES().header("=~/access-control-allow-origin/i", "=~/^\*|null$/i")
    severity: WARNING
- rules:
  - id: command-injection-formatted-runtime-call
    languages:
    - java
    message: A formatted or concatenated string was detected as input to a java.lang.Runtime
      call. This is dangerous if a variable is controlled by user input and could
      result in a command injection. Ensure your variables are not controlled by users
      or sufficiently sanitized.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#COMMAND_INJECTION.
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - metavariable-pattern:
        metavariable: $RUNTIME
        patterns:
        - pattern-either:
          - pattern: (java.lang.Runtime $R)
          - pattern: java.lang.Runtime.getRuntime(...)
    - pattern-either:
      - pattern: $RUNTIME.exec($X + $Y);
      - pattern: $RUNTIME.exec(String.format(...));
      - pattern: $RUNTIME.loadLibrary($X + $Y);
      - pattern: $RUNTIME.loadLibrary(String.format(...));
      - patterns:
        - pattern-either:
          - pattern: '$RUNTIME.exec("=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", $ARG,...)

              '
          - pattern: '$RUNTIME.exec(Arrays.asList("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...),...)

              '
          - pattern: '$RUNTIME.exec(new String[]{"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...},...)

              '
          - patterns:
            - pattern-either:
              - pattern: '$RUNTIME.exec($CMD,"-c",$ARG,...)

                  '
              - pattern: '$RUNTIME.exec(Arrays.asList($CMD,"-c",$ARG,...),...)

                  '
              - pattern: '$RUNTIME.exec(new String[]{$CMD,"-c",$ARG,...},...)

                  '
            - pattern-inside: '$CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/";

                ...

                '
          - patterns:
            - pattern-either:
              - pattern: '$RUNTIME.exec($CMD, $EXECUTE, $ARG, ...)

                  '
            - pattern-inside: '$CMD = new String[]{"=~/(sh|bash|ksh|csh|tcsh|zsh)/",
                ...};

                ...

                '
          - patterns:
            - pattern-either:
              - pattern: '$RUNTIME.exec("=~/(sh|bash|ksh|csh|tcsh|zsh)/", $BASH, $ARG,...)

                  '
              - pattern: '$RUNTIME.exec(Arrays.asList("=~/(sh|bash|ksh|csh|tcsh|zsh)/",$BASH,$ARG,...),...)

                  '
              - pattern: '$RUNTIME.exec(new String[]{"=~/(sh|bash|ksh|csh|tcsh|zsh)/",$BASH,$ARG,...},...)

                  '
            - pattern-inside: '$BASH = new String[]{"=~/(-c)/", ...};

                ...

                '
        - pattern-not-inside: '$ARG = "...";

            ...

            '
        - pattern-not: '$RUNTIME.exec("...","...","...",...)

            '
        - pattern-not: '$RUNTIME.exec(new String[]{"...","...","...",...},...)

            '
        - pattern-not: '$RUNTIME.exec(Arrays.asList("...","...","...",...),...)

            '
    severity: ERROR
- rules:
  - fix-regex:
      regex: (.*?)\.getInstance\(.*?\)
      replacement: \1.getInstance("TLSv1.2")
    id: weak-ssl-context
    languages:
    - java
    message: An insecure SSL context was detected. TLS versions 1.0, 1.1, and all
      SSL versions are considered weak encryption and are deprecated. Use SSLContext.getInstance("TLSv1.2")
      for the best security.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-326: Inadequate Encryption Strength'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://tools.ietf.org/html/rfc7568
      - https://tools.ietf.org/id/draft-ietf-tls-oldversions-deprecate-02.html
      source_rule_url: https://find-sec-bugs.github.io/bugs.htm#SSL_CONTEXT
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-not: SSLContext.getInstance("TLSv1.3")
    - pattern-not: SSLContext.getInstance("TLSv1.2")
    - pattern: SSLContext.getInstance("...")
    severity: WARNING
- rules:
  - id: http-response-splitting
    languages:
    - java
    message: Older Java application servers are vulnerable to HTTP response splitting,
      which may occur if an HTTP request can be injected with CRLF characters. This
      finding is reported for completeness; it is recommended to ensure your environment
      is not affected by testing this yourself.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-113: Improper Neutralization of CRLF Sequences in HTTP Headers (''HTTP
        Request/Response Splitting'')'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2021 - Injection
      references:
      - https://www.owasp.org/index.php/HTTP_Response_Splitting
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#HTTP_RESPONSE_SPLITTING
      subcategory:
      - vuln
      technology:
      - java
    pattern-either:
    - pattern: '$VAR = $REQ.getParameter(...);

        ...

        $COOKIE = new Cookie(..., $VAR, ...);

        ...

        $RESP.addCookie($COOKIE, ...);

        '
    - patterns:
      - pattern-inside: "$RETTYPE $FUNC(...,@PathVariable $TYPE $VAR, ...) {\n  ...\n\
          }\n"
      - pattern: '$COOKIE = new Cookie(..., $VAR, ...);

          ...

          $RESP.addCookie($COOKIE, ...);

          '
    severity: INFO
- rules:
  - id: unvalidated-redirect
    languages:
    - java
    message: Application redirects to a destination URL specified by a user-supplied
      parameter that is not validated. This could direct users to malicious locations.
      Consider using an allowlist to validate URLs.
    metadata:
      asvs:
        control_id: 5.1.5 Open Redirect
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v51-input-validation-requirements
        section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
        version: '4'
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
      impact: LOW
      likelihood: MEDIUM
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://owasp.org/Top10/A01_2021-Broken_Access_Control
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#UNVALIDATED_REDIRECT
      subcategory:
      - vuln
      technology:
      - java
    pattern-either:
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...,String $URL,...) {\n \
        \ ...\n  $RES.sendRedirect($URL);\n  ...\n}\n"
    - pattern: "$X $METHOD(...,String $URL,...,HttpServletResponse $RES,...) {\n \
        \ ...\n  $RES.sendRedirect($URL);\n  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletRequest $REQ,...,HttpServletResponse $RES,...)\
        \ {\n  ...\n  String $URL = $REQ.getParameter(...);\n  ...\n  $RES.sendRedirect($URL);\n\
        \  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...,HttpServletRequest $REQ,...)\
        \ {\n  ...\n  String $URL = $REQ.getParameter(...);\n  ...\n  $RES.sendRedirect($URL);\n\
        \  ...\n}\n"
    - pattern: "$X $METHOD(...,String $URL,...) {\n  ...\n  HttpServletResponse $RES\
        \ = ...;\n  ...\n  $RES.sendRedirect($URL);\n  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletRequest $REQ,...,HttpServletResponse $RES,...)\
        \ {\n  ...\n  $RES.sendRedirect($REQ.getParameter(...));\n  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...,HttpServletRequest $REQ,...)\
        \ {\n  ...\n  $RES.sendRedirect($REQ.getParameter(...));\n  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...,String $URL,...) {\n \
        \ ...\n  $RES.addHeader(\"Location\",$URL);\n  ...\n}\n"
    - pattern: "$X $METHOD(...,String $URL,...,HttpServletResponse $RES,...) {\n \
        \ ...\n  $RES.addHeader(\"Location\",$URL);\n  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletRequest $REQ,...,HttpServletResponse $RES,...)\
        \ {\n  ...\n  String $URL = $REQ.getParameter(...);\n  ...\n  $RES.addHeader(\"\
        Location\",$URL);\n  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...,HttpServletRequest $REQ,...)\
        \ {\n  ...\n  String $URL = $REQ.getParameter(...);\n  ...\n  $RES.addHeader(\"\
        Location\",$URL);\n  ...\n}\n"
    - pattern: "$X $METHOD(...,String $URL,...) {\n  ...\n  HttpServletResponse $RES\
        \ = ...;\n  ...\n  $RES.addHeader(\"Location\",$URL);\n  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletRequest $REQ,...,HttpServletResponse $RES,...)\
        \ {\n  ...\n  $RES.addHeader(\"Location\",$REQ.getParameter(...));\n  ...\n\
        }\n"
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...,HttpServletRequest $REQ,...)\
        \ {\n  ...\n  $RES.addHeader(\"Location\",$REQ.getParameter(...));\n  ...\n\
        }"
    severity: WARNING
- rules:
  - id: jdbc-sql-formatted-string
    languages:
    - java
    message: 'Possible JDBC injection detected. Use the parameterized query feature
      available in queryForObject instead of concatenating or formatting strings:
      ''jdbc.queryForObject("select * from table where name = ?", Integer.class, parameterName);'''
    metadata:
      asvs:
        control_id: 5.3.5 Injection
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
        section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SQL_INJECTION_SPRING_JDBC
      subcategory:
      - audit
      technology:
      - jdbc
    patterns:
    - pattern-inside: '$JDBC = new JdbcTemplate(...);

        ...

        '
    - pattern-either:
      - pattern: $JDBC.queryForObject($STR + $VAR, ...);
      - pattern: $JDBC.queryForObject(String.format(...), ...);
      - pattern: 'String $Q = $STR + $VAR;

          ...

          $JDBC.queryForObject($Q, ...);

          '
      - pattern: 'String $Q = String.format(...);

          ...

          $JDBC.queryForObject($Q, ...);

          '
      - pattern: 'StringBuilder $Q = new StringBuilder(...);

          ...

          $Q.append($STR + $VAR);

          ...

          $JDBC.queryForObject($Q, ...);

          '
      - pattern: $JDBC.queryForList($STR + $VAR);
      - pattern: $JDBC.queryForList(String.format(...));
      - pattern: 'String $Q = $STR + $VAR;

          ...

          $JDBC.queryForList($Q);

          '
      - pattern: 'String $Q = String.format(...);

          ...

          $JDBC.queryForList($Q);

          '
      - pattern: 'StringBuilder $Q = new StringBuilder(...);

          ...

          $Q.append($STR + $VAR);

          ...

          $JDBC.queryForList($Q, ...);

          '
      - pattern: $JDBC.update($STR + $VAR);
      - pattern: $JDBC.update(String.format(...));
      - pattern: 'String $Q = $STR + $VAR;

          ...

          $JDBC.update($Q);

          '
      - pattern: 'String $Q = String.format(...);

          ...

          $JDBC.update($Q);

          '
      - pattern: 'StringBuilder $Q = new StringBuilder(...);

          ...

          $Q.append($STR + $VAR);

          ...

          $JDBC.update($Q, ...);

          '
      - pattern: $JDBC.execute($STR + $VAR);
      - pattern: $JDBC.execute(String.format(...));
      - pattern: 'String $Q = $STR + $VAR;

          ...

          $JDBC.execute($Q);

          '
      - pattern: 'String $Q = String.format(...);

          ...

          $JDBC.execute($Q);

          '
      - pattern: 'StringBuilder $Q = new StringBuilder(...);

          ...

          $Q.append($STR + $VAR);

          ...

          $JDBC.execute($Q, ...);

          '
      - pattern: $JDBC.insert($STR + $VAR);
      - pattern: $JDBC.insert(String.format(...));
      - pattern: 'String $Q = $STR + $VAR;

          ...

          $JDBC.insert($Q);

          '
      - pattern: 'String $Q = String.format(...);

          ...

          $JDBC.insert($Q);

          '
      - pattern: 'StringBuilder $Q = new StringBuilder(...);

          ...

          $Q.append($STR + $VAR);

          ...

          $JDBC.insert($Q, ...);

          '
    severity: WARNING
- rules:
  - id: tainted-cmd-from-http-request
    languages:
    - java
    message: Detected input from a HTTPServletRequest going into a 'ProcessBuilder'
      or 'exec' command. This could lead to command injection if variables passed
      into the exec commands are not properly sanitized. Instead, avoid using these
      OS commands with user-supplied input, or, if you must use these commands, use
      a whitelist of specific values.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - java
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: '(ProcessBuilder $PB) = ...;

            '
        - patterns:
          - pattern: '(Process $P) = ...;

              '
          - pattern-not: '(Process $P) = (java.lang.Runtime $R).exec(...);

              '
        - patterns:
          - pattern: (java.lang.Runtime $R).exec($CMD, ...);
          - focus-metavariable: $CMD
        - patterns:
          - pattern-either:
            - pattern-inside: "(java.util.List<$TYPE> $ARGLIST) = ...;  \n...\n(ProcessBuilder\
                \ $PB) = ...;\n...\n$PB.command($ARGLIST);\n"
            - pattern-inside: "(java.util.List<$TYPE> $ARGLIST) = ...;  \n...\n(ProcessBuilder\
                \ $PB) = ...;\n"
            - pattern-inside: "(java.util.List<$TYPE> $ARGLIST) = ...;  \n...\n(Process\
                \ $P) = ...;\n"
          - pattern: '$ARGLIST.add(...);

              '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: '(HttpServletRequest $REQ)

            '
        - patterns:
          - pattern-inside: "(javax.servlet.http.Cookie[] $COOKIES) = (HttpServletRequest\
              \ $REQ).getCookies(...);\n...\nfor (javax.servlet.http.Cookie $COOKIE:\
              \ $COOKIES) {\n  ...\n}\n"
          - pattern: '$COOKIE.getValue(...)

              '
    severity: ERROR
- rules:
  - id: ldap-entry-poisoning
    languages:
    - java
    message: An object-returning LDAP search will allow attackers to control the LDAP
      response. This could lead to Remote Code Execution.
    metadata:
      asvs:
        control_id: 5.3.7 Injection
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
        section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-90: Improper Neutralization of Special Elements used in an LDAP Query
        (''LDAP Injection'')'
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE-wp.pdf
      - https://cheatsheetseries.owasp.org/cheatsheets/LDAP_Injection_Prevention_Cheat_Sheet.html
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#LDAP_ENTRY_POISONING
      subcategory:
      - audit
      technology:
      - java
    pattern-either:
    - pattern: 'new SearchControls($S, $CL, $TL, $AT, true, $DEREF)

        '
    - pattern: 'SearchControls $VAR = new SearchControls();

        ...

        $VAR.setReturningObjFlag(true);

        '
    severity: WARNING
- rules:
  - id: cookie-missing-httponly
    languages:
    - java
    message: A cookie was detected without setting the 'HttpOnly' flag. The 'HttpOnly'
      flag for cookies instructs the browser to forbid client-side scripts from reading
      the cookie. Set the 'HttpOnly' flag by calling 'cookie.setHttpOnly(true);'
    metadata:
      asvs:
        control_id: 3.4.2 Missing Cookie Attribute
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v34-cookie-based-session-management
        section: 'V3: Session Management Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-1004: Sensitive Cookie Without ''HttpOnly'' Flag'
      impact: LOW
      likelihood: LOW
      owasp:
      - A05:2021 - Security Misconfiguration
      references:
      - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-not-inside: $COOKIE.setValue(""); ...
    - pattern-either:
      - pattern: $COOKIE.setHttpOnly(false);
      - patterns:
        - pattern-not-inside: $COOKIE.setHttpOnly(...); ...
        - pattern-not-inside: $COOKIE = ResponseCookie.from(...). ...; ...
        - pattern: $RESPONSE.addCookie($COOKIE);
    severity: WARNING
- rules:
  - id: tainted-ldapi-from-http-request
    languages:
    - java
    message: Detected input from a HTTPServletRequest going into an LDAP query. This
      could lead to LDAP injection if the input is not properly sanitized, which could
      result in attackers modifying objects in the LDAP tree structure. Ensure data
      passed to an LDAP query is not controllable or properly sanitize the data.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-90: Improper Neutralization of Special Elements used in an LDAP Query
        (''LDAP Injection'')'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://sensei.securecodewarrior.com/recipes/scw%3Ajava%3ALDAP-injection
      subcategory:
      - vuln
      technology:
      - java
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: '(javax.naming.directory.InitialDirContext $IDC).search(...)

            '
        - pattern: '(javax.naming.directory.DirContext $CTX).search(...)

            '
      - pattern-not: '(javax.naming.directory.InitialDirContext $IDC).search($Y, "...",
          ...)

          '
      - pattern-not: '(javax.naming.directory.DirContext $CTX).search($Y, "...", ...)

          '
    pattern-sources:
    - patterns:
      - pattern: (HttpServletRequest $REQ)
    severity: WARNING
- rules:
  - id: command-injection-process-builder
    languages:
    - java
    message: A formatted or concatenated string was detected as input to a ProcessBuilder
      call. This is dangerous if a variable is controlled by user input and could
      result in a command injection. Ensure your variables are not controlled by users
      or sufficiently sanitized.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command
        (''OS Command Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - java
    pattern-either:
    - patterns:
      - pattern: 'new ProcessBuilder($CMD,...)

          '
      - pattern-not-inside: '$CMD = "...";

          ...

          '
      - pattern-not-inside: '$CMD = Arrays.asList("...",...);

          ...

          '
      - pattern-not-inside: '$CMD = new String[]{"...",...};

          ...

          '
      - pattern-not: 'new ProcessBuilder("...",...)

          '
      - pattern-not: 'new ProcessBuilder(new String[]{"...",...},...)

          '
      - pattern-not: 'new ProcessBuilder(Arrays.asList("...",...),...)

          '
    - patterns:
      - pattern: '$PB.command($CMD,...)

          '
      - pattern-inside: '$TYPE $PB = new ProcessBuilder(...);

          ...

          '
      - pattern-not-inside: '$CMD = "...";

          ...

          '
      - pattern-not-inside: '$CMD = Arrays.asList("...",...);

          ...

          '
      - pattern-not-inside: '$CMD = new String[]{"...",...};

          ...

          '
      - pattern-not: '$PB.command("...",...)

          '
      - pattern-not: '$PB.command(new String[]{"...",...},...)

          '
      - pattern-not: '$PB.command(Arrays.asList("...",...),...)

          '
    - patterns:
      - pattern-either:
        - pattern: 'new ProcessBuilder("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...)

            '
        - pattern: 'new ProcessBuilder("cmd","/c",$ARG,...)

            '
        - pattern: 'new ProcessBuilder(Arrays.asList("cmd","/c",$ARG,...),...)

            '
        - pattern: 'new ProcessBuilder(new String[]{"cmd","/c",$ARG,...},...)

            '
        - patterns:
          - pattern-either:
            - pattern: 'new ProcessBuilder($CMD,"/c",$ARG,...)

                '
            - pattern: 'new ProcessBuilder(Arrays.asList($CMD,"/c",$ARG,...),...)

                '
            - pattern: 'new ProcessBuilder(new String[]{$CMD,"/c",$ARG,...},...)

                '
          - pattern-inside: '$CMD = "cmd";

              ...

              '
      - pattern-not-inside: '$ARG = "...";

          ...

          '
      - pattern-not: 'new ProcessBuilder("...","...","...",...)

          '
      - pattern-not: 'new ProcessBuilder(new String[]{"...","...","...",...},...)

          '
      - pattern-not: 'new ProcessBuilder(Arrays.asList("...","...","...",...),...)

          '
    - patterns:
      - pattern-either:
        - pattern: '$PB.command("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...)

            '
        - pattern: '$PB.command("cmd","/c",$ARG,...)

            '
        - pattern: '$PB.command(Arrays.asList("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...),...)

            '
        - pattern: '$PB.command(Arrays.asList("cmd","/c",$ARG,...),...)

            '
        - pattern: '$PB.command(new String[]{"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...},...)

            '
        - pattern: '$PB.command(new String[]{"cmd","/c",$ARG,...},...)

            '
        - patterns:
          - pattern-either:
            - pattern: '$PB.command($CMD,"-c",$ARG,...)

                '
            - pattern: '$PB.command(Arrays.asList($CMD,"-c",$ARG,...),...)

                '
            - pattern: '$PB.command(new String[]{$CMD,"-c",$ARG,...},...)

                '
          - pattern-inside: '$CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/";

              ...

              '
        - patterns:
          - pattern-either:
            - pattern: '$PB.command($CMD,"/c",$ARG,...)

                '
            - pattern: '$PB.command(Arrays.asList($CMD,"/c",$ARG,...),...)

                '
            - pattern: '$PB.command(new String[]{$CMD,"/c",$ARG,...},...)

                '
          - pattern-inside: '$CMD = "cmd";

              ...

              '
      - pattern-inside: '$TYPE $PB = new ProcessBuilder(...);

          ...

          '
      - pattern-not-inside: '$ARG = "...";

          ...

          '
      - pattern-not: '$PB.command("...","...","...",...)

          '
      - pattern-not: '$PB.command(new String[]{"...","...","...",...},...)

          '
      - pattern-not: '$PB.command(Arrays.asList("...","...","...",...),...)

          '
    severity: ERROR
- rules:
  - id: unsafe-reflection
    languages:
    - java
    message: If an attacker can supply values that the application then uses to determine
      which class to instantiate or which method to invoke, the potential exists for
      the attacker to create control flow paths through the application that were
      not intended by the application developers. This attack vector may allow the
      attacker to bypass authentication or access control checks or otherwise cause
      the application to behave in an unexpected manner.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-470: Use of Externally-Controlled Input to Select Classes or Code (''Unsafe
        Reflection'')'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://owasp.org/www-community/vulnerabilities/Unsafe_use_of_Reflection
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern: 'Class.forName($CLASS,...)

        '
    - pattern-not: 'Class.forName("...",...)

        '
    - pattern-not-inside: '$CLASS = "...";

        ...

        '
    severity: WARNING
- rules:
  - id: tainted-xpath-from-http-request
    languages:
    - java
    message: Detected input from a HTTPServletRequest going into a XPath evaluate
      or compile command. This could lead to xpath injection if variables passed into
      the evaluate or compile commands are not properly sanitized. Xpath injection
      could lead to unauthorized access to sensitive information in XML documents.
      Instead, thoroughly sanitize user input or use parameterized xpath queries if
      you can.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-643: Improper Neutralization of Data within XPath Expressions (''XPath
        Injection'')'
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - java
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: '(javax.xml.xpath.XPath $XP).evaluate(...)

            '
        - pattern: '(javax.xml.xpath.XPath $XP).compile(...).evaluate(...)

            '
    pattern-sources:
    - patterns:
      - pattern: '(HttpServletRequest $REQ).$FUNC(...)

          '
    severity: WARNING
- rules:
  - id: overly-permissive-file-permission
    languages:
    - java
    message: Detected file permissions that are overly permissive (read, write, and
      execute). It is generally a bad practices to set overly permissive file permission
      such as read+write+exec for all users. If the file affected is a configuration,
      a binary, a script or sensitive data, it can lead to privilege escalation or
      information leakage. Instead, follow the principle of least privilege and give
      users only the  permissions they need.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-276: Incorrect Default Permissions'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://owasp.org/Top10/A01_2021-Broken_Access_Control
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#OVERLY_PERMISSIVE_FILE_PERMISSION
      subcategory:
      - audit
      technology:
      - java
    pattern-either:
    - pattern: java.nio.file.Files.setPosixFilePermissions($FILE, java.nio.file.attribute.PosixFilePermissions.fromString("=~/(^......r..$)|(^.......w.$)|(^........x$)/"));
    - pattern: '$TYPE $P = java.nio.file.attribute.PosixFilePermissions.fromString("=~/(^......r..$)|(^.......w.$)|(^........x$)/");

        ...

        java.nio.file.Files.setPosixFilePermissions($FILE, $P);

        '
    - pattern: '$P.add(java.nio.file.attribute.PosixFilePermission.OTHERS_READ);

        ...

        java.nio.file.Files.setPosixFilePermissions($FILE, $P);

        '
    - pattern: '$P.add(java.nio.file.attribute.PosixFilePermission.OTHERS_WRITE);

        ...

        java.nio.file.Files.setPosixFilePermissions($FILE, $P);

        '
    - pattern: '$P.add(java.nio.file.attribute.PosixFilePermission.OTHERS_EXECUTE);

        ...

        java.nio.file.Files.setPosixFilePermissions($FILE, $P);'
    severity: WARNING
- rules:
  - id: bad-hexa-conversion
    languages:
    - java
    message: '''Integer.toHexString()'' strips leading zeroes from each byte if read
      byte-by-byte. This mistake weakens the hash value computed since it introduces
      more collisions. Use ''String.format("%02X", ...)'' instead.'
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-704: Incorrect Type Conversion or Cast'
      impact: LOW
      likelihood: LOW
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://cwe.mitre.org/data/definitions/704.html
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#BAD_HEXA_CONVERSION
      subcategory:
      - audit
      technology:
      - java
    pattern: "$X $METHOD(...) {\n  ...\n  MessageDigest $MD = ...;\n  ...\n  $MD.digest(...);\n\
      \  ...\n  Integer.toHexString(...);\n}"
    severity: WARNING
- rules:
  - id: anonymous-ldap-bind
    languages:
    - java
    message: Detected anonymous LDAP bind. This permits anonymous users to execute
      LDAP statements. Consider enforcing authentication for LDAP. See https://docs.oracle.com/javase/tutorial/jndi/ldap/auth_mechs.html
      for more information.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-287: Improper Authentication'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A02:2017 - Broken Authentication
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#LDAP_ANONYMOUS
      subcategory:
      - audit
      technology:
      - java
    pattern: '$ENV.put($CTX.SECURITY_AUTHENTICATION, "none");

      ...

      $DCTX = new InitialDirContext($ENV, ...);

      '
    severity: WARNING
- rules:
  - id: ognl-injection
    languages:
    - java
    message: A expression is built with a dynamic value. The source of the value(s)
      should be verified to avoid that unfiltered values fall into this risky code
      evaluation.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#OGNL_INJECTION
      subcategory:
      - audit
      technology:
      - ognl
    patterns:
    - pattern-either:
      - pattern: "$X $METHOD(...,OgnlReflectionProvider $P,...) {\n  ...\n  $P.getGetMethod($T,\
          \ $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlReflectionProvider $P,...) {\n  ...\n  $P.getSetMethod($T,\
          \ $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlReflectionProvider $P,...) {\n  ...\n  $P.getField($T,\
          \ $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlReflectionProvider $P,...) {\n  ...\n  $P.setProperties($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlReflectionProvider $P,...) {\n  ...\n  $P.setProperty($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlReflectionProvider $P,...) {\n  ...\n  $P.getValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlReflectionProvider $P,...) {\n  ...\n  $P.setValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,ReflectionProvider $P,...) {\n  ...\n  $P.getGetMethod($T,\
          \ $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...,ReflectionProvider $P,...) {\n  ...\n  $P.getSetMethod($T,\
          \ $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...,ReflectionProvider $P,...) {\n  ...\n  $P.getField($T,\
          \ $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...,ReflectionProvider $P,...) {\n  ...\n  $P.setProperties($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,ReflectionProvider $P,...) {\n  ...\n  $P.setProperty($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,ReflectionProvider $P,...) {\n  ...\n  $P.getValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,ReflectionProvider $P,...) {\n  ...\n  $P.setValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,TextParseUtil $P,...) {\n  ...\n  $P.translateVariables($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,TextParseUtil $P,...) {\n  ...\n  $P.translateVariablesCollection($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,TextParseUtil $P,...) {\n  ...\n  $P.shallBeIncluded($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,TextParseUtil $P,...) {\n  ...\n  $P.commaDelimitedStringToSet($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,TextParser $P,...) {\n  ...\n  $P.evaluate($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlTextParser $P,...) {\n  ...\n  $P.evaluate($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlUtil $P,...) {\n  ...\n  $P.setProperties($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlUtil $P,...) {\n  ...\n  $P.setProperty($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlUtil $P,...) {\n  ...\n  $P.getValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlUtil $P,...) {\n  ...\n  $P.setValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlUtil $P,...) {\n  ...\n  $P.callMethod($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlUtil $P,...) {\n  ...\n  $P.compile($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,VelocityStrutsUtil $P,...) {\n  ...\n  $P.evaluate($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,StrutsUtil $P,...) {\n  ...\n  $P.isTrue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,StrutsUtil $P,...) {\n  ...\n  $P.findString($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,StrutsUtil $P,...) {\n  ...\n  $P.findValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,StrutsUtil $P,...) {\n  ...\n  $P.getText($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,StrutsUtil $P,...) {\n  ...\n  $P.translateVariables($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,StrutsUtil $P,...) {\n  ...\n  $P.makeSelectList($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,OgnlTool $P,...) {\n  ...\n  $P.findValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,ValueStack $P,...) {\n  ...\n  $P.findString($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,ValueStack $P,...) {\n  ...\n  $P.findValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,ValueStack $P,...) {\n  ...\n  $P.setValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...,ValueStack $P,...) {\n  ...\n  $P.setParameter($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlReflectionProvider $P = ...;\n \
          \ ...\n  $P.getGetMethod($T, $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlReflectionProvider $P = ...;\n \
          \ ...\n  $P.getSetMethod($T, $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlReflectionProvider $P = ...;\n \
          \ ...\n  $P.getField($T, $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlReflectionProvider $P = ...;\n \
          \ ...\n  $P.setProperties($INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlReflectionProvider $P = ...;\n \
          \ ...\n  $P.setProperty($INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlReflectionProvider $P = ...;\n \
          \ ...\n  $P.getValue($INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlReflectionProvider $P = ...;\n \
          \ ...\n  $P.setValue($INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ReflectionProvider $P = ...;\n  ...\n\
          \  $P.getGetMethod($T, $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ReflectionProvider $P = ...;\n  ...\n\
          \  $P.getSetMethod($T, $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ReflectionProvider $P = ...;\n  ...\n\
          \  $P.getField($T, $INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ReflectionProvider $P = ...;\n  ...\n\
          \  $P.setProperties($INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ReflectionProvider $P = ...;\n  ...\n\
          \  $P.setProperty($INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ReflectionProvider $P = ...;\n  ...\n\
          \  $P.getValue($INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ReflectionProvider $P = ...;\n  ...\n\
          \  $P.setValue($INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  TextParseUtil $P = ...;\n  ...\n  $P.translateVariables($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  TextParseUtil $P = ...;\n  ...\n  $P.translateVariablesCollection($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  TextParseUtil $P = ...;\n  ...\n  $P.shallBeIncluded($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  TextParseUtil $P = ...;\n  ...\n  $P.commaDelimitedStringToSet($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  TextParser $P = ...;\n  ...\n  $P.evaluate($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlTextParser $P = ...;\n  ...\n  $P.evaluate($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlUtil $P = ...;\n  ...\n  $P.setProperties($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlUtil $P = ...;\n  ...\n  $P.setProperty($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlUtil $P = ...;\n  ...\n  $P.getValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlUtil $P = ...;\n  ...\n  $P.setValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlUtil $P = ...;\n  ...\n  $P.callMethod($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlUtil $P = ...;\n  ...\n  $P.compile($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  VelocityStrutsUtil $P = ...;\n  ...\n\
          \  $P.evaluate($INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  StrutsUtil $P = ...;\n  ...\n  $P.isTrue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  StrutsUtil $P = ...;\n  ...\n  $P.findString($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  StrutsUtil $P = ...;\n  ...\n  $P.findValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  StrutsUtil $P = ...;\n  ...\n  $P.getText($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  StrutsUtil $P = ...;\n  ...\n  $P.translateVariables($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  StrutsUtil $P = ...;\n  ...\n  $P.makeSelectList($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  OgnlTool $P = ...;\n  ...\n  $P.findValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ValueStack $P = ...;\n  ...\n  $P.findString($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ValueStack $P = ...;\n  ...\n  $P.findValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ValueStack $P = ...;\n  ...\n  $P.setValue($INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ValueStack $P = ...;\n  ...\n  $P.setParameter($INPUT,...);\n\
          \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.getGetMethod($T,\"...\",...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.getSetMethod($T,\"...\",...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.getField($T,\"...\",...);\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.setProperties(\"...\",...);\n \
        \ ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.setProperty(\"...\",...);\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.getValue(\"...\",...);\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.setValue(\"...\",...);\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.translateVariables(\"...\",...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.translateVariablesCollection(\"\
        ...\",...);\n  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.shallBeIncluded(\"...\",...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.commaDelimitedStringToSet(\"...\"\
        ,...);\n  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.evaluate(\"...\",...);\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.callMethod(\"...\",...);\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.compile(\"...\",...);\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.isTrue(\"...\",...);\n  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.findString(\"...\",...);\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.findValue(\"...\",...);\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.getText(\"...\",...);\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.makeSelectList(\"...\",...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $P.setParameter(\"...\",...);\n  ...\n\
        }\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.getGetMethod($T,$S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.getSetMethod($T,$S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.getField($T,$S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.setProperties($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.setProperty($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.getValue($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.setValue($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.translateVariables($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.translateVariablesCollection($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.shallBeIncluded($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.commaDelimitedStringToSet($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.evaluate($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.callMethod($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.compile($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.isTrue($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.findString($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.findValue($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.getText($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.makeSelectList($S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $P.setParameter($S,...);\n\
        \  ...\n}\n"
    severity: WARNING
- rules:
  - id: tainted-env-from-http-request
    languages:
    - java
    message: Detected input from a HTTPServletRequest going into the environment variables
      of an 'exec' command.  Instead, call the command with user-supplied arguments
      by using the overloaded method with one String array as the argument. `exec({"command",
      "arg1", "arg2"})`.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-454: External Initialization of Trusted Variables or Data Stores'
      cwe2021-top25: false
      cwe2022-top25: false
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - java
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern: (java.lang.Runtime $R).exec($CMD, $ENV_ARGS, ...);
      - focus-metavariable: $ENV_ARGS
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: '(HttpServletRequest $REQ)

            '
        - patterns:
          - pattern-inside: "(javax.servlet.http.Cookie[] $COOKIES) = (HttpServletRequest\
              \ $REQ).getCookies(...);\n...\nfor (javax.servlet.http.Cookie $COOKIE:\
              \ $COOKIES) {\n  ...\n}\n"
          - pattern: '$COOKIE.getValue(...)

              '
    severity: ERROR
- rules:
  - id: el-injection
    languages:
    - java
    message: An expression is built with a dynamic value. The source of the value(s)
      should be verified to avoid that unfiltered values fall into this risky code
      evaluation.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#EL_INJECTION
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern: "class $CLASS {\n  ...\n  ExpressionFactory $EF;\n  ...\n  $X $METHOD(...)\
          \ {\n    ...\n    $EF.createValueExpression($CTX,$INPUT,...);\n    ...\n\
          \  }\n  ...\n}\n"
      - pattern: "class $CLASS {\n  ...\n  ExpressionFactory $EF = ...;\n  ...\n \
          \ $X $METHOD(...) {\n    ...\n    $EF.createValueExpression($CTX,$INPUT,...);\n\
          \    ...\n  }\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ExpressionFactory $EF = ...;\n  ...\n\
          \  $EF.createValueExpression($CTX,$INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...,ExpressionFactory $EF,...) {\n  ...\n  $EF.createValueExpression($CTX,$INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "class $CLASS {\n  ...\n  ExpressionFactory $EF;\n  ...\n  $X $METHOD(...)\
          \ {\n    ...\n    $EF.createMethodExpression($CTX,$INPUT,...);\n    ...\n\
          \  }\n  ...\n}\n"
      - pattern: "class $CLASS {\n  ...\n  ExpressionFactory $EF = ...;\n  ...\n \
          \ $X $METHOD(...) {\n    ...\n    $EF.createMethodExpression($CTX,$INPUT,...);\n\
          \    ...\n  }\n  ...\n}\n"
      - pattern: "$X $METHOD(...) {\n  ...\n  ExpressionFactory $EF = ...;\n  ...\n\
          \  $EF.createMethodExpression($CTX,$INPUT,...);\n  ...\n}\n"
      - pattern: "$X $METHOD(...,ExpressionFactory $EF,...) {\n  ...\n  $EF.createMethodExpression($CTX,$INPUT,...);\n\
          \  ...\n}\n"
      - pattern: "$X $METHOD(String $INPUT, ...) {\n  ...\n  $OBJECT.buildConstraintViolationWithTemplate($INPUT,\
          \ ...);\n  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $EF.createValueExpression($CTX,\"\
        ...\",...);\n  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $EF.createValueExpression($CTX,$S,...);\n\
        \  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  $EF.createMethodExpression($CTX,\"\
        ...\",...);\n  ...\n}\n"
    - pattern-not: "$X $METHOD(...) {\n  ...\n  String $S = \"...\";\n  ...\n  $EF.createMethodExpression($CTX,$S,...);\n\
        \  ...\n}\n"
    severity: WARNING
- rules:
  - id: url-rewriting
    languages:
    - java
    message: URL rewriting has significant security risks. Since session ID appears
      in the URL, it may be easily seen by third parties.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
      cwe2021-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://owasp.org/Top10/A01_2021-Broken_Access_Control
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#URL_REWRITING
      subcategory:
      - vuln
      technology:
      - java
    pattern-either:
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...) {\n  ...\n  $RES.encodeURL(...);\n\
        \  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...) {\n  ...\n  $RES.encodeUrl(...);\n\
        \  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...) {\n  ...\n  $RES.encodeRedirectURL(...);\n\
        \  ...\n}\n"
    - pattern: "$X $METHOD(...,HttpServletResponse $RES,...) {\n  ...\n  $RES.encodeRedirectUrl(...);\n\
        \  ...\n}\n"
    - pattern: "$X $METHOD(...) {\n  ...\n  HttpServletResponse $RES = ...;\n  ...\n\
        \  $RES.encodeURL(...);\n  ...\n}\n"
    - pattern: "$X $METHOD(...) {\n  ...\n  HttpServletResponse $RES = ...;\n  ...\n\
        \  $RES.encodeUrl(...);\n  ...\n}\n"
    - pattern: "$X $METHOD(...) {\n  ...\n  HttpServletResponse $RES = ...;\n  ...\n\
        \  $RES.encodeRedirectURL(...);\n  ...\n}\n"
    - pattern: "$X $METHOD(...) {\n  ...\n  HttpServletResponse $RES = ...;\n  ...\n\
        \  $RES.encodeRedirectUrl(...);\n  ...\n}"
    severity: WARNING
- rules:
  - id: md5-used-as-password
    languages:
    - java
    message: It looks like MD5 is used as a password hash. MD5 is not considered a
      secure password hash because it can be cracked by an attacker in a short amount
      of time. Use a suitable password hashing function such as PBKDF2 or bcrypt.
      You can use `javax.crypto.SecretKeyFactory` with `SecretKeyFactory.getInstance("PBKDF2WithHmacSHA1")`
      or, if using Spring, `org.springframework.security.crypto.bcrypt`.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://tools.ietf.org/id/draft-lvelvindron-tls-md5-sha1-deprecate-01.html
      - https://github.com/returntocorp/semgrep-rules/issues/1609
      - https://docs.oracle.com/javase/7/docs/technotes/guides/security/StandardNames.html#SecretKeyFactory
      - https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/crypto/bcrypt/BCryptPasswordEncoder.html
      subcategory:
      - vuln
      technology:
      - java
      - md5
    mode: taint
    pattern-sinks:
    - patterns:
      - pattern: $MODEL.$METHOD(...);
      - metavariable-regex:
          metavariable: $METHOD
          regex: (?i)(.*password.*)
    pattern-sources:
    - patterns:
      - pattern-inside: '$TYPE $MD = MessageDigest.getInstance("MD5");

          ...

          '
      - pattern: $MD.digest(...);
    severity: WARNING
- rules:
  - id: tainted-session-from-http-request
    languages:
    - java
    message: Detected input from a HTTPServletRequest going into a session command,
      like `setAttribute`. User input into such a command could lead to an attacker
      inputting malicious code into your session parameters, blurring the line between
      what's trusted and untrusted, and therefore leading to a trust boundary violation.
      This could lead to programmers trusting unvalidated data. Instead, thoroughly
      sanitize user input before passing it into such function calls.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-501: Trust Boundary Violation'
      impact: MEDIUM
      interfile: true
      likelihood: MEDIUM
      owasp:
      - A04:2021 - Insecure Design
      references:
      - https://owasp.org/Top10/A04_2021-Insecure_Design
      subcategory:
      - vuln
      technology:
      - java
    mode: taint
    options:
      interfile: true
    pattern-sinks:
    - patterns:
      - pattern: (HttpServletRequest $REQ).getSession().$FUNC($NAME, $VALUE);
      - metavariable-regex:
          metavariable: $FUNC
          regex: ^(putValue|setAttribute)$
      - focus-metavariable: $VALUE
    pattern-sources:
    - patterns:
      - pattern-either:
        - patterns:
          - pattern: '(HttpServletRequest $REQ).$FUNC(...)

              '
          - pattern-not: '(HttpServletRequest $REQ).getSession()

              '
        - patterns:
          - pattern-inside: "(javax.servlet.http.Cookie[] $COOKIES) = (HttpServletRequest\
              \ $REQ).getCookies(...);\n...\nfor (javax.servlet.http.Cookie $COOKIE:\
              \ $COOKIES) {\n  ...\n}\n"
          - pattern: '$COOKIE.getValue(...)

              '
        - patterns:
          - pattern-inside: '$TYPE[] $VALS = (HttpServletRequest $REQ).$GETFUNC(...
              );

              ...

              '
          - pattern: '$PARAM = $VALS[$INDEX];

              '
        - patterns:
          - pattern-inside: '$HEADERS = (HttpServletRequest $REQ).getHeaders(...);

              ...

              $PARAM = $HEADERS.$FUNC(...);

              ...

              '
          - pattern: 'java.net.URLDecoder.decode($PARAM, ...)

              '
    severity: WARNING
- rules:
  - id: formatted-sql-string
    languages:
    - java
    message: Detected a formatted string in a SQL statement. This could lead to SQL
      injection if variables in the SQL statement are not properly sanitized. Use
      a prepared statements (java.sql.PreparedStatement) instead. You can obtain a
      PreparedStatement using 'connection.prepareStatement'.
    metadata:
      asvs:
        control_id: 5.3.5 Injection
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
        section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
        version: '4'
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
      - https://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html#create_ps
      - https://software-security.sans.org/developer-how-to/fix-sql-injection-in-java-using-prepared-callable-statement
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SQL_INJECTION
      subcategory:
      - vuln
      technology:
      - java
    mode: taint
    options:
      taint_assume_safe_booleans: true
      taint_assume_safe_numbers: true
    pattern-propagators:
    - from: $X
      pattern: (StringBuffer $S).append($X)
      to: $S
    - from: $X
      pattern: (StringBuilder $S).append($X)
      to: $S
    pattern-sanitizers:
    - patterns:
      - pattern: (CriteriaBuilder $CB).$ANY(...)
    pattern-sinks:
    - patterns:
      - pattern-not: $S.$SQLFUNC(<... "=~/.*TABLE *$/" ...>)
      - pattern-not: $S.$SQLFUNC(<... "=~/.*TABLE %s$/" ...>)
      - pattern-either:
        - pattern: (Statement $S).$SQLFUNC(...)
        - pattern: (PreparedStatement $P).$SQLFUNC(...)
        - pattern: (Connection $C).createStatement(...).$SQLFUNC(...)
        - pattern: (Connection $C).prepareStatement(...).$SQLFUNC(...)
        - pattern: (EntityManager $EM).$SQLFUNC(...)
      - metavariable-regex:
          metavariable: $SQLFUNC
          regex: execute|executeQuery|createQuery|query|addBatch|nativeSQL|create|prepare
      requires: CONCAT
    pattern-sources:
    - label: INPUT
      patterns:
      - pattern-either:
        - pattern: '(HttpServletRequest $REQ)

            '
        - patterns:
          - pattern-inside: "$ANNOT $FUNC (..., $INPUT, ...) {\n  ...\n}\n"
          - pattern: (String $INPUT)
      - focus-metavariable: $INPUT
    - label: CONCAT
      patterns:
      - pattern-either:
        - pattern: $X + $INPUT
        - pattern: $X += $INPUT
        - pattern: $STRB.append($INPUT)
        - pattern: String.format(..., $INPUT, ...)
        - pattern: String.join(..., $INPUT, ...)
        - pattern: (String $STR).concat($INPUT)
        - pattern: $INPUT.concat(...)
        - pattern: new $STRB(..., $INPUT, ...)
      requires: INPUT
    severity: ERROR
- rules:
  - fix: $DBFACTORY.setFeature("http://xml.org/sax/features/external-general-entities",
      false);
    id: documentbuilderfactory-external-general-entities-true
    languages:
    - java
    message: External entities are allowed for $DBFACTORY. This is vulnerable to XML
      external entity attacks. Disable this by setting the feature "http://xml.org/sax/features/external-general-entities"
      to false.
    metadata:
      asvs:
        control_id: 5.5.2 Insecue XML Deserialization
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://semgrep.dev/blog/2022/xml-security-in-java
      - https://semgrep.dev/docs/cheat-sheets/java-xxe/
      - https://blog.sonarsource.com/secure-xml-processor
      subcategory:
      - vuln
      technology:
      - java
      - xml
    pattern: $DBFACTORY.setFeature("http://xml.org/sax/features/external-general-entities",
      true);
    severity: ERROR
- rules:
  - fix: '$FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl",
      true);

      $FACTORY.newDocumentBuilder();

      '
    id: documentbuilderfactory-disallow-doctype-decl-missing
    languages:
    - java
    message: DOCTYPE declarations are enabled for this DocumentBuilderFactory. This
      is vulnerable to XML external entity attacks. Disable this by setting the feature
      "http://apache.org/xml/features/disallow-doctype-decl" to true. Alternatively,
      allow DOCTYPE declarations and only prohibit external entities declarations.
      This can be done by setting the features "http://xml.org/sax/features/external-general-entities"
      and "http://xml.org/sax/features/external-parameter-entities" to false.
    metadata:
      asvs:
        control_id: 5.5.2 Insecue XML Deserialization
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://semgrep.dev/blog/2022/xml-security-in-java
      - https://semgrep.dev/docs/cheat-sheets/java-xxe/
      - https://blog.sonarsource.com/secure-xml-processor
      - https://xerces.apache.org/xerces2-j/features.html
      subcategory:
      - vuln
      technology:
      - java
      - xml
    mode: taint
    pattern-sanitizers:
    - by-side-effect: true
      pattern-either:
      - patterns:
        - pattern-either:
          - pattern: '$FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl",
              true);

              '
          - pattern: '$FACTORY.setFeature("http://xml.org/sax/features/external-general-entities",
              false);

              ...

              $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities",
              false);

              '
          - pattern: '$FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities",
              false);

              ...

              $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities",
              false);

              '
        - focus-metavariable: $FACTORY
      - patterns:
        - pattern-either:
          - pattern-inside: "class $C {\n  ...\n  $T $M(...) {\n    ...\n    $FACTORY.setFeature(\"\
              http://apache.org/xml/features/disallow-doctype-decl\",\n    true);\n\
              \    ...\n  }\n  ...\n}\n"
          - pattern-inside: "class $C {\n  ...\n  $T $M(...) {\n    ...\n    $FACTORY.setFeature(\"\
              http://xml.org/sax/features/external-general-entities\", false);\n \
              \   ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-parameter-entities\"\
              , false);\n    ...\n  }\n  ...\n}\n"
          - pattern-inside: "class $C {\n  ...\n  $T $M(...) {\n    ...\n    $FACTORY.setFeature(\"\
              http://xml.org/sax/features/external-parameter-entities\", false);\n\
              \    ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-general-entities\"\
              ,false);\n    ...\n  }\n  ...\n}\n"
        - pattern: $M($X)
        - focus-metavariable: $X
    pattern-sinks:
    - patterns:
      - pattern: $FACTORY.newDocumentBuilder();
    pattern-sources:
    - by-side-effect: true
      patterns:
      - pattern-either:
        - pattern: '$FACTORY = DocumentBuilderFactory.newInstance();

            '
        - patterns:
          - pattern: $FACTORY
          - pattern-inside: "class $C {\n  ...\n  $V $FACTORY = DocumentBuilderFactory.newInstance();\n\
              \  ...\n}\n"
          - pattern-not-inside: "class $C {\n  ...\n  $V $FACTORY = DocumentBuilderFactory.newInstance();\n\
              \  static {\n    ...\n    $FACTORY.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\"\
              , true);\n    ...\n  }\n  ...\n}\n"
          - pattern-not-inside: "class $C {\n  ...\n  $V $FACTORY = DocumentBuilderFactory.newInstance();\n\
              \  static {\n    ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-parameter-entities\"\
              , false);\n    ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-general-entities\"\
              , false);\n    ...\n  }\n  ...\n}\n"
          - pattern-not-inside: "class $C {\n  ...\n  $V $FACTORY = DocumentBuilderFactory.newInstance();\n\
              \  static {\n    ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-general-entities\"\
              , false);\n    ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-parameter-entities\"\
              , false);\n    ...\n  }\n  ...\n}\n"
    severity: ERROR
- rules:
  - fix: '$FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, ""); $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET,
      "");

      $FACTORY.newTransformer(...);

      '
    id: transformerfactory-dtds-not-disabled
    languages:
    - java
    message: DOCTYPE declarations are enabled for this TransformerFactory. This is
      vulnerable to XML external entity attacks. Disable this by setting the attributes
      "accessExternalDTD" and "accessExternalStylesheet" to "".
    metadata:
      asvs:
        control_id: 5.5.2 Insecue XML Deserialization
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://semgrep.dev/blog/2022/xml-security-in-java
      - https://semgrep.dev/docs/cheat-sheets/java-xxe/
      - https://blog.sonarsource.com/secure-xml-processor
      - https://xerces.apache.org/xerces2-j/features.html
      subcategory:
      - vuln
      technology:
      - java
      - xml
    mode: taint
    pattern-sanitizers:
    - by-side-effect: true
      pattern-either:
      - patterns:
        - pattern-either:
          - pattern: '$FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET,
              ""); ...

              $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");

              '
          - pattern: '$FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");

              ...

              $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");

              '
          - pattern: '$FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");
              ...

              $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");

              '
          - pattern: '$FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");

              ...

              $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");

              '
        - focus-metavariable: $FACTORY
      - patterns:
        - pattern-either:
          - pattern-inside: "class $C {\n  ...\n  $T $M(...) {\n    ...\n    $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET,\
              \ \"\");\n    ...\n    $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD,\
              \ \"\");\n    ...\n  }\n  ...\n}\n"
          - pattern-inside: "class $C {\n  ...\n  $T $M(...) {\n    ...\n    $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD,\
              \ \"\");\n    ...\n    $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET,\
              \ \"\");\n    ...\n  }\n  ...\n}\n"
          - pattern-inside: "class $C {\n  ...\n  $T $M(...) {\n    ...\n    $FACTORY.setAttribute(\"\
              =~/.*accessExternalStylesheet.*/\", \"\");\n    ...\n    $FACTORY.setAttribute(\"\
              =~/.*accessExternalDTD.*/\", \"\");\n    ...\n  }\n  ...\n}\n"
          - pattern-inside: "class $C {\n  ...\n  $T $M(...) {\n    ...\n    $FACTORY.setAttribute(\"\
              =~/.*accessExternalDTD.*/\", \"\");\n    ...\n    $FACTORY.setAttribute(\"\
              =~/.*accessExternalStylesheet.*/\", \"\");\n    ...\n  }\n  ...\n}\n"
        - pattern: $M($X)
        - focus-metavariable: $X
    pattern-sinks:
    - patterns:
      - pattern: $FACTORY.newTransformer(...);
    pattern-sources:
    - by-side-effect: true
      patterns:
      - pattern-either:
        - pattern: '$FACTORY = TransformerFactory.newInstance();

            '
        - patterns:
          - pattern: $FACTORY
          - pattern-inside: "class $C {\n  ...\n  $V $FACTORY = TransformerFactory.newInstance();\n\
              \  ...\n}\n"
          - pattern-not-inside: "class $C {\n  ...\n  $V $FACTORY = TransformerFactory.newInstance();\n\
              \  static {\n    ...\n    $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD,\
              \ \"\");\n    ...\n    $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET,\
              \ \"\");\n    ...\n  }\n  ...\n}\n"
          - pattern-not-inside: "class $C {\n  ...\n  $V $FACTORY = TransformerFactory.newInstance();\n\
              \  static {\n    ...\n    $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET,\
              \ \"\");\n    ...\n    $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD,\
              \ \"\");\n    ...\n  }\n  ...\n}\n"
          - pattern-not-inside: "class $C {\n  ...\n  $V $FACTORY = TransformerFactory.newInstance();\n\
              \  static {\n    ...\n    $FACTORY.setAttribute(\"=~/.*accessExternalDTD.*/\"\
              , \"\");\n    ...\n    $FACTORY.setAttribute(\"=~/.*accessExternalStylesheet.*/\"\
              , \"\");\n    ...\n  }\n  ...\n}\n"
          - pattern-not-inside: "class $C {\n  ...\n  $V $FACTORY = TransformerFactory.newInstance();\n\
              \  static {\n    ...\n    $FACTORY.setAttribute(\"=~/.*accessExternalStylesheet.*/\"\
              , \"\");\n    ...\n    $FACTORY.setAttribute(\"=~/.*accessExternalDTD.*/\"\
              , \"\");\n    ...\n  }\n  ...\n}\n"
    severity: ERROR
- rules:
  - fix: '$FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl",
      true);

      $FACTORY.newSAXParser();

      '
    id: saxparserfactory-disallow-doctype-decl-missing
    languages:
    - java
    message: DOCTYPE declarations are enabled for this SAXParserFactory. This is vulnerable
      to XML external entity attacks. Disable this by setting the feature `http://apache.org/xml/features/disallow-doctype-decl`
      to true. Alternatively, allow DOCTYPE declarations and only prohibit external
      entities declarations. This can be done by setting the features `http://xml.org/sax/features/external-general-entities`
      and `http://xml.org/sax/features/external-parameter-entities` to false. NOTE
      - The previous links are not meant to be clicked. They are the literal config
      key values that are supposed to be used to disable these features. For more
      information, see https://semgrep.dev/docs/cheat-sheets/java-xxe/#3a-documentbuilderfactory.
    metadata:
      asvs:
        control_id: 5.5.2 Insecue XML Deserialization
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://semgrep.dev/blog/2022/xml-security-in-java
      - https://semgrep.dev/docs/cheat-sheets/java-xxe/
      - https://blog.sonarsource.com/secure-xml-processor
      - https://xerces.apache.org/xerces2-j/features.html
      subcategory:
      - vuln
      technology:
      - java
      - xml
    mode: taint
    pattern-sanitizers:
    - by-side-effect: true
      pattern-either:
      - patterns:
        - pattern-either:
          - pattern: '$FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl",
              true);

              '
          - pattern: '$FACTORY.setFeature("http://xml.org/sax/features/external-general-entities",
              false);

              ...

              $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities",
              false);

              '
          - pattern: '$FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities",
              false);

              ...

              $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities",
              false);

              '
        - focus-metavariable: $FACTORY
      - patterns:
        - pattern-either:
          - pattern-inside: "class $C {\n  ...\n  $T $M(...) {\n    ...\n    $FACTORY.setFeature(\"\
              http://apache.org/xml/features/disallow-doctype-decl\",\n    true);\n\
              \    ...\n  }\n  ...\n}\n"
          - pattern-inside: "class $C {\n  ...\n  $T $M(...) {\n    ...\n    $FACTORY.setFeature(\"\
              http://xml.org/sax/features/external-general-entities\", false);\n \
              \   ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-parameter-entities\"\
              , false);\n    ...\n  }\n  ...\n}\n"
          - pattern-inside: "class $C {\n  ...\n  $T $M(...) {\n    ...\n    $FACTORY.setFeature(\"\
              http://xml.org/sax/features/external-parameter-entities\", false);\n\
              \    ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-general-entities\"\
              ,false);\n    ...\n  }\n  ...\n}\n"
        - pattern: $M($X)
        - focus-metavariable: $X
    pattern-sinks:
    - patterns:
      - pattern: $FACTORY.newSAXParser();
    pattern-sources:
    - by-side-effect: true
      patterns:
      - pattern-either:
        - pattern: '$FACTORY = SAXParserFactory.newInstance();

            '
        - patterns:
          - pattern: $FACTORY
          - pattern-inside: "class $C {\n  ...\n  $V $FACTORY = SAXParserFactory.newInstance();\n\
              \  ...\n}\n"
          - pattern-not-inside: "class $C {\n  ...\n  $V $FACTORY = SAXParserFactory.newInstance();\n\
              \  static {\n    ...\n    $FACTORY.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\"\
              , true);\n    ...\n  }\n  ...\n}\n"
          - pattern-not-inside: "class $C {\n  ...\n  $V $FACTORY = SAXParserFactory.newInstance();\n\
              \  static {\n    ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-parameter-entities\"\
              , false);\n    ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-general-entities\"\
              , false);\n    ...\n  }\n  ...\n}\n"
          - pattern-not-inside: "class $C {\n  ...\n  $V $FACTORY = SAXParserFactory.newInstance();\n\
              \  static {\n    ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-general-entities\"\
              , false);\n    ...\n    $FACTORY.setFeature(\"http://xml.org/sax/features/external-parameter-entities\"\
              , false);\n    ...\n  }\n  ...\n}\n"
    severity: ERROR
- rules:
  - fix: $DBFACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities",
      false);
    id: documentbuilderfactory-external-parameter-entities-true
    languages:
    - java
    message: External entities are allowed for $DBFACTORY. This is vulnerable to XML
      external entity attacks. Disable this by setting the feature "http://xml.org/sax/features/external-parameter-entities"
      to false.
    metadata:
      asvs:
        control_id: 5.5.2 Insecue XML Deserialization
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://semgrep.dev/blog/2022/xml-security-in-java
      - https://semgrep.dev/docs/cheat-sheets/java-xxe/
      - https://blog.sonarsource.com/secure-xml-processor
      subcategory:
      - vuln
      technology:
      - java
      - xml
    pattern: $DBFACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities",
      true);
    severity: ERROR
- rules:
  - id: documentbuilderfactory-disallow-doctype-decl-false
    languages:
    - java
    message: DOCTYPE declarations are enabled for $DBFACTORY. Without prohibiting
      external entity declarations, this is vulnerable to XML external entity attacks.
      Disable this by setting the feature "http://apache.org/xml/features/disallow-doctype-decl"
      to true. Alternatively, allow DOCTYPE declarations and only prohibit external
      entities declarations. This can be done by setting the features "http://xml.org/sax/features/external-general-entities"
      and "http://xml.org/sax/features/external-parameter-entities" to false.
    metadata:
      asvs:
        control_id: 5.5.2 Insecue XML Deserialization
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
        section: V5 Validation, Sanitization and Encoding
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-611: Improper Restriction of XML External Entity Reference'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A04:2017 - XML External Entities (XXE)
      - A05:2021 - Security Misconfiguration
      references:
      - https://semgrep.dev/blog/2022/xml-security-in-java
      - https://semgrep.dev/docs/cheat-sheets/java-xxe/
      - https://blog.sonarsource.com/secure-xml-processor
      - https://xerces.apache.org/xerces2-j/features.html
      subcategory:
      - vuln
      technology:
      - java
      - xml
    patterns:
    - pattern: $DBFACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl",
        false);
    - pattern-not-inside: "$RETURNTYPE $METHOD(...){\n  ...\n  $DBF.setFeature(\"\
        http://xml.org/sax/features/external-general-entities\", false);\n  ...\n\
        \  $DBF.setFeature(\"http://xml.org/sax/features/external-parameter-entities\"\
        , false);\n  ...\n}\n"
    - pattern-not-inside: "$RETURNTYPE $METHOD(...){\n  ...\n  $DBF.setFeature(\"\
        http://xml.org/sax/features/external-parameter-entities\", false);\n  ...\n\
        \  $DBF.setFeature(\"http://xml.org/sax/features/external-general-entities\"\
        , false);\n  ...\n}\n"
    - pattern-not-inside: "$RETURNTYPE $METHOD(...){\n  ...\n  $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD,\
        \ \"\");\n  ...\n  $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA,\
        \ \"\");\n  ...\n}\n"
    - pattern-not-inside: "$RETURNTYPE $METHOD(...){\n  ...\n  $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA,\
        \ \"\");\n  ...\n  $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\"\
        );\n  ...\n}\n"
    severity: ERROR
- rules:
  - id: desede-is-deprecated
    languages:
    - java
    - kt
    message: Triple DES (3DES or DESede) is considered deprecated. AES is the recommended
      cipher. Upgrade to use AES.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-326: Inadequate Encryption Strength'
      functional-categories:
      - crypto::search::symmetric-algorithm::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://csrc.nist.gov/News/2017/Update-to-Current-Use-and-Deprecation-of-TDEA
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#TDES_USAGE
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern: '$CIPHER.getInstance("=~/DESede.*/")

          '
      - pattern: '$CRYPTO.KeyGenerator.getInstance("DES")

          '
    severity: WARNING
- rules:
  - id: use-of-aes-ecb
    languages:
    - java
    message: 'Use of AES with ECB mode detected. ECB doesn''t provide message confidentiality
      and  is not semantically secure so should not be used. Instead, use a strong,
      secure cipher: Cipher.getInstance("AES/CBC/PKCS7PADDING"). See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions
      for more information.'
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      functional-categories:
      - crypto::search::mode::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      - https://googleprojectzero.blogspot.com/2022/10/rc4-is-still-considered-harmful.html
      subcategory:
      - vuln
      technology:
      - java
    pattern: $CIPHER.getInstance("=~/AES/ECB.*/")
    severity: WARNING
- rules:
  - id: use-of-default-aes
    languages:
    - java
    message: 'Use of AES with no settings detected. By default, java.crypto.Cipher
      uses ECB mode. ECB doesn''t  provide message confidentiality and is not semantically
      secure so should not be used. Instead, use a strong, secure cipher: java.crypto.Cipher.getInstance("AES/CBC/PKCS7PADDING").
      See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions
      for more information.'
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      functional-categories:
      - crypto::search::mode::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      - https://googleprojectzero.blogspot.com/2022/10/rc4-is-still-considered-harmful.html
      subcategory:
      - vuln
      technology:
      - java
    pattern-either:
    - patterns:
      - pattern-either:
        - pattern-inside: 'import javax;

            ...

            '
      - pattern-either:
        - pattern: javax.crypto.Cipher.getInstance("AES")
        - pattern: (javax.crypto.Cipher $CIPHER).getInstance("AES")
    - patterns:
      - pattern-either:
        - pattern-inside: 'import javax.*;

            ...

            '
        - pattern-inside: 'import javax.crypto;

            ...

            '
      - pattern-either:
        - pattern: crypto.Cipher.getInstance("AES")
        - pattern: (crypto.Cipher $CIPHER).getInstance("AES")
    - patterns:
      - pattern-either:
        - pattern-inside: 'import javax.crypto.*;

            ...

            '
        - pattern-inside: 'import javax.crypto.Cipher;

            ...

            '
      - pattern-either:
        - pattern: Cipher.getInstance("AES")
        - pattern: (Cipher $CIPHER).getInstance("AES")
    severity: WARNING
- rules:
  - id: weak-random
    languages:
    - java
    message: Detected use of the functions `Math.random()` or `java.util.Random()`.
      These are both not cryptographically strong random number generators (RNGs).
      If you are using these RNGs to create passwords or secret tokens, use `java.security.SecureRandom`
      instead.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-330: Use of Insufficiently Random Values'
      functional-categories:
      - crypto::search::randomness::java.security
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      subcategory:
      - audit
      technology:
      - java
    pattern-either:
    - pattern: 'new java.util.Random(...).$FUNC(...)

        '
    - pattern: 'java.lang.Math.random(...)

        '
    severity: WARNING
- rules:
  - id: use-of-blowfish
    languages:
    - java
    message: 'Use of Blowfish was detected. Blowfish uses a 64-bit block size that  makes
      it vulnerable to birthday attacks, and is therefore considered non-compliant.  Instead,
      use a strong, secure cipher: Cipher.getInstance("AES/CBC/PKCS7PADDING"). See
      https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions for
      more information.'
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      functional-categories:
      - crypto::search::symmetric-algorithm::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      - https://googleprojectzero.blogspot.com/2022/10/rc4-is-still-considered-harmful.html
      subcategory:
      - vuln
      technology:
      - java
    pattern: $CIPHER.getInstance("Blowfish")
    severity: WARNING
- rules:
  - id: gcm-detection
    languages:
    - java
    message: GCM detected, please check that IV/nonce is not reused, an Initialization
      Vector (IV) is a nonce used to randomize the encryption, so that even if multiple
      messages with identical plaintext are encrypted, the generated corresponding
      ciphertexts are different. Unlike the Key, the IV usually does not need to be
      secret, rather it is important that it is random and unique. Certain encryption
      schemes the IV is exchanged in public as part of the ciphertext. Reusing same
      Initialization Vector with the same Key to encrypt multiple plaintext blocks
      allows an attacker to compare the ciphertexts and then, with some assumptions
      on the content of the messages, to gain important information about the data
      being encrypted.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-323: Reusing a Nonce, Key Pair in Encryption'
      functional-categories:
      - crypto::search::randomness::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A02:2021 - Cryptographic Failures
      references:
      - https://cwe.mitre.org/data/definitions/323.html
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern: $METHOD.getInstance("AES/GCM/NoPadding",...);
      - pattern: new GCMParameterSpec(...);
    severity: INFO
- rules:
  - id: unencrypted-socket
    languages:
    - java
    message: Detected use of a Java socket that is not encrypted. As a result, the
      traffic could be read by an attacker intercepting the network traffic. Use an
      SSLSocket created by 'SSLSocketFactory' or 'SSLServerSocketFactory' instead.
    metadata:
      asvs:
        control_id: 6.2.5 Insecure Algorithm
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
        section: V6 Stored Cryptography Verification Requirements
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-319: Cleartext Transmission of Sensitive Information'
      functional-categories:
      - net::search::crypto-config::java.net
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#UNENCRYPTED_SOCKET
      subcategory:
      - vuln
      technology:
      - java
    pattern-either:
    - pattern: new ServerSocket(...)
    - pattern: new Socket(...)
    severity: WARNING
- rules:
  - fix: '"AES/GCM/NoPadding"

      '
    id: des-is-deprecated
    languages:
    - java
    - kt
    message: DES is considered deprecated. AES is the recommended cipher. Upgrade
      to use AES. See https://www.nist.gov/news-events/news/2005/06/nist-withdraws-outdated-data-encryption-standard
      for more information.
    metadata:
      asvs:
        control_id: 6.2.5 Insecure Algorithm
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
        section: V6 Stored Cryptography Verification Requirements
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-326: Inadequate Encryption Strength'
      functional-categories:
      - crypto::search::symmetric-algorithm::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://www.nist.gov/news-events/news/2005/06/nist-withdraws-outdated-data-encryption-standard
      - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#algorithms
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#DES_USAGE
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern-inside: $CIPHER.getInstance("=~/DES/.*/")
      - pattern-inside: $CIPHER.getInstance("DES")
    - pattern-either:
      - pattern: '"=~/DES/.*/"

          '
      - pattern: '"DES"

          '
    severity: WARNING
- rules:
  - fix: '"SHA-512"

      '
    id: use-of-md5
    languages:
    - java
    message: Detected MD5 hash algorithm which is considered insecure. MD5 is not
      collision resistant and is therefore not suitable as a cryptographic signature.
      Use HMAC instead.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-328: Use of Weak Hash'
      functional-categories:
      - crypto::search::hash-algorithm::java.security
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_MESSAGE_DIGEST_MD5
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern: 'java.security.MessageDigest.getInstance($ALGO, ...);

        '
    - metavariable-regex:
        metavariable: $ALGO
        regex: (.MD5.)
    - focus-metavariable: $ALGO
    severity: WARNING
- rules:
  - id: use-of-weak-rsa-key
    languages:
    - java
    message: RSA keys should be at least 2048 bits based on NIST recommendation.
    metadata:
      asvs:
        control_id: 6.2.5 Insecure Algorithm
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
        section: V6 Stored Cryptography Verification Requirements
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-326: Inadequate Encryption Strength'
      functional-categories:
      - crypto::search::key-length::java.security
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#algorithms
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#RSA_KEY_SIZE
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern: 'KeyPairGenerator $KEY = $G.getInstance("RSA");

        ...

        $KEY.initialize($BITS);

        '
    - metavariable-comparison:
        comparison: $BITS < 2048
        metavariable: $BITS
    severity: WARNING
- rules:
  - id: use-of-sha1
    languages:
    - java
    message: Detected SHA1 hash algorithm which is considered insecure. SHA1 is not
      collision resistant and is therefore not suitable as a cryptographic signature.
      Instead, use PBKDF2 for password hashing or SHA256 or SHA512 for other hash
      function applications.
    metadata:
      asvs:
        control_id: 6.2.5 Insecure Algorithm
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
        section: V6 Stored Cryptography Verification Requirements
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-328: Use of Weak Hash'
      functional-categories:
      - crypto::search::hash-algorithm::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_MESSAGE_DIGEST_SHA1
      subcategory:
      - vuln
      technology:
      - java
    pattern-either:
    - patterns:
      - pattern: 'java.security.MessageDigest.getInstance("$ALGO", ...);

          '
      - metavariable-regex:
          metavariable: $ALGO
          regex: (SHA1|SHA-1)
    - pattern: '$DU.getSha1Digest().digest(...)

        '
    severity: WARNING
- rules:
  - id: no-null-cipher
    languages:
    - java
    message: 'NullCipher was detected. This will not encrypt anything; the cipher
      text will be the same as the plain text. Use a valid, secure cipher: Cipher.getInstance("AES/CBC/PKCS7PADDING").
      See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions
      for more information.'
    metadata:
      asvs:
        control_id: 6.2.5 Insecure Algorithm
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
        section: V6 Stored Cryptography Verification Requirements
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#NULL_CIPHER
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern: new NullCipher(...);
      - pattern: new javax.crypto.NullCipher(...);
    severity: WARNING
- rules:
  - id: use-of-rc4
    languages:
    - java
    message: 'Use of RC4 was detected. RC4 is vulnerable to several attacks, including
      stream cipher attacks and bit flipping attacks. Instead, use a strong, secure
      cipher: Cipher.getInstance("AES/CBC/PKCS7PADDING"). See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions
      for more information.'
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      functional-categories:
      - crypto::search::symmetric-algorithm::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      - https://googleprojectzero.blogspot.com/2022/10/rc4-is-still-considered-harmful.html
      subcategory:
      - vuln
      technology:
      - java
    pattern: $CIPHER.getInstance("RC4")
    severity: WARNING
- rules:
  - fix: 'getSha512Digest

      '
    id: use-of-md5-digest-utils
    languages:
    - java
    message: Detected MD5 hash algorithm which is considered insecure. MD5 is not
      collision resistant and is therefore not suitable as a cryptographic signature.
      Use HMAC instead.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-328: Use of Weak Hash'
      functional-categories:
      - crypto::search::hash-algorithm::org.apache.commons
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_MESSAGE_DIGEST_MD5
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern: '$DU.$GET_ALGO().digest(...)

        '
    - metavariable-pattern:
        metavariable: $GET_ALGO
        pattern: getMd5Digest
    - metavariable-pattern:
        metavariable: $DU
        pattern: DigestUtils
    - focus-metavariable: $GET_ALGO
    severity: WARNING
- rules:
  - id: rsa-no-padding
    languages:
    - java
    - kt
    message: Using RSA without OAEP mode weakens the encryption.
    metadata:
      asvs:
        control_id: 6.2.5 Insecure Algorithm
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
        section: V6 Stored Cryptography Verification Requirements
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-326: Inadequate Encryption Strength'
      functional-categories:
      - crypto::search::mode::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://rdist.root.org/2009/10/06/why-rsa-encryption-padding-is-critical/
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#RSA_NO_PADDING
      subcategory:
      - vuln
      technology:
      - java
      - kotlin
    pattern: $CIPHER.getInstance("=~/RSA/[Nn][Oo][Nn][Ee]/NoPadding/")
    severity: WARNING
- rules:
  - id: use-of-rc2
    languages:
    - java
    message: 'Use of RC2 was detected. RC2 is vulnerable to related-key attacks, and
      is therefore considered non-compliant. Instead, use a strong, secure cipher:
      Cipher.getInstance("AES/CBC/PKCS7PADDING"). See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions
      for more information.'
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      functional-categories:
      - crypto::search::symmetric-algorithm::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      - https://googleprojectzero.blogspot.com/2022/10/rc4-is-still-considered-harmful.html
      subcategory:
      - vuln
      technology:
      - java
    pattern: $CIPHER.getInstance("RC2")
    severity: WARNING
- rules:
  - id: no-static-initialization-vector
    languages:
    - java
    message: Initialization Vectors (IVs) for block ciphers should be randomly generated
      each time they are used. Using a static IV means the same plaintext encrypts
      to the same ciphertext every time, weakening the strength of the encryption.
    metadata:
      asvs:
        control_id: 6.2.5 Insecure Algorithm
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
        section: V6 Stored Cryptography Verification Requirements
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-329: Generation of Predictable IV with CBC Mode'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A02:2021 - Cryptographic Failures
      references:
      - https://cwe.mitre.org/data/definitions/329.html
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#STATIC_IV
      subcategory:
      - vuln
      technology:
      - java
    pattern-either:
    - pattern: "byte[] $IV = {\n    ...\n};\n...\nnew IvParameterSpec($IV, ...);\n"
    - pattern: "class $CLASS {\n    byte[] $IV = {\n        ...\n    };\n    ...\n\
        \    $METHOD(...) {\n        ...\n        new IvParameterSpec($IV, ...);\n\
        \        ...\n    }\n}\n"
    severity: WARNING
- rules:
  - id: gcm-nonce-reuse
    languages:
    - java
    message: 'GCM IV/nonce is reused: encryption can be totally useless'
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-323: Reusing a Nonce, Key Pair in Encryption'
      functional-categories:
      - crypto::search::randomness::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://www.youtube.com/watch?v=r1awgAl90wM
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern: new GCMParameterSpec(..., "...".getBytes(...), ...);
      - pattern: byte[] $NONCE = "...".getBytes(...); ... new GCMParameterSpec(...,
          $NONCE, ...);
    severity: ERROR
- rules:
  - id: ecb-cipher
    languages:
    - java
    message: Cipher in ECB mode is detected. ECB mode produces the same output for
      the same input each time which allows an attacker to intercept and replay the
      data. Further, ECB mode does not provide any integrity checking. See https://find-sec-bugs.github.io/bugs.htm#CIPHER_INTEGRITY.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      functional-categories:
      - crypto::search::mode::javax.crypto
      impact: MEDIUM
      likelihood: MEDIUM
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#ECB_MODE
      subcategory:
      - vuln
      technology:
      - java
    patterns:
    - pattern: 'Cipher $VAR = $CIPHER.getInstance($MODE);

        '
    - metavariable-regex:
        metavariable: $MODE
        regex: .*ECB.*
    severity: WARNING
- rules:
  - id: use-of-sha224
    languages:
    - java
    message: This code uses a 224-bit hash function, which is deprecated or disallowed
      in some security policies. Consider updating to a stronger hash function such
      as SHA-384 or higher to ensure compliance and security.
    metadata:
      asvs:
        control_id: 6.2.5 Insecure Algorithm
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
        section: V6 Stored Cryptography Verification Requirements
        version: '4'
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-328: Use of Weak Hash'
      functional-categories:
      - crypto::search::hash-algorithm::javax.crypto
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar3.ipd.pdf
      - https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/ism/cyber-security-guidelines/guidelines-cryptography
      subcategory:
      - vuln
      technology:
      - java
    pattern-either:
    - pattern: org.apache.commons.codec.digest.DigestUtils.getSha3_224Digest()
    - pattern: org.apache.commons.codec.digest.DigestUtils.getSha512_224Digest()
    - pattern: org.apache.commons.codec.digest.DigestUtils.sha3_224(...)
    - pattern: org.apache.commons.codec.digest.DigestUtils.sha3_224Hex(...)
    - pattern: org.apache.commons.codec.digest.DigestUtils.sha512_224(...)
    - pattern: org.apache.commons.codec.digest.DigestUtils.sha512_224Hex(...)
    - pattern: new org.apache.commons.codec.digest.DigestUtils(org.apache.commons.codec.digest.MessageDigestAlgorithms.SHA_224)
    - pattern: new org.apache.commons.codec.digest.DigestUtils(org.apache.commons.codec.digest.MessageDigestAlgorithms.SHA_512_224)
    - pattern: new org.apache.commons.codec.digest.DigestUtils(org.apache.commons.codec.digest.MessageDigestAlgorithms.SHA3_224)
    - patterns:
      - pattern: java.security.MessageDigest.getInstance("$ALGO", ...);
      - metavariable-regex:
          metavariable: $ALGO
          regex: .*224
    severity: WARNING
- rules:
  - id: insecure-hostname-verifier
    languages:
    - java
    message: Insecure HostnameVerifier implementation detected. This will accept any
      SSL certificate with any hostname, which creates the possibility for man-in-the-middle
      attacks.
    metadata:
      asvs:
        control_id: 9.2.1 Weak TLS
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x17-V9-Communications.md#v92-server-communications-security-requirements
        section: V9 Communications Verification Requirements
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-295: Improper Certificate Validation'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_HOSTNAME_VERIFIER
      subcategory:
      - audit
      technology:
      - java
    pattern-either:
    - pattern: "class $CLASS implements HostnameVerifier {\n  ...\n  public boolean\
        \ verify(...) { return true; }\n}\n"
    - pattern: "new HostnameVerifier(...){\n  public boolean verify(...) {\n    return\
        \ true;\n  }\n}"
    - pattern: import org.apache.http.conn.ssl.NoopHostnameVerifier;
    severity: WARNING
- rules:
  - fix-regex:
      regex: DefaultHttpClient
      replacement: HttpClientBuilder
    id: defaulthttpclient-is-deprecated
    languages:
    - java
    message: DefaultHttpClient is deprecated. Further, it does not support connections
      using TLS1.2, which makes using DefaultHttpClient a security hazard. Use HttpClientBuilder
      instead.
    metadata:
      asvs:
        control_id: 9.1.3 Weak TLS
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x17-V9-Communications.md#v91-client-communications-security-requirements
        section: V9 Communications Verification Requirements
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-326: Inadequate Encryption Strength'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#DEFAULT_HTTP_CLIENT
      subcategory:
      - audit
      technology:
      - java
    pattern: new DefaultHttpClient(...);
    severity: WARNING
- rules:
  - id: insecure-trust-manager
    languages:
    - java
    message: Detected empty trust manager implementations. This is dangerous because
      it accepts any certificate, enabling man-in-the-middle attacks. Consider using
      a KeyStore and TrustManagerFactory instead. See https://stackoverflow.com/questions/2642777/trusting-all-certificates-using-httpclient-over-https
      for more information.
    metadata:
      asvs:
        control_id: 9.2.1 Weak TLS
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x17-V9-Communications.md#v92-server-communications-security-requirements
        section: V9 Communications Verification Requirements
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-295: Improper Certificate Validation'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A07:2021 - Identification and Authentication Failures
      references:
      - https://stackoverflow.com/questions/2642777/trusting-all-certificates-using-httpclient-over-https
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_TRUST_MANAGER
      subcategory:
      - audit
      technology:
      - java
    patterns:
    - pattern-either:
      - pattern-inside: "class $CLASS implements X509TrustManager {\n  ...\n}\n"
      - pattern-inside: "new X509TrustManager() {\n  ...\n}\n"
      - pattern-inside: "class $CLASS implements X509ExtendedTrustManager {\n  ...\n\
          }\n"
      - pattern-inside: "new X509ExtendedTrustManager() {\n  ...\n}\n"
    - pattern-not: public void checkClientTrusted(...) { $SOMETHING; }
    - pattern-not: public void checkServerTrusted(...) { $SOMETHING; }
    - pattern-either:
      - pattern: public void checkClientTrusted(...) {}
      - pattern: public void checkServerTrusted(...) {}
      - pattern: public X509Certificate[] getAcceptedIssuers(...) { return null; }
    severity: WARNING
- rules:
  - id: avoid-implementing-custom-digests
    languages:
    - java
    message: 'Cryptographic algorithms are notoriously difficult to get right. By
      implementing a custom message digest, you risk introducing security issues into
      your program. Use one of the many sound message digests already available to
      you: MessageDigest sha256Digest = MessageDigest.getInstance("SHA256");'
    metadata:
      asvs:
        control_id: 6.2.2 Insecure Custom Algorithm
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
        section: V6 Stored Cryptography Verification Requirements
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#custom-algorithms
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#CUSTOM_MESSAGE_DIGEST
      subcategory:
      - audit
      technology:
      - java
    pattern: "class $CLASS extends MessageDigest {\n  ...\n}"
    severity: WARNING
- rules:
  - id: vertx-sqli
    languages:
    - java
    message: Detected a formatted string in a SQL statement. This could lead to SQL
      injection if variables in the SQL statement are not properly sanitized. Use
      a prepared statements (java.sql.PreparedStatement) instead. You can obtain a
      PreparedStatement using 'connection.prepareStatement'.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - vertx
    patterns:
    - pattern-either:
      - patterns:
        - pattern-either:
          - pattern-inside: 'String $SQL = $X + $Y;

              ...

              '
          - pattern-inside: 'String $SQL = String.format(...);

              ...

              '
          - pattern-inside: "$TYPE $FUNC(...,String $SQL,...) {\n  ...\n}\n"
        - pattern-not-inside: 'String $SQL = "..." + "...";

            ...

            '
        - pattern: $SC.$METHOD($SQL,...)
      - pattern: '$SC.$METHOD(String.format(...),...);

          '
      - pattern: '$SC.$METHOD($X + $Y,...);

          '
    - pattern-either:
      - pattern-inside: 'SqlClient $SC = ...;

          ...

          '
      - pattern-inside: 'SqlConnection $SC = ...;

          ...

          '
      - pattern-inside: "$TYPE $FUNC(...,SqlClient $SC,...) {\n  ...\n}\n"
      - pattern-inside: "$TYPE $FUNC(...,SqlConnection $SC,...) {\n  ...\n}\n"
    - pattern-not: '$SC.$METHOD("..." + "...",...);

        '
    - metavariable-regex:
        metavariable: $METHOD
        regex: ^(query|preparedQuery|prepare)$
    severity: WARNING
- rules:
  - id: hibernate-sqli
    languages:
    - java
    message: Detected a formatted string in a SQL statement. This could lead to SQL
      injection if variables in the SQL statement are not properly sanitized. Use
      a prepared statements (java.sql.PreparedStatement) instead. You can obtain a
      PreparedStatement using 'connection.prepareStatement'.
    metadata:
      asvs:
        control_id: 5.3.5 Insecure Custom Algorithm
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
        section: V5 Stored Cryptography Verification Requirements
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SQL_INJECTION_HIBERNATE
      subcategory:
      - audit
      technology:
      - hibernate
    pattern-either:
    - patterns:
      - pattern-either:
        - pattern-inside: 'String $SQL = $X + $Y;

            ...

            '
        - pattern-inside: 'String $SQL = String.format(...);

            ...

            '
        - pattern-inside: '$VAL $FUNC(...,String $SQL,...) {

            ...

            }

            '
      - pattern-not-inside: 'String $SQL = "..." + "...";

          ...

          '
      - pattern: org.hibernate.criterion.Restrictions.sqlRestriction($SQL,...)
    - pattern: org.hibernate.criterion.Restrictions.sqlRestriction(String.format(...),...)
    - patterns:
      - pattern: org.hibernate.criterion.Restrictions.sqlRestriction($X + $Y,...)
      - pattern-not: org.hibernate.criterion.Restrictions.sqlRestriction("..." + "...",...)
    - patterns:
      - pattern-either:
        - patterns:
          - pattern-either:
            - pattern-inside: 'String $SQL = $X + $Y;

                ...

                '
            - pattern-inside: 'String $SQL = String.format(...);

                ...

                '
            - pattern-inside: "$TYPE $FUNC(...,String $SQL,...) {\n  ...\n}\n"
          - pattern-not-inside: 'String $SQL = "..." + "...";

              ...

              '
          - pattern: $SESSION.$METHOD($SQL,...)
        - pattern: '$SESSION.$METHOD(String.format(...),...);

            '
        - pattern: '$SESSION.$METHOD($X + $Y,...);

            '
      - pattern-either:
        - pattern-inside: 'org.hibernate.Session $SESSION = ...;

            ...

            '
        - pattern-inside: "$TYPE $FUNC(...,org.hibernate.Session $SESSION,...) {\n\
            \  ...\n}\n"
      - pattern-not: '$SESSION.$METHOD("..." + "...",...);

          '
      - metavariable-regex:
          metavariable: $METHOD
          regex: ^(createQuery|createSQLQuery)$
    severity: WARNING
- rules:
  - id: tainted-sql-from-http-request
    languages:
    - java
    message: Detected input from a HTTPServletRequest going into a SQL sink or statement.
      This could lead to SQL injection if variables in the SQL statement are not properly
      sanitized. Use parameterized SQL queries or properly sanitize user input instead.
    metadata:
      category: security
      confidence: HIGH
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: HIGH
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
      - https://owasp.org/www-community/attacks/SQL_Injection
      subcategory:
      - vuln
      technology:
      - sql
      - java
      - servlets
      - spring
    mode: taint
    options:
      taint_assume_safe_booleans: true
      taint_assume_safe_numbers: true
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: "(java.sql.CallableStatement $STMT) = ...; \n"
        - pattern: '(java.sql.Statement $STMT) = ...;

            ...

            $OUTPUT = $STMT.$FUNC(...);

            '
        - pattern: '(java.sql.PreparedStatement $STMT) = ...;

            '
        - pattern: '$VAR = $CONN.prepareStatement(...)

            '
        - pattern: '$PATH.queryForObject(...);

            '
        - pattern: '(java.util.Map<String, Object> $STMT) = $PATH.queryForMap(...);

            '
        - pattern: '(org.springframework.jdbc.support.rowset.SqlRowSet $STMT) = ...;

            '
        - pattern: '(org.springframework.jdbc.core.JdbcTemplate $TEMPL).batchUpdate(...)

            '
        - patterns:
          - pattern-inside: '(String $SQL) = "$SQLSTR" + ...;

              ...

              '
          - pattern: $PATH.$SQLCMD(..., $SQL, ...);
          - metavariable-regex:
              metavariable: $SQLSTR
              regex: (?i)(^SELECT.* | ^INSERT.* | ^UPDATE.*)
          - metavariable-regex:
              metavariable: $SQLCMD
              regex: (execute|query|executeUpdate|batchUpdate)
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: '(HttpServletRequest $REQ).$REQFUNC(...)

            '
        - pattern: "(ServletRequest $REQ).$REQFUNC(...) \n"
      - metavariable-regex:
          metavariable: $REQFUNC
          regex: (getInputStream|getParameter|getParameterMap|getParameterValues|getReader|getCookies|getHeader|getHeaderNames|getHeaders|getPart|getParts|getQueryString)
    severity: WARNING
- rules:
  - id: turbine-sqli
    languages:
    - java
    message: Detected a formatted string in a SQL statement. This could lead to SQL
      injection if variables in the SQL statement are not properly sanitized. Use
      a prepared statements (java.sql.PreparedStatement) instead. You can obtain a
      PreparedStatement using 'connection.prepareStatement'.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - turbine
    pattern-either:
    - patterns:
      - pattern-either:
        - patterns:
          - pattern-either:
            - pattern-inside: 'String $SQL = $X + $Y;

                ...

                '
            - pattern-inside: 'String $SQL = String.format(...);

                ...

                '
            - pattern-inside: "$VAL $FUNC(...,String $SQL,...) {\n  ...\n}\n"
          - pattern-not-inside: 'String $SQL = "..." + "...";

              ...

              '
          - pattern: $PEER.executeQuery($SQL,...)
        - pattern: '$PEER.executeQuery(String.format(...),...)

            '
        - pattern: '$PEER.executeQuery($X + $Y,...)

            '
      - pattern-not: '$PEER.executeQuery("..." + "...",...)

          '
      - metavariable-regex:
          metavariable: $PEER
          regex: (BasePeer|GroupPeer)
    - patterns:
      - pattern-either:
        - patterns:
          - pattern-either:
            - pattern-inside: 'String $SQL = $X + $Y;

                ...

                '
            - pattern-inside: 'String $SQL = String.format(...);

                ...

                '
            - pattern-inside: "$VAL $FUNC(...,String $SQL,...) {\n  ...\n}\n"
          - pattern-not-inside: 'String $SQL = "..." + "...";

              ...

              '
          - pattern: $P.executeQuery($SQL,...)
        - pattern: '$P.executeQuery(String.format(...),...)

            '
        - pattern: '$P.executeQuery($X + $Y,...)

            '
      - pattern-either:
        - pattern-inside: 'BasePeer $P = ...;

            ...

            '
        - pattern-inside: 'GroupPeer $P = ...;

            ...

            '
        - pattern-inside: "$VAL $FUNC(...,GroupPeer $P,...) {\n  ...\n}\n"
        - pattern-inside: "$VAL $FUNC(...,BasePeer $P,...) {\n  ...\n}\n"
      - pattern-not: '$P.executeQuery("..." + "...",...)

          '
    severity: WARNING
- rules:
  - id: jdbc-sqli
    languages:
    - java
    message: Detected a formatted string in a SQL statement. This could lead to SQL
      injection if variables in the SQL statement are not properly sanitized. Use
      a prepared statements (java.sql.PreparedStatement) instead. You can obtain a
      PreparedStatement using 'connection.prepareStatement'.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - jdbc
    patterns:
    - pattern-either:
      - patterns:
        - pattern-either:
          - pattern-inside: 'String $SQL = $X + $Y;

              ...

              '
          - pattern-inside: 'String $SQL = String.format(...);

              ...

              '
          - pattern-inside: "$VAL $FUNC(...,String $SQL,...) {\n  ...\n}\n"
        - pattern-not-inside: 'String $SQL = "..." + "...";

            ...

            '
        - pattern: $S.$METHOD($SQL,...)
      - pattern: '$S.$METHOD(String.format(...),...);

          '
      - pattern: '$S.$METHOD($X + $Y,...);

          '
    - pattern-either:
      - pattern-inside: 'java.sql.Statement $S = ...;

          ...

          '
      - pattern-inside: "$TYPE $FUNC(...,java.sql.Statement $S,...) {\n  ...\n}\n"
    - pattern-not: '$S.$METHOD("..." + "...",...);

        '
    - metavariable-regex:
        metavariable: $METHOD
        regex: ^(executeQuery|execute|executeUpdate|executeLargeUpdate|addBatch|nativeSQL)$
    severity: WARNING
- rules:
  - id: jpa-sqli
    languages:
    - java
    message: Detected a formatted string in a SQL statement. This could lead to SQL
      injection if variables in the SQL statement are not properly sanitized. Use
      a prepared statements (java.sql.PreparedStatement) instead. You can obtain a
      PreparedStatement using 'connection.prepareStatement'.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - jpa
    patterns:
    - pattern-either:
      - patterns:
        - pattern-either:
          - pattern-inside: 'String $SQL = $X + $Y;

              ...

              '
          - pattern-inside: 'String $SQL = String.format(...);

              ...

              '
          - pattern-inside: "$TYPE $FUNC(...,String $SQL,...) {\n  ...\n}\n"
        - pattern-not-inside: 'String $SQL = "..." + "...";

            ...

            '
        - pattern: $EM.$METHOD($SQL,...)
      - pattern: '$EM.$METHOD(String.format(...),...);

          '
      - pattern: '$EM.$METHOD($X + $Y,...);

          '
    - pattern-either:
      - pattern-inside: 'EntityManager $EM = ...;

          ...

          '
      - pattern-inside: "$TYPE $FUNC(...,EntityManager $EM,...) {\n  ...\n}\n"
    - pattern-not: '$EM.$METHOD("..." + "...",...);

        '
    - metavariable-regex:
        metavariable: $METHOD
        regex: ^(createQuery|createNativeQuery)$
    severity: WARNING
- rules:
  - id: jdo-sqli
    languages:
    - java
    message: Detected a formatted string in a SQL statement. This could lead to SQL
      injection if variables in the SQL statement are not properly sanitized. Use
      a prepared statements (java.sql.PreparedStatement) instead. You can obtain a
      PreparedStatement using 'connection.prepareStatement'.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - audit
      technology:
      - java
    pattern-either:
    - patterns:
      - pattern-either:
        - patterns:
          - pattern-either:
            - pattern-inside: 'String $SQL = $X + $Y;

                ...

                '
            - pattern-inside: 'String $SQL = String.format(...);

                ...

                '
            - pattern-inside: "$TYPE $FUNC(...,String $SQL,...) {\n  ...\n}\n"
          - pattern-not-inside: 'String $SQL = "..." + "...";

              ...

              '
          - pattern: $Q.$METHOD($SQL,...)
        - pattern: '$Q.$METHOD(String.format(...),...);

            '
        - pattern: '$Q.$METHOD($X + $Y,...);

            '
      - pattern-either:
        - pattern-inside: 'javax.jdo.Query $Q = ...;

            ...

            '
        - pattern-inside: "$TYPE $FUNC(...,javax.jdo.Query $Q,...) {\n  ...\n}\n"
      - pattern-not: '$Q.$METHOD("..." + "...",...);

          '
      - metavariable-regex:
          metavariable: $METHOD
          regex: ^(setFilter|setGrouping)$
    - patterns:
      - pattern-either:
        - patterns:
          - pattern-either:
            - pattern-inside: 'String $SQL = $X + $Y;

                ...

                '
            - pattern-inside: 'String $SQL = String.format(...);

                ...

                '
            - pattern-inside: "$VAL $FUNC(...,String $SQL,...) {\n  ...\n}\n"
          - pattern-not-inside: 'String $SQL = "..." + "...";

              ...

              '
          - pattern: $PM.newQuery(...,$SQL,...)
        - pattern: '$PM.newQuery(...,String.format(...),...);

            '
        - pattern: '$PM.newQuery(...,$X + $Y,...);

            '
      - pattern-either:
        - pattern-inside: 'javax.jdo.PersistenceManager $PM = ...;

            ...

            '
        - pattern-inside: "$TYPE $FUNC(...,javax.jdo.PersistenceManager $PM,...) {\n\
            \  ...\n}\n"
      - pattern-not: '$PM.newQuery(...,"..." + "...",...);

          '
    severity: WARNING
- rules:
  - id: no-direct-response-writer
    languages:
    - java
    message: Detected a request with potential user-input going into a OutputStream
      or Writer object. This bypasses any view or template environments, including
      HTML escaping, which may expose this application to cross-site scripting (XSS)
      vulnerabilities. Consider using a view technology such as JavaServer Faces (JSFs)
      which automatically escapes HTML views.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
        Scripting'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      interfile: true
      likelihood: HIGH
      owasp:
      - A07:2017 - Cross-Site Scripting (XSS)
      - A03:2021 - Injection
      references:
      - https://www3.ntu.edu.sg/home/ehchua/programming/java/JavaServerFaces.html
      subcategory:
      - vuln
      technology:
      - java
      - servlets
    mode: taint
    options:
      interfile: true
    pattern-sanitizers:
    - pattern-either:
      - pattern: Encode.forHtml(...)
      - pattern: (PolicyFactory $POLICY).sanitize(...)
      - pattern: (AntiSamy $AS).scan(...)
      - pattern: JSoup.clean(...)
      - pattern: org.apache.commons.lang.StringEscapeUtils.escapeHtml(...)
      - pattern: org.springframework.web.util.HtmlUtils.htmlEscape(...)
      - pattern: org.owasp.esapi.ESAPI.encoder().encodeForHTML(...)
    pattern-sinks:
    - patterns:
      - pattern-either:
        - pattern: '(HttpServletResponse $RESPONSE).getWriter(...).$WRITE(...)

            '
        - pattern: '(HttpServletResponse $RESPONSE).getOutputStream(...).$WRITE(...)

            '
        - pattern: '(java.io.PrintWriter $WRITER).$WRITE(...)

            '
        - pattern: '(PrintWriter $WRITER).$WRITE(...)

            '
        - pattern: '(javax.servlet.ServletOutputStream $WRITER).$WRITE(...)

            '
        - pattern: '(ServletOutputStream $WRITER).$WRITE(...)

            '
        - pattern: '(java.io.OutputStream $WRITER).$WRITE(...)

            '
        - pattern: '(OutputStream $WRITER).$WRITE(...)

            '
    pattern-sources:
    - patterns:
      - pattern-either:
        - pattern: '(HttpServletRequest $REQ).$REQFUNC(...)

            '
        - pattern: "(ServletRequest $REQ).$REQFUNC(...) \n"
      - metavariable-regex:
          metavariable: $REQFUNC
          regex: (getInputStream|getParameter|getParameterMap|getParameterValues|getReader|getCookies|getHeader|getHeaderNames|getHeaders|getPart|getParts|getQueryString)
    severity: WARNING
- rules:
  - id: use-escapexml
    languages:
    - regex
    message: Detected an Expression Language segment that does not escape output.
      This is dangerous because if any data in this expression can be controlled externally,
      it is a cross-site scripting vulnerability. Instead, use the 'escapeXml' function
      from the JSTL taglib. See https://www.tutorialspoint.com/jsp/jstl_function_escapexml.htm
      for more information.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-116: Improper Encoding or Escaping of Output'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://www.tutorialspoint.com/jsp/jstl_function_escapexml.htm
      - https://stackoverflow.com/a/4948856
      - https://stackoverflow.com/a/3180202
      subcategory:
      - audit
      technology:
      - jsp
    paths:
      include:
      - '*.jsp'
    pattern-regex: \$\{(?!.*escapeXml).*\}
    severity: WARNING
- rules:
  - id: use-jstl-escaping
    languages:
    - regex
    message: Detected an Expression Language segment in a tag that does not escape
      output. This is dangerous because if any data in this expression can be controlled
      externally, it is a cross-site scripting vulnerability. Instead, use the 'out'
      tag from the JSTL taglib to escape this expression. See https://www.tutorialspoint.com/jsp/jstl_core_out_tag.htm
      for more information.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-116: Improper Encoding or Escaping of Output'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://www.tutorialspoint.com/jsp/jstl_core_out_tag.htm
      - https://stackoverflow.com/a/4948856
      - https://stackoverflow.com/a/3180202
      subcategory:
      - audit
      technology:
      - jsp
    paths:
      include:
      - '*.jsp'
    pattern-regex: <(?![A-Za-z0-9]+:out).*?\$\{.*?\}.*>
    severity: WARNING
- rules:
  - id: no-scriptlets
    languages:
    - regex
    message: JSP scriptlet detected. Scriptlets are difficult to use securely and
      are considered bad practice. See https://stackoverflow.com/a/3180202. Instead,
      consider migrating to JSF or using the Expression Language '${...}' with the
      escapeXml function in your JSP files.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-116: Improper Encoding or Escaping of Output'
      impact: LOW
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://stackoverflow.com/a/3180202
      - https://stackoverflow.com/a/4948856
      subcategory:
      - audit
      technology:
      - jsp
    paths:
      include:
      - '*.jsp'
    pattern-regex: \<\%[^\@].*
    severity: WARNING
- rules:
  - id: autoescape-disabled
    languages:
    - regex
    message: Detected an element with disabled HTML escaping. If external data can
      reach this, this is a cross-site scripting (XSS) vulnerability. Ensure no external
      data can reach here, or remove 'escape=false' from this element.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-150: Improper Neutralization of Escape, Meta, or Control Sequences'
      impact: MEDIUM
      likelihood: LOW
      owasp: A07:2017 - Cross-Site Scripting (XSS)
      references:
      - https://stackoverflow.com/a/7442668
      subcategory:
      - audit
      technology:
      - jsf
    paths:
      include:
      - '*.html'
      - '*.xhtml'
    pattern-regex: .*escape.*?=.*?false.*
    severity: WARNING
- rules:
  - id: server-dangerous-object-deserialization
    languages:
    - java
    message: Using an arbitrary object ('$PARAMTYPE $PARAM') with Java RMI is an insecure
      deserialization vulnerability. This object can be manipulated by a malicious
      actor allowing them to execute code on your system. Instead, use an integer
      ID to look up your object, or consider alternative serialization schemes such
      as JSON.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-502: Deserialization of Untrusted Data'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A08:2017 - Insecure Deserialization
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://frohoff.github.io/appseccali-marshalling-pickles/
      - https://book.hacktricks.xyz/network-services-pentesting/1099-pentesting-java-rmi
      - https://youtu.be/t_aw1mDNhzI
      - https://github.com/qtc-de/remote-method-guesser
      - https://github.com/openjdk/jdk/blob/master/src/java.rmi/share/classes/sun/rmi/server/UnicastRef.java#L303C4-L331
      subcategory:
      - audit
      technology:
      - rmi
    patterns:
    - pattern: "interface $INTERFACE extends Remote {\n  $RETURNTYPE $METHOD($PARAMTYPE\
        \ $PARAM) throws RemoteException;\n}\n"
    - metavariable-pattern:
        language: generic
        metavariable: $PARAMTYPE
        patterns:
        - pattern-not: String
        - pattern-not: java.lang.String
        - pattern-not: boolean
        - pattern-not: Boolean
        - pattern-not: java.lang.Boolean
        - pattern-not: byte
        - pattern-not: Byte
        - pattern-not: java.lang.Byte
        - pattern-not: char
        - pattern-not: Character
        - pattern-not: java.lang.Character
        - pattern-not: double
        - pattern-not: Double
        - pattern-not: java.lang.Double
        - pattern-not: float
        - pattern-not: Float
        - pattern-not: java.lang.Float
        - pattern-not: int
        - pattern-not: Integer
        - pattern-not: java.lang.Integer
        - pattern-not: long
        - pattern-not: Long
        - pattern-not: java.lang.Long
        - pattern-not: short
        - pattern-not: Short
        - pattern-not: java.lang.Short
    severity: ERROR
- rules:
  - id: server-dangerous-class-deserialization
    languages:
    - java
    message: Using a non-primitive class with Java RMI may be an insecure deserialization
      vulnerability. Depending on the underlying implementation. This object could
      be manipulated by a malicious actor allowing them to execute code on your system.
      Instead, use an integer ID to look up your object, or consider alternative serialization
      schemes such as JSON.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-502: Deserialization of Untrusted Data'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A08:2017 - Insecure Deserialization
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://mogwailabs.de/blog/2019/03/attacking-java-rmi-services-after-jep-290/
      subcategory:
      - audit
      technology:
      - rmi
    patterns:
    - pattern: "interface $INTERFACE extends Remote {\n  $RETURNTYPE $METHOD($CLASS\
        \ $PARAM) throws RemoteException;\n}\n"
    - metavariable-regex:
        metavariable: $CLASS
        regex: (?!int|boolean|short|long|byte|char|float|double)
    severity: WARNING
- rules:
  - id: seam-log-injection
    languages:
    - java
    message: Seam Logging API support an expression language to introduce bean property
      to log messages. The expression language can also be the source to unwanted
      code execution. In this context, an expression is built with a dynamic value.
      The source of the value(s) should be verified to avoid that unfiltered values
      fall into this risky code evaluation.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code
        (''Eval Injection'')'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SEAM_LOG_INJECTION
      subcategory:
      - audit
      technology:
      - jboss
    patterns:
    - pattern: '$LOG.$INFO($X + $Y,...)

        '
    - pattern-either:
      - pattern-inside: 'import org.jboss.seam.log.Log;

          ...

          '
      - pattern-inside: 'org.jboss.seam.log.Log $LOG = ...;

          ...

          '
    - metavariable-regex:
        metavariable: $INFO
        regex: (debug|error|fatal|info|trace|warn)
    severity: ERROR
- rules:
  - id: find-sql-string-concatenation
    languages:
    - java
    message: In $METHOD, $X is used to construct a SQL query via string concatenation.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
        (''SQL Injection'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2017 - Injection
      - A03:2021 - Injection
      references:
      - https://owasp.org/Top10/A03_2021-Injection
      subcategory:
      - vuln
      technology:
      - jboss
    pattern-either:
    - pattern: "$RETURN $METHOD(...,String $X,...){\n  ...\n  Session $SESSION = ...;\n\
        \  ...\n  String $QUERY = ... + $X + ...;\n  ...\n  PreparedStatement $PS\
        \ = $SESSION.connection().prepareStatement($QUERY);\n  ...\n  ResultSet $RESULT\
        \ = $PS.executeQuery();\n  ...\n}\n"
    - pattern: "$RETURN $METHOD(...,String $X,...){\n  ...\n  String $QUERY = ...\
        \ + $X + ...;\n  ...\n  Session $SESSION = ...;\n  ...\n  PreparedStatement\
        \ $PS = $SESSION.connection().prepareStatement($QUERY);\n  ...\n  ResultSet\
        \ $RESULT = $PS.executeQuery();\n  ...\n}\n"
    severity: ERROR
- rules:
  - id: jjwt-none-alg
    languages:
    - java
    message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm
      assumes the integrity of the token has already been verified. This would allow
      a malicious actor to forge a JWT token that will automatically be verified.
      Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as
      'HS256'.
    metadata:
      asvs:
        control_id: 3.5.3 Insecue Stateless Session Tokens
        control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
        section: 'V3: Session Management Verification Requirements'
        version: '4'
      category: security
      confidence: LOW
      cwe:
      - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A03:2017 - Sensitive Data Exposure
      - A02:2021 - Cryptographic Failures
      references:
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
      source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
      subcategory:
      - audit
      technology:
      - jwt
    patterns:
    - pattern: 'io.jsonwebtoken.Jwts.builder();

        '
    - pattern-not-inside: "$RETURNTYPE $FUNC(...) {\n  ...\n  $JWTS.signWith(...);\n\
        \  ...\n}"
    severity: ERROR
- rules:
  - id: insecure-resteasy-deserialization
    languages:
    - java
    message: When a Restful webservice endpoint is configured to use wildcard mediaType
      {*/*} as a value for the @Consumes annotation, an attacker could abuse the SerializableProvider
      by sending a HTTP Request with a Content-Type of application/x-java-serialized-object.
      The body of that request would be processed by the SerializationProvider and
      could contain a malicious payload, which may lead to arbitrary code execution
      when calling the $Y.getObject method.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-502: Deserialization of Untrusted Data'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A08:2017 - Insecure Deserialization
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://access.redhat.com/blogs/766093/posts/3162112
      subcategory:
      - audit
      technology:
      - jax-rs
    pattern-either:
    - pattern: '@Consumes({"application/x-java-serialized-object"})

        '
    - pattern: '@Consumes({"*/*"})

        '
    - pattern: '@Consumes("*/*")

        '
    - pattern: '@Consumes({MediaType.WILDCARD_TYPE})

        '
    severity: WARNING
  - id: default-resteasy-provider-abuse
    languages:
    - java
    message: When a Restful webservice endpoint isn't configured with a @Consumes
      annotation, an attacker could abuse the SerializableProvider by sending a HTTP
      Request with a Content-Type of application/x-java-serialized-object. The body
      of that request would be processed by the SerializationProvider and could contain
      a malicious payload, which may lead to arbitrary code execution. Instead, add
      a @Consumes annotation to the function or class.
    metadata:
      category: security
      confidence: LOW
      cwe:
      - 'CWE-502: Deserialization of Untrusted Data'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A08:2017 - Insecure Deserialization
      - A08:2021 - Software and Data Integrity Failures
      references:
      - https://access.redhat.com/blogs/766093/posts/3162112
      subcategory:
      - audit
      technology:
      - jax-rs
    patterns:
    - pattern: '@Path("...")

        public $RETURNTYPE $METHOD(...) { ...}

        '
    - pattern-not-inside: '@GET

        public $RETURNTYPE $METHOD(...) { ...}

        '
    - pattern-not-inside: '@Path("...")

        @Consumes(...)

        public $RETURNTYPE $METHOD(...) { ...}

        '
    - pattern-not-inside: '@Consumes(...)

        public class $CLASSNAME { ... }

        '
    severity: WARNING
- rules:
  - id: jax-rs-path-traversal
    languages:
    - java
    message: Detected a potential path traversal. A malicious actor could control
      the location of this file, to include going backwards in the directory with
      '../'. To address this, ensure that user-controlled variables in file paths
      are sanitized. You may also consider using a utility method such as org.apache.commons.io.FilenameUtils.getName(...)
      to only retrieve the file name from the path.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path
        Traversal'')'
      cwe2021-top25: true
      cwe2022-top25: true
      impact: LOW
      likelihood: LOW
      owasp:
      - A05:2017 - Broken Access Control
      - A01:2021 - Broken Access Control
      references:
      - https://www.owasp.org/index.php/Path_Traversal
      source-rule-url: https://find-sec-bugs.github.io/bugs.htm#PATH_TRAVERSAL_IN
      subcategory:
      - vuln
      technology:
      - jax-rs
    pattern-either:
    - pattern: "$RETURNTYPE $FUNC (..., @PathParam(...) $TYPE $VAR, ...) {\n  ...\n\
        \  new File(..., $VAR, ...);\n  ...\n}\n"
    - pattern: "$RETURNTYPE $FUNC (..., @javax.ws.rs.PathParam(...) $TYPE $VAR, ...)\
        \ {\n  ...\n  new File(..., $VAR, ...);\n  ...\n}"
    severity: WARNING
