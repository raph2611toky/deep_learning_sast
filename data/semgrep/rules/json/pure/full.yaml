- rules:
  - id: public-s3-bucket
    languages:
    - json
    message: Detected public S3 bucket. This policy allows anyone to have some kind
      of access to the bucket. The exact level of access and types of actions allowed
      will depend on the configuration of bucket policy and ACLs. Please review the
      bucket configuration to make sure they are set with intended values.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-264: CWE CATEGORY: Permissions, Privileges, and Access Controls'
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html
      subcategory:
      - vuln
      technology:
      - aws
    patterns:
    - pattern-inside: "$BUCKETNAME: {\n  \"Type\": \"AWS::S3::Bucket\",\n  \"Properties\"\
        : {\n  ...,\n  },\n  ...,\n}\n"
    - pattern-either:
      - pattern: "\"PublicAccessBlockConfiguration\": {\n     ...,\n     \"RestrictPublicBuckets\"\
          : false,\n     ...,\n   },\n"
      - pattern: "\"PublicAccessBlockConfiguration\": {\n     ...,\n     \"IgnorePublicAcls\"\
          : false,\n     ...,\n   },\n"
      - pattern: "\"PublicAccessBlockConfiguration\": {\n     ...,\n     \"BlockPublicAcls\"\
          : false,\n     ...,\n   },\n"
      - pattern: "\"PublicAccessBlockConfiguration\": {\n     ...,\n     \"BlockPublicPolicy\"\
          : false,\n     ...,\n   },\n"
    severity: WARNING
- rules:
  - id: public-s3-policy-statement
    languages:
    - json
    message: Detected public S3 bucket policy. This policy allows anyone to access
      certain properties of or items in the bucket. Do not do this unless you will
      never have sensitive data inside the bucket.
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-264: CWE CATEGORY: Permissions, Privileges, and Access Controls'
      impact: HIGH
      likelihood: LOW
      owasp:
      - A01:2021 - Broken Access Control
      references:
      - https://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteAccessPermissionsReqd.html
      subcategory:
      - vuln
      technology:
      - aws
    pattern: "{\n  \"Effect\": \"Allow\",\n  \"Principal\": \"*\",\n  \"Resource\"\
      : [\n    ..., \"=~/arn:aws:s3.*/\", ...\n  ],\n  ...\n}\n"
    severity: WARNING
- rules:
  - id: wildcard-assume-role
    languages:
    - json
    message: 'Detected wildcard access granted to sts:AssumeRole. This means anyone
      with your AWS account ID and the name of the role can assume the role. Instead,
      limit to a specific identity in your account, like this: `arn:aws:iam::<account_id>:root`.'
    metadata:
      category: security
      confidence: MEDIUM
      cwe:
      - 'CWE-250: Execution with Unnecessary Privileges'
      impact: HIGH
      likelihood: HIGH
      owasp:
      - A06:2017 - Security Misconfiguration
      - A05:2021 - Security Misconfiguration
      references:
      - https://rhinosecuritylabs.com/aws/assume-worst-aws-assume-role-enumeration/
      subcategory:
      - vuln
      technology:
      - aws
    patterns:
    - pattern-inside: '"Statement": [...]

        '
    - pattern-inside: '{..., "Effect": "Allow", ..., "Action": "sts:AssumeRole", ...}

        '
    - pattern: '"Principal": {..., "AWS": "*", ...}

        '
    severity: ERROR
