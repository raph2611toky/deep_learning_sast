- rules:
  - id: grequests-http-request
    languages:
    - go
    message: Checks for requests to http (unencrypted) sites using grequests, a popular
      HTTP client library. This is dangerous because it could result in plaintext
      PII being passed around the network.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://godoc.org/github.com/levigross/grequests#DoRegularRequest
      - https://github.com/levigross/grequests
      subcategory:
      - vuln
      technology:
      - grequests
      vulnerability: Insecure Transport
    patterns:
    - pattern-either:
      - pattern: 'grequests.$FUNC(...,"=~/[hH][tT][tT][pP]://.*/", ...)

          '
      - pattern: '$FUNC(...,"=~/[hH][tT][tT][pP]://.*/", ...)

          '
    - metavariable-regex:
        metavariable: $FUNC
        regex: (Get|Head|Post|Put|Delete|Patch|Options|Req|DoRegularRequest)
    severity: WARNING
- rules:
  - fix-regex:
      count: 1
      regex: '[Hh][Tt][Tt][Pp]://'
      replacement: https://
    id: http-customized-request
    languages:
    - go
    message: Checks for requests sent via http.NewRequest to http:// URLS. This is
      dangerous because the server is attempting to connect to a website that does
      not encrypt traffic with TLS. Instead, send requests only to https:// URLS.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://golang.org/pkg/net/http/#NewRequest
      subcategory:
      - vuln
      technology:
      - go
      vulnerability: Insecure Transport
    pattern: 'http.NewRequest(..., "=~/[hH][tT][tT][pP]://.*/", ...)

      '
    severity: WARNING
- rules:
  - id: gorequest-http-request
    languages:
    - go
    message: Checks for requests to http (unencrypted) sites using gorequest, a popular
      HTTP client library. This is dangerous because it could result in plaintext
      PII being passed around the network.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: HIGH
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://github.com/parnurzeal/gorequest
      subcategory:
      - vuln
      technology:
      - gorequest
      vulnerability: Insecure Transport
    pattern-either:
    - patterns:
      - pattern-inside: '$REQ = gorequest.New()

          ...

          $RES = ...

          '
      - pattern: '$REQ.$FUNC("=~/[hH][tT][tT][pP]://.*/")

          '
      - metavariable-regex:
          metavariable: $FUNC
          regex: (Get|Post|Delete|Head|Put|Patch)
    - patterns:
      - pattern: gorequest.New().$FUNC("=~/[hH][tT][tT][pP]://.*/")
      - metavariable-regex:
          metavariable: $FUNC
          regex: (Get|Post|Delete|Head|Put|Patch)
    severity: WARNING
- rules:
  - fix-regex:
      count: 1
      regex: '[fF][tT][pP]://'
      replacement: sftp://
    id: ftp-request
    languages:
    - go
    message: Checks for outgoing connections to ftp servers with the ftp package.
      FTP does not encrypt traffic, possibly leading to PII being sent plaintext over
      the network. Instead, connect via the SFTP protocol.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://godoc.org/github.com/jlaffaye/ftp#Dial
      - https://github.com/jlaffaye/ftp
      subcategory:
      - vuln
      technology:
      - ftp
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: 'ftp.Dial("=~/^[fF][tT][pP]://.*/", ...)

        '
    - pattern: 'ftp.DialTimeout("=~/^[fF][tT][pP]://.*/", ...)

        '
    - pattern: 'ftp.Connect("=~/^[fF][tT][pP]://.*/")

        '
    - pattern: '$URL = "=~/^[fF][tT][pP]://.*/"

        ...

        ftp.Dial($URL, ...)

        '
    - pattern: '$URL = "=~/^[fF][tT][pP]://.*/"

        ...

        ftp.DialTimeout($URL, ...)

        '
    - pattern: '$URL = "=~/^[fF][tT][pP]://.*/"

        ...

        ftp.Connect($URL)

        '
    severity: WARNING
- rules:
  - id: bypass-tls-verification
    languages:
    - go
    message: Checks for disabling of TLS/SSL certificate verification. This should
      only be used for debugging purposes because it leads to vulnerability to MTM
      attacks.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: HIGH
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://stackoverflow.com/questions/12122159/how-to-do-a-https-request-with-bad-certificate
      subcategory:
      - vuln
      technology:
      - go
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: 'tls.Config{..., InsecureSkipVerify: true, ...}

        '
    - pattern: '$CONFIG = &tls.Config{...}

        ...

        $CONFIG.InsecureSkipVerify = true

        '
    severity: WARNING
- rules:
  - fix-regex:
      count: 1
      regex: '[Hh][Tt][Tt][Pp]://'
      replacement: https://
    id: http-request
    languages:
    - go
    message: Checks for requests sent via http.$FUNC to http:// URLS. This is dangerous
      because the server is attempting to connect to a website that does not encrypt
      traffic with TLS. Instead, send requests only to https:// URLS.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://golang.org/pkg/net/http/#Get
      subcategory:
      - vuln
      technology:
      - go
      vulnerability: Insecure Transport
    patterns:
    - pattern-either:
      - pattern: 'http.$FUNC("=~/[hH][tT][tT][pP]://.*/", ...)

          '
      - patterns:
        - pattern-inside: '$CLIENT := &http.Client{...}

            ...

            '
        - pattern: 'client.$FUNC("=~/[hH][tT][tT][pP]://.*/", ...)

            '
    - pattern-not: http.$FUNC("=~/[hH][tT][tT][pP]://127.0.0.1.*/", ...)
    - pattern-not: client.$FUNC("=~/[hH][tT][tT][pP]://127.0.0.1.*/", ...)
    - pattern-not: http.$FUNC("=~/[hH][tT][tT][pP]://localhost.*/", ...)
    - pattern-not: client.$FUNC("=~/[hH][tT][tT][pP]://localhost.*/", ...)
    - metavariable-regex:
        metavariable: $FUNC
        regex: (Get|Post|Head|PostForm)
    severity: WARNING
- rules:
  - id: telnet-request
    languages:
    - go
    message: Checks for attempts to connect to an insecure telnet server using the
      package telnet. This is bad because it can lead to man in the middle attacks.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://godoc.org/github.com/reiver/go-telnet
      subcategory:
      - vuln
      technology:
      - go-telnet
      vulnerability: Insecure Transport
    pattern: 'telnet.DialToAndCall(...)

      '
    severity: WARNING
- rules:
  - id: disallow-old-tls-versions
    languages:
    - go
    message: Detects creations of tls configuration objects with an insecure MinVersion
      of TLS. These protocols are deprecated due to POODLE, man in the middle attacks,
      and other vulnerabilities.
    metadata:
      category: security
      confidence: HIGH
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: HIGH
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://stackoverflow.com/questions/26429751/java-http-clients-and-poodle
      subcategory:
      - vuln
      technology:
      - go
      vulnerability: Insecure Transport
    patterns:
    - pattern-either:
      - pattern: 'tls.Config{..., MinVersion: $TLS.$VERSION, ...}

          '
      - pattern: '$CONFIG = &tls.Config{...}

          ...

          $CONFIG.MinVersion = $TLS.$VERSION

          '
    - metavariable-regex:
        metavariable: $VERSION
        regex: (VersionTLS10|VersionTLS11|VersionSSL30)
    severity: WARNING
- rules:
  - id: sling-http-request
    languages:
    - go
    message: Checks for requests to http (unencrypted) sites using gorequest, a popular
      HTTP client library. This is dangerous because it could result in plaintext
      PII being passed around the network.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://godoc.org/github.com/dghubble/sling#Sling.Add
      - https://github.com/dghubble/sling
      subcategory:
      - vuln
      technology:
      - sling
      vulnerability: Insecure Transport
    pattern-either:
    - patterns:
      - pattern-inside: '$REQ = sling.New()

          ...

          $RES = ...

          '
      - pattern: '$REQ.$FUNC("=~/[hH][tT][tT][pP]://.*/")

          '
      - metavariable-regex:
          metavariable: $FUNC
          regex: (Get|Post|Delete|Head|Put|Options|Patch|Base|Connect)
    - patterns:
      - pattern: sling.New().$FUNC("=~/[hH][tT][tT][pP]://.*/")
      - metavariable-regex:
          metavariable: $FUNC
          regex: (Get|Post|Delete|Head|Put|Options|Patch|Base|Connect)
    - patterns:
      - pattern-inside: '$REQ = sling.New()

          ...

          $URL = "=~/[hH][tT][tT][pP]://.*/"

          ...

          $RES = ...

          '
      - pattern: '$REQ.$FUNC($URL)

          '
      - metavariable-regex:
          metavariable: $FUNC
          regex: (Get|Post|Delete|Head|Put|Options|Patch|Base|Connect)
    - patterns:
      - pattern-inside: '$URL = "=~/[hH][tT][tT][pP]://.*/"

          ...

          $RES = ...

          '
      - pattern: 'sling.New().$FUNC($URL)

          '
      - metavariable-regex:
          metavariable: $FUNC
          regex: (Get|Post|Delete|Head|Put|Options|Patch|Base|Connect)
    severity: WARNING
- rules:
  - id: disallow-old-tls-versions2
    languages:
    - javascript
    - typescript
    message: Detects creations of $HTTPS servers from option objects that don't disallow
      SSL v2, SSL v3, and TLS v1. These protocols are deprecated due to POODLE, man
      in the middle attacks, and other vulnerabilities.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://us-cert.cisa.gov/ncas/alerts/TA14-290A
      - https://stackoverflow.com/questions/40434934/how-to-disable-the-ssl-3-0-and-tls-1-0-in-nodejs
      - https://nodejs.org/api/https.html#https_https_createserver_options_requestlistener
      subcategory:
      - vuln
      technology:
      - node.js
      vulnerability: Insecure Transport
    patterns:
    - pattern-either:
      - pattern-inside: '$CONST = require(''crypto'');

          ...

          '
      - pattern-inside: '$CONST = require(''constants'');

          ...

          '
    - pattern-inside: '$HTTPS = require(''https'');

        ...

        '
    - pattern: '$OPTIONS = {};

        ...

        $HTTPS.createServer($OPTIONS, ...);

        '
    - pattern-not: '$OPTIONS = {secureOptions: $CONST.SSL_OP_NO_TLSv1 | $CONST.SSL_OP_NO_SSLv3
        | $CONST.SSL_OP_NO_SSLv2};

        ...

        $HTTPS.createServer($OPTIONS, ...);

        '
    - pattern-not: '$OPTIONS = {secureOptions: $CONST.SSL_OP_NO_TLSv1 | $CONST.SSL_OP_NO_SSLv2
        | $CONST.SSL_OP_NO_SSLv3};

        ...

        $HTTPS.createServer($OPTIONS, ...);

        '
    - pattern-not: '$OPTIONS = {secureOptions: $CONST.SSL_OP_NO_SSLv2  | $CONST.SSL_OP_NO_TLSv1
        | $CONST.SSL_OP_NO_SSLv3};

        ...

        $HTTPS.createServer($OPTIONS, ...);

        '
    - pattern-not: '$OPTIONS = {secureOptions: $CONST.SSL_OP_NO_SSLv2 | $CONST.SSL_OP_NO_SSLv3
        | $CONST.SSL_OP_NO_TLSv1};

        ...

        $HTTPS.createServer($OPTIONS, ...);

        '
    - pattern-not: '$OPTIONS = {secureOptions: $CONST.SSL_OP_NO_SSLv3 | $CONST.SSL_OP_NO_SSLv2
        | $CONST.SSL_OP_NO_TLSv1};

        ...

        $HTTPS.createServer($OPTIONS, ...);

        '
    - pattern-not: '$OPTIONS = {secureOptions: $CONST.SSL_OP_NO_SSLv3 | $CONST.SSL_OP_NO_TLSv1
        | $CONST.SSL_OP_NO_SSLv2};

        ...

        $HTTPS.createServer($OPTIONS, ...);

        '
    severity: WARNING
- rules:
  - id: ftp-request
    languages:
    - javascript
    - typescript
    message: 'Checks for lack of usage of the "secure: true" option when sending ftp
      requests through the nodejs ftp module. This leads to unencrypted traffic being
      sent to the ftp server. There are other options such as "implicit" that still
      does not encrypt all traffic. ftp is the most utilized npm ftp module.'
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://www.npmjs.com/package/ftp
      - https://openbase.io/js/ftp
      subcategory:
      - vuln
      technology:
      - node.js
      vulnerability: Insecure Transport
    patterns:
    - pattern-inside: '$X = require(''ftp'');

        ...

        $C = new $X();

        ...

        '
    - pattern-not-inside: '$OPTIONS = {secure: true};

        ...

        '
    - pattern: '$C.connect($OPTIONS,...);

        '
    - pattern-not: '$C.connect({...,secure: true});

        '
    severity: WARNING
- rules:
  - id: bypass-tls-verification
    languages:
    - javascript
    - typescript
    message: Checks for setting the environment variable NODE_TLS_REJECT_UNAUTHORIZED
      to 0, which disables TLS verification. This should only be used for debugging
      purposes. Setting the option rejectUnauthorized to false bypasses verification
      against the list of trusted CAs, which also leads to insecure transport. These
      options lead to vulnerability to MTM attacks, and should not be used.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://nodejs.org/api/https.html#https_https_request_options_callback
      - https://stackoverflow.com/questions/20433287/node-js-request-cert-has-expired#answer-29397100
      subcategory:
      - vuln
      technology:
      - node.js
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: 'process.env["NODE_TLS_REJECT_UNAUTHORIZED"] = 0;

        '
    - pattern: '{rejectUnauthorized:false}

        '
    severity: WARNING
- rules:
  - id: http-request
    languages:
    - javascript
    message: Checks for requests sent to http:// URLs. This is dangerous as the server
      is attempting to connect to a website that does not encrypt traffic with TLS.
      Instead, only send requests to https:// URLs.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://nodejs.org/api/http.html#http_http_request_options_callback
      subcategory:
      - vuln
      technology:
      - node.js
      vulnerability: Insecure Transport
    patterns:
    - pattern-inside: '$HTTP = require(''http'');

        ...

        '
    - pattern-either:
      - pattern: '$HTTP.request("=~/http://.*/",...);

          '
      - pattern: '$HTTP.get("=~/http://.*/", ...)

          '
      - pattern: '$VAR = new URL("=~/http://.*/");

          ...

          $HTTP.request($VAR, ...);

          '
      - pattern: '$VAR = {...,hostname: "..."};

          ...

          $HTTP.request(..., $VAR, ...);

          '
      - pattern: '$HTTP.request(..., {...,hostname: "..."}, ...);

          '
    - pattern-not: '$VAR = {...,protocol: "https"};

        ...

        $HTTP.request(..., $VAR, ...);

        '
    - pattern-not: '$HTTP.request(..., {...,protocol: "https"}, ...);

        '
    severity: WARNING
- rules:
  - id: telnet-request
    languages:
    - javascript
    message: Checks for creation of telnet servers or attempts to connect through
      telnet. This is insecure as the telnet protocol supports no encryption, and
      data passes through unencrypted.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://www.npmjs.com/package/telnet
      - https://www.npmjs.com/package/telnet-client
      subcategory:
      - vuln
      technology:
      - node.js
      vulnerability: Insecure Transport
    patterns:
    - pattern-either:
      - pattern-inside: '$TEL = require(''telnet-client'');

          ...

          $SERVER = new $TEL();

          ...

          '
      - pattern-inside: '$SERVER = require(''telnet'');

          ...

          '
    - pattern-either:
      - pattern: '$SERVER.on(...)

          '
      - pattern: '$SERVER.connect(...)

          '
      - pattern: '$SERVER.createServer(...)

          '
    severity: WARNING
- rules:
  - id: disallow-old-tls-versions1
    languages:
    - javascript
    - typescript
    message: Detects direct creations of $HTTPS servers that don't disallow SSL v2,
      SSL v3, and TLS v1. These protocols are deprecated due to POODLE, man in the
      middle attacks, and other vulnerabilities.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://us-cert.cisa.gov/ncas/alerts/TA14-290A
      - https://stackoverflow.com/questions/40434934/how-to-disable-the-ssl-3-0-and-tls-1-0-in-nodejs
      - https://nodejs.org/api/https.html#https_https_createserver_options_requestlistener
      subcategory:
      - vuln
      technology:
      - node.js
      vulnerability: Insecure Transport
    patterns:
    - pattern-either:
      - pattern-inside: '$CONST = require(''crypto'');

          ...

          '
      - pattern-inside: '$CONST = require(''constants'');

          ...

          '
    - pattern-inside: '$HTTPS = require(''https'');

        ...

        '
    - pattern: '$HTTPS.createServer(...).$FUNC(...);

        '
    - pattern-not: '$HTTPS.createServer({secureOptions: $CONST.SSL_OP_NO_TLSv1 | $CONST.SSL_OP_NO_SSLv3
        | $CONST.SSL_OP_NO_SSLv2 }, ...).$FUNC(...);

        '
    - pattern-not: '$HTTPS.createServer({secureOptions: $CONST.SSL_OP_NO_TLSv1 | $CONST.SSL_OP_NO_SSLv2
        |$CONST.SSL_OP_NO_SSLv3 }, ...).$FUNC(...);

        '
    - pattern-not: '$HTTPS.createServer({secureOptions: $CONST.SSL_OP_NO_SSLv2 |$CONST.SSL_OP_NO_SSLv3
        |$CONST.SSL_OP_NO_TLSv1 }, ...).$FUNC(...);

        '
    - pattern-not: '$HTTPS.createServer({secureOptions: $CONST.SSL_OP_NO_SSLv2 |$CONST.SSL_OP_NO_TLSv1
        | $CONST.SSL_OP_NO_SSLv3}, ...).$FUNC(...);

        '
    - pattern-not: '$HTTPS.createServer({secureOptions:$CONST.SSL_OP_NO_SSLv3 | $CONST.SSL_OP_NO_SSLv2
        |$CONST.SSL_OP_NO_TLSv1}, ...).$FUNC(...);

        '
    - pattern-not: '$HTTPS.createServer({secureOptions:$CONST.SSL_OP_NO_SSLv3 | $CONST.SSL_OP_NO_TLSv1|
        $CONST.SSL_OP_NO_SSLv2}, ...).$FUNC(...);

        '
    severity: WARNING
- rules:
  - id: using-http-server
    languages:
    - javascript
    message: Checks for any usage of http servers instead of https servers. Encourages
      the usage of https protocol instead of http, which does not have TLS and is
      therefore unencrypted. Using http can lead to man-in-the-middle attacks in which
      the attacker is able to read sensitive information.
    metadata:
      category: security
      confidence: LOW
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: LOW
      owasp:
      - A02:2021 - Cryptographic Failures
      - A03:2017 - Sensitive Data Exposure
      references:
      - https://nodejs.org/api/http.html#http_class_http_agent
      - https://groups.google.com/g/rubyonrails-security/c/NCCsca7TEtY
      subcategory:
      - audit
      technology:
      - node.js
      vulnerability: Insecure Transport
    patterns:
    - pattern-inside: '$HTTP = require(''http'');

        ...

        '
    - pattern-either:
      - pattern: '$HTTP.$FUNC(...);

          '
      - pattern: 'new $HTTP.$FUNC2(...);

          '
    - pattern: $HTTP
    severity: WARNING
- rules:
  - id: rest-http-client-support
    languages:
    - javascript
    message: Checks for requests to http (unencrypted) sites using some of node js's
      most popular REST/HTTP libraries, including node-rest-client, axios, and got.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://www.npmjs.com/package/axios
      - https://www.npmjs.com/package/got
      - https://www.npmjs.com/package/node-rest-client
      subcategory:
      - vuln
      technology:
      - node.js
      vulnerability: Insecure Transport
    patterns:
    - pattern-either:
      - pattern-inside: '$CLIENT = require(''node-rest-client'').Client;

          ...

          $C = new $CLIENT();

          ...

          '
      - pattern-inside: '$C = require(''axios'');

          ...

          '
      - pattern-inside: '$C = require(''got'');

          ...

          '
    - pattern-either:
      - pattern: '$C.$REQ("=~/http://.*/", ...)

          '
      - pattern: '$C("=~/http://.*/", ...)

          '
      - pattern: '$C({...,url: "=~/http://.*/"})

          '
      - pattern: '$C.$REQ({...,url: "=~/http://.*/"})

          '
    severity: WARNING
- rules:
  - id: disallow-old-tls-versions2
    languages:
    - java
    message: Detects setting client protocols to insecure versions of TLS and SSL.
      These protocols are deprecated due to POODLE, man in the middle attacks, and
      other vulnerabilities.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://stackoverflow.com/questions/26504653/is-it-possible-to-disable-sslv3-for-all-java-applications
      subcategory:
      - vuln
      technology:
      - java
      vulnerability: Insecure Transport
    patterns:
    - pattern: $VALUE. ... .setProperty("jdk.tls.client.protocols", "$PATTERNS");
    - metavariable-pattern:
        language: generic
        metavariable: $PATTERNS
        patterns:
        - pattern-either:
          - pattern: TLS1
          - pattern-regex: ^(.*TLSv1|.*SSLv.*)$
          - pattern-regex: ^(.*TLSv1,.*)
    severity: WARNING
- rules:
  - id: socket-request
    languages:
    - java
    message: Insecure transport rules to catch socket connections to http, telnet,
      and ftp servers. This is dangerous because these are protocols that do not encrypt
      traffic.
    metadata:
      category: security
      confidence: LOW
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://docs.oracle.com/javase/8/docs/api/java/net/Socket.html
      subcategory:
      - audit
      technology:
      - java
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: '$SOCKET = new Socket("=~/[tT][eE][lL][nN][eE][tT]://.*/", ...);

        ...

        $OUT = new PrintWriter($SOCKET.getOutputStream(...), ...);

        ...

        $OUT.$FUNC(...);

        '
    - pattern: '$SOCKET = new Socket("=~/^[fF][tT][pP]://.*/", ...);

        ...

        $OUT = new PrintWriter($SOCKET.getOutputStream(...), ...);

        ...

        $OUT.$FUNC(...);

        '
    - pattern: '$SOCKET = new Socket("=~/[hH][tT][tT][pP]://.*/", ...);

        ...

        $OUT = new PrintWriter($SOCKET.getOutputStream(...), ...);

        ...

        $OUT.$FUNC(...);

        '
    severity: WARNING
- rules:
  - fix-regex:
      count: 1
      regex: '[Hh][Tt][Tt][Pp]://'
      replacement: https://
    id: httpclient-http-request
    languages:
    - java
    message: Checks for requests sent via HttpClient to http:// URLS. This is dangerous
      because the server is attempting to connect to a website that does not encrypt
      traffic with TLS. Instead, send requests only to https:// URLS.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://openjdk.java.net/groups/net/httpclient/intro.html
      subcategory:
      - vuln
      technology:
      - java
      vulnerability: Insecure Transport
    pattern-either:
    - patterns:
      - pattern: 'URI.create("=~/[hH][tT][tT][pP]://.*/", ...)

          '
      - pattern-inside: 'HttpClient $CLIENT = ...;

          ...

          HttpRequest $REQ = ...;

          ...

          $CLIENT.sendAsync(...);

          '
    - patterns:
      - pattern: 'URI.create("=~/[hH][tT][tT][pP]://.*/", ...)

          '
      - pattern-inside: 'HttpClient $CLIENT = ...;

          ...

          HttpRequest $REQ = ...;

          ...

          $CLIENT.send(...);

          '
    - patterns:
      - pattern: 'URI.create($URI)

          '
      - pattern-inside: 'String $URI = "=~/[hH][tT][tT][pP]://.*/";

          ...

          HttpClient $CLIENT = ...;

          ...

          HttpRequest $REQ = ...;

          ...

          $CLIENT.send(...);

          '
    - patterns:
      - pattern: 'URI.create($URI)

          '
      - pattern-inside: 'String $URI = "=~/[hH][tT][tT][pP]://.*/";

          ...

          HttpClient $CLIENT = ...;

          ...

          HttpRequest $REQ = ...;

          ...

          $CLIENT.sendAsync(...);

          '
    severity: WARNING
- rules:
  - fix-regex:
      count: 1
      regex: '[fF][tT][pP]://'
      replacement: sftp://
    id: ftp-request
    languages:
    - java
    message: Checks for outgoing connections to ftp servers. FTP does not encrypt
      traffic, possibly leading to PII being sent plaintext over the network.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://www.codejava.net/java-se/ftp/connect-and-login-to-a-ftp-server
      - https://commons.apache.org/proper/commons-net/apidocs/org/apache/commons/net/ftp/FTPClient.html
      subcategory:
      - vuln
      technology:
      - java
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: 'FTPClient $FTPCLIENT = new FTPClient();

        ...

        $FTPCLIENT.connect(...);

        '
    - pattern: 'URL $URL = new URL("=~/^[fF][tT][pP]://.*/");

        ...

        URLConnection $CONN = $URL.openConnection(...);

        '
    severity: WARNING
- rules:
  - id: bypass-tls-verification
    languages:
    - java
    message: Checks for redefinitions of the checkServerTrusted function in the X509TrustManager
      class that disables TLS/SSL certificate verification. This should only be used
      for debugging purposes because it leads to vulnerability to MTM attacks.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://riptutorial.com/java/example/16517/temporarily-disable-ssl-verification--for-testing-purposes-
      - https://stackoverflow.com/questions/35530558/how-to-fix-unsafe-implementation-of-x509trustmanager-in-android-app?rq=1
      subcategory:
      - vuln
      technology:
      - java
      vulnerability: Insecure Transport
    patterns:
    - pattern: "new X509TrustManager() {\n  ...\n  public void checkClientTrusted(X509Certificate[]\
        \ certs, String authType) {...}\n  ...\n}\n"
    - pattern-not: "new X509TrustManager() {\n  ...\n  public void checkServerTrusted(X509Certificate[]\
        \ certs, String authType) {\n    ...\n    throw new CertificateException(...);\n\
        \    ...\n  }\n  ...\n}\n"
    - pattern-not: "new X509TrustManager() {\n  ...\n  public void checkServerTrusted(X509Certificate[]\
        \ certs, String authType) {\n    ...\n    throw new IllegalArgumentException(...);\n\
        \    ...\n  }\n  ...\n}\n"
    severity: WARNING
- rules:
  - fix-regex:
      count: 1
      regex: '[Hh][Tt][Tt][Pp]://'
      replacement: https://
    id: unirest-http-request
    languages:
    - java
    message: Checks for requests sent via Unirest to http:// URLS. This is dangerous
      because the server is attempting to connect to a website that does not encrypt
      traffic with TLS. Instead, send requests only to https:// URLS.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://kong.github.io/unirest-java/#requests
      subcategory:
      - vuln
      technology:
      - unirest
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: 'Unirest.get("=~/[hH][tT][tT][pP]://.*/")

        '
    - pattern: 'Unirest.post("=~/[hH][tT][tT][pP]://.*/")

        '
    severity: WARNING
- rules:
  - fix-regex:
      count: 1
      regex: '[Hh][Tt][Tt][Pp]://'
      replacement: https://
    id: httpurlconnection-http-request
    languages:
    - java
    message: Detected an HTTP request sent via HttpURLConnection. This could lead
      to sensitive information being sent over an insecure channel. Instead, it is
      recommended to send requests over HTTPS.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URLConnection.html
      - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URL.html#openConnection()
      subcategory:
      - vuln
      technology:
      - java
      vulnerability: Insecure Transport
    patterns:
    - pattern: '"=~/[Hh][Tt][Tt][Pp]://.*/"

        '
    - pattern-either:
      - pattern-inside: 'URL $URL = new URL ("=~/[Hh][Tt][Tt][Pp]://.*/", ...);

          ...

          $CON = (HttpURLConnection) $URL.openConnection(...);

          ...

          $CON.$FUNC(...);

          '
      - pattern-inside: 'URL $URL = new URL ("=~/[Hh][Tt][Tt][Pp]://.*/", ...);

          ...

          $CON = $URL.openConnection(...);

          ...

          $CON.$FUNC(...);

          '
    severity: WARNING
- rules:
  - id: telnet-request
    languages:
    - java
    message: Checks for attempts to connect through telnet. This is insecure as the
      telnet protocol supports no encryption, and data passes through unencrypted.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://commons.apache.org/proper/commons-net/javadocs/api-3.6/org/apache/commons/net/telnet/TelnetClient.html
      subcategory:
      - vuln
      technology:
      - java
      vulnerability: Insecure Transport
    pattern: '$TELNETCLIENT = new TelnetClient(...);

      ...

      $TELNETCLIENT.connect(...);

      '
    severity: WARNING
- rules:
  - id: disallow-old-tls-versions1
    languages:
    - java
    message: Detects direct creations of SSLConnectionSocketFactories that don't disallow
      SSL v2, SSL v3, and TLS v1. SSLSocketFactory can be used to validate the identity
      of the HTTPS server against a list of trusted certificates. These protocols
      are deprecated due to POODLE, man in the middle attacks, and other vulnerabilities.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: HIGH
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://stackoverflow.com/questions/26429751/java-http-clients-and-poodle
      subcategory:
      - vuln
      technology:
      - java
      vulnerability: Insecure Transport
    patterns:
    - pattern: 'new SSLConnectionSocketFactory(...);

        '
    - pattern-not: 'new SSLConnectionSocketFactory(..., new String[] {"TLSv1.2", "TLSv1.3"},
        ...);

        '
    - pattern-not: 'new SSLConnectionSocketFactory(..., new String[] {"TLSv1.3", "TLSv1.2"},
        ...);

        '
    - pattern-not: 'new SSLConnectionSocketFactory(..., new String[] {"TLSv1.3"},
        ...);

        '
    - pattern-not: 'new SSLConnectionSocketFactory(..., new String[] {"TLSv1.2"},
        ...);

        '
    - pattern-not-inside: '(SSLConnectionSocketFactory $SF) = new SSLConnectionSocketFactory(...);
        ... (TlsConfig $TLSCONFIG) = TlsConfig.custom(). ... .setSupportedProtocols(TLS.V_1_2).
        ... .build(); ... HttpClientConnectionManager cm = $CM.create(). ... .setSSLSocketFactory($SF).
        ... .setDefaultTlsConfig($TLSCONFIG). ... .build();

        '
    - pattern-not-inside: '(SSLConnectionSocketFactory $SF) = new SSLConnectionSocketFactory(...);
        ... (TlsConfig $TLSCONFIG) = TlsConfig.custom(). ... .setSupportedProtocols(TLS.V_1_3).
        ... .build(); ... HttpClientConnectionManager cm = $CM.create(). ... .setSSLSocketFactory($SF).
        ... .setDefaultTlsConfig($TLSCONFIG). ... .build();

        '
    severity: WARNING
- rules:
  - fix-regex:
      count: 1
      regex: '[Hh][Tt][Tt][Pp]://'
      replacement: https://
    id: http-components-request
    languages:
    - java
    message: Checks for requests sent via Apache HTTP Components to http:// URLS.
      This is dangerous because the server is attempting to connect to a website that
      does not encrypt traffic with TLS. Instead, send requests only to https:// URLS.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://hc.apache.org/httpcomponents-client-ga/quickstart.html
      subcategory:
      - vuln
      technology:
      - java
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: '$HTTPCLIENT = HttpClients.$CREATE(...);

        ...

        $HTTPREQ = new $HTTPFUNC("=~/[hH][tT][tT][pP]://.*/");

        ...

        $RESPONSE = $HTTPCLIENT.execute($HTTPREQ);

        '
    - pattern: '$HTTPCLIENT = HttpClients.$CREATE(...);

        ...

        $RESPONSE = $HTTPCLIENT.execute(new $HTTPFUNC("=~/[hH][tT][tT][pP]://.*/"));

        '
    severity: WARNING
- rules:
  - fix-regex:
      count: 1
      regex: '[Hh][Tt][Tt][Pp]://'
      replacement: https://
    id: httpget-http-request
    languages:
    - java
    message: Detected an HTTP request sent via HttpGet. This could lead to sensitive
      information being sent  over an insecure channel. Instead, it is recommended
      to send requests over HTTPS.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URLConnection.html
      - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URL.html#openConnection()
      subcategory:
      - vuln
      technology:
      - java
      vulnerability: Insecure Transport
    patterns:
    - pattern: '"=~/[Hh][Tt][Tt][Pp]://.*/"

        '
    - pattern-inside: '$R = new HttpGet("=~/[Hh][Tt][Tt][Pp]://.*/");

        ...

        $CLIENT. ... .execute($R, ...);

        '
    severity: WARNING
- rules:
  - id: tls-renegotiation
    languages:
    - java
    message: Checks for cases where java applications are allowing unsafe renegotiation.
      This leaves the application vulnerable to a man-in-the-middle attack where chosen
      plain text is injected as prefix to a TLS connection.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: LOW
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://www.oracle.com/java/technologies/javase/tlsreadme.html
      subcategory:
      - vuln
      technology:
      - java
      vulnerability: Insecure Transport
    pattern: 'java.lang.System.setProperty("sun.security.ssl.allowUnsafeRenegotiation",
      true);

      '
    severity: WARNING
- rules:
  - id: net-telnet-request
    languages:
    - ruby
    message: Checks for creation of telnet servers or attempts to connect through
      telnet. This is insecure as the telnet protocol supports no encryption, and
      data passes through unencrypted.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://docs.ruby-lang.org/en/2.2.0/Net/Telnet.html
      - https://www.rubydoc.info/gems/net-ssh-telnet2/0.1.0/Net/SSH/Telnet
      subcategory:
      - vuln
      technology:
      - ruby
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: 'Net::Telnet::new(...)

        '
    - pattern: 'Net::SSH::Telnet.new(...)

        '
    severity: WARNING
- rules:
  - id: net-http-request
    languages:
    - ruby
    message: Checks for requests sent to http:// URLs. This is dangerous as the server
      is attempting to connect to a website that does not encrypt traffic with TLS.
      Instead, only send requests to https:// URLs.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://ruby-doc.org/stdlib-2.6.5/libdoc/net/http/rdoc/Net/
      subcategory:
      - vuln
      technology:
      - ruby
      vulnerability: Insecure Transport
    patterns:
    - pattern-either:
      - pattern: '$URI = URI(''=~/[hH][tT][tT][pP]://.*/'')

          ...

          Net::HTTP::$FUNC.new $URI

          '
      - pattern: '$URI = URI(''=~/[hH][tT][tT][pP]://.*/'')

          ...

          Net::HTTP.$FUNC($URI, ...)

          '
      - pattern: 'Net::HTTP.$FUNC(URI(''=~/[hH][tT][tT][pP]://.*/''), ...)

          '
    - metavariable-regex:
        metavariable: $FUNC
        regex: ([gG]et|post_form|[pP]ost|get_response|get_print|Head|Patch|Put|Proppatch|Lock|Unlock|Options|Propfind|Delete|Move|Copy|Trace|Mkcol)
    severity: WARNING
- rules:
  - id: openuri-request
    languages:
    - ruby
    message: Checks for requests to http and ftp (unencrypted) sites using OpenURI.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://ruby-doc.org/stdlib-2.6.3/libdoc/open-uri/rdoc/OpenURI.html
      subcategory:
      - vuln
      technology:
      - open-uri
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: 'URI.open(''=~/[hH][tT][tT][pP]://.*/'', ...)

        '
    - pattern: '$URI = URI.parse(''=~/[hH][tT][tT][pP]://.*/'', ...)

        ...

        $URI.open

        '
    - pattern: 'URI.open(''=~/^[fF][tT][pP]://.*/'', ...)

        '
    - pattern: '$URI = URI.parse(''=~/^[fF][tT][pP]://.*/'', ...)

        ...

        $URI.open

        '
    severity: WARNING
- rules:
  - id: net-ftp-request
    languages:
    - ruby
    message: Checks for outgoing connections to ftp servers with the 'net/ftp' package.
      FTP does not encrypt traffic, possibly leading to PII being sent plaintext over
      the network. Instead, connect via the SFTP protocol.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://docs.ruby-lang.org/en/2.0.0/Net/FTP.html
      subcategory:
      - vuln
      technology:
      - ruby
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: '$FTP = Net::FTP.new(''...'')

        ...

        $FTP.login

        '
    - pattern: "Net::FTP.open('...') do |ftp|\n  ...\n  ftp.login\nend\n"
    severity: WARNING
- rules:
  - id: http-client-requests
    languages:
    - ruby
    message: Checks for requests to http (unencrypted) sites using some of ruby's
      most popular REST/HTTP libraries, including httparty and restclient.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://github.com/rest-client/rest-client
      - https://github.com/jnunemaker/httparty/tree/master/docs
      subcategory:
      - vuln
      technology:
      - httparty
      - rest-client
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: 'HTTParty.$PARTYVERB("=~/[hH][tT][tT][pP]://.*/", ...)

        '
    - pattern: '$STRING = "=~/[hH][tT][tT][pP]://.*/"

        ...

        HTTParty.$PARTYVERB($STRING, ...)

        '
    - pattern: 'RestClient.$RESTVERB "=~/[hH][tT][tT][pP]://.*/", ...

        '
    - pattern: 'RestClient::Request.execute(..., url: "=~/[hH][tT][tT][pP]://.*/",
        ...)

        '
    severity: WARNING
- rules:
  - id: bypass-tls-verification
    languages:
    - java
    message: Checks for redefinitions of functions that check TLS/SSL certificate
      verification. This can lead to vulnerabilities, as simple errors in the code
      can result in lack of proper certificate validation. This should only be used
      for debugging purposes because it leads to vulnerability to MTM attacks.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: HIGH
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://stackoverflow.com/questions/4072585/disabling-ssl-certificate-validation-in-spring-resttemplate
      - https://stackoverflow.com/questions/35530558/how-to-fix-unsafe-implementation-of-x509trustmanager-in-android-app?rq=1
      subcategory:
      - vuln
      technology:
      - spring
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: "new HostnameVerifier() {\n  ...\n  public boolean verify(String hostname,\
        \ SSLSession session) {\n    ...\n  }\n  ...\n};\n"
    - pattern: "public RestTemplate restTemplate() throws KeyStoreException, NoSuchAlgorithmException,\
        \ KeyManagementException {\n  ...\n  TrustStrategy $FUNCNAME = (X509Certificate[]\
        \ chain, String authType) -> ...;\n  ...\n}\n"
    - pattern: "TrustStrategy $FUNCNAME= new TrustStrategy() {\n  ...\n  public boolean\
        \ isTrusted(X509Certificate[] x509Certificates, String s) throws CertificateException\
        \ {\n    ...\n  }\n  ...\n};\n"
    severity: WARNING
- rules:
  - fix-regex:
      count: 1
      regex: '[Hh][Tt][Tt][Pp]://'
      replacement: https://
    id: spring-http-request
    languages:
    - java
    message: Checks for requests sent via Java Spring RestTemplate API to http://
      URLS. This is dangerous because the server is attempting to connect to a website
      that does not encrypt traffic with TLS. Instead, send requests only to https://
      URLS.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#delete-java.lang.String-java.util.Map-
      - https://www.baeldung.com/rest-template
      subcategory:
      - vuln
      technology:
      - spring
      vulnerability: Insecure Transport
    patterns:
    - pattern-either:
      - pattern: '$RESTTEMP = new RestTemplate(...);

          ...

          $RESTTEMP.$FUNC("=~/[hH][tT][tT][pP]://.*/", ...);

          '
      - pattern: '$RESTTEMP = new RestTemplate(...);

          ...

          String $URL = "=~/[hH][tT][tT][pP]://.*/";

          ...

          $RESTTEMP.$FUNC($URL, ...);

          '
      - pattern: '$RESTTEMP = new RestTemplate(...);

          ...

          $URL = new URI(..., "=~/[hH][tT][tT][pP]://.*/", ...);

          ...

          $RESTTEMP.$FUNC($URL, ...);

          '
    - metavariable-regex:
        metavariable: $FUNC
        regex: (delete|doExecute|exchange|getForEntity|getForObject|headForHeaders|optionsForAllow|patchForObject|postForEntity|postForLocation|postForObject|put)
    severity: WARNING
- rules:
  - fix-regex:
      count: 1
      regex: '[fF][tT][pP]://'
      replacement: sftp://
    id: spring-ftp-request
    languages:
    - java
    message: Checks for outgoing connections to ftp servers via Spring plugin ftpSessionFactory.
      FTP does not encrypt traffic, possibly leading to PII being sent plaintext over
      the network.
    metadata:
      category: security
      confidence: MEDIUM
      cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
      impact: MEDIUM
      likelihood: MEDIUM
      owasp: A03:2017 - Sensitive Data Exposure
      references:
      - https://docs.spring.io/spring-integration/api/org/springframework/integration/ftp/session/AbstractFtpSessionFactory.html#setClientMode-int-
      subcategory:
      - vuln
      technology:
      - spring
      vulnerability: Insecure Transport
    pattern-either:
    - pattern: '$SF = new DefaultFtpSessionFactory(...);

        ...

        $SF.setHost("=~/^[fF][tT][pP]://.*/");

        ...

        $SF.$FUNC(...);

        '
    - pattern: '$SF = new DefaultFtpSessionFactory(...);

        ...

        String $URL = "=~/^[fF][tT][pP]://.*/";

        ...

        $SF.setHost($URL);

        ...

        $SF.$FUNC(...);

        '
    severity: WARNING
